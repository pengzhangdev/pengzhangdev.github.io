{
    "docs": [
        {
            "location": "/", 
            "text": "\u6b22\u8fce\n\n\n\u672c\u7ad9\u867d\u7136\u53d6\u540d\u4e3a\u4e07\u5377\u8305\u5c4b, \u4f46\u5e76\u4e0d\u662f\u4e00\u4e2a\u5728\u7ebf\u9605\u8bfb\u7f51\u7ad9\u6216\u8005\u4e00\u4e2a\u8d2d\u4e66\u7f51\u7ad9. \u5176\u4e07\u5377\u53d6\u81ea\n\u8bfb\u4e66\u7834\u4e07\u5377\n, \u4e43\u662f\u5bf9\u81ea\u6211\u7684\u6fc0\u52b1.\n\u5728\u672a\u6765\u7684\u9053\u8def\u4e0a\u80fd\u591f\u4e00\u76f4\u4fdd\u6301\u9605\u8bfb, \u505a\u4e00\u4e2a\u7ec8\u8eab\u5b66\u4e60\u8005.\n\n\n\u4f5c\u8005\u672c\u4eba\u662fIT\u884c\u4e1a\u7684\u8f6f\u4ef6\u5de5\u7a0b\u5e08, \u4f46\u662f\u4e2a\u4eba\u671f\u671b\u6240\u9605\u8bfb\u7684\u4e66\u4e0d\u53ea\u662f\u6280\u672f\u76f8\u5173, \u8be5\u7f51\u7ad9\u8bb0\u8f7d\u7684\u4e5f\u5e76\u4e0d\u662f\u4ec5\u4ec5\u6280\u672f\u7b14\u8bb0.\n\n\n\u5bf9\u4e8e\u6280\u672f\u4ee5\u5916\u7684\u4e66\u7c4d, \u4e2a\u4eba\u504f\u7231\u4e8e\u5386\u53f2(\u7279\u522b\u662f\u4e2d\u56fd\u5386\u53f2)\u7c7b\u4e66\u7c4d\u548c\u63a2\u6848\u7c7b\u4e66\u7c4d. \u4e0b\u9762\u8c08\u8c08\u4e2a\u4eba\u5bf9\u8fd9\u4e24\u7c7b\u4e66\u7c4d\u7684\u4e00\u4e9b\u770b\u6cd5.\n\n\n\u5bf9\u4e8e\u5386\u53f2\u7c7b, \u504f\u7231\u4e2d\u56fd\u5386\u53f2\u7684\u539f\u56e0, \u5c31\u662f\u56e0\u4e3a\u4f5c\u8005\u672c\u4eba\u662f\u4e2d\u56fd\u4eba. \u5148\u8bf4\u8bf4, \u4e0d\u600e\u4e48\u5f85\u89c1\u897f\u65b9\u53f2\u7684\u539f\u56e0\u5427, \u8bb0\u4e0d\u4f4f\u90a3\u4e9b\u4eba\u7269\u7684\u540d\u5b57\u554a(\u76f8\u4fe1\u5f88\u591a\u8bfb\u8005\u8ddf\u4f5c\u8005\u4e00\u6837\u65e0\u6cd5\u8bb0\u4f4f\u897f\u65b9\u4eba\u7684\u540d\u5b57, \u7279\u522b\u662f\u97f3\u8bd1\u540e\u7684\u540d\u5b57). \u672c\u4eba\u662f\u57fa\u7763\u5f92, \u6240\u4ee5\u5bf9\u4e8e\u897f\u65b9\u5386\u53f2\u5012\u662f\u6ca1\u6709\u4efb\u4f55\u504f\u89c1, \u5404\u79cd\u8457\u540d\u7684\u4e8b\u4ef6\u90fd\u77e5\u9053\u4e2a\u5927\u6982, \u7136\u800c\u522b\u95ee\u4e3b\u89d2\u540d\u5b57, \u522b\u95ee\u4e8b\u4ef6\u540d\u5b57, \u522b\u95ee\u5730\u70b9\u540d\u5b57, \u4e00\u6982\u8bb0\u4e0d\u4f4f(\u7528\u4f5c\u8005\u5bb6\u653f\u59d4\u7684\u8bdd\u8bf4, \u8fd9\u662f1\u79d2\u8bb0\u5fc6\u554a). \u8fa3\u4e48, \u4e2d\u56fd\u53e4\u65f6\u5019\u7684\u5386\u53f2\u662f\u4e0d\u662f\u4e00\u5b9a\u90fd\u8bb0\u5f97\u4f4f\u5462?\n\u4e5f\u4e0d\u662f(\u624b\u52a8\u6d41\u6c57). \u4e3e\u4e2a\u7b80\u5355\u4f8b\u5b50\u5427, \u5eb7\u96cd\u4e7e\u4e09\u4e2a\u7687\u5e1d\u7684\u540d\u5b57(\u5bf9\u4e0d\u8d77, \u8bb0\u4e0d\u4f4f), \u5148\u540e\u987a\u5e8f, \u548c\u76db\u4e16\u540d\u5b57, \u4ee5\u4e0a\u90fd\u8bb0\u4e0d\u4f4f.\u4f46\u662f\u554a, \u6c49\u5510\u5b8b\u7684\u5386\u53f2\u57fa\u672c\u8bb0\u5f97. \u603b\u7ed3\u4e00\u53e5\u8bdd\u5c31\u662f, \u6c49\u4eba\u7684\u5386\u53f2\u80fd\u8bb0\u5f97.\n\n\n\u5bf9\u4e8e\u63a2\u6848\u7c7b, \u4e2a\u4eba\u504f\u7231\u65e5\u672c\u7684(\u5fc5\u987b\u70b9\u9898\u4e1c\u91ce).\u4e0d\u7ba1\u662f\u5c0f\u8bf4, \u7535\u89c6\u5267, \u63a2\u6848\u7c7b\u7684\u65e5\u672c\u603b\u662f\u62cd\u7684\u5f88\u597d. \u5e94\u8be5\u8bf4, \u5728\u6c1b\u56f4\u628a\u6211\u4e0a, \u65e5\u672c\u5728\u8fd9\u5757\u6bd4\u8f83\u7cbe\u901a\u5427. \u4ece\u5c0f\u8bf4\u7684\u60ac\u7591\u548c\u5f15\u4eba\u5165\u80dc, \u4ece\u7535\u89c6\u5267\u7684\u80cc\u666f\u97f3\u4e50, \u573a\u666f\u6e32\u67d3, \u90fd\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e9b\u6280\u672f. \u5f53\u7136, \u56fd\u5185\u7684\u60ac\u7591\u5c0f\u8bf4, \u897f\u65b9\u7684\u963f\u838e\u52a0, \u798f\u5c14\u6469\u65af, \u4e5f\u90fd\u7231. \u63d0\u5230\u798f\u5c14\u6469\u65af, \u4e0d\u5f97\u4e0d\u63a8\u4e00\u4e0bBBC\u7684\u8150\u5c14\u83ab\u65af(\u590f\u6d1b\u514b\u7cfb\u5217), \u8fd8\u6709\u7f8e\u5267\u7684\u5973\u7248\u798f\u5c14\u6469\u65af, \u6700\u540e\u9a6c\u4e0a\u5c31\u4e0a\u7684\u65e5\u5267\u7684\u5973\u7248\u798f\u5c14\u6469\u65af\u548c\u5973\u7248\u534e\u751f.\n\n\n\u7f51\u7ad9\u5bfc\u822a\n\n\n\u4e0a\u9762\u7684\u5927\u5bfc\u822a\u680f\u5206\u522b\u6307\u5411\u4e0d\u540c\u7684\u6587\u7ae0\u5206\u7c7b(\u7b14\u8bb0\u5206\u7c7b), \u5b58\u6863\u680f\u5219\u5305\u542b\u672c\u7ad9\u6240\u6709\u6587\u7ae0, \u4e14\u6587\u7ae0\u6309\u7167\u53d1\u8868\u65f6\u95f4\u5012\u53d9.\n\u6587\u7ae0\u9875\u9762\u7684\u5de6\u4fa7\u4e3a\u8be5\u5927\u680f\u76ee\u4e0b\u7684\u6587\u7ae0\u540d\u5b57\u5217\u8868, \u53f3\u4fa7\u4e3a\u8be5\u7bc7\u6587\u7ae0\u7684\u76ee\u5f55.\n\n\n\u5173\u4e8e\u672c\u7ad9\n\n\n\u672c\u7ad9\u662f\u5efa\u5728coding\u548cgithub\u4e0a, \u5185\u5bb9\u662f\u81ea\u5efa\u7684leanote\u7b14\u8bb0\u5bfc\u51fa(\u5176\u5b9e\u90fd\u662fmarkdown, \u590d\u5236\u9ecf\u8d34). \u5efa\u7ad9\u5de5\u5177\u662fmkdocs, \u7136\u540e\u7528\u4e86\nsquidfunk/mkdocs-material\n, \u611f\u5174\u8da3\u53ef\u4ee5\u5728dockerhub\u4e0a\u641c\u7d22\u4e0b.\n\n\n\u5e0c\u671b\u8fd9\u4e2a\u7f51\u7ad9\u80fd\u4e00\u76f4\u5b58\u5728, \u4ee5\u540e\u8001\u4e86\u540e\u80fd\u4f5c\u4e3a\u56de\u5fc6\u5427. \u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a, \u540c\u65f6\u5e0c\u671bcoding\u80fd\u4e00\u76f4\u5b58\u5728, github\u4e5f\u4e00\u76f4\u5728, \u6211\u7684vps\u80fd\u4e00\u76f4\u5728, leanote\u80fd\u4e00\u76f4\u5728, github\u80fd\u4e00\u76f4\u5728. \u6211\u662f\u4e00\u4e2a\u6000\u65e7\u7684\u4eba, \u5e0c\u671b\u8eab\u8fb9\u7684\u4e00\u5207\u90fd\u5728, \u5e0c\u671b\u8eab\u8fb9\u7684\u4e00\u5207\u90fd\u80fd\u8bb0\u5f55\u5728\u8fd9\u4e2a\u7ad9\u70b9\u4e0a.\n\n\n\u611f\u6069\n\n\n\u6000\u7740\u4e00\u9897\u611f\u6069\u7684\u5fc3\u9605\u8bfb\u8fd9\u4e2a\u4e16\u754c\u5e76\u8bb0\u5f55, \u4e0d\u7ba1\u751f\u6d3b\u5982\u4f55, \u5e0c\u671b\u6211\u4eec\u80fd\u4e00\u76f4\u8d70\u4e0b\u53bb.\n\n\n\u5386\u53f2\n\n\n\n\n2018\u5e743\u6708: \u65b0\u5efa\u8be5\u7ad9. \u5f00\u59cb\u9010\u6e10\u5c06leanote\u4e0a\u7684\u7b14\u8bb0\u548c\u8d44\u6599\u8f6c\u79fb\u5230\u8be5\u7ad9\u70b9.", 
            "title": "\u4e07\u5377\u8305\u5c4b"
        }, 
        {
            "location": "/#_1", 
            "text": "\u672c\u7ad9\u867d\u7136\u53d6\u540d\u4e3a\u4e07\u5377\u8305\u5c4b, \u4f46\u5e76\u4e0d\u662f\u4e00\u4e2a\u5728\u7ebf\u9605\u8bfb\u7f51\u7ad9\u6216\u8005\u4e00\u4e2a\u8d2d\u4e66\u7f51\u7ad9. \u5176\u4e07\u5377\u53d6\u81ea \u8bfb\u4e66\u7834\u4e07\u5377 , \u4e43\u662f\u5bf9\u81ea\u6211\u7684\u6fc0\u52b1.\n\u5728\u672a\u6765\u7684\u9053\u8def\u4e0a\u80fd\u591f\u4e00\u76f4\u4fdd\u6301\u9605\u8bfb, \u505a\u4e00\u4e2a\u7ec8\u8eab\u5b66\u4e60\u8005.  \u4f5c\u8005\u672c\u4eba\u662fIT\u884c\u4e1a\u7684\u8f6f\u4ef6\u5de5\u7a0b\u5e08, \u4f46\u662f\u4e2a\u4eba\u671f\u671b\u6240\u9605\u8bfb\u7684\u4e66\u4e0d\u53ea\u662f\u6280\u672f\u76f8\u5173, \u8be5\u7f51\u7ad9\u8bb0\u8f7d\u7684\u4e5f\u5e76\u4e0d\u662f\u4ec5\u4ec5\u6280\u672f\u7b14\u8bb0.  \u5bf9\u4e8e\u6280\u672f\u4ee5\u5916\u7684\u4e66\u7c4d, \u4e2a\u4eba\u504f\u7231\u4e8e\u5386\u53f2(\u7279\u522b\u662f\u4e2d\u56fd\u5386\u53f2)\u7c7b\u4e66\u7c4d\u548c\u63a2\u6848\u7c7b\u4e66\u7c4d. \u4e0b\u9762\u8c08\u8c08\u4e2a\u4eba\u5bf9\u8fd9\u4e24\u7c7b\u4e66\u7c4d\u7684\u4e00\u4e9b\u770b\u6cd5.  \u5bf9\u4e8e\u5386\u53f2\u7c7b, \u504f\u7231\u4e2d\u56fd\u5386\u53f2\u7684\u539f\u56e0, \u5c31\u662f\u56e0\u4e3a\u4f5c\u8005\u672c\u4eba\u662f\u4e2d\u56fd\u4eba. \u5148\u8bf4\u8bf4, \u4e0d\u600e\u4e48\u5f85\u89c1\u897f\u65b9\u53f2\u7684\u539f\u56e0\u5427, \u8bb0\u4e0d\u4f4f\u90a3\u4e9b\u4eba\u7269\u7684\u540d\u5b57\u554a(\u76f8\u4fe1\u5f88\u591a\u8bfb\u8005\u8ddf\u4f5c\u8005\u4e00\u6837\u65e0\u6cd5\u8bb0\u4f4f\u897f\u65b9\u4eba\u7684\u540d\u5b57, \u7279\u522b\u662f\u97f3\u8bd1\u540e\u7684\u540d\u5b57). \u672c\u4eba\u662f\u57fa\u7763\u5f92, \u6240\u4ee5\u5bf9\u4e8e\u897f\u65b9\u5386\u53f2\u5012\u662f\u6ca1\u6709\u4efb\u4f55\u504f\u89c1, \u5404\u79cd\u8457\u540d\u7684\u4e8b\u4ef6\u90fd\u77e5\u9053\u4e2a\u5927\u6982, \u7136\u800c\u522b\u95ee\u4e3b\u89d2\u540d\u5b57, \u522b\u95ee\u4e8b\u4ef6\u540d\u5b57, \u522b\u95ee\u5730\u70b9\u540d\u5b57, \u4e00\u6982\u8bb0\u4e0d\u4f4f(\u7528\u4f5c\u8005\u5bb6\u653f\u59d4\u7684\u8bdd\u8bf4, \u8fd9\u662f1\u79d2\u8bb0\u5fc6\u554a). \u8fa3\u4e48, \u4e2d\u56fd\u53e4\u65f6\u5019\u7684\u5386\u53f2\u662f\u4e0d\u662f\u4e00\u5b9a\u90fd\u8bb0\u5f97\u4f4f\u5462?\n\u4e5f\u4e0d\u662f(\u624b\u52a8\u6d41\u6c57). \u4e3e\u4e2a\u7b80\u5355\u4f8b\u5b50\u5427, \u5eb7\u96cd\u4e7e\u4e09\u4e2a\u7687\u5e1d\u7684\u540d\u5b57(\u5bf9\u4e0d\u8d77, \u8bb0\u4e0d\u4f4f), \u5148\u540e\u987a\u5e8f, \u548c\u76db\u4e16\u540d\u5b57, \u4ee5\u4e0a\u90fd\u8bb0\u4e0d\u4f4f.\u4f46\u662f\u554a, \u6c49\u5510\u5b8b\u7684\u5386\u53f2\u57fa\u672c\u8bb0\u5f97. \u603b\u7ed3\u4e00\u53e5\u8bdd\u5c31\u662f, \u6c49\u4eba\u7684\u5386\u53f2\u80fd\u8bb0\u5f97.  \u5bf9\u4e8e\u63a2\u6848\u7c7b, \u4e2a\u4eba\u504f\u7231\u65e5\u672c\u7684(\u5fc5\u987b\u70b9\u9898\u4e1c\u91ce).\u4e0d\u7ba1\u662f\u5c0f\u8bf4, \u7535\u89c6\u5267, \u63a2\u6848\u7c7b\u7684\u65e5\u672c\u603b\u662f\u62cd\u7684\u5f88\u597d. \u5e94\u8be5\u8bf4, \u5728\u6c1b\u56f4\u628a\u6211\u4e0a, \u65e5\u672c\u5728\u8fd9\u5757\u6bd4\u8f83\u7cbe\u901a\u5427. \u4ece\u5c0f\u8bf4\u7684\u60ac\u7591\u548c\u5f15\u4eba\u5165\u80dc, \u4ece\u7535\u89c6\u5267\u7684\u80cc\u666f\u97f3\u4e50, \u573a\u666f\u6e32\u67d3, \u90fd\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e9b\u6280\u672f. \u5f53\u7136, \u56fd\u5185\u7684\u60ac\u7591\u5c0f\u8bf4, \u897f\u65b9\u7684\u963f\u838e\u52a0, \u798f\u5c14\u6469\u65af, \u4e5f\u90fd\u7231. \u63d0\u5230\u798f\u5c14\u6469\u65af, \u4e0d\u5f97\u4e0d\u63a8\u4e00\u4e0bBBC\u7684\u8150\u5c14\u83ab\u65af(\u590f\u6d1b\u514b\u7cfb\u5217), \u8fd8\u6709\u7f8e\u5267\u7684\u5973\u7248\u798f\u5c14\u6469\u65af, \u6700\u540e\u9a6c\u4e0a\u5c31\u4e0a\u7684\u65e5\u5267\u7684\u5973\u7248\u798f\u5c14\u6469\u65af\u548c\u5973\u7248\u534e\u751f.", 
            "title": "\u6b22\u8fce"
        }, 
        {
            "location": "/#_2", 
            "text": "\u4e0a\u9762\u7684\u5927\u5bfc\u822a\u680f\u5206\u522b\u6307\u5411\u4e0d\u540c\u7684\u6587\u7ae0\u5206\u7c7b(\u7b14\u8bb0\u5206\u7c7b), \u5b58\u6863\u680f\u5219\u5305\u542b\u672c\u7ad9\u6240\u6709\u6587\u7ae0, \u4e14\u6587\u7ae0\u6309\u7167\u53d1\u8868\u65f6\u95f4\u5012\u53d9.\n\u6587\u7ae0\u9875\u9762\u7684\u5de6\u4fa7\u4e3a\u8be5\u5927\u680f\u76ee\u4e0b\u7684\u6587\u7ae0\u540d\u5b57\u5217\u8868, \u53f3\u4fa7\u4e3a\u8be5\u7bc7\u6587\u7ae0\u7684\u76ee\u5f55.", 
            "title": "\u7f51\u7ad9\u5bfc\u822a"
        }, 
        {
            "location": "/#_3", 
            "text": "\u672c\u7ad9\u662f\u5efa\u5728coding\u548cgithub\u4e0a, \u5185\u5bb9\u662f\u81ea\u5efa\u7684leanote\u7b14\u8bb0\u5bfc\u51fa(\u5176\u5b9e\u90fd\u662fmarkdown, \u590d\u5236\u9ecf\u8d34). \u5efa\u7ad9\u5de5\u5177\u662fmkdocs, \u7136\u540e\u7528\u4e86 squidfunk/mkdocs-material , \u611f\u5174\u8da3\u53ef\u4ee5\u5728dockerhub\u4e0a\u641c\u7d22\u4e0b.  \u5e0c\u671b\u8fd9\u4e2a\u7f51\u7ad9\u80fd\u4e00\u76f4\u5b58\u5728, \u4ee5\u540e\u8001\u4e86\u540e\u80fd\u4f5c\u4e3a\u56de\u5fc6\u5427. \u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a, \u540c\u65f6\u5e0c\u671bcoding\u80fd\u4e00\u76f4\u5b58\u5728, github\u4e5f\u4e00\u76f4\u5728, \u6211\u7684vps\u80fd\u4e00\u76f4\u5728, leanote\u80fd\u4e00\u76f4\u5728, github\u80fd\u4e00\u76f4\u5728. \u6211\u662f\u4e00\u4e2a\u6000\u65e7\u7684\u4eba, \u5e0c\u671b\u8eab\u8fb9\u7684\u4e00\u5207\u90fd\u5728, \u5e0c\u671b\u8eab\u8fb9\u7684\u4e00\u5207\u90fd\u80fd\u8bb0\u5f55\u5728\u8fd9\u4e2a\u7ad9\u70b9\u4e0a.", 
            "title": "\u5173\u4e8e\u672c\u7ad9"
        }, 
        {
            "location": "/#_4", 
            "text": "\u6000\u7740\u4e00\u9897\u611f\u6069\u7684\u5fc3\u9605\u8bfb\u8fd9\u4e2a\u4e16\u754c\u5e76\u8bb0\u5f55, \u4e0d\u7ba1\u751f\u6d3b\u5982\u4f55, \u5e0c\u671b\u6211\u4eec\u80fd\u4e00\u76f4\u8d70\u4e0b\u53bb.", 
            "title": "\u611f\u6069"
        }, 
        {
            "location": "/#_5", 
            "text": "2018\u5e743\u6708: \u65b0\u5efa\u8be5\u7ad9. \u5f00\u59cb\u9010\u6e10\u5c06leanote\u4e0a\u7684\u7b14\u8bb0\u548c\u8d44\u6599\u8f6c\u79fb\u5230\u8be5\u7ad9\u70b9.", 
            "title": "\u5386\u53f2"
        }, 
        {
            "location": "/about/", 
            "text": "\u672c\u4eba\u7b80\u4ecb\n\n\n\u8003\u8651\u548c\u597d\u4e45, \u8fd8\u662f\u51b3\u5b9a\u4f7f\u7528\u82f1\u6587\u540d\u5b57\u5427. \u719f\u6089\u6211\u7684\u4eba, \u4e5f\u731c\u5f97\u51fa\u6765.\n\n\n\u82f1\u6587\u540d\u5b57: Werther Zhang\n\n\n\u672c\u4eba\u8f6f\u4ef6\u5de5\u7a0b\u5e08, \u6df7\u8ff9\u4e0a\u6d77, \u7b97\u4e0a\u6f02\u8fd8\u662f\u6d77\u6f02\u5462?(--.) \u53cd\u6b63\u5c31\u662f\u5404\u79cd\u52aa\u529b\u8ba9\u81ea\u5df1\u5728\u4e0a\u6d77\u6d3b\u4e0b\u6765.\n\n\n\u6309\u5bb6\u91cc\u653f\u59d4\u5bf9\u6211\u7684\u8bc4\u4ef7, 1s\u8bb0\u5fc6, \u50cf\u4e2a\u50bb\u5b50, \u53ef\u7231, \u8bdd\u5520.\n\n\n\u4f46\u662f\u561b, \u5982\u679c\u662f\u5468\u56f4\u4eba\u7684\u8bc4\u4ef7\u662f, \u6c89\u9ed8, \u5185\u5411.\n\n\n\u4e00\u76f4\u5411\u7740\u8d22\u52a1\u81ea\u7531\u800c\u594b\u6597, \u54c8\u54c8\u54c8.\n\n\n\u672c\u7ad9\u7b80\u4ecb\n\n\n\u5728\u8fd9\u4e2a\u7ad9\u4e4b\u524d, \u6797\u6797\u603b\u603b\u5df2\u7ecf\u5b58\u5728\u597d\u51e0\u4e2a\u4e86, \u8fd9\u662f\u7b2c\u4e00\u4e2a\u771f\u771f\u6b63\u6b63\u51b3\u5b9a\u6301\u7eed\u4e0d\u65ad\u5730\u505a\u4e0b\u53bb, \u505a\u4e00\u8f88\u5b50. \u53ef\u80fd\u57df\u540d\u4f1a\u6539\u53d8(\u5982\u679ccoding\u6216\u8005github\u5012\u4e86), \u4f46\u662f\u5185\u5bb9\u4f1a\u4e00\u76f4\u6301\u7eed. \u76ee\u524d\u7684\u5730\u5740\u4e3a \ngithub\n \u548c \ncoding\n, \u672a\u6765\u53ef\u80fd\u4f1a\u589e\u52a0.\u53ef\u80fd\u6709\u4eba\u4f1a\u95ee, \u4e3a\u4ec0\u4e48\u4e0d\u81ea\u5df1\u4e70\u4e00\u4e2a. \u4f1a\u4e70\u7684, \u4f46\u662f\u8fd9\u4e2a\u5c31\u4f53\u73b0\u4e2a\u4eba\u6027\u683c\u4e86, \u9e21\u86cb\u4e0d\u653e\u5728\u4e00\u4e2a\u7bee\u5b50\u91cc, \u4e0d\u7ba1\u662fvps\u8fd8\u662f\u4ec0\u4e48, \u90fd\u4e0d\u77e5\u9053\u662f\u5426\u80fd\u5b58\u5728\u4e00\u8f88\u5b50, \u65e2\u7136\u6211\u662f\u8ba4\u771f\u5728\u505a\u8fd9\u4ef6\u4e8b, \u90a3\u4e48\u5c31\u5f97\u8003\u8651\u672a\u6765\u5b83\u4eec\u5012\u95ed\u7684\u60c5\u51b5.\n\n\n\u8865\u5145\u70b9: coding\u7531\u4e8e\u514d\u8d39\u53ea\u6709250M, \u6240\u4ee5, \u56fe\u7247\u8fd9\u4e9b\u4f1a\u5c3d\u53ef\u80fd\u653e\u5728github\u4e0a, \u4ececoding\u53bb\u5f15\u7528. \u5e0c\u671bgithub\u522b\u88ab\u5899\u4e86.", 
            "title": "\u5173\u4e8e"
        }, 
        {
            "location": "/about/#_1", 
            "text": "\u8003\u8651\u548c\u597d\u4e45, \u8fd8\u662f\u51b3\u5b9a\u4f7f\u7528\u82f1\u6587\u540d\u5b57\u5427. \u719f\u6089\u6211\u7684\u4eba, \u4e5f\u731c\u5f97\u51fa\u6765.  \u82f1\u6587\u540d\u5b57: Werther Zhang  \u672c\u4eba\u8f6f\u4ef6\u5de5\u7a0b\u5e08, \u6df7\u8ff9\u4e0a\u6d77, \u7b97\u4e0a\u6f02\u8fd8\u662f\u6d77\u6f02\u5462?(--.) \u53cd\u6b63\u5c31\u662f\u5404\u79cd\u52aa\u529b\u8ba9\u81ea\u5df1\u5728\u4e0a\u6d77\u6d3b\u4e0b\u6765.  \u6309\u5bb6\u91cc\u653f\u59d4\u5bf9\u6211\u7684\u8bc4\u4ef7, 1s\u8bb0\u5fc6, \u50cf\u4e2a\u50bb\u5b50, \u53ef\u7231, \u8bdd\u5520.  \u4f46\u662f\u561b, \u5982\u679c\u662f\u5468\u56f4\u4eba\u7684\u8bc4\u4ef7\u662f, \u6c89\u9ed8, \u5185\u5411.  \u4e00\u76f4\u5411\u7740\u8d22\u52a1\u81ea\u7531\u800c\u594b\u6597, \u54c8\u54c8\u54c8.", 
            "title": "\u672c\u4eba\u7b80\u4ecb"
        }, 
        {
            "location": "/about/#_2", 
            "text": "\u5728\u8fd9\u4e2a\u7ad9\u4e4b\u524d, \u6797\u6797\u603b\u603b\u5df2\u7ecf\u5b58\u5728\u597d\u51e0\u4e2a\u4e86, \u8fd9\u662f\u7b2c\u4e00\u4e2a\u771f\u771f\u6b63\u6b63\u51b3\u5b9a\u6301\u7eed\u4e0d\u65ad\u5730\u505a\u4e0b\u53bb, \u505a\u4e00\u8f88\u5b50. \u53ef\u80fd\u57df\u540d\u4f1a\u6539\u53d8(\u5982\u679ccoding\u6216\u8005github\u5012\u4e86), \u4f46\u662f\u5185\u5bb9\u4f1a\u4e00\u76f4\u6301\u7eed. \u76ee\u524d\u7684\u5730\u5740\u4e3a  github  \u548c  coding , \u672a\u6765\u53ef\u80fd\u4f1a\u589e\u52a0.\u53ef\u80fd\u6709\u4eba\u4f1a\u95ee, \u4e3a\u4ec0\u4e48\u4e0d\u81ea\u5df1\u4e70\u4e00\u4e2a. \u4f1a\u4e70\u7684, \u4f46\u662f\u8fd9\u4e2a\u5c31\u4f53\u73b0\u4e2a\u4eba\u6027\u683c\u4e86, \u9e21\u86cb\u4e0d\u653e\u5728\u4e00\u4e2a\u7bee\u5b50\u91cc, \u4e0d\u7ba1\u662fvps\u8fd8\u662f\u4ec0\u4e48, \u90fd\u4e0d\u77e5\u9053\u662f\u5426\u80fd\u5b58\u5728\u4e00\u8f88\u5b50, \u65e2\u7136\u6211\u662f\u8ba4\u771f\u5728\u505a\u8fd9\u4ef6\u4e8b, \u90a3\u4e48\u5c31\u5f97\u8003\u8651\u672a\u6765\u5b83\u4eec\u5012\u95ed\u7684\u60c5\u51b5.  \u8865\u5145\u70b9: coding\u7531\u4e8e\u514d\u8d39\u53ea\u6709250M, \u6240\u4ee5, \u56fe\u7247\u8fd9\u4e9b\u4f1a\u5c3d\u53ef\u80fd\u653e\u5728github\u4e0a, \u4ececoding\u53bb\u5f15\u7528. \u5e0c\u671bgithub\u522b\u88ab\u5899\u4e86.", 
            "title": "\u672c\u7ad9\u7b80\u4ecb"
        }, 
        {
            "location": "/zram/", 
            "text": "\u6765\u6e90: https://pengzhangdev.github.io/zram/\n\n\n\u7b80\u4ecb\n\n\n\u5728linux\u5185\u6838\u7684mm\u5b50\u7cfb\u7edf\u4e2d, \u5305\u542b\u4e09\u4e2a\u652f\u6301\u5185\u5b58\u538b\u7f29\u7684\u7ec4\u4ef6, \u5206\u522b\u662fzram, zcache \u548c zswap.\n\n\n\nzswap\n: \u524d\u63d0\u6761\u4ef6\u662f, \u7cfb\u7edf\u4e2d\u5b58\u5728swap\u8bbe\u5907, \u5185\u6838\u7248\u672c\n3.5, \u56e0\u4e3a\u4f9d\u8d56\u4e86frontswap\u7684\u63a5\u53e3, \u7528\u4e8e\u7ba1\u7406swap page.\nzswap\u662f\u4e00\u4e2a\u8f7b\u91cf\u5316\u7684\u540e\u7aef\u67b6\u6784, \u5c06\u8fdb\u7a0b\u5404\u79cd\u4ea4\u6362\u51fa\u7684\u9875\u9762\u8fdb\u884c\u538b\u7f29, \u5e76\u5b58\u50a8\u5728\u4e00\u4e2a\u57fa\u4e8eRAM\u7684\u5185\u7f13\u51b2\u6c60\u4e2d. \u7f13\u51b2\u6c60\u4e0d\u9884\u5206\u914d, \u6709\u6700\u5927\u503c, \u4e14\u5f53\u7f13\u51b2\u6c60\u6ee1\u4e86, LRU\u7684\u5185\u5b58\u9875\u4f1a\u88ab\u5199\u5165swap\u8bbe\u5907. \u4f9d\u8d56swap\u5206\u533a, \u4e0d\u9002\u7528hdtv.\n\n\n\nzcache\n: \u4e0ezswap\u7c7b\u4f3c, \u4f9d\u8d56frontswap\u63a5\u53e3\u548ccleacache\u63a5\u53e3, \u5185\u6838\u7248\u672c\n3.5. \u4e0ezswap\u4e00\u6837, \u5c06\u8fdb\u7a0b\u4ea4\u6362\u51fa\u7684\u9875\u9762\u548c\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u51b2\u8fdb\u884c\u538b\u7f29\u5e76\u5b58\u50a8\u5728RAM\u7684\u5185\u5b58\u7f13\u51b2\u6c60\u4e2d, \u5728\u7f13\u51b2\u6c60\u6ee1\u540e, \u5c06\u9875\u9762\u5b58\u5165swap\u5206\u533a\u6216\u8005 RAMster (\u4e00\u79cd\u57fa\u4e8e\u7f51\u7edc\u7684\u5185\u5b58\u6c60\u5171\u4eab\u6280\u672f, \u53ef\u4ee5\u5171\u4eab\u7f51\u7edc\u4e2d\u5176\u4f59\u786c\u4ef6\u7684\u5185\u5b58). zswap\u53ef\u4ee5\u7406\u89e3\u4e3a\u662fzcache\u7684\u5b50\u96c6. \u4e0d\u9002\u7528hdtv.\n\n\n\nzram\n: \u5185\u5b58\u4e2d\u7684swap\u8bbe\u5907, \u5185\u6838\n3.14, \u53ef\u4ee5\u7406\u89e3\u4e3azcache\u7684RAM\u7f13\u51b2\u6c60. \u4f18\u5148\u7ea7\u6700\u9ad8, \u4e0d\u5efa\u8bae\u4e0e\u5176\u4ed6swap\u4e00\u8d77\u4f7f\u7528.\u4e0d\u4f9d\u8d56\u771f\u5b9e\u7684swap\u8bbe\u5907(Nand\u6216\u8005\u7f51\u7edc), \u503e\u5411\u4e8e\u5728\u4f4e\u5185\u5b58\u7684\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e2d\u4f7f\u7528.\n\n\n\n\u7efc\u4e0a, zram\u66f4\u9002\u5408hdtv\u8fd9\u4e2a\u9879\u76ee\n\n\n zram \n\n\nzram\u662f\u5c06\u7cfb\u7edf\u4e2d\u7684\u5185\u5b58\u7684\u4e00\u90e8\u5206\u5185\u5b58\u9694\u79bb\u6210zram\u8bbe\u5907(swap\u8bbe\u5907),\u5bf9\u4e8e\u5c0f\u5185\u5b58\u7684\u8bbe\u5907, \u5728\u4f7f\u7528\u4e0a\u4f1a\u611f\u5185\u5b58\u88ab\u6269\u5927\u4e86.\n\n\nlinux\u5185\u6838\u4e2d\u4e3azram\u63d0\u4f9b\u4e86\u5404\u79cd\u538b\u7f29\u7b97\u6cd5, \u9ed8\u8ba4\u7684\u662fLZO, \u8be5\u7b97\u6cd5\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u80fd\u5f88\u597d\u5730\u5e73\u8861\u538b\u7f29\u7387\u548c\u901f\u5ea6. LZO\u4e3b\u8981\u662f\u5728\u901f\u5ea6\u4e0a\u4f18\u5316.\u5728\u4e00\u4e9b\u6bd4\u8f83\u6b63\u5f0f\u7684\u6587\u6863\u4e0a, LZO\u7684\u538b\u7f29\u7387\u5e73\u5747\u4e3a50%. \u4e0b\u9762\u662f\u9488\u5bf9\u5185\u6838\u6e90\u7801(50.6M)\u538b\u7f29\u7684\u4e00\u4e2a\u56fe\u8868, \u7f51\u4e0a\u63d0\u4f9b\u7684.\n\n\nlzop\n:\n \n1.62\n \nseconds\n \nto\n \ncompress\n,\n \n18.0\n \nMB\n,\n \nratio\n=.\n355\n\n\ngzip\n:\n \n19.13\n \nseconds\n,\n \n10.8\n \nMB\n,\n \nratio\n=.\n213\n\n\nbzip2\n:\n \n60.81\n \nseconds\n,\n \n8.46\n \nMB\n,\n \nratio\n=.\n176\n\n\nxz\n:\n \n311.65\n \nseconds\n,\n \n7.33\n \nMB\n,\n \nratio\n=.\n145\n\n\n\n\n\n\n\n\n\u538b\u7f29\u7387\u8ba1\u7b97:\n\u76f8\u5173\u6570\u636e/sys/block/zram0/{\nmem_used_total\n,\norig_data_size\n,\ncompr_data_size\n}\n\n\ncompression radio = orig_data_size / compr_data_size\nreal compr. ratio  = orig_data_size / mem_used_total\n\n\n\n\n\n\n\n\u4f18\u70b9\n\n\n\n\n\u5185\u5b58\u6269\u5927, \u5e73\u5747\u538b\u7f29\u6bd4\u4e3a2.0\n\n\n\u7531\u4e8e\u5728\u5b9e\u73b0\u4e0a, \u5982\u679c\u67d0\u4e2aPAGE\u7684\u538b\u7f29\u7387\u5927\u4e8ePAGE_SIZE * 4 / 3 (kernel 3.10), \u5219\u4e0d\u8fdb\u884c\u538b\u7f29, \u5728\u8bfb\u53d6\u65f6, \u4e5f\u5c31\u7701\u4e0b\u89e3\u538b\u7684\u6d88\u8017. \u4ece\u800c\u63d0\u9ad8\u901f\u5ea6,\u964d\u4f4eCPU\u5360\u7528,\u4f46\u662f\u4f1a\u964d\u4f4e\u538b\u7f29\u7387.\n\n\n\n\n\u7f3a\u70b9\n\n\n\n\nCPU\u5360\u7528\n\n\n\u529f\u8017\u589e\u52a0\n\n\n\u7531\u4e8e\u5360\u7528\u4e00\u90e8\u5206\u5185\u5b58\u4f5c\u4e3azram\u8bbe\u5907, \u5219\u5982\u679czram\u538b\u7f29\u901f\u5ea6\u4e0d\u591f\u5feb, \u53cd\u800c\u66f4\u5bb9\u6613\u5f15\u53d1OOM.(github\u4e0a\u7684\u4e00\u4e2a\u60c5\u51b5, \u65e0\u6570\u636e\u4fe1\u606f, \u5728ZX2000\u4e0a\u672a\u51fa\u73b0\u8be5\u60c5\u51b5)\n\n\n\n\n\u8c03\u6574\u65b9\u6cd5\n\n\nCPU\u5360\u7528\u67e5\u770bkswapd(kswap)\n\n\nCPU\u5360\u7528\u8c03\u6574:\n\n\n\n\n/sys/block/zram0/max_comp_streams \u8bbe\u7f6e\u538b\u7f29\u6d41\u4e2a\u6570. \u9ed8\u8ba4\u4e3a\u6bcf\u4e2aCPU\u5206\u914d1\u4e2a.\n\n\n/sys/block/zram0/comp_algorithm  \u5207\u6362\u538b\u7f29\u7b97\u6cd5, \u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684LZO, \u901f\u5ea6\u5feb\n\n\n\n\n\n\n\u6d4b\u8bd5\n\n\n\n\n\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728\nZX2000\n\u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e\n\n\n\u538b\u7f29\u7387\u76f8\u5173\u7684\u4e09\u4e2a\u503c\u5206\u522b\u4e3a\n\n\n# busybox free                               \n             total       used       free     shared    buffers     cached\nMem:        427400     365136      62264        408        348      72148\n-/+ buffers/cache:     292640     134760\nSwap:       204796     103784     101012\n\n\norig_data_size:\u300090275840\nmem_used_total:  25862144\ncompr_data_size: 21846958\nzero_pages:      1903\n\n\n\n\n\n\n\u538b\u7f29\u7387\u4e3a\uff1a\n\n\ncompression radio(orig_data_size / compr_data_size) = 90275840 / 21846958 = 4.13\nreal compr. ratio (orig_data_size / mem_used_total) = 90275840 / 25862144 = 3.49\n\n\n\n\n\ncpu \u5360\u7528\u6570\u636e\uff1a\n\n\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   5% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n5%\u662f\u5728\u542f\u52a8\u65b0Activity\u7684\u65f6\u5019, \u521d\u6b65\u7ed3\u8bba\u662f, CPU\u5360\u7528\u4e0d\u9ad8.\n\n\n\n\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728\nZX1800\n\u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e\n\n\n\n# ./busybox free                                  \n             total       used       free     shared    buffers     cached\nMem:        427396     422720       4676       1688          0      42412\n-/+ buffers/cache:     380308      47088\nSwap:       204796     112748      92048\n\norig_data_size:  106278912\nmem_used_total:  25624576\ncompr_data_size: 23845230\nzero_pages:      3273\n\n\n\n\n\n\n\u538b\u7f29\u7387\u4e3a\uff1a\n\n\ncompression radio(orig_data_size / compr_data_size) = 106278912 / 23845230 = 4.45\nreal compr. ratio (orig_data_size / mem_used_total) = 106278912 / 25624576 = 4.14\n\n\n\n\n\ncpu \u5360\u7528\u6570\u636e\uff1a\n\n\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   4% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n\n\n\u5185\u5b58\u7533\u8bf7\u6d4b\u8bd5\n\n\n\u4ee5\u4e0b\u662f\u5728\nzx2000\n\u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.\n\n\n\n\u5728\u7cfb\u7edf\u505c\u7559\u5728\u4e3b\u754c\u9762\u540e, \u5c0f\u7a97\u53e3\u64ad\u53f0, \u5728\u5185\u5b58\u7533\u8bf7\u4f7f\u7528\u4e86167M\u540e, \u89e6\u53d1OOM.\nCPU\u5360\u7528\u5982\u4e0b, \u89e6\u53d1OOM\u65f6, CPU\u5360\u7528\u8fbe\u52308%\n\n\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n\u5185\u5b58\u5360\u7528\u5982\u4e0b:\n\n\n# busybox free     #\u5f00\u59cb\u65f6\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     423752       3648       2224       2540     105892\n-/+ buffers/cache:     315320     112080\nSwap:       204796          0     204796\n\n# busybox free     # OOM \u65f6\u5185\u5b58                              \n             total       used       free     shared    buffers     cached\nMem:        427400     422908       4492        292        200      11464\n-/+ buffers/cache:     411244      16156\nSwap:       204796     204796          0\n\n\n\n\n\nzram\u4fe1\u606f\u5982\u4e0b:\n\n\n# \u5f00\u59cb\u4f7f\u7528zram\u4e0d\u4e45\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 1175K\norig_data_size: 2232K\nmem_used_total: 2232K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n# \u4e00\u6bb5\u65f6\u95f4\u540e\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 3675K\norig_data_size: 11800K\nmem_used_total: 4648K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n==============================================\nstatus: enabled\ncompression: 3\ndisksize: 200M\ncompr_data_size: 15230K\norig_data_size: 55040K\nmem_used_total: 16624K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 44355K\norig_data_size: 120788K\nmem_used_total: 46196K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 137773K\norig_data_size: 200280K\nmem_used_total: 144096K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n\n\n\n\n\u53ef\u4ee5\u770b\u5230, \u538b\u7f29\u6bd4, \u4ece1 -\n 3 -\n\uff11, \u4e5f\u5c31\u662f\u8bf4\u5728swap\u7a7a\u6216\u8005\u5feb\u6ee1\u662f, \u538b\u7f29\u6bd4\u662f\u6700\u4f4e\u7684, \u4ece\u6700\u540e\u89e6\u53d1OOM\u770b, \u901a\u8fc7\u538b\u7f29\u8282\u7701\u7684\u5185\u5b58\u670960M\u5de6\u53f3. \u5e76\u4e14\u7531\u4e8e1M\u586b\u5145\u7684\u90fd\u662furandom\u8bbe\u5907\u7684\u5185\u5bb9, \u672c\u8eab\u5bfc\u81f4\u538b\u7f29\u6bd4\u6bd4\u6b63\u5e38\u4f7f\u7528\u65f6\u504f\u4f4e(\u51e0\u4e4e\u65e00\u9875, \u6570\u636e\u968f\u673a).\n\n\n\n\u5728\u4e0d\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b\uff0c\u3000\u5185\u5b58\u7533\u8bf7\u572895 M\u7684\u65f6\u5019\uff0c\u3000\u89e6\u53d1\u4e86OOM.\n\n\n # busybox free       # \u5f00\u59cb\u5185\u5b58\u7533\u8bf7\u65f6\u7684\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     422932       4468       2224       2524     103748\n-/+ buffers/cache:     316660     110740\nSwap:            0          0          0\n\n\n# busybox free       # OOM \u65f6\u7684\u5185\u5b58                                            \n             total       used       free     shared    buffers     cached\nMem:        427400     424052       3348       2224         36      16608\n-/+ buffers/cache:     407408      19992\nSwap:            0          0          0\n\n\n\n\n\n\n\n\n\n\u4ee5\u4e0b\u662f\u5728\nzx1800\n\u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.\n\n\n\u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u5185\u5b58\u8fbe\u5230166M\u65f6, \u89e6\u53d1OOM.\nCPU \u5360\u7528\n\n\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   1% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% R     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% R     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n\u538b\u7f29\u6bd4\u7684\u6570\u636e\u4e0ezx2000 emmc\u76f8\u540c, \u7279\u522b\u662f\u5728zram\u5269\u4f59\u5927\u5c0f\u4e0d\u591a\u65f6, \u538b\u7f29\u6bd4\u5feb\u901f\u7f29\u5c0f\u52301.4(\u4ece3\u964d\u52301)\u5de6\u53f3.\n\u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.\n\n\n# ./busybox free           #\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u65f6                 \n             total       used       free     shared    buffers     cached\nMem:        427396     422192       5204       2224          4     109536\n-/+ buffers/cache:     312652     114744\nSwap:       204796          0     204796\n\n\n# ./busybox free        # OOM \u65f6\n             total       used       free     shared    buffers     cached\nMem:        427396     423280       4116        264          0      13268\n-/+ buffers/cache:     410012      17384\nSwap:       204796     204796          0\n\n\n\n\n\n\u5728\u4e0d\u5f00\u542fzram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u7684\u5185\u5b58\u8fbe\u523096M\u65f6\u89e6\u53d1OOM, \u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.\n\n\n# ./busybox free         # \u7cfb\u7edf\u542f\u52a8\u5b8c\u6210                      \n             total       used       free     shared    buffers     cached\nMem:        427396     411928      15468       2224          0     107552\n-/+ buffers/cache:     304376     123020\nSwap:            0          0          0\n\n\n# ./busybox free         # \u89e6\u53d1OOM                         \n             total       used       free     shared    buffers     cached\nMem:        427396     419892       7504       2224          0      15372\n-/+ buffers/cache:     404520      22876\nSwap:            0          0          0\n\n\n\n\n\n\u7efc\u4e0a, \u4e0ezx2000\u76f8\u540c, \u53ef\u7528\u5185\u5b58\u589e\u52a070M\u5de6\u53f3.\n\n\nOOM\u6d4b\u8bd5\n\n\n\u57fa\u4e8e\nzx2000\n 8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.\n\n\n\u6267\u884c\u64cd\u4f5c\u5982\u4e0b:\n\n\n\n\n\u91cd\u542f\u7cfb\u7edf.\n\n\n\u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.\n\n\n\u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.\n\n\n\n\n\u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u672a\u89e6\u53d1OOM.\n\n\n\n\n\n\u57fa\u4e8e\nzx1800\n 8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.\n\n\n\u6267\u884c\u64cd\u4f5c\u5982\u4e0b:\n\n\n\n\n\u91cd\u542f\u7cfb\u7edf.\n\n\n\u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.\n\n\n\u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.\n\n\n\n\n\u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u975e\u5e38\u5361, \u751a\u81f3\u9ed1\u5c4f\u51e0\u79d2\u949f.\n\u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u4e0d\u4f1a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u53ea\u6709\u7b2c\u4e00\u6b21\u5bfc\u89c6\u952e\u5361\u987f, \u4e4b\u540e\u90fd\u4e0d\u5361.\n\n\n \u5728Android\u542f\u7528\u65b9\u6cd5 \n\n\nhttps://source.android.com/devices/tech/perf/low-ram\n\n\n\u4e0a\u9762\u8fd9\u4e2a\u94fe\u63a5\u662fAndroid\u5b98\u7f51\u7ed9\u51fa\u6765\u7684\u5bf9\u4e8e\u4f4e\u5185\u5b58\u8bbe\u5907(512M)\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae(\u5185\u6838/\u7cfb\u7edf/\u5e94\u7528\u7b49), \u5176\u4e2d\u6709\u5728Android\u4e0a\u542f\u7528zram\u7684\u6574\u4e2a\u914d\u7f6e\u6d41\u7a0b.\n\n\n\u5728hisi\u63d0\u4f9b\u7684TVOS2.0\u4ee3\u7801\u4e2d, \u5df2\u7ecf\u5b9e\u73b0Android\u5b98\u65b9\u63d0\u4f9b\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae, \u8fdb\u884c\u4e86\u4f18\u5316, \u5176\u4e2d\u5305\u62eczram\u7684\u914d\u7f6e, \u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u4e5f\u4f7f\u7528.\n\n\n\u5b98\u65b9\u5efa\u8bae, \u4f7f\u7528\u603b\u5185\u5b58\u7684 30%-50% \u4f5c\u4e3azram, \u6309\u7167\u538b\u7f29\u7387\u4e3a50%\u8ba1\u7b97, \u5219\u5185\u5b58\u589e\u52a030%-50%\u5de6\u53f3.\n\n\nSwap to zRAM\n\n\nzRAM swap can increase the amount of memory available in the system by compressing memory pages and putting them in a dynamically allocated swap area of memory.\n\n\nAgain, since this is trading off CPU time for a small increase in memory, you should be careful about measuring the performance impact zRAM swap has on your system.\n\n\nAndroid handles swap to zRAM at several levels:\n\n\nFirst, the following kernel options must be enabled to use zRAM swap effectively:\n    CONFIG_SWAP\n    CONFIG_CGROUP_MEM_RES_CTLR\n    CONFIG_CGROUP_MEM_RES_CTLR_SWAP\n    CONFIG_ZRAM\nThen, you should add a line that looks like this to your fstab:\n\n/dev/block/zram0 none swap defaults zramsize=\nsize in bytes\n,swapprio=\nswap partition priority\n\n\n    zramsize is mandatory and indicates how much uncompressed memory you want the zram area to hold. Compression ratios in the 30-50% range are usually observed.\n    swapprio is optional and not needed if you don\nt have more than one swap area.\n\nYou should also be sure to label the associated block device as a swap_block_device in the device-specific sepolicy/file_contexts so that it is treated properly by SELinux.\n\n/dev/block/zram0 u:object_r:swap_block_device:s0\n\nBy default, the Linux kernel swaps in 8 pages of memory at a time. When using ZRAM, the incremental cost of reading 1 page at a time is negligible and may help in case the device is under extreme memory pressure. To read only 1 page at a time, add the following to your init.rc:\n\nwrite /proc/sys/vm/page-cluster 0\n\nIn your init.rc after the mount_all /fstab.X line, add:\n\nswapon_all /fstab.X\n\nThe memory cgroups are automatically configured at boot time if the feature is enabled in kernel.\nIf memory cgroups are available, the ActivityManager will mark lower priority threads as being more swappable than other threads. If memory is needed, the Android kernel will start migrating memory pages to zRAM swap, giving a higher priority to those memory pages that have been marked by ActivityManager.\n\n\n\n\n\n\n\n\n\n\n \u6210\u529f\u4f8b\u5b50 \n\n\n\n\nchrome os\n\n\ndebian/ubuntu\n\n\n\u7b2c\u4e09\u65b9Android ROM \u548c TV", 
            "title": "zram"
        }, 
        {
            "location": "/zram/#_1", 
            "text": "\u5728linux\u5185\u6838\u7684mm\u5b50\u7cfb\u7edf\u4e2d, \u5305\u542b\u4e09\u4e2a\u652f\u6301\u5185\u5b58\u538b\u7f29\u7684\u7ec4\u4ef6, \u5206\u522b\u662fzram, zcache \u548c zswap.  zswap : \u524d\u63d0\u6761\u4ef6\u662f, \u7cfb\u7edf\u4e2d\u5b58\u5728swap\u8bbe\u5907, \u5185\u6838\u7248\u672c 3.5, \u56e0\u4e3a\u4f9d\u8d56\u4e86frontswap\u7684\u63a5\u53e3, \u7528\u4e8e\u7ba1\u7406swap page.\nzswap\u662f\u4e00\u4e2a\u8f7b\u91cf\u5316\u7684\u540e\u7aef\u67b6\u6784, \u5c06\u8fdb\u7a0b\u5404\u79cd\u4ea4\u6362\u51fa\u7684\u9875\u9762\u8fdb\u884c\u538b\u7f29, \u5e76\u5b58\u50a8\u5728\u4e00\u4e2a\u57fa\u4e8eRAM\u7684\u5185\u7f13\u51b2\u6c60\u4e2d. \u7f13\u51b2\u6c60\u4e0d\u9884\u5206\u914d, \u6709\u6700\u5927\u503c, \u4e14\u5f53\u7f13\u51b2\u6c60\u6ee1\u4e86, LRU\u7684\u5185\u5b58\u9875\u4f1a\u88ab\u5199\u5165swap\u8bbe\u5907. \u4f9d\u8d56swap\u5206\u533a, \u4e0d\u9002\u7528hdtv.  zcache : \u4e0ezswap\u7c7b\u4f3c, \u4f9d\u8d56frontswap\u63a5\u53e3\u548ccleacache\u63a5\u53e3, \u5185\u6838\u7248\u672c 3.5. \u4e0ezswap\u4e00\u6837, \u5c06\u8fdb\u7a0b\u4ea4\u6362\u51fa\u7684\u9875\u9762\u548c\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u51b2\u8fdb\u884c\u538b\u7f29\u5e76\u5b58\u50a8\u5728RAM\u7684\u5185\u5b58\u7f13\u51b2\u6c60\u4e2d, \u5728\u7f13\u51b2\u6c60\u6ee1\u540e, \u5c06\u9875\u9762\u5b58\u5165swap\u5206\u533a\u6216\u8005 RAMster (\u4e00\u79cd\u57fa\u4e8e\u7f51\u7edc\u7684\u5185\u5b58\u6c60\u5171\u4eab\u6280\u672f, \u53ef\u4ee5\u5171\u4eab\u7f51\u7edc\u4e2d\u5176\u4f59\u786c\u4ef6\u7684\u5185\u5b58). zswap\u53ef\u4ee5\u7406\u89e3\u4e3a\u662fzcache\u7684\u5b50\u96c6. \u4e0d\u9002\u7528hdtv.  zram : \u5185\u5b58\u4e2d\u7684swap\u8bbe\u5907, \u5185\u6838 3.14, \u53ef\u4ee5\u7406\u89e3\u4e3azcache\u7684RAM\u7f13\u51b2\u6c60. \u4f18\u5148\u7ea7\u6700\u9ad8, \u4e0d\u5efa\u8bae\u4e0e\u5176\u4ed6swap\u4e00\u8d77\u4f7f\u7528.\u4e0d\u4f9d\u8d56\u771f\u5b9e\u7684swap\u8bbe\u5907(Nand\u6216\u8005\u7f51\u7edc), \u503e\u5411\u4e8e\u5728\u4f4e\u5185\u5b58\u7684\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e2d\u4f7f\u7528.  \u7efc\u4e0a, zram\u66f4\u9002\u5408hdtv\u8fd9\u4e2a\u9879\u76ee", 
            "title": "\u7b80\u4ecb"
        }, 
        {
            "location": "/zram/#zram", 
            "text": "zram\u662f\u5c06\u7cfb\u7edf\u4e2d\u7684\u5185\u5b58\u7684\u4e00\u90e8\u5206\u5185\u5b58\u9694\u79bb\u6210zram\u8bbe\u5907(swap\u8bbe\u5907),\u5bf9\u4e8e\u5c0f\u5185\u5b58\u7684\u8bbe\u5907, \u5728\u4f7f\u7528\u4e0a\u4f1a\u611f\u5185\u5b58\u88ab\u6269\u5927\u4e86.  linux\u5185\u6838\u4e2d\u4e3azram\u63d0\u4f9b\u4e86\u5404\u79cd\u538b\u7f29\u7b97\u6cd5, \u9ed8\u8ba4\u7684\u662fLZO, \u8be5\u7b97\u6cd5\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u80fd\u5f88\u597d\u5730\u5e73\u8861\u538b\u7f29\u7387\u548c\u901f\u5ea6. LZO\u4e3b\u8981\u662f\u5728\u901f\u5ea6\u4e0a\u4f18\u5316.\u5728\u4e00\u4e9b\u6bd4\u8f83\u6b63\u5f0f\u7684\u6587\u6863\u4e0a, LZO\u7684\u538b\u7f29\u7387\u5e73\u5747\u4e3a50%. \u4e0b\u9762\u662f\u9488\u5bf9\u5185\u6838\u6e90\u7801(50.6M)\u538b\u7f29\u7684\u4e00\u4e2a\u56fe\u8868, \u7f51\u4e0a\u63d0\u4f9b\u7684.  lzop :   1.62   seconds   to   compress ,   18.0   MB ,   ratio =. 355  gzip :   19.13   seconds ,   10.8   MB ,   ratio =. 213  bzip2 :   60.81   seconds ,   8.46   MB ,   ratio =. 176  xz :   311.65   seconds ,   7.33   MB ,   ratio =. 145    \u538b\u7f29\u7387\u8ba1\u7b97:\n\u76f8\u5173\u6570\u636e/sys/block/zram0/{ mem_used_total , orig_data_size , compr_data_size }  compression radio = orig_data_size / compr_data_size\nreal compr. ratio  = orig_data_size / mem_used_total", 
            "title": " zram "
        }, 
        {
            "location": "/zram/#_2", 
            "text": "\u5185\u5b58\u6269\u5927, \u5e73\u5747\u538b\u7f29\u6bd4\u4e3a2.0  \u7531\u4e8e\u5728\u5b9e\u73b0\u4e0a, \u5982\u679c\u67d0\u4e2aPAGE\u7684\u538b\u7f29\u7387\u5927\u4e8ePAGE_SIZE * 4 / 3 (kernel 3.10), \u5219\u4e0d\u8fdb\u884c\u538b\u7f29, \u5728\u8bfb\u53d6\u65f6, \u4e5f\u5c31\u7701\u4e0b\u89e3\u538b\u7684\u6d88\u8017. \u4ece\u800c\u63d0\u9ad8\u901f\u5ea6,\u964d\u4f4eCPU\u5360\u7528,\u4f46\u662f\u4f1a\u964d\u4f4e\u538b\u7f29\u7387.", 
            "title": "\u4f18\u70b9"
        }, 
        {
            "location": "/zram/#_3", 
            "text": "CPU\u5360\u7528  \u529f\u8017\u589e\u52a0  \u7531\u4e8e\u5360\u7528\u4e00\u90e8\u5206\u5185\u5b58\u4f5c\u4e3azram\u8bbe\u5907, \u5219\u5982\u679czram\u538b\u7f29\u901f\u5ea6\u4e0d\u591f\u5feb, \u53cd\u800c\u66f4\u5bb9\u6613\u5f15\u53d1OOM.(github\u4e0a\u7684\u4e00\u4e2a\u60c5\u51b5, \u65e0\u6570\u636e\u4fe1\u606f, \u5728ZX2000\u4e0a\u672a\u51fa\u73b0\u8be5\u60c5\u51b5)", 
            "title": "\u7f3a\u70b9"
        }, 
        {
            "location": "/zram/#_4", 
            "text": "CPU\u5360\u7528\u67e5\u770bkswapd(kswap)  CPU\u5360\u7528\u8c03\u6574:   /sys/block/zram0/max_comp_streams \u8bbe\u7f6e\u538b\u7f29\u6d41\u4e2a\u6570. \u9ed8\u8ba4\u4e3a\u6bcf\u4e2aCPU\u5206\u914d1\u4e2a.  /sys/block/zram0/comp_algorithm  \u5207\u6362\u538b\u7f29\u7b97\u6cd5, \u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684LZO, \u901f\u5ea6\u5feb", 
            "title": "\u8c03\u6574\u65b9\u6cd5"
        }, 
        {
            "location": "/zram/#_5", 
            "text": "\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728 ZX2000 \u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e \n\u538b\u7f29\u7387\u76f8\u5173\u7684\u4e09\u4e2a\u503c\u5206\u522b\u4e3a  # busybox free                               \n             total       used       free     shared    buffers     cached\nMem:        427400     365136      62264        408        348      72148\n-/+ buffers/cache:     292640     134760\nSwap:       204796     103784     101012\n\n\norig_data_size:\u300090275840\nmem_used_total:  25862144\ncompr_data_size: 21846958\nzero_pages:      1903  \n\u538b\u7f29\u7387\u4e3a\uff1a  compression radio(orig_data_size / compr_data_size) = 90275840 / 21846958 = 4.13\nreal compr. ratio (orig_data_size / mem_used_total) = 90275840 / 25862144 = 3.49  cpu \u5360\u7528\u6570\u636e\uff1a     44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   5% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0  5%\u662f\u5728\u542f\u52a8\u65b0Activity\u7684\u65f6\u5019, \u521d\u6b65\u7ed3\u8bba\u662f, CPU\u5360\u7528\u4e0d\u9ad8.  \n\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728 ZX1800 \u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e  # ./busybox free                                  \n             total       used       free     shared    buffers     cached\nMem:        427396     422720       4676       1688          0      42412\n-/+ buffers/cache:     380308      47088\nSwap:       204796     112748      92048\n\norig_data_size:  106278912\nmem_used_total:  25624576\ncompr_data_size: 23845230\nzero_pages:      3273  \n\u538b\u7f29\u7387\u4e3a\uff1a  compression radio(orig_data_size / compr_data_size) = 106278912 / 23845230 = 4.45\nreal compr. ratio (orig_data_size / mem_used_total) = 106278912 / 25624576 = 4.14  cpu \u5360\u7528\u6570\u636e\uff1a     44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   4% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0", 
            "title": "\u6d4b\u8bd5"
        }, 
        {
            "location": "/zram/#_6", 
            "text": "\u4ee5\u4e0b\u662f\u5728 zx2000 \u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.  \n\u5728\u7cfb\u7edf\u505c\u7559\u5728\u4e3b\u754c\u9762\u540e, \u5c0f\u7a97\u53e3\u64ad\u53f0, \u5728\u5185\u5b58\u7533\u8bf7\u4f7f\u7528\u4e86167M\u540e, \u89e6\u53d1OOM.\nCPU\u5360\u7528\u5982\u4e0b, \u89e6\u53d1OOM\u65f6, CPU\u5360\u7528\u8fbe\u52308%     44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0  \u5185\u5b58\u5360\u7528\u5982\u4e0b:  # busybox free     #\u5f00\u59cb\u65f6\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     423752       3648       2224       2540     105892\n-/+ buffers/cache:     315320     112080\nSwap:       204796          0     204796\n\n# busybox free     # OOM \u65f6\u5185\u5b58                              \n             total       used       free     shared    buffers     cached\nMem:        427400     422908       4492        292        200      11464\n-/+ buffers/cache:     411244      16156\nSwap:       204796     204796          0  zram\u4fe1\u606f\u5982\u4e0b:  # \u5f00\u59cb\u4f7f\u7528zram\u4e0d\u4e45\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 1175K\norig_data_size: 2232K\nmem_used_total: 2232K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n# \u4e00\u6bb5\u65f6\u95f4\u540e\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 3675K\norig_data_size: 11800K\nmem_used_total: 4648K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n==============================================\nstatus: enabled\ncompression: 3\ndisksize: 200M\ncompr_data_size: 15230K\norig_data_size: 55040K\nmem_used_total: 16624K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 44355K\norig_data_size: 120788K\nmem_used_total: 46196K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 137773K\norig_data_size: 200280K\nmem_used_total: 144096K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]  \u53ef\u4ee5\u770b\u5230, \u538b\u7f29\u6bd4, \u4ece1 -  3 - \uff11, \u4e5f\u5c31\u662f\u8bf4\u5728swap\u7a7a\u6216\u8005\u5feb\u6ee1\u662f, \u538b\u7f29\u6bd4\u662f\u6700\u4f4e\u7684, \u4ece\u6700\u540e\u89e6\u53d1OOM\u770b, \u901a\u8fc7\u538b\u7f29\u8282\u7701\u7684\u5185\u5b58\u670960M\u5de6\u53f3. \u5e76\u4e14\u7531\u4e8e1M\u586b\u5145\u7684\u90fd\u662furandom\u8bbe\u5907\u7684\u5185\u5bb9, \u672c\u8eab\u5bfc\u81f4\u538b\u7f29\u6bd4\u6bd4\u6b63\u5e38\u4f7f\u7528\u65f6\u504f\u4f4e(\u51e0\u4e4e\u65e00\u9875, \u6570\u636e\u968f\u673a).  \n\u5728\u4e0d\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b\uff0c\u3000\u5185\u5b58\u7533\u8bf7\u572895 M\u7684\u65f6\u5019\uff0c\u3000\u89e6\u53d1\u4e86OOM.   # busybox free       # \u5f00\u59cb\u5185\u5b58\u7533\u8bf7\u65f6\u7684\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     422932       4468       2224       2524     103748\n-/+ buffers/cache:     316660     110740\nSwap:            0          0          0\n\n\n# busybox free       # OOM \u65f6\u7684\u5185\u5b58                                            \n             total       used       free     shared    buffers     cached\nMem:        427400     424052       3348       2224         36      16608\n-/+ buffers/cache:     407408      19992\nSwap:            0          0          0    \u4ee5\u4e0b\u662f\u5728 zx1800 \u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.  \u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u5185\u5b58\u8fbe\u5230166M\u65f6, \u89e6\u53d1OOM.\nCPU \u5360\u7528     44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   1% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% R     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% R     1      0K      0K  fg root     kswapd0  \u538b\u7f29\u6bd4\u7684\u6570\u636e\u4e0ezx2000 emmc\u76f8\u540c, \u7279\u522b\u662f\u5728zram\u5269\u4f59\u5927\u5c0f\u4e0d\u591a\u65f6, \u538b\u7f29\u6bd4\u5feb\u901f\u7f29\u5c0f\u52301.4(\u4ece3\u964d\u52301)\u5de6\u53f3.\n\u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.  # ./busybox free           #\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u65f6                 \n             total       used       free     shared    buffers     cached\nMem:        427396     422192       5204       2224          4     109536\n-/+ buffers/cache:     312652     114744\nSwap:       204796          0     204796\n\n\n# ./busybox free        # OOM \u65f6\n             total       used       free     shared    buffers     cached\nMem:        427396     423280       4116        264          0      13268\n-/+ buffers/cache:     410012      17384\nSwap:       204796     204796          0  \u5728\u4e0d\u5f00\u542fzram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u7684\u5185\u5b58\u8fbe\u523096M\u65f6\u89e6\u53d1OOM, \u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.  # ./busybox free         # \u7cfb\u7edf\u542f\u52a8\u5b8c\u6210                      \n             total       used       free     shared    buffers     cached\nMem:        427396     411928      15468       2224          0     107552\n-/+ buffers/cache:     304376     123020\nSwap:            0          0          0\n\n\n# ./busybox free         # \u89e6\u53d1OOM                         \n             total       used       free     shared    buffers     cached\nMem:        427396     419892       7504       2224          0      15372\n-/+ buffers/cache:     404520      22876\nSwap:            0          0          0  \u7efc\u4e0a, \u4e0ezx2000\u76f8\u540c, \u53ef\u7528\u5185\u5b58\u589e\u52a070M\u5de6\u53f3.", 
            "title": "\u5185\u5b58\u7533\u8bf7\u6d4b\u8bd5"
        }, 
        {
            "location": "/zram/#oom", 
            "text": "\u57fa\u4e8e zx2000  8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.  \u6267\u884c\u64cd\u4f5c\u5982\u4e0b:   \u91cd\u542f\u7cfb\u7edf.  \u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.  \u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.   \u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u672a\u89e6\u53d1OOM.   \u57fa\u4e8e zx1800  8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.  \u6267\u884c\u64cd\u4f5c\u5982\u4e0b:   \u91cd\u542f\u7cfb\u7edf.  \u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.  \u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.   \u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u975e\u5e38\u5361, \u751a\u81f3\u9ed1\u5c4f\u51e0\u79d2\u949f.\n\u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u4e0d\u4f1a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u53ea\u6709\u7b2c\u4e00\u6b21\u5bfc\u89c6\u952e\u5361\u987f, \u4e4b\u540e\u90fd\u4e0d\u5361.", 
            "title": "OOM\u6d4b\u8bd5"
        }, 
        {
            "location": "/zram/#android", 
            "text": "https://source.android.com/devices/tech/perf/low-ram \n\u4e0a\u9762\u8fd9\u4e2a\u94fe\u63a5\u662fAndroid\u5b98\u7f51\u7ed9\u51fa\u6765\u7684\u5bf9\u4e8e\u4f4e\u5185\u5b58\u8bbe\u5907(512M)\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae(\u5185\u6838/\u7cfb\u7edf/\u5e94\u7528\u7b49), \u5176\u4e2d\u6709\u5728Android\u4e0a\u542f\u7528zram\u7684\u6574\u4e2a\u914d\u7f6e\u6d41\u7a0b. \n\u5728hisi\u63d0\u4f9b\u7684TVOS2.0\u4ee3\u7801\u4e2d, \u5df2\u7ecf\u5b9e\u73b0Android\u5b98\u65b9\u63d0\u4f9b\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae, \u8fdb\u884c\u4e86\u4f18\u5316, \u5176\u4e2d\u5305\u62eczram\u7684\u914d\u7f6e, \u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u4e5f\u4f7f\u7528. \n\u5b98\u65b9\u5efa\u8bae, \u4f7f\u7528\u603b\u5185\u5b58\u7684 30%-50% \u4f5c\u4e3azram, \u6309\u7167\u538b\u7f29\u7387\u4e3a50%\u8ba1\u7b97, \u5219\u5185\u5b58\u589e\u52a030%-50%\u5de6\u53f3. \nSwap to zRAM  zRAM swap can increase the amount of memory available in the system by compressing memory pages and putting them in a dynamically allocated swap area of memory.  Again, since this is trading off CPU time for a small increase in memory, you should be careful about measuring the performance impact zRAM swap has on your system.  Android handles swap to zRAM at several levels:  First, the following kernel options must be enabled to use zRAM swap effectively:\n    CONFIG_SWAP\n    CONFIG_CGROUP_MEM_RES_CTLR\n    CONFIG_CGROUP_MEM_RES_CTLR_SWAP\n    CONFIG_ZRAM\nThen, you should add a line that looks like this to your fstab:\n\n/dev/block/zram0 none swap defaults zramsize= size in bytes ,swapprio= swap partition priority \n\n    zramsize is mandatory and indicates how much uncompressed memory you want the zram area to hold. Compression ratios in the 30-50% range are usually observed.\n    swapprio is optional and not needed if you don t have more than one swap area.\n\nYou should also be sure to label the associated block device as a swap_block_device in the device-specific sepolicy/file_contexts so that it is treated properly by SELinux.\n\n/dev/block/zram0 u:object_r:swap_block_device:s0\n\nBy default, the Linux kernel swaps in 8 pages of memory at a time. When using ZRAM, the incremental cost of reading 1 page at a time is negligible and may help in case the device is under extreme memory pressure. To read only 1 page at a time, add the following to your init.rc:\n\nwrite /proc/sys/vm/page-cluster 0\n\nIn your init.rc after the mount_all /fstab.X line, add:\n\nswapon_all /fstab.X\n\nThe memory cgroups are automatically configured at boot time if the feature is enabled in kernel.\nIf memory cgroups are available, the ActivityManager will mark lower priority threads as being more swappable than other threads. If memory is needed, the Android kernel will start migrating memory pages to zRAM swap, giving a higher priority to those memory pages that have been marked by ActivityManager.", 
            "title": " \u5728Android\u542f\u7528\u65b9\u6cd5 "
        }, 
        {
            "location": "/zram/#_7", 
            "text": "chrome os  debian/ubuntu  \u7b2c\u4e09\u65b9Android ROM \u548c TV", 
            "title": " \u6210\u529f\u4f8b\u5b50 "
        }, 
        {
            "location": "/android8-partiton-table/", 
            "text": "\u6765\u6e90: https://pengzhangdev.github.io/android8-partiton-table/\n\n\n\u5dee\u5f02\u7b80\u8ff0 \n\n\n\u5728Android8.0\u4e4b\u540e, \u5c31\u5b58\u5728\u4e24\u5957\u5206\u533a\u8868, \u5206\u522b\u5bf9\u5e94\u7684\u662fA/B\u7cfb\u7edf\u548c\u975eA/B\u7cfb\u7edf.\n\n\n\n\n\u975eA/B\u7cfb\u7edf\u7684\u5206\u533a\u8868\u4e0e\u4e4b\u524d\u5206\u533a\u8868\u4e00\u6837, \u6ca1\u6709\u53d8\u5316.\n\n\nA/B\u7cfb\u7edf\u7684\u5206\u533a\u8868, \u662f\u672c\u6587\u7684\u4e3b\u8981\u63cf\u8ff0\u70b9.\n\n\n\n\n\u6240\u8c13\u7684A/B\u7cfb\u7edf, \u662f\u6307\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf, \u5176\u5206\u533a\u540d\u4e5f\u662f\u5b58\u5728\n_a\n \u548c \n_b\n \u7684\u533a\u522b.\u4e24\u5957\u7cfb\u7edf\u4e2d, \u53ea\u6709\u4e00\u5957\u4e3aactive, \u8fd0\u884c\u72b6\u6001, \u800c\u5347\u7ea7\u5219\u6267\u884c\u5728\u53e6\u4e00\u5957\u7cfb\u7edf\u7684\u5206\u533a\u4e2d. \u4ece\u800c\u8fbe\u5230, \u4e0d\u7ba1\u5347\u7ea7\u6210\u529f\u4e0e\u5426, \u603b\u6709\u4e00\u5957\u7cfb\u7edf\u4fdd\u8bc1\u80fd\u4f7f\u7528.\n\n\n\u800c\u5237\u673a, \u5305\u62ec\u6302\u65f6\u7684\u5206\u533a\u8868\u4e2d, \u90fd\u4e0d\u4f1a\u6dfb\u52a0\u540e\u7f00(\n_a\n\u6216\n_b\n). \u53ea\u6709\u5728fastboot\u5237\u673a\u65f6, \u6216\u8005\u5728init\u6302\u8f7d\u65f6, \u627e\u5230active\u7684slot, \u5728\u6307\u5b9a\u5206\u533a\u540d\u5b57\u540e\u9762\u6dfb\u52a0\u540e\u7f00\u5e76\u6302\u8f7d. \u6240\u4ee5, \u5355\u7eaf\u4ece\u6e90\u7801\u6216\u8005\u5237\u673a\u5305\u662f\u65e0\u6cd5\u6307\u5b9a\u54ea\u4e9b\u5206\u533a\u88ab\u6307\u5b9a\u4e3aA/B\u4e86.\n\n\n\nA/B\u7cfb\u7edf\u5e26\u6765\u7684\u597d\u5904\u662f:\n\n\n\n\n\u65e0\u7f1d\u5347\u7ea7, \u4e0d\u9700\u8981\u518d\u8fdb\u5165recovery\u8fdb\u884c\u5347\u7ea7.\n\n\n\u53cc\u7cfb\u7edf\u5907\u4efd, \u4e0d\u7ba1\u662f\u7cfb\u7edf\u5347\u7ea7\u5931\u8d25, \u8fd8\u662f\u88ab\u7834\u574f, \u90fd\u53ef\u4ee5\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u8bbe\u5907\u7684\u6b63\u5e38\u4f7f\u7528.\n\n\n\n\n\u5206\u533a\u8868\u4e0e\u5176\u5185\u5bb9\n\n\n\u4e0b\u9762\u4e3b\u8981\u9488\u5bf9pixel\u8bbe\u5907\u8fdb\u884c\u5206\u6790, \u4e5f\u5c31\u662fAndroid8\u7684\u6e90\u7801\u4e2dmarlin\u8bbe\u5907.\n\n\n\u5237\u673a\u6587\u4ef6\u548c\u5237\u673a\u65b9\u5f0f \n\n\n\u9996\u5148\u6211\u4eec\u770b\u4e0bandroid\u5b98\u7f51\u63d0\u4f9b\u7684marlin\u8bbe\u5907\u5237\u673a\u6587\u4ef6. \u4e0b\u9762\u662f\u57fa\u5e26\u548cbootloader\u7684\u5237\u673a\u6587\u4ef6.\n\n\n\n\n\nzip\u5305\u4e2d\u7684\u6587\u4ef6\u5982\u4e0b.\n\n\n\n\n\n\u5982\u679c\u5355\u7eaf\u6309\u7167\u4e4b\u524d\u5bf9\u8be5zip\u5305\u6587\u4ef6\u7684\u7406\u89e3, \u6587\u4ef6\u540d\u5b57\u5c31\u662f\u5bf9\u5e94\u7684\u5206\u533a\u540d. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u5374\u5e76\u4e0d\u662f\u5982\u6b64. \u800c\u662f\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u67e5\u627eA/B\u5206\u533a.\n\n\n\u9996\u5148, \u6700\u5148\u6ce8\u610f\u5230\u7684\u662f\u4e24\u4e2asystem\u5927\u5c0f\u4e0d\u4e00\u81f4, \u4f46\u662f\u8fd9\u4e2a\u5c55\u5f00\u6765\u8bb2\u6709\u70b9\u591a, \u6211\u4eec\u5148\u628aA/B\u7cfb\u7edf\u5237\u673a\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u4ecb\u7ecd\u4ee5\u4e0b, \u4ee3\u7801\u5728\u540e\u6587\u4ecb\u7ecd\u7b2c\u4e8c\u4e2a\u89c4\u5219\u65f6\u53ef\u4ee5\u540c\u65f6\u770b\u5230.\n\n\nA/B\u7cfb\u7edffastboot\u5237\u673a\u65f6, \u5982\u679c\u6ca1\u6709\u6307\u5b9aslot, \u5219\u9ed8\u8ba4\u5237\u5165\u7684\u662factive\u7684slot, \u6bd4\u5982\u5982\u679cbootloader\u6807\u8bb0\u4e3aslot A \u4e3aactive, \u5219\u6240\u6709\u5206\u533a\u9ed8\u8ba4\u5237\u5165slot A, \u4e5f\u5c31\u662f\u8bf4\nboot_a\n, \nsystem_a\n \u7b49. \u4f46\u662f, \u5982\u679cbootloader\u53cd\u9988\u67d0\u4e2a\u5206\u533a\u6ca1\u6709\u533a\u5206A/B, \u5219\u9ed8\u8ba4\u76f4\u63a5\u5237\u5165\u8be5\u5206\u533a. \u6bd4\u5982 vendor \u65e0\u533a\u5206A/B, \u5219\u76f4\u63a5\u5237\u5165vendor.\n\n\n\u7136\u540e, \u6211\u4eec\u5173\u6ce8\u4e0b\nsystem.img\n\u548c\nsystem_other.img\n, \u5982\u679c\u5355\u7eaf\u7406\u89e3\u4e3a\u8fd9\u4e24\u4e2aimage\u5206\u522b\u5237\u5165A/B\u5206\u533a, \u5219\u5927\u5c0f\u4e5f\u5b8c\u5168\u5bf9\u5e94\u4e0d\u4e0a. \u5927\u5c0f\u95ee\u9898, \u6211\u4eec\u7a0d\u540e\u518d\u770b, \u5148\u7814\u7a76\u4e0b\nsystem_other.img\n\u5237\u5165\u54ea\u4e2a\u5206\u533a.\n\n\nstatic struct {\n    char img_name[17];\n    char sig_name[17];\n    char part_name[9];\n    bool is_optional;\n    bool is_secondary;\n} images[] = {\n    {\nboot.img\n, \nboot.sig\n, \nboot\n, false, false},\n    {\nboot_other.img\n, \nboot.sig\n, \nboot\n, true, true},\n    {\nrecovery.img\n, \nrecovery.sig\n, \nrecovery\n, true, false},\n    {\nsystem.img\n, \nsystem.sig\n, \nsystem\n, false, false},\n    {\nsystem_other.img\n, \nsystem.sig\n, \nsystem\n, true, true},\n    {\nvendor.img\n, \nvendor.sig\n, \nvendor\n, true, false},\n    {\nvendor_other.img\n, \nvendor.sig\n, \nvendor\n, true, true},\n};\n\n\n\n\n\n\u5176\u4e2d \nis_secondary\n \u5982\u679c\u4e3atrue, \u5219\u610f\u5473\u7740\u8f93\u5165\u975eactive slot.\n\n\n    \nif\n \n(!\nskip_secondary\n)\n \n{\n         \n//\n \n\u9ed8\u8ba4\n \nfalse\n\n        \nif\n \n(slot_override\n \n!=\n \n)\n \n{\n  \n//\n \n\u5237\u673a\u65f6\n \n\u4e3a\n \n\n            \nsecondary\n \n=\n \nget_other_slot(transport,\n \nslot_override)\n;\n\n        \n}\n \nelse\n \n{\n\n            \nsecondary\n \n=\n \nget_other_slot(transport)\n;\n \n//\n \n\u83b7\u53d6\u975eactive\n \nslot\n\n        \n}\n\n        \nif\n \n(\nsecondary\n \n==\n \n)\n \n{\n\n            \nif\n \n(supports_AB(transport))\n \n{\n\n                \nfprintf(stderr,\n \nWarning\n:\n \nCould\n \nnot\n \ndetermine\n \nslot\n \nfor\n \nsecondary\n \nimages\n.\n \nIgnoring\n.\n\\\nn\n);\n\n\n            }\n\n\n            skip_secondary = true;\n\n\n        }\n\n\n    }\n\n\n    for (size_t i = 0; i \n arraysize(images); ++i) {\n\n\n        const char* slot = slot_override.c_str();\n\n\n        if (images\n[\ni\n]\n.is_secondary) {\n\n\n            if (!skip_secondary) {\n\n\n                slot = secondary.c_str(); //\u6307\u5b9a\u4e3a\u975eactive slot\n\n\n            } else {\n\n\n                continue;\n\n\n            }\n\n\n        }\n\n\n\n        int fd = unzip_to_file(zip, images\n[\ni\n]\n.img_name);\n\n\n        if (fd == -1) {\n\n\n            if (images\n[\ni\n]\n.is_optional) {\n\n\n                continue;\n\n\n            }\n\n\n            CloseArchive(zip);\n\n\n            exit(1); // unzip_to_file already explained why.\n\n\n        }\n\n\n        fastboot_buffer buf;\n\n\n        if (!load_buf_fd(transport, fd, \nbuf)) {\n\n\n            die(\ncannot\n \nload\n \n%\ns\n \nfrom\n \nflash\n:\n \n%\ns\n,\n \nimages\n[\ni\n]\n.\nimg_name\n,\n \nstrerror\n(\nerrno\n));\n\n        \n}\n\n\n        \nauto\n \nupdate\n \n=\n \n[\n]\n(\nconst\n \nstd\n::\nstring\n \npartition\n)\n \n{\n\n            \ndo_update_signature(zip,\n \nimages\n[\ni\n]\n.sig_name)\n;\n\n            \nif\n \n(erase_first\n \n \nneeds_erase(transport,\n \npartition.c_str()))\n \n{\n\n                \nfb_queue_erase(partition.c_str())\n;\n\n            \n}\n\n            \nflash_buf\n(\npartition\n.\nc_str\n(),\n \nbuf\n);\n\n            \n/* not closing the fd here since the sparse code keeps the fd around\n\n\n             * but hasn\nt mmaped data yet. The tmpfile will get cleaned up when the\n\n\n             * program exits.\n\n\n             */\n\n        \n}\n;\n\n        \ndo_for_partitions\n(\ntransport\n,\n \nimages\n[\ni\n]\n.\npart_name\n,\n \nslot\n,\n \nupdate\n,\n \nfalse\n);\n\n    \n}\n\n\n\n\n\n\n\u6240\u4ee5, \nsystem_other.img\n \u4f1a\u5237\u5165\u975eactive slot, \u5982\u679cactive\u4e3aa. \u5219\u5237\u5165\nsystem_b\n. \n\n\n\u5728\u786e\u5b9a\nsystem_other.img\n\u4f1a\u5237\u5165\u53e6\u4e00\u4e2aslot\u540e, \u6309\u7167\u7b2c\u4e00\u4e2a\u89c4\u5219(\u53ea\u5237active\u7684slot), \u5219\u53ef\u4ee5\u57fa\u672c\u731c\u6d4b, \nsystem_other.img\n\u4e2d\u7684\u5185\u5bb9\u4e0d\u662f\u7528\u4e8e\u542f\u52a8\u7cfb\u7edf\u7684, \u6216\u8005\u4e0d\u662f\u5b8c\u6574\u7cfb\u7edf.\n\n\n\n\n\u5bf9\u6bd4, \u5176\u5185\u5bb9\u5dee\u5f02, \nsystem_other.img\n \u4e2d, \u53ea\u6709 app \u548c \npriv-app\n\u76ee\u5f55.\nsystem_other.img\n\u7684\u76ee\u5f55\u4e2d\u53ea\u5b58\u5728odex\u548cvdex\u6587\u4ef6, \u4e5f\u5c31\u662fapp\u4f18\u5316\u8fc7\u7684\u6587\u4ef6, \u5e76\u4e14\u989d\u5916\u591a\u4e00\u4e2a\u6587\u4ef6\nsystem-other-odex-marker\n. \u8fd9\u4e2a\u6587\u4ef6\u662f\u4e2a\u7ebf\u7d22, \u6240\u4ee5, \u521d\u6b65\u53ef\u4ee5\u5224\u65ad, \u7cfb\u7edf\u542f\u52a8\u540e\u4e00\u5b9a\u4f1a\u4ece\nsystem_b\n\u5c06\u8fd9\u4e9b\u6570\u636e\u590d\u5236\u5230/data/\u4e0b.\n\n\n\u4e0b\u9762\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u6587\u4ef6\u7684\u4f5c\u7528\u548c\u5982\u4f55copy.\n\n\non property:sys.cppreopt=requested \n property:ro.boot.slot_suffix=_a\n    mount ext4 /dev/block/bootdevice/by-name/system_b /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished\n\non property:sys.cppreopt=requested \n property:ro.boot.slot_suffix=_b\n    mount ext4 /dev/block/bootdevice/by-name/system_a /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished\n\n\n\n\n\n\u5728\u542f\u52a8\u4e3a\u4efb\u4f55\u4e4b\u4e00\u65f6, \u4f1a\u4ece\u53e6\u4e00\u4e2aslot\u6302\u8f7d\u5230/postinstall, \u7136\u540e\u4f7f\u7528cppreopts.sh, \u5c06odexvdex\u6587\u4ef6\u62f7\u8d1d\u5230\n/data/\ndalvik-cache/\nisa\n/\nxiam, isa\u662f\u786c\u4ef6\u67b6\u6784(arm64/arm32).\n\u800c \npreloads_copy.sh\n \u4f1a\u5c06\nsystem_other\n\u4e2d\u7684preloads\u6587\u4ef6\u62f7\u8d1d\u5230/data/preloads/ \u76ee\u5f55\u4e0b.\n\n\n\u57fa\u4e8e\u4ee5\u4e0asystem\u7684\u673a\u5236, \u5728\u5237\u673a\u65f6, \u5b9e\u9645\u53ea\u5237\u5165\u4e00\u5957\u7cfb\u7edf\u5230active slot\u4e2d, \u7136\u540e\u4ece\u53e6\u4e00\u5957\u7cfb\u7edf\u4e2d\u7684system\u5206\u533a\u5c06\u4f18\u5316\u540e\u7684dex\u5305\u62f7\u8d1d\u5230data\u5206\u533a\u4e0b,. \u4e0e\u4e4b\u524d\u7684\u5dee\u5f02\u662f, \u8fde\u5e94\u7528\u7684\u7f16\u8bd1\u548c\u4f18\u5316\u90fd\u5728host\u7aef\u5b8c\u6210, android8\u7684\u542f\u52a8\u901f\u5ea6\u5c06\u975e\u5e38\u5feb.\n\n\n\u6e90\u7801\u548c\u5206\u533a\u5927\u5c0f \n\n\n\u4ecerecovery\u7684fstab\u4e2d,\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7684\u5206\u533a\u8868\u5982\u4e0b:\n\n\n/dev/block/platform/soc/624000.ufshc/by-name/system_a\n/dev/block/platform/soc/624000.ufshc/by-name/system_b\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_a\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_b\n/dev/block/platform/soc/624000.ufshc/by-name/userdata\n/dev/block/platform/soc/624000.ufshc/by-name/boot_a\n/dev/block/platform/soc/624000.ufshc/by-name/boot_b\n\n\n\n\n\n\u4f46\u4ee5\u4e0a\u5206\u533a\u8868\u5728\u4e3b\u7cfb\u7edf\u4e2d\u65e0\u6cd5\u770b\u5230, \u6216\u8005\u8bf4\u4e3b\u7cfb\u7edf\u4e2d\u53ea\u6709\u5728vendor\u4e0b\u5b58\u5728fstab, \u5176\u4ed6\u5730\u65b9\u5e76\u6ca1\u6709, \u800cvendor\u4e0b\u7684fstab\u5185\u5bb9\u5982\u4e0b, \u662f\u7531vendor\u5e95\u4e0b\u7684init.{device}.rc \u6302\u8f7d.\n\n\n/dev/block/platform/soc/624000.ufshc/by-name/system     /                   ext4    ro,barrier=1                wait,slotselect,verify\n/dev/block/platform/soc/624000.ufshc/by-name/modem      /firmware/radio     vfat    ro,shortname=lower,uid=1000,gid=0,dmask=227,fmask=337,context=u:object_r:firmware_file:s0   wait,slotselect\n/dev/block/platform/soc/624000.ufshc/by-name/userdata   /data               ext4    noatime,nosuid,nodev,barrier=1,noauto_da_alloc  latemount,wait,check,formattable,fileencryption=ice,quota\n/dev/block/zram0                                        none                swap    defaults                    zramsize=536870912,max_comp_streams=4\n/dev/block/platform/soc/624000.ufshc/by-name/misc       /misc               emmc    defaults                    defaults\n/devices/*/xhci-hcd.0.auto/usb*                         auto                vfat    defaults                    voldmanaged=usb:auto\n\n\n\n\n\n\u521d\u6b65\u5224\u65ad, \u5176\u6709\u7528\u7684\u5185\u5bb9\u662f\u7ed9vold\u7684\u6302\u8f7d\u4fe1\u606f\u548c\u57fa\u5e26\u5206\u533a. \u4f46\u4e0d\u7ba1\u600e\u4e48\u770b\u81f3\u5c11\u7f3a\u5c11\u4e86vendor\u6302\u8f7d\u7684\u4fe1\u606f. \u800c\u4e14fstab\u5728vendor\u5206\u533a\u4e0b, \u5219\u610f\u5473\u7740vendor\u7684\u6302\u8f7d\u5c06\u63d0\u524d\u5230\u548cboot\u540c\u4e2a\u7ea7\u522b. \u6ca1\u9519, \u65b0\u5f15\u5165\u4e86\u4e00\u4e2a\nearly-mounted\n, \u800c\u5206\u533a\u8868\u662f\u5728 device tree \u4e2d, \u4e5f\u5c31\u662f\u542f\u52a8\u540e, \u5728 \n/proc/device-tree/firmware/android/fstab/vendor\n. \n\u4e0a\u6587\u7684fstab\u8fd8\u7ed9\u6211\u4eec\u4e00\u4e2a\u4fe1\u606f, \u6807\u5fd7\u4f4d\nslotselect\n, \u610f\u5473\u8fd9system\u5206\u533a\u662f\u5206A/B\u7cfb\u7edf\u7684\u5e76\u4e14\u7531init\u6839\u636eactive\u7684slot\u9009\u62e9\u5bf9\u5e94\u7684\u771f\u5b9e\u5206\u533a\u8def\u5f84(\u540e\u7f00'_a'\u6216'_b')\u8fdb\u884c\u6302\u8f7d.\n\n\n\u6211\u4eec\u5728\u770b\u4e00\u773csystem\u5206\u533a, \u5176\u6302\u8f7d\u70b9\u662f / .  \u6ca1\u9519, \u5728Android8\u4e4b\u540e, system\u5206\u533a\u7684\u786e\u662f\u88ab\u6302\u8f7d\u5230 /, \u4e5f\u5c31\u662f\u8bf4, system\u5206\u533a\u5305\u542b\u4e86rootfs, \u5176\u5185\u5bb9\u5982\u4e0b.\n\n\ntotal 1724\ndrwxr-xr-x. 21 root    root       4096 Sep  8 18:30 .\ndrwxrwxrwx  25 werther werther   32768 Sep 19 13:15 ..\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 acct\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 bt_firmware\nlrw-r--r--.  1 root    root         50 Sep  8 18:30 bugreports -\n /data/user_de/0/com.android.shell/files/bugreports\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 cache -\n /data/cache\nlrw-r--r--.  1 root    root         13 Sep  8 18:30 charger -\n /sbin/charger\ndr-x------.  2 root    root       4096 Sep  8 15:49 config\nlrw-r--r--.  1 root    root         17 Sep  8 18:30 d -\n /sys/kernel/debug\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 data\nlrw-------.  1 root    root         23 Sep  8 18:30 default.prop -\n system/etc/prop.default\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 dev\nlrw-r--r--.  1 root    root         15 Sep  8 18:30 dsp -\n /vendor/lib/dsp\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 etc -\n /system/etc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:49 firmware\n-rwxr-x---.  1 root       2000 1559136 Sep  8 18:11 init\n-rwxr-x---.  1 root       2000     996 Sep  8 15:49 init.environ.rc\n-rwxr-x---.  1 root       2000   26830 Sep  8 15:49 init.rc\n-rwxr-x---.  1 root       2000     141 Sep  8 15:49 init.recovery.marlin.rc\n-rwxr-x---.  1 root       2000    7623 Sep  8 15:49 init.usb.configfs.rc\n-rwxr-x---.  1 root       2000    5715 Sep  8 15:49 init.usb.rc\n-rwxr-x---.  1 root       2000     497 Sep  8 15:49 init.zygote32.rc\n-rwxr-x---.  1 root       2000     847 Sep  8 15:49 init.zygote64_32.rc\ndrwx------.  2 root    root      16384 Sep  8 18:30 lost+found\ndrwxr-xr-x.  2 root    werther    4096 Sep  8 15:49 mnt\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 oem\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 persist\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 postinstall\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 proc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:48 res\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 root\ndrwxr-x---.  2 root       2000    4096 Sep  8 18:11 sbin\nlrw-r--r--.  1 root    root         21 Sep  8 18:30 sdcard -\n /storage/self/primary\ndrwxr-x--x.  2 root       1028    4096 Sep  8 15:49 storage\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 sys\ndrwxr-xr-x. 16 root    root       4096 Sep  8 18:30 system\n-rw-r--r--.  1 root    root       4849 Sep  8 15:49 ueventd.rc\ndrwxr-xr-x.  2 root       2000    4096 Sep  8 15:49 vendor\n-rw-r--r--.  1 root    root        524 Sep  8 15:50 verity_key\n\n\n\n\n\n\u90a3\u4e48, \u8fd9\u4e9b\u53d8\u5316\u662f\u5982\u4f55\u505a\u5230\u7684, \u5e76\u4e14, \u4e3a\u4ec0\u4e48system.img\u4e2d\u8981\u5305\u542brootfs? \u6211\u4eec\u5728\u540e\u6587\u4f1a\u63d0\u5230.\n\n\n\n\u6211\u4eec\u6765\u770b\u4e0bAndroid\u5b98\u65b9\u7f51\u7ad9\u7ed9\u51fa\u7684\u4ece\u666e\u901a\u5206\u533a\u5207\u6362\u5230A/B\u5206\u533a, \u5bf9\u4e8e\u5206\u533a\u5927\u5c0f\u7684\u5f71\u54cd.\n\n\n\n\n\n\n\n\nPixel Partitions Size\n\n\nA/B\n\n\nNon-A/B\n\n\n\n\n\n\n\n\n\n\nBootloader\n\n\n50*2\n\n\n50\n\n\n\n\n\n\nBoot\n\n\n32*2\n\n\n32\n\n\n\n\n\n\nRecovery\n\n\n0\n\n\n32\n\n\n\n\n\n\nCache\n\n\n0\n\n\n100\n\n\n\n\n\n\nRadio\n\n\n70*2\n\n\n70\n\n\n\n\n\n\nVendor\n\n\n300*2\n\n\n300\n\n\n\n\n\n\nSystem\n\n\n2048*2\n\n\n4096\n\n\n\n\n\n\nTotal\n\n\n5000\n\n\n4680\n\n\n\n\n\n\n\n\n\u4ece\u8fd9\u5f20\u8868\u4e0a,\u6211\u4eec\u770b\u5230pixel\u5206\u533a\u7684A/B\u7cfb\u7edf\u5305\u62ec bootloader, boot, radio, vendor, system.\n\n\n\u5206\u533a\u8868\u6539\u53d8\u5bf9\u7cfb\u7edf\u903b\u8f91\u7684\u5f71\u54cd\n\n\n\u8fd9\u91cc\u603b\u7ed3\u4e0b\u4ee5\u4e0a\u5206\u533a\u8868\u7684\u6539\u53d8:\n\n\n\n\n\u6ca1\u6709recovery\u5206\u533a\u548ccache\u5206\u533a.\n\n\nvendor\u5206\u533a\u63d0\u524d\u6302\u8f7d(\u4e0d\u662f\u5728fstab\u6587\u4ef6\u4e2d\u4e2d\u6302\u8f7d, \u5728 device tree\u4e2d\u6307\u5b9a)\n\n\n\u771f\u5b9e\u5206\u533a\u540d\u5b57\u5b58\u5728\n_a\n\u548c\n_b\n\u540e\u7f00.\n\n\n\n\n \u6302\u8f7d\u5206\u533a\u65b9\u5f0f\u6539\u53d8 \n\n\nearly-mounted\n\u4ee3\u7801\u89c1 \ninit_first_stage.cpp\n\n\u5728init\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6, \u4f1a\u8c03\u7528\nDoFirstStageMount\n, \u548c\u4e00\u4e9b\u73af\u5883\u7684\u914d\u7f6e. \u5b8c\u6210\u540e\u518d\u6b21\u8fd0\u884cinit, \u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\u7684\u6267\u884c. \u800c\u7b2c\u4e8c\u9636\u6bb5\u5b9e\u9645\u4e0a\u5c31\u662f\u8ddf\u4ee5\u524d\u7684Android\u5904\u7406\u65b9\u5f0f\u4e00\u6837.\n\n\n\u6302\u8f7d\u65f6\u9009\u62e9slot\u7684\u4ee3\u7801\u89c1init\u7684\nDoFirstStageMount\n\n\u5237\u673a\u65f6\u9009\u62e9slog\u7684\u4ee3\u7801\u89c1fastboot, \u4e5f\u53ef\u89c1\u4e0a\u9762\u8d34\u7684\u4ee3\u7801.\n\n\nboot\u5305\u542brecovery\u529f\u80fd\n\n\n\u9996\u5148, \u5347\u7ea7\u5207\u6362\u6210A/B\u65e0\u7f1d\u5347\u7ea7, \u5177\u4f53\u8bf4\u660e\u8bf7\u53c2\u8003recovery8\u7684\u6587\u6863.\n\u4f46\u662f, recovery\u7684\u529f\u80fd\u5e76\u4e0d\u6b62\u662f\u5347\u7ea7, \u8fd8\u5305\u62ec\u6062\u590d, \u5982\u5176\u540d\u5b57.\n\n\n\u4e3a\u4e86\u652f\u6301\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u529f\u80fd, recovery\u7684\u529f\u80fd\u88ab\u96c6\u6210\u5230\u4e86boot\u4e2d, bootloader\u5728\u8fdb\u5165recovery\u7684\u65f6\u5019, \u8fdb\u7684\u662fboot\u5206\u533a, \u4f46\u662f\u4f20\u7684\u53c2\u6570\u4e0d\u5305\u542b\nskip_initramfs\n. \n\u6b63\u5e38\u542f\u52a8\u5230android\u7cfb\u7edf\u65f6\u7684\u542f\u52a8\u53c2\u6570.\n\n\nskip_initramfs rootwait ro init=/init root=\n/dev/dm-0 dm=system none ro,0 1 android-verity \npublic-key-id\n \npath-to-system-partition\n\n\n\n\n\n\n\u8fd9\u91cc\u8bbe\u7f6e\u7684\nskip_initramfs\n, \u662f\u901a\u77e5\u5185\u6838, \u8df3\u8fc7boot\u4e2d\u7684ramdisk. \u8fd9\u4e2a\u53c2\u6570\u662fandroid\u6dfb\u52a0\u7684, \u6807\u51c6\u5185\u6838\u4e0d\u652f\u6301. \n\u7136\u540e\u6211\u4eec\u89e3\u6790\u4e0b\u5269\u4f59\u53c2\u6570, \u4e3b\u8981\u662froot\u53c2\u6570. \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230, root\u6307\u5b9a\u7684\u662fsystem\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u6839\u5206\u533a\u5c31\u662f\u4ee5system\u5206\u533a.\n\n\n\u7136\u540e\u6211\u4eec\u770b\u4e0b\u542f\u52a8recovery\u65f6\u7684\u53c2\u6570.\n\n\nrootwait init=/init ro\n\n\n\n\n\n\u8fd9\u91cc\u56e0\u4e3a\u6ca1\u6307\u5b9a\nskip_initramfs\n, \u6240\u4ee5, \u4f1a\u76f4\u63a5\u8bfb\u53d6boot\u5206\u533a\u4e2d\u7684ramdisk.\n\n\n\u8fdb\u4e00\u6b65\u7684\u7406\u89e3\u5c31\u662f, boot.img\u5305\u542b\u7684\u662f\u4ee5\u524drecovery\u7684\u5185\u5bb9, \u529f\u80fd\u53ea\u6709\u6062\u590d\u51fa\u5382\u8bbe\u7f6e. \u800c\u539f\u6765\u7684boot\u4e0esystem\u5408\u5e76\u4e3asystem.img.\n\n\n\u7f16\u8bd1\u53c2\u6570\u6539\u53d8\n\n\nhttps://source.android.com/devices/tech/ota/ab_implement\n\n\n\u5fc5\u987b\u5b9a\u4e49\u5b58\u6863\u53c2\u6570\u5982\u4e0b:\n\n\n    AB_OTA_UPDATER := true\n    AB_OTA_PARTITIONS := \\\n      boot \\\n      system \\\n      vendor\n    *and other partitions updated through update_engine (radio, bootloader, etc.)*\n    BOARD_BUILD_SYSTEM_ROOT_IMAGE := true\n    TARGET_NO_RECOVERY := true\n    BOARD_USES_RECOVERY_AS_BOOT := true\n    PRODUCT_PACKAGES += \\\n      update_engine \\\n      update_verifier\n\n*For an example, refer to /device/google/marlin/+/android-7.1.0_r1/device-common.mk. You can optionally conduct the post-install (but pre-reboot) dex2oat step described in Compiling. *\n\n\n\n\n\n\u5fc5\u987b\u4e0d\u5b9a\u4e49\u7684\u53c2\u6570\u5982\u4e0b:\n\n\n    BOARD_RECOVERYIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE", 
            "title": "Android8\u5206\u533a\u8868\u5206\u6790"
        }, 
        {
            "location": "/android8-partiton-table/#_1", 
            "text": "\u5728Android8.0\u4e4b\u540e, \u5c31\u5b58\u5728\u4e24\u5957\u5206\u533a\u8868, \u5206\u522b\u5bf9\u5e94\u7684\u662fA/B\u7cfb\u7edf\u548c\u975eA/B\u7cfb\u7edf.   \u975eA/B\u7cfb\u7edf\u7684\u5206\u533a\u8868\u4e0e\u4e4b\u524d\u5206\u533a\u8868\u4e00\u6837, \u6ca1\u6709\u53d8\u5316.  A/B\u7cfb\u7edf\u7684\u5206\u533a\u8868, \u662f\u672c\u6587\u7684\u4e3b\u8981\u63cf\u8ff0\u70b9.   \u6240\u8c13\u7684A/B\u7cfb\u7edf, \u662f\u6307\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf, \u5176\u5206\u533a\u540d\u4e5f\u662f\u5b58\u5728 _a  \u548c  _b  \u7684\u533a\u522b.\u4e24\u5957\u7cfb\u7edf\u4e2d, \u53ea\u6709\u4e00\u5957\u4e3aactive, \u8fd0\u884c\u72b6\u6001, \u800c\u5347\u7ea7\u5219\u6267\u884c\u5728\u53e6\u4e00\u5957\u7cfb\u7edf\u7684\u5206\u533a\u4e2d. \u4ece\u800c\u8fbe\u5230, \u4e0d\u7ba1\u5347\u7ea7\u6210\u529f\u4e0e\u5426, \u603b\u6709\u4e00\u5957\u7cfb\u7edf\u4fdd\u8bc1\u80fd\u4f7f\u7528.  \u800c\u5237\u673a, \u5305\u62ec\u6302\u65f6\u7684\u5206\u533a\u8868\u4e2d, \u90fd\u4e0d\u4f1a\u6dfb\u52a0\u540e\u7f00( _a \u6216 _b ). \u53ea\u6709\u5728fastboot\u5237\u673a\u65f6, \u6216\u8005\u5728init\u6302\u8f7d\u65f6, \u627e\u5230active\u7684slot, \u5728\u6307\u5b9a\u5206\u533a\u540d\u5b57\u540e\u9762\u6dfb\u52a0\u540e\u7f00\u5e76\u6302\u8f7d. \u6240\u4ee5, \u5355\u7eaf\u4ece\u6e90\u7801\u6216\u8005\u5237\u673a\u5305\u662f\u65e0\u6cd5\u6307\u5b9a\u54ea\u4e9b\u5206\u533a\u88ab\u6307\u5b9a\u4e3aA/B\u4e86.  \nA/B\u7cfb\u7edf\u5e26\u6765\u7684\u597d\u5904\u662f:   \u65e0\u7f1d\u5347\u7ea7, \u4e0d\u9700\u8981\u518d\u8fdb\u5165recovery\u8fdb\u884c\u5347\u7ea7.  \u53cc\u7cfb\u7edf\u5907\u4efd, \u4e0d\u7ba1\u662f\u7cfb\u7edf\u5347\u7ea7\u5931\u8d25, \u8fd8\u662f\u88ab\u7834\u574f, \u90fd\u53ef\u4ee5\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u8bbe\u5907\u7684\u6b63\u5e38\u4f7f\u7528.", 
            "title": "\u5dee\u5f02\u7b80\u8ff0 "
        }, 
        {
            "location": "/android8-partiton-table/#_2", 
            "text": "\u4e0b\u9762\u4e3b\u8981\u9488\u5bf9pixel\u8bbe\u5907\u8fdb\u884c\u5206\u6790, \u4e5f\u5c31\u662fAndroid8\u7684\u6e90\u7801\u4e2dmarlin\u8bbe\u5907.", 
            "title": "\u5206\u533a\u8868\u4e0e\u5176\u5185\u5bb9"
        }, 
        {
            "location": "/android8-partiton-table/#_3", 
            "text": "\u9996\u5148\u6211\u4eec\u770b\u4e0bandroid\u5b98\u7f51\u63d0\u4f9b\u7684marlin\u8bbe\u5907\u5237\u673a\u6587\u4ef6. \u4e0b\u9762\u662f\u57fa\u5e26\u548cbootloader\u7684\u5237\u673a\u6587\u4ef6.   \nzip\u5305\u4e2d\u7684\u6587\u4ef6\u5982\u4e0b.   \u5982\u679c\u5355\u7eaf\u6309\u7167\u4e4b\u524d\u5bf9\u8be5zip\u5305\u6587\u4ef6\u7684\u7406\u89e3, \u6587\u4ef6\u540d\u5b57\u5c31\u662f\u5bf9\u5e94\u7684\u5206\u533a\u540d. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u5374\u5e76\u4e0d\u662f\u5982\u6b64. \u800c\u662f\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u67e5\u627eA/B\u5206\u533a.  \u9996\u5148, \u6700\u5148\u6ce8\u610f\u5230\u7684\u662f\u4e24\u4e2asystem\u5927\u5c0f\u4e0d\u4e00\u81f4, \u4f46\u662f\u8fd9\u4e2a\u5c55\u5f00\u6765\u8bb2\u6709\u70b9\u591a, \u6211\u4eec\u5148\u628aA/B\u7cfb\u7edf\u5237\u673a\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u4ecb\u7ecd\u4ee5\u4e0b, \u4ee3\u7801\u5728\u540e\u6587\u4ecb\u7ecd\u7b2c\u4e8c\u4e2a\u89c4\u5219\u65f6\u53ef\u4ee5\u540c\u65f6\u770b\u5230.  A/B\u7cfb\u7edffastboot\u5237\u673a\u65f6, \u5982\u679c\u6ca1\u6709\u6307\u5b9aslot, \u5219\u9ed8\u8ba4\u5237\u5165\u7684\u662factive\u7684slot, \u6bd4\u5982\u5982\u679cbootloader\u6807\u8bb0\u4e3aslot A \u4e3aactive, \u5219\u6240\u6709\u5206\u533a\u9ed8\u8ba4\u5237\u5165slot A, \u4e5f\u5c31\u662f\u8bf4 boot_a ,  system_a  \u7b49. \u4f46\u662f, \u5982\u679cbootloader\u53cd\u9988\u67d0\u4e2a\u5206\u533a\u6ca1\u6709\u533a\u5206A/B, \u5219\u9ed8\u8ba4\u76f4\u63a5\u5237\u5165\u8be5\u5206\u533a. \u6bd4\u5982 vendor \u65e0\u533a\u5206A/B, \u5219\u76f4\u63a5\u5237\u5165vendor.  \u7136\u540e, \u6211\u4eec\u5173\u6ce8\u4e0b system.img \u548c system_other.img , \u5982\u679c\u5355\u7eaf\u7406\u89e3\u4e3a\u8fd9\u4e24\u4e2aimage\u5206\u522b\u5237\u5165A/B\u5206\u533a, \u5219\u5927\u5c0f\u4e5f\u5b8c\u5168\u5bf9\u5e94\u4e0d\u4e0a. \u5927\u5c0f\u95ee\u9898, \u6211\u4eec\u7a0d\u540e\u518d\u770b, \u5148\u7814\u7a76\u4e0b system_other.img \u5237\u5165\u54ea\u4e2a\u5206\u533a.  static struct {\n    char img_name[17];\n    char sig_name[17];\n    char part_name[9];\n    bool is_optional;\n    bool is_secondary;\n} images[] = {\n    { boot.img ,  boot.sig ,  boot , false, false},\n    { boot_other.img ,  boot.sig ,  boot , true, true},\n    { recovery.img ,  recovery.sig ,  recovery , true, false},\n    { system.img ,  system.sig ,  system , false, false},\n    { system_other.img ,  system.sig ,  system , true, true},\n    { vendor.img ,  vendor.sig ,  vendor , true, false},\n    { vendor_other.img ,  vendor.sig ,  vendor , true, true},\n};  \u5176\u4e2d  is_secondary  \u5982\u679c\u4e3atrue, \u5219\u610f\u5473\u7740\u8f93\u5165\u975eactive slot.       if   (! skip_secondary )   {           //   \u9ed8\u8ba4   false \n         if   (slot_override   !=   )   {    //   \u5237\u673a\u65f6   \u4e3a   \n             secondary   =   get_other_slot(transport,   slot_override) ; \n         }   else   { \n             secondary   =   get_other_slot(transport) ;   //   \u83b7\u53d6\u975eactive   slot \n         } \n         if   ( secondary   ==   )   { \n             if   (supports_AB(transport))   { \n                 fprintf(stderr,   Warning :   Could   not   determine   slot   for   secondary   images .   Ignoring . \\ n );              }              skip_secondary = true;          }      }      for (size_t i = 0; i   arraysize(images); ++i) {          const char* slot = slot_override.c_str();          if (images [ i ] .is_secondary) {              if (!skip_secondary) {                  slot = secondary.c_str(); //\u6307\u5b9a\u4e3a\u975eactive slot              } else {                  continue;              }          }          int fd = unzip_to_file(zip, images [ i ] .img_name);          if (fd == -1) {              if (images [ i ] .is_optional) {                  continue;              }              CloseArchive(zip);              exit(1); // unzip_to_file already explained why.          }          fastboot_buffer buf;          if (!load_buf_fd(transport, fd,  buf)) {              die( cannot   load   % s   from   flash :   % s ,   images [ i ] . img_name ,   strerror ( errno )); \n         } \n\n         auto   update   =   [ ] ( const   std :: string   partition )   { \n             do_update_signature(zip,   images [ i ] .sig_name) ; \n             if   (erase_first     needs_erase(transport,   partition.c_str()))   { \n                 fb_queue_erase(partition.c_str()) ; \n             } \n             flash_buf ( partition . c_str (),   buf ); \n             /* not closing the fd here since the sparse code keeps the fd around               * but hasn t mmaped data yet. The tmpfile will get cleaned up when the               * program exits.               */ \n         } ; \n         do_for_partitions ( transport ,   images [ i ] . part_name ,   slot ,   update ,   false ); \n     }   \u6240\u4ee5,  system_other.img  \u4f1a\u5237\u5165\u975eactive slot, \u5982\u679cactive\u4e3aa. \u5219\u5237\u5165 system_b .   \u5728\u786e\u5b9a system_other.img \u4f1a\u5237\u5165\u53e6\u4e00\u4e2aslot\u540e, \u6309\u7167\u7b2c\u4e00\u4e2a\u89c4\u5219(\u53ea\u5237active\u7684slot), \u5219\u53ef\u4ee5\u57fa\u672c\u731c\u6d4b,  system_other.img \u4e2d\u7684\u5185\u5bb9\u4e0d\u662f\u7528\u4e8e\u542f\u52a8\u7cfb\u7edf\u7684, \u6216\u8005\u4e0d\u662f\u5b8c\u6574\u7cfb\u7edf.   \u5bf9\u6bd4, \u5176\u5185\u5bb9\u5dee\u5f02,  system_other.img  \u4e2d, \u53ea\u6709 app \u548c  priv-app \u76ee\u5f55. system_other.img \u7684\u76ee\u5f55\u4e2d\u53ea\u5b58\u5728odex\u548cvdex\u6587\u4ef6, \u4e5f\u5c31\u662fapp\u4f18\u5316\u8fc7\u7684\u6587\u4ef6, \u5e76\u4e14\u989d\u5916\u591a\u4e00\u4e2a\u6587\u4ef6 system-other-odex-marker . \u8fd9\u4e2a\u6587\u4ef6\u662f\u4e2a\u7ebf\u7d22, \u6240\u4ee5, \u521d\u6b65\u53ef\u4ee5\u5224\u65ad, \u7cfb\u7edf\u542f\u52a8\u540e\u4e00\u5b9a\u4f1a\u4ece system_b \u5c06\u8fd9\u4e9b\u6570\u636e\u590d\u5236\u5230/data/\u4e0b.  \u4e0b\u9762\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u6587\u4ef6\u7684\u4f5c\u7528\u548c\u5982\u4f55copy.  on property:sys.cppreopt=requested   property:ro.boot.slot_suffix=_a\n    mount ext4 /dev/block/bootdevice/by-name/system_b /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished\n\non property:sys.cppreopt=requested   property:ro.boot.slot_suffix=_b\n    mount ext4 /dev/block/bootdevice/by-name/system_a /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished  \u5728\u542f\u52a8\u4e3a\u4efb\u4f55\u4e4b\u4e00\u65f6, \u4f1a\u4ece\u53e6\u4e00\u4e2aslot\u6302\u8f7d\u5230/postinstall, \u7136\u540e\u4f7f\u7528cppreopts.sh, \u5c06odexvdex\u6587\u4ef6\u62f7\u8d1d\u5230 /data/\ndalvik-cache/ isa / xiam, isa\u662f\u786c\u4ef6\u67b6\u6784(arm64/arm32).\n\u800c  preloads_copy.sh  \u4f1a\u5c06 system_other \u4e2d\u7684preloads\u6587\u4ef6\u62f7\u8d1d\u5230/data/preloads/ \u76ee\u5f55\u4e0b.  \u57fa\u4e8e\u4ee5\u4e0asystem\u7684\u673a\u5236, \u5728\u5237\u673a\u65f6, \u5b9e\u9645\u53ea\u5237\u5165\u4e00\u5957\u7cfb\u7edf\u5230active slot\u4e2d, \u7136\u540e\u4ece\u53e6\u4e00\u5957\u7cfb\u7edf\u4e2d\u7684system\u5206\u533a\u5c06\u4f18\u5316\u540e\u7684dex\u5305\u62f7\u8d1d\u5230data\u5206\u533a\u4e0b,. \u4e0e\u4e4b\u524d\u7684\u5dee\u5f02\u662f, \u8fde\u5e94\u7528\u7684\u7f16\u8bd1\u548c\u4f18\u5316\u90fd\u5728host\u7aef\u5b8c\u6210, android8\u7684\u542f\u52a8\u901f\u5ea6\u5c06\u975e\u5e38\u5feb.", 
            "title": "\u5237\u673a\u6587\u4ef6\u548c\u5237\u673a\u65b9\u5f0f "
        }, 
        {
            "location": "/android8-partiton-table/#_4", 
            "text": "\u4ecerecovery\u7684fstab\u4e2d,\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7684\u5206\u533a\u8868\u5982\u4e0b:  /dev/block/platform/soc/624000.ufshc/by-name/system_a\n/dev/block/platform/soc/624000.ufshc/by-name/system_b\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_a\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_b\n/dev/block/platform/soc/624000.ufshc/by-name/userdata\n/dev/block/platform/soc/624000.ufshc/by-name/boot_a\n/dev/block/platform/soc/624000.ufshc/by-name/boot_b  \u4f46\u4ee5\u4e0a\u5206\u533a\u8868\u5728\u4e3b\u7cfb\u7edf\u4e2d\u65e0\u6cd5\u770b\u5230, \u6216\u8005\u8bf4\u4e3b\u7cfb\u7edf\u4e2d\u53ea\u6709\u5728vendor\u4e0b\u5b58\u5728fstab, \u5176\u4ed6\u5730\u65b9\u5e76\u6ca1\u6709, \u800cvendor\u4e0b\u7684fstab\u5185\u5bb9\u5982\u4e0b, \u662f\u7531vendor\u5e95\u4e0b\u7684init.{device}.rc \u6302\u8f7d.  /dev/block/platform/soc/624000.ufshc/by-name/system     /                   ext4    ro,barrier=1                wait,slotselect,verify\n/dev/block/platform/soc/624000.ufshc/by-name/modem      /firmware/radio     vfat    ro,shortname=lower,uid=1000,gid=0,dmask=227,fmask=337,context=u:object_r:firmware_file:s0   wait,slotselect\n/dev/block/platform/soc/624000.ufshc/by-name/userdata   /data               ext4    noatime,nosuid,nodev,barrier=1,noauto_da_alloc  latemount,wait,check,formattable,fileencryption=ice,quota\n/dev/block/zram0                                        none                swap    defaults                    zramsize=536870912,max_comp_streams=4\n/dev/block/platform/soc/624000.ufshc/by-name/misc       /misc               emmc    defaults                    defaults\n/devices/*/xhci-hcd.0.auto/usb*                         auto                vfat    defaults                    voldmanaged=usb:auto  \u521d\u6b65\u5224\u65ad, \u5176\u6709\u7528\u7684\u5185\u5bb9\u662f\u7ed9vold\u7684\u6302\u8f7d\u4fe1\u606f\u548c\u57fa\u5e26\u5206\u533a. \u4f46\u4e0d\u7ba1\u600e\u4e48\u770b\u81f3\u5c11\u7f3a\u5c11\u4e86vendor\u6302\u8f7d\u7684\u4fe1\u606f. \u800c\u4e14fstab\u5728vendor\u5206\u533a\u4e0b, \u5219\u610f\u5473\u7740vendor\u7684\u6302\u8f7d\u5c06\u63d0\u524d\u5230\u548cboot\u540c\u4e2a\u7ea7\u522b. \u6ca1\u9519, \u65b0\u5f15\u5165\u4e86\u4e00\u4e2a early-mounted , \u800c\u5206\u533a\u8868\u662f\u5728 device tree \u4e2d, \u4e5f\u5c31\u662f\u542f\u52a8\u540e, \u5728  /proc/device-tree/firmware/android/fstab/vendor . \n\u4e0a\u6587\u7684fstab\u8fd8\u7ed9\u6211\u4eec\u4e00\u4e2a\u4fe1\u606f, \u6807\u5fd7\u4f4d slotselect , \u610f\u5473\u8fd9system\u5206\u533a\u662f\u5206A/B\u7cfb\u7edf\u7684\u5e76\u4e14\u7531init\u6839\u636eactive\u7684slot\u9009\u62e9\u5bf9\u5e94\u7684\u771f\u5b9e\u5206\u533a\u8def\u5f84(\u540e\u7f00'_a'\u6216'_b')\u8fdb\u884c\u6302\u8f7d.  \u6211\u4eec\u5728\u770b\u4e00\u773csystem\u5206\u533a, \u5176\u6302\u8f7d\u70b9\u662f / .  \u6ca1\u9519, \u5728Android8\u4e4b\u540e, system\u5206\u533a\u7684\u786e\u662f\u88ab\u6302\u8f7d\u5230 /, \u4e5f\u5c31\u662f\u8bf4, system\u5206\u533a\u5305\u542b\u4e86rootfs, \u5176\u5185\u5bb9\u5982\u4e0b.  total 1724\ndrwxr-xr-x. 21 root    root       4096 Sep  8 18:30 .\ndrwxrwxrwx  25 werther werther   32768 Sep 19 13:15 ..\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 acct\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 bt_firmware\nlrw-r--r--.  1 root    root         50 Sep  8 18:30 bugreports -  /data/user_de/0/com.android.shell/files/bugreports\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 cache -  /data/cache\nlrw-r--r--.  1 root    root         13 Sep  8 18:30 charger -  /sbin/charger\ndr-x------.  2 root    root       4096 Sep  8 15:49 config\nlrw-r--r--.  1 root    root         17 Sep  8 18:30 d -  /sys/kernel/debug\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 data\nlrw-------.  1 root    root         23 Sep  8 18:30 default.prop -  system/etc/prop.default\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 dev\nlrw-r--r--.  1 root    root         15 Sep  8 18:30 dsp -  /vendor/lib/dsp\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 etc -  /system/etc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:49 firmware\n-rwxr-x---.  1 root       2000 1559136 Sep  8 18:11 init\n-rwxr-x---.  1 root       2000     996 Sep  8 15:49 init.environ.rc\n-rwxr-x---.  1 root       2000   26830 Sep  8 15:49 init.rc\n-rwxr-x---.  1 root       2000     141 Sep  8 15:49 init.recovery.marlin.rc\n-rwxr-x---.  1 root       2000    7623 Sep  8 15:49 init.usb.configfs.rc\n-rwxr-x---.  1 root       2000    5715 Sep  8 15:49 init.usb.rc\n-rwxr-x---.  1 root       2000     497 Sep  8 15:49 init.zygote32.rc\n-rwxr-x---.  1 root       2000     847 Sep  8 15:49 init.zygote64_32.rc\ndrwx------.  2 root    root      16384 Sep  8 18:30 lost+found\ndrwxr-xr-x.  2 root    werther    4096 Sep  8 15:49 mnt\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 oem\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 persist\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 postinstall\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 proc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:48 res\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 root\ndrwxr-x---.  2 root       2000    4096 Sep  8 18:11 sbin\nlrw-r--r--.  1 root    root         21 Sep  8 18:30 sdcard -  /storage/self/primary\ndrwxr-x--x.  2 root       1028    4096 Sep  8 15:49 storage\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 sys\ndrwxr-xr-x. 16 root    root       4096 Sep  8 18:30 system\n-rw-r--r--.  1 root    root       4849 Sep  8 15:49 ueventd.rc\ndrwxr-xr-x.  2 root       2000    4096 Sep  8 15:49 vendor\n-rw-r--r--.  1 root    root        524 Sep  8 15:50 verity_key  \u90a3\u4e48, \u8fd9\u4e9b\u53d8\u5316\u662f\u5982\u4f55\u505a\u5230\u7684, \u5e76\u4e14, \u4e3a\u4ec0\u4e48system.img\u4e2d\u8981\u5305\u542brootfs? \u6211\u4eec\u5728\u540e\u6587\u4f1a\u63d0\u5230.  \n\u6211\u4eec\u6765\u770b\u4e0bAndroid\u5b98\u65b9\u7f51\u7ad9\u7ed9\u51fa\u7684\u4ece\u666e\u901a\u5206\u533a\u5207\u6362\u5230A/B\u5206\u533a, \u5bf9\u4e8e\u5206\u533a\u5927\u5c0f\u7684\u5f71\u54cd.     Pixel Partitions Size  A/B  Non-A/B      Bootloader  50*2  50    Boot  32*2  32    Recovery  0  32    Cache  0  100    Radio  70*2  70    Vendor  300*2  300    System  2048*2  4096    Total  5000  4680     \u4ece\u8fd9\u5f20\u8868\u4e0a,\u6211\u4eec\u770b\u5230pixel\u5206\u533a\u7684A/B\u7cfb\u7edf\u5305\u62ec bootloader, boot, radio, vendor, system.", 
            "title": "\u6e90\u7801\u548c\u5206\u533a\u5927\u5c0f "
        }, 
        {
            "location": "/android8-partiton-table/#_5", 
            "text": "\u8fd9\u91cc\u603b\u7ed3\u4e0b\u4ee5\u4e0a\u5206\u533a\u8868\u7684\u6539\u53d8:   \u6ca1\u6709recovery\u5206\u533a\u548ccache\u5206\u533a.  vendor\u5206\u533a\u63d0\u524d\u6302\u8f7d(\u4e0d\u662f\u5728fstab\u6587\u4ef6\u4e2d\u4e2d\u6302\u8f7d, \u5728 device tree\u4e2d\u6307\u5b9a)  \u771f\u5b9e\u5206\u533a\u540d\u5b57\u5b58\u5728 _a \u548c _b \u540e\u7f00.", 
            "title": "\u5206\u533a\u8868\u6539\u53d8\u5bf9\u7cfb\u7edf\u903b\u8f91\u7684\u5f71\u54cd"
        }, 
        {
            "location": "/android8-partiton-table/#_6", 
            "text": "early-mounted \u4ee3\u7801\u89c1  init_first_stage.cpp \n\u5728init\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6, \u4f1a\u8c03\u7528 DoFirstStageMount , \u548c\u4e00\u4e9b\u73af\u5883\u7684\u914d\u7f6e. \u5b8c\u6210\u540e\u518d\u6b21\u8fd0\u884cinit, \u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\u7684\u6267\u884c. \u800c\u7b2c\u4e8c\u9636\u6bb5\u5b9e\u9645\u4e0a\u5c31\u662f\u8ddf\u4ee5\u524d\u7684Android\u5904\u7406\u65b9\u5f0f\u4e00\u6837.  \u6302\u8f7d\u65f6\u9009\u62e9slot\u7684\u4ee3\u7801\u89c1init\u7684 DoFirstStageMount \n\u5237\u673a\u65f6\u9009\u62e9slog\u7684\u4ee3\u7801\u89c1fastboot, \u4e5f\u53ef\u89c1\u4e0a\u9762\u8d34\u7684\u4ee3\u7801.", 
            "title": " \u6302\u8f7d\u5206\u533a\u65b9\u5f0f\u6539\u53d8 "
        }, 
        {
            "location": "/android8-partiton-table/#bootrecovery", 
            "text": "\u9996\u5148, \u5347\u7ea7\u5207\u6362\u6210A/B\u65e0\u7f1d\u5347\u7ea7, \u5177\u4f53\u8bf4\u660e\u8bf7\u53c2\u8003recovery8\u7684\u6587\u6863.\n\u4f46\u662f, recovery\u7684\u529f\u80fd\u5e76\u4e0d\u6b62\u662f\u5347\u7ea7, \u8fd8\u5305\u62ec\u6062\u590d, \u5982\u5176\u540d\u5b57.  \u4e3a\u4e86\u652f\u6301\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u529f\u80fd, recovery\u7684\u529f\u80fd\u88ab\u96c6\u6210\u5230\u4e86boot\u4e2d, bootloader\u5728\u8fdb\u5165recovery\u7684\u65f6\u5019, \u8fdb\u7684\u662fboot\u5206\u533a, \u4f46\u662f\u4f20\u7684\u53c2\u6570\u4e0d\u5305\u542b skip_initramfs . \n\u6b63\u5e38\u542f\u52a8\u5230android\u7cfb\u7edf\u65f6\u7684\u542f\u52a8\u53c2\u6570.  skip_initramfs rootwait ro init=/init root= /dev/dm-0 dm=system none ro,0 1 android-verity  public-key-id   path-to-system-partition   \u8fd9\u91cc\u8bbe\u7f6e\u7684 skip_initramfs , \u662f\u901a\u77e5\u5185\u6838, \u8df3\u8fc7boot\u4e2d\u7684ramdisk. \u8fd9\u4e2a\u53c2\u6570\u662fandroid\u6dfb\u52a0\u7684, \u6807\u51c6\u5185\u6838\u4e0d\u652f\u6301. \n\u7136\u540e\u6211\u4eec\u89e3\u6790\u4e0b\u5269\u4f59\u53c2\u6570, \u4e3b\u8981\u662froot\u53c2\u6570. \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230, root\u6307\u5b9a\u7684\u662fsystem\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u6839\u5206\u533a\u5c31\u662f\u4ee5system\u5206\u533a. \n\u7136\u540e\u6211\u4eec\u770b\u4e0b\u542f\u52a8recovery\u65f6\u7684\u53c2\u6570.  rootwait init=/init ro  \u8fd9\u91cc\u56e0\u4e3a\u6ca1\u6307\u5b9a skip_initramfs , \u6240\u4ee5, \u4f1a\u76f4\u63a5\u8bfb\u53d6boot\u5206\u533a\u4e2d\u7684ramdisk.  \u8fdb\u4e00\u6b65\u7684\u7406\u89e3\u5c31\u662f, boot.img\u5305\u542b\u7684\u662f\u4ee5\u524drecovery\u7684\u5185\u5bb9, \u529f\u80fd\u53ea\u6709\u6062\u590d\u51fa\u5382\u8bbe\u7f6e. \u800c\u539f\u6765\u7684boot\u4e0esystem\u5408\u5e76\u4e3asystem.img.", 
            "title": "boot\u5305\u542brecovery\u529f\u80fd"
        }, 
        {
            "location": "/android8-partiton-table/#_7", 
            "text": "https://source.android.com/devices/tech/ota/ab_implement  \u5fc5\u987b\u5b9a\u4e49\u5b58\u6863\u53c2\u6570\u5982\u4e0b:      AB_OTA_UPDATER := true\n    AB_OTA_PARTITIONS := \\\n      boot \\\n      system \\\n      vendor\n    *and other partitions updated through update_engine (radio, bootloader, etc.)*\n    BOARD_BUILD_SYSTEM_ROOT_IMAGE := true\n    TARGET_NO_RECOVERY := true\n    BOARD_USES_RECOVERY_AS_BOOT := true\n    PRODUCT_PACKAGES += \\\n      update_engine \\\n      update_verifier\n\n*For an example, refer to /device/google/marlin/+/android-7.1.0_r1/device-common.mk. You can optionally conduct the post-install (but pre-reboot) dex2oat step described in Compiling. *  \u5fc5\u987b\u4e0d\u5b9a\u4e49\u7684\u53c2\u6570\u5982\u4e0b:      BOARD_RECOVERYIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE", 
            "title": "\u7f16\u8bd1\u53c2\u6570\u6539\u53d8"
        }, 
        {
            "location": "/Android-AB-system-update/", 
            "text": "\u6765\u6e90:https://pengzhangdev.github.io/Android-AB-system-update/\n\n\n A/B\u7cfb\u7edf\u7b80\u4ecb \n\n\n\n\u987e\u540d\u601d\u4e49, \nA/B\n\u7cfb\u7edf\u5c31\u662f\u6307\u7ec8\u7aef\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf,(userdata\u53ea\u6709\u4e00\u4efd, \u88ab\u4e24\u5957\u7cfb\u7edf\u5171\u7528). \u7b80\u5355\u6765\u8bb2, \u53ef\u4ee5\u7406\u89e3\u4e3a, \u5b58\u5728\u4e00\u5957\u7cfb\u7edf\u5206\u533a, \u4e00\u5957\u5907\u4efd\u5206\u533a, \u4e24\u5957\u7cfb\u7edf\u90fd\u53ef\u4ee5\u88ab\u542f\u52a8, \u4e24\u5957\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u53ef\u4ee5\u4e00\u6837, \u4e5f\u53ef\u4ee5\u4e00\u5957\u65e7, \u4e00\u5957\u65b0. \u800c\u5347\u7ea7\u5c31\u662f\u5c06\u65e7\u7684\u7cfb\u7edf\u5347\u7ea7\u5230\u65b0\u7248\u672c.\n\n\nA/B\u7cfb\u7edf\u5b9e\u73b0\u4e86\u65e0\u7f1d\u5347\u7ea7(Seamless System Updates), \u5b58\u5728\u5982\u4e0b\u7279\u70b9:\n\n\n\n\n\u7ec8\u7aef\u8bbe\u5907\u5728\u51fa\u5382\u65f6\u6709\u4e24\u5957\u8bbe\u5907\u53ef\u4ee5\u5de5\u4f5c, \u5728\u5347\u7ea7\u51fa\u73b0\u5f02\u5e38\u6216\u8005\u51fa\u9519\u65f6, \u59cb\u7ec8\u786e\u4fdd\u7cfb\u7edf\u5b58\u5728\u4e00\u5957\u8bbe\u5907\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c.\n\n\n\u7cfb\u7edf\u5728\u540e\u53f0\u8fdb\u884c\u5347\u7ea7, \u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf, \u7528\u6237\u4e0d\u4f1a\u88ab\u6253\u65ad. \u5728\u66f4\u65b0\u5b8c\u6210\u540e, \u7528\u6237\u5728\u4e0b\u6b21\u91cd\u542f\u624b\u673a\u65f6, \u5c31\u4f1a\u8fdb\u5165\u65b0\u7cfb\u7edf.\n\n\n\u5728 dm-verity \u6216\u8005\u5176\u4ed6\u6821\u9a8c\u65b9\u5f0f\u68c0\u6d4b\u5230\u7cfb\u7edf\u987a\u574f\u6216\u5f02\u5e38\u540e, \u53ef\u4ee5\u91cd\u542f\u56de\u5230\u5347\u7ea7\u524d\u7684\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u4f7f\u7528\u4e0d\u53d7\u5f71\u54cd.\n\n\n\n\nAndroid8.0\u7684\u4ee3\u7801\u7f16\u8bd1\u65f6, \u5728BoardConfig\u6709\u5bf9\u5e94\u7684\u9009\u9879\u6765\u63a7\u5236\u662f\u7f16\u8bd1\u6210A/B\u7cfb\u7edf\u8fd8\u662f\u6b63\u5e38\u5355\u7cfb\u7edf. \u7531\u4e8e\u65b0\u7cfb\u7edf\u8ddf\u539f\u6765\u7684OTA\u5347\u7ea7\u7cfb\u7edf\u5b58\u5728\u5927\u4e0d\u540c, \u5bfc\u81f4\u65e0\u6cd5\u901a\u8fc7\u4ee5\u524d\u7684OTA\u5347\u7ea7\u65b9\u5f0f(\u5b89\u5168\u5730)\u5347\u7ea7\u5230A/B\u7cfb\u7edf.\n\n\n\u800cA/B\u7cfb\u7edf\u5347\u7ea7, \u662f\u7531\u8fd0\u884c\u4e8eAndroid\u540e\u53f0\u7684\nupdate_engine\n\u548c \nslot a\n, \nslot b\n\u4e24\u5957\u7cfb\u7edf\u5171\u540c\u5b8c\u6210. \u5728\u542f\u52a8\u5176\u4e2d\u4e00\u5957\u7cfb\u7edf\u7684\u60c5\u51b5\u4e0b, \nupdate_engine\n\u5728\u540e\u53f0\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u4e0b\u8f7d\u5347\u7ea7\u6d41\u5e76\u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf.\n\n\nA/B \u7cfb\u7edf\u5347\u7ea7\u4e3b\u8981\u6d89\u53ca\u5982\u4e0b4\u4e2a\u65b9\u9762:\n\n\n\n\n\u5206\u533a\u9009\u62e9(slots), \u5373\u9009\u62e9\u54ea\u4e2a\u7cfb\u7edf.\n\n\nupdate_engine\n, \u5373\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7\n\n\nbootloader\u4ea4\u4e92, \u5373\u5982\u4f55\u901a\u77e5bootloader\u5207\u6362slot\n\n\nota\u5305\u751f\u6210.\n\n\n\n\n\n \u5206\u533a\u9009\u62e9 \n\n\n\n\n\u5206\u533a\u8868\u548c\u5206\u533a\u5185\u5bb9\u53d8\u5316\n\n\n\n\n\u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003 \nAndroid8 \u5206\u533a\u8868\u548c\u5206\u533a\u76f8\u5173\u64cd\u4f5c\n. \u8fd9\u91cc\u7b80\u5355\u603b\u7ed3\u4e0b\u5206\u533a\u8868\u4e0a\u8ddf\u5355\u7cfb\u7edf\u7684\u5dee\u5f02.\n\u8fd9\u91cc\u4ee5boot,system, vendor\u548cmodem\u5b58\u5728\u4e24\u5957\u7cfb\u7edf\u4e3a\u4f8b\u5b50, \u5176\u4f59\u5206\u533a\u6309\u7167\u6700\u5c0f\u5206\u533a\u8868.\n\n\n\n\n\n\n\n\n\u5355\u7cfb\u7edf\u5206\u533a\u8868\n\n\nA/B\u7cfb\u7edf\u5206\u533a\u8868\n\n\n\u529f\u80fd\u63cf\u8ff0\n\n\n\n\n\n\n\n\n\n\nbootloader\n\n\nbootloader\n\n\n\u5f15\u5bfclinux\u7cfb\u7edf\n\n\n\n\n\n\nmisc\n\n\nmisc\n\n\nAndroid\u7cfb\u7edf\u4e0erecovery, bootloade\u901a\u4fe1\u7684\u6570\u636e\n\n\n\n\n\n\nboot\n\n\n-\n\n\n\u5b58\u653eAndroid\u7684kernel\u548cramdisk\n\n\n\n\n\n\n-\n\n\nboot_a\n\n\n\u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk\n\n\n\n\n\n\n-\n\n\nboot_b\n\n\n\u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk\n\n\n\n\n\n\nsystem\n\n\n-\n\n\nAndroid\u7cfb\u7edf\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6.\n\n\n\n\n\n\n-\n\n\nsystem_a\n\n\n\u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6\n\n\n\n\n\n\n-\n\n\nsystem_b\n\n\n\u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6\n\n\n\n\n\n\n-\n\n\nvendor_a\n\n\n\u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4\n\n\n\n\n\n\n-\n\n\nvendor_b\n\n\n\u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4\n\n\n\n\n\n\ncache\n\n\n-\n\n\n\u4e34\u65f6\u5b58\u653e\u6570\u636e, \u901a\u5e38\u4e34\u65f6\u5b58\u653e\u4e0b\u8f7d, \u5907\u4efd\u548c\u5347\u7ea7\u5305\n\n\n\n\n\n\nrecovery\n\n\n-\n\n\n\u5b58\u653erecovery\u7cfb\u7edf\u7684kernel\u548cramdisk\n\n\n\n\n\n\nuserdata\n\n\nuserdata\n\n\n\u5b58\u653e\u7528\u6237\u6570\u636e\n\n\n\n\n\n\n\n\n\u6240\u8c13\u7684A/B\u7cfb\u7edf\u5206\u533a, \u5c31\u662f\u5728\u539f\u6709\u5206\u533a\u540d\u5b57\u540e\u5417\u6dfb\u52a0\n_a\n \u548c \n_b\n, \u5728\u5237\u673a, \u6216\u8005\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019, \u6839\u636ebootloader\u7684\u53c2\u6570\u6dfb\u52a0\u540e\u7f00, \u9009\u62e9\u6b63\u786e\u7684\u7cfb\u7edf. misc\u5206\u533a\u5728A/B\u7cfb\u7edf\u4e2d\u53d8\u6210\u4e00\u4e2a\u53ef\u6709\u53ef\u65e0\u7684\u5b58\u5728, \u56e0\u4e3a\u5176\u529f\u80fd\u53ea\u662f\u4f20\u9012\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u53c2\u6570, \u800crecovery\u7684\u529f\u80fd\u4e5f\u53ea\u5269\u4e0b\u6062\u590d\u51fa\u5382\u8bbe\u7f6e, \u6240\u4ee5, \u672c\u8d28\u4e0a, \u6ca1\u5fc5\u8981\u518d\u57fa\u4e8emisc\u4f20\u9012\u53c2\u6570\u4e86.\n\n\n\n\u7cfb\u7edf\u5206\u533a\u5c5e\u6027\n\n\n\nbootloader\u4e3a\u4e86\u5224\u65ad\u4e00\u4e2a\u7cfb\u7edf(slot)\u662f\u5426\u4e3a\u53ef\u4ee5\u542f\u52a8\u7684\u72b6\u6001, \u9700\u8981\u4e3a\u5176\u5b9a\u4e49\u5bf9\u5e94\u7684\u5c5e\u6027(\u72b6\u6001). \u5176\u72b6\u6001\u8bf4\u660e\u5982\u4e0b:\n\n\n\n\nactive. \u6d3b\u52a8\u5206\u533a\u6807\u8bc6, \u6392\u4ed6, \u4ee3\u8868\u8be5\u5206\u533a\u4e3a\u542f\u52a8\u5206\u533a, bootloader\u603b\u4f1a\u9009\u62e9\u8be5\u5206\u533a.\n\n\nbootable. \u8868\u793a\u8be5slot\u7684\u5206\u533a\u5b58\u5728\u4e00\u5957\u53ef\u80fd\u53ef\u4ee5\u542f\u52a8\u7684\u7cfb\u7edf.\n\n\nsuccessful. \u8868\u793a\u8be5slot\u7684\u7cfb\u7edf\u80fd\u6b63\u5e38\u542f\u52a8.\n\n\nunbootable. \u4ee3\u8868\u8be5\u5206\u533a\u635f\u574f\u7684, \u65e0\u6cd5\u542f\u52a8, \u5728\u5347\u7ea7\u8fc7\u7a0b\u603b\u88ab\u6807\u8bb0, \u8be5\u6807\u8bb0\u7b49\u6548\u4e8e\u4ee5\u4e0a\u6807\u8bb0\u88ab\u6e05\u7a7a. \u800cactive\u6807\u8bb0\u4f1a\u5c06\u8be5\u6807\u8bb0\u6e05\u7a7a.\n\n\n\n\nslot a\n \u548c \nslot b\n, \u53ea\u6709\u4e00\u4e2a\u662factive, \u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u6709 bootable \u548c successful \u5c5e\u6027.\n\n\n\n\n\nbootloader\u68c0\u6d4b\u52301\u4e2a\u6216\u80052\u4e2aslot\u90fd\u662fbootable\u7684\u72b6\u6001.\n\n\n\u9009\u62e9active\u7684slot\u6216\u8005\u9009\u62e9successful\u7684slot\u8fdb\u884c\u5c1d\u8bd5\u542f\u52a8.\n\n\n\u542f\u52a8\u6210\u529f\u7684\u6807\u8bb0\u662f, dm-verity \u6210\u529f.\n\n\n\u7531\u4e8e\u542f\u52a8\u6210\u529f, \u5219\u8be5slot\u88ab\u6807\u8bb0\u4e3asuccessful\u548cactive\n\n\n\u7531\u4e8e\u542f\u52a8\u5931\u8d25, \u5219\u8bbe\u7f6e\u8be5slot\u4e3aunbootable, \u5e76\u8bbe\u7f6e\u53e6\u4e00\u4e2aslot\u4e3aactive, \u8fdb\u884c\u4e0b\u4e00\u6b21\u5c1d\u8bd5.\n\n\n\n\n\n\n\n\n\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7\n\n\n\n\n\u9996\u5148, \u6211\u4eec\u770b\u4e0b\u5347\u7ea7\u5305\u7684\u5185\u5bb9. \u5728A/B\u5347\u7ea7\u7684\u60c5\u51b5\u4e0b, \u5347\u7ea7\u5305\u5185\u5bb9\u5982\u4e0b:\n\n\nPath = aosp_marlin-ota-eng.builder.zip\nType = zip\nComment = signed by SignApk\nPhysical Size = 384694679\n\n   Date      Time    Attr         Size   Compressed  Name\n------------------- ----- ------------ ------------  ------------------------\n2009-01-01 00:00:00 .....          360          360  META-INF/com/android/metadata\n2009-01-01 00:00:00 .....          107          107  care_map.txt\n2009-01-01 00:00:00 .....    384690699    384690699  payload.bin\n2009-01-01 00:00:00 .....          154          154  payload_properties.txt\n2009-01-01 00:00:00 .....         1675          943  META-INF/com/android/otacert\n------------------- ----- ------------ ------------  ------------------------\n                             384692995    384692263  5 files, 0 folders\n\n\n\n\n\n\n\n\u4e0b\u8f7d\u548c\u5347\u7ea7\u7a0b\u5e8f\u662f\nupdate_engine\n, \u6765\u81eachrome os, \u4ee3\u7801\u4e2d\u5927\u91cf\u5b58\u5728dbus\u548cchrome os\u7684\u75d5\u8ff9, \u800cAndroid\u4e0a\u6539\u7a0b\u5e8f\u662f\u57fa\u4e8ebinde\u8fdb\u884c\u901a\u4fe1. \u4e0e\u539f\u5148\u7684ota\u5347\u7ea7\u4e0d\u540c, \u8be5\u5347\u7ea7\u5305\u4e2d\u4e0d\u5305\u542bupdater, \u4e5f\u5c31\u662f\u8bf4, \u5347\u7ea7\u7684\u903b\u8f91\u5728\u8bbe\u5907\u7aef\u800c\u4e0d\u662f\u5728\u5347\u7ea7\u5305\u4e2d. \u5982\u679c\u719f\u6089ota\u5347\u7ea7\u7684\u8bdd, \u8fd9\u4e2a\u5347\u7ea7\u5305\u4e2d\u7684\u6570\u636e\u8ddf\u5757\u5347\u7ea7\u6570\u636e\u51e0\u4e4e\u4e00\u6837, \u521d\u6b65\u5224\u65ad\u7528\u7684\u662f\u5757\u5347\u7ea7.\n\u90a3\u4e48, \u5982\u679c\u6709\u65b0\u7684\u9700\u6c42, \u6bd4\u5982\u6b64\u6b21\u66f4\u65b0\u9700\u8981\u8c03\u6574\u6570\u636e\u5e93, \u662f\u5982\u4f55\u505a\u5230\u7684? \u8bf7\u67e5\u770b\u540e\u6587\u7b2c\u4e8c\u6b65\u5347\u7ea7.\n\n\n\n\u6574\u4e2a\u5347\u7ea7\u5206\u4e3a\u4e94\u6b65:\n\n\n\n\n\u4e0b\u8f7d\u5347\u7ea7\u5305, \u6216\u8005\u5347\u7ea7\u6d41. Android8 \u65b0\u652f\u6301\u4e86\u6d41\u5f0f\u5347\u7ea7, \u53ef\u4ee5\u8fb9\u4e0b\u8fb9\u5347.\n\n\n\u7b2c\u4e00\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f, \nupdate_engine\n\u6267\u884c\u7684\u5347\u7ea7\u903b\u8f91, \u57fa\u672c\u7684\u6570\u636e\u5199\u5165.\n\n\n\u6821\u9a8c\u5199\u5165\u6570\u636e. \u786e\u4fdd\u4e0a\u4e00\u6b65\u5199\u5165\u6570\u636e\u53ef\u9760\u5b8c\u6574.\n\n\n\u7b2c\u4e8c\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f, \u6302\u8f7d\u65b0\u70e7\u5199\u7684\u5206\u533a, \u5e76\u6267\u884c\u5176\u4e2d\u7684\u6307\u5b9a\u811a\u672c(\u7a0b\u5e8f)\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u64cd\u4f5c.\n\n\n\u5e94\u7528\u4f18\u5316.  \u7531\u4e8e\u5b58\u5728A/B\u65b0\u65e7\u4e24\u5957\u7cfb\u7edf, \u6240\u4ee5, data\u5e95\u4e0b\u4e5f\u5b58\u5728\u4e24\u5957odex/vdex.\n\n\n\n\n\u524d4\u6b65, \u57fa\u4e8e\u4e00\u79cdpipe\u7684\u6846\u67b6\u5b9e\u73b0, \u6bcf\u4e00\u6b65\u90fd\u662f\u4e00\u4e2aaction, \u522b\u94fe\u63a5\u5230actio list\u4e2d, \u524d\u540e\u4e24\u4e2aaction\u901a\u8fc7pipe\u673a\u5236\u8fdb\u884c\u6570\u636e\u901a\u4fe1. \u4e5f\u5c31\u662f\u8bf4, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u9ed8\u8ba4\u53d8\u6210\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. action\u7684\u6267\u884c\u51fd\u6570\u662f\nPerformAction()\n. \u901a\u8fc7\nHasInputObject()\n\u548c\nHasOutputPipe()\n\u5224\u65ad\u662f\u5426\u6709\u8f93\u5165\u548c\u8f93\u51fa\u6d41, \u800c\nGetInputObject()\n\u63a5\nSetOutputObject()\n\u5206\u522b\u662f\u8bfb\u53d6\u548c\u5199\u5165pipe.\n\n\nupdate_engine\n \u7684 Androidmk\u76ee\u6807, \u4f9d\u8d56\u548c\u5bf9\u5e94\u6e90\u7801\u6587\u4ef6\u5982\u4e0b.\n\n\n# \u9759\u6001\u5e93\u6a21\u5757\nSTATIC_LIBRARIES:\n    update_metadata-protos      (host, target)\n    libpayload_consumer         (host, target)\n    libupdate_engine_android    (target)\n    libpayload_generator        (host, target)\n\n# \u53ef\u6267\u884c\u6a21\u5757\nEXECUTABLES:\n    update_engine           (target)\n    update_engine_sideload      (target)\n    update_engine_client        (target)\n    delta_generator         (host)\n\n# \u5171\u4eab\u5e93\u6a21\u5757\nSHARED_LIBRARIES:\n    libupdate_engine_client     (target)\n\n# \u9884\u7f16\u8bd1\u6a21\u5757\nPREBUILT:\n    updater.json            (target)\n    brillo_update_payload       (host)\n\n\n\n\n\n\u4ece\u4e0a\u6587\u7684\u76ee\u6807\u53ef\u4ee5\u83b7\u53d6\u5982\u4e0b\u4fe1\u606f:\n\n\n\n\npayload \u4e2d\u7684\u6587\u4ef6\u7ed3\u6784\u662fprotos\n\n\n\u53ef\u6267\u884c\u6587\u4ef6\u662f \nupdate_engine\n, \u800c \nupdate_engine_client\n \u662f\u5ba2\u6237\u7aef, \nupdate_engine_sideload\n \u662frecovery\u6a21\u5f0f\u4e0b\u901a\u8fc7usb\u66f4\u65b0.\n\n\ndelta_generator\n \u7528\u4e8e\u751f\u6210payload\n\n\n\u5b8c\u6574\u7684Android.mk\u4e2d, \u5b58\u5728\u6807\u8bb0\u4e3a\nlocal_use_omaha\n, \u53ea\u6709\u5728 \nPRODUCT_IOT\n \u7269\u8054\u7f51\u65f6, \u624d\u542f\u7528, \u7f16\u8bd1\u83b7\u5f97\u7684\u662fdbus\u7248\u672c\u7684\nupdate_engine\n.\n\n\n\n\n\u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b:\n\n\nupdate_engine (target)\n  --\n libupdate_engine_android\n    --\n libpayload_consumer\n      --\n update_metadata-protos\n\nupdate_engine_sideload (target)\n  --\n update_engine_sideload\n    --\n update_metadata-protos\n\nupdate_engine_client (target)\n\ndelta_generator (host)\n  --\n libpayload_generator\n    --\n libpayload_consumer\n      --\n update_metadata-protos\n\n\n\n\n\n\u6e90\u7801\u5217\u8868\u5982\u4e0b:\n\n\nupdate_metadata-protos (STATIC_LIBRARIES)\n  --\n update_metadata.proto\n\nlibpayload_consumer (STATIC_LIBRARIES)\n  --\n common/action_processor.cc\n      common/boot_control_stub.cc\n      common/clock.cc\n      common/constants.cc\n      common/cpu_limiter.cc\n      common/error_code_utils.cc\n      common/hash_calculator.cc\n      common/http_common.cc\n      common/http_fetcher.cc\n      common/file_fetcher.cc\n      common/hwid_override.cc\n      common/multi_range_http_fetcher.cc\n      common/platform_constants_android.cc\n      common/prefs.cc\n      common/subprocess.cc\n      common/terminator.cc\n      common/utils.cc\n      payload_consumer/bzip_extent_writer.cc\n      payload_consumer/delta_performer.cc\n      payload_consumer/download_action.cc\n      payload_consumer/extent_writer.cc\n      payload_consumer/file_descriptor.cc\n      payload_consumer/file_writer.cc\n      payload_consumer/filesystem_verifier_action.cc\n      payload_consumer/install_plan.cc\n      payload_consumer/payload_constants.cc\n      payload_consumer/payload_verifier.cc\n      payload_consumer/postinstall_runner_action.cc\n      payload_consumer/xz_extent_writer.cc\n\nlibupdate_engine_android (STATIC_LIBRARIES)\n  --\n binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      binder_service_android.cc\n      boot_control_android.cc\n      certificate_checker.cc\n      daemon.cc\n      daemon_state_android.cc\n      hardware_android.cc\n      libcurl_http_fetcher.cc\n      network_selector_android.cc\n      proxy_resolver.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n\nupdate_engine (EXECUTABLES)\n  --\n main.cc\n\nupdate_engine_sideload (EXECUTABLES)\n  --\n boot_control_android.cc\n      hardware_android.cc\n      network_selector_stub.cc\n      proxy_resolver.cc\n      sideload_main.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n      boot_control_recovery_stub.cc\n\nupdate_engine_client (EXECUTABLES)\n  --\n binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      common/error_code_utils.cc\n      update_engine_client_android.cc\n      update_status_utils.cc\n\nlibpayload_generator (SHARED_LIBRARIES)\n  --\n payload_generator/ab_generator.cc\n      payload_generator/annotated_operation.cc\n      payload_generator/blob_file_writer.cc\n      payload_generator/block_mapping.cc\n      payload_generator/bzip.cc\n      payload_generator/cycle_breaker.cc\n      payload_generator/delta_diff_generator.cc\n      payload_generator/delta_diff_utils.cc\n      payload_generator/ext2_filesystem.cc\n      payload_generator/extent_ranges.cc\n      payload_generator/extent_utils.cc\n      payload_generator/full_update_generator.cc\n      payload_generator/graph_types.cc\n      payload_generator/graph_utils.cc\n      payload_generator/inplace_generator.cc\n      payload_generator/payload_file.cc\n      payload_generator/payload_generation_config.cc\n      payload_generator/payload_signer.cc\n      payload_generator/raw_filesystem.cc\n      payload_generator/tarjan.cc\n      payload_generator/topological_sort.cc\n      payload_generator/xz_android.cc\n\ndelta_generator (EXECUTABLES)\n  --\n payload_generator/generate_delta_main.cc\n\n\n\n\n\n \u4e0b\u8f7d \n\n\n\u4e0b\u8f7d\u76f8\u5173\u4e0e\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u903b\u8f91: \ndelta_performer.cc\n\n\n\u5347\u7ea7\u6d41(\u5305)\u7684\u4e0b\u8f7d, \u5206\u4e3a\u4e24\u4e2a\u6a21\u5f0f:\n\n\n\n\n\u4e0b\u8f7dzip\u5305\u5230data\u5206\u533a.\n\n\n\u4e0b\u8f7d\u5347\u7ea7\u6d41, \u8fb9\u4e0b\u8fb9\u5347\u7ea7.\n\n\n\n\n( \u4ecechrome os\u4ee3\u7801\u770b, \u5176\u5347\u7ea7\u670d\u52a1\u5668\u662fomaha server, \u53ef\u4ee5\u53c2\u8003\u770b\u4e0b\u5bf9\u4e8e\u6211\u4eec\u7684\u5347\u7ea7\u670d\u52a1\u5668\u662f\u5426\u6709\u5e2e\u52a9.\nhttps://github.com/Crystalnix/omaha-server\nhttps://github.com/Crystalnix/omaha-server/wiki\n)\n\n\npayload \u6570\u636e\u7ed3\u6784:\n\n\nversion 1:\n| \nC\nr\nA\nU\n | version(8) | manifestSize(8) | manifest(manifestSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |\n\nversion 2:\n| \nC\nr\nA\nU\n | version(8) | manifestSize(8) | MetadataSignatureSize(4) | manifest(manifestSize) | medatadataSignatureMessage(MetadataSignatureSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |\n\n\n\n\n\n\u5176\u4e2d medatadataSignatureMessage \u6821\u9a8c\u7684\u662f\u5176\u4e4b\u524d\u7684\u6240\u6709\u6570\u636e, \u800c payloadSignatureMessage \u6821\u9a8c\u7684\u662f payloadSignatureMessageSize \u4e4b\u524d\u7684\u6240\u6709\u6570\u636e.\n\n\n\u800c manifest \u662fprotobuff, \u5176\u4e2d\u5305\u542b\u4e00\u7ec4\u6307\u4ee4\u96c6, \u4e5f\u5c31\u662f\u4ee5\u524drecovery \u5757\u5347\u7ea7\u7684\u4e00\u7cfb\u5217\u6307\u4ee4. rawData\u662f\u88ab\u66f4\u65b0\u6570\u636e, \u6307\u4ee4\u4f1a\u4ecerawData\u6307\u5b9a\u4f4d\u7f6e\u8bfb\u53d6\u6570\u636e\u5e76\u5e94\u7528\u5230\u76ee\u6807\u5206\u533a\u7684\u6307\u5b9a\u4f4d\u7f6e.\n\n\nmetadata\u7684\u6570\u636e\u662fprotobuf, \u6570\u636e\u7ed3\u6784\u4e3a update_metadata.proto\n\n\n\u4e0b\u8f7d\u5b58\u5728\u4e24\u79cd\u6a21\u5f0f, p2p\u548c\u666e\u901a\u4e0b\u8f7d.\n\n\n\u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u903b\u8f91\u4e0e\u4e4b\u524dota\u5347\u7ea7\u4e0b\u8f7d\u5347\u7ea7\u5305\u7684\u903b\u8f91\u4e00\u81f4. \nupdate_engine\n\u5c06\u5347\u7ea7\u5305\u4e0b\u8f7d\u5230\u672c\u5730.  \u4e0b\u9762\u5148\u4ecb\u7ecd\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u7684\u903b\u8f91.\n\n\n\u4e0b\u8f7d\u5230data\u5206\u533a\n\n\n\u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u5b9e\u73b0\u4e0d\u518d\nupdate_engine\n\u4e2d, \u800c\u5982\u679c\u662f\u9884\u5148\u4e0b\u8f7d\u5b8c\u6210\u7684payload, \u901a\u8fc7\nfile://\n\u7684url\u4f20\u9012\u7ed9\nupdate_engine\n, \u540e\u7eed\u903b\u8f91\u4e0e\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u4e00\u6837.\n\n\n\u800cjava\u5c42\u7684UpdateEngine.java\u7684API, \u66b4\u9732\u5230\u4e86\u7cfb\u7edf\u7684jar\u5305\u4e2d, \u5e76\u672a\u627e\u5230\u8c03\u7528\u8005, \u4e5f\u5c31\u662f\u8bf4, \u8fd9\u5757\u903b\u8f91\u662f\u975e\u5f00\u6e90\u7684, \u6211\u4eec\u65e0\u6cd5\u83b7\u5f97.\n\n\n\u8fb9\u4e0b\u8fb9\u5347\n\n\n\u6240\u8c13\u8fb9\u4e0b\u8fb9\u5347, \u5c31\u662f\u5c06\u5347\u7ea7\u6570\u636e\u4e0b\u8f7d\u5230\u5185\u5b58\u4e2d, \u5e76\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\u76f8\u5e94\u5904\u7406, \u6700\u540e\u5199\u5165\u76ee\u6807\u5206\u533a.\n\n\n\u4e0b\u9762\u662f\u8fb9\u4e0b\u8fb9\u5347\u7684\u5ba2\u6237\u7aef\u6267\u884c\u547d\u4ee4.\n\n\n# update_engine_client \\\n--payload=http://xxx/android/full-ota/payload.bin \\\n--update \\\n--headers=\n\\\n  FILE_HASH=ozGgyQEddkI5Zax+Wbjo6I/PCR8PEZka9gGd0nWa+oY= \\\n  FILE_SIZE=282344983\n  METADATA_HASH=GLIKfE6KRwylWMHsNadG/Q8iy5f786WTatvMdBlpOPg= \\\n  METADATA_SIZE=26723 \\\n\n\n\n\n\n\n\n\u5728Pixel\u624b\u673a\u4e0a\u5347\u7ea7\u7684\u8f93\u51falog\u5982\u9644\u4ef6\nupdate_engine.log\n, \u611f\u5174\u8da3\u7684\u7ae5\u978b\u53ef\u4ee5\u770b\u4e0b, \u5176\u4e2d\u5305\u542b\u4e86\u5404\u4e2a\u9636\u6bb5\u7684\u884c\u4e3a.\n\n\n\u5176\u4e2dheader\u540e\u9762\u7684\u5185\u5bb9, \u8ddf\u5347\u7ea7\u5305\u4e2d\u7684\npayload_properties.txt\n \u6587\u4ef6\u5185\u5bb9\u4e00\u6837. \u5404\u5b57\u6bb5\u7684\u4f5c\u7528\u53ef\u4ee5\u53c2\u8003\u524d\u6587payload\u7684\u5934\u6570\u636e\u683c\u5f0f\u6765\u7406\u89e3\u5177\u4f53\u6821\u9a8c\u7684\u6570\u636e\u4f4d.\n\n\nupdate_engine\n \u9996\u5148\u5b9a\u4e49\u4e00\u7cfb\u5217\u7684action:\n\n\n\n\ndownload_action\n: \u4e0b\u8f7d\u6a21\u5757, \u8d1f\u8d23\u8fb9\u4e0b\u8fb9\u5347\u7ea7.\n\n\nfilesystem_verifier_action\n: \u6587\u4ef6\u7cfb\u7edf\u6821\u9a8c\u6a21\u5757, \u8d1f\u8d23\u5347\u7ea7\u5b8c\u6210\u540e\u6821\u9a8c\u6570\u636e\u7684\u5b8c\u6574\u6027\n\n\npostinstall_runner_action\n: \u540e\u5347\u7ea7\u6a21\u5757, \u4e00\u4e9b\u811a\u672c\u6216\u53ef\u6267\u884c\u7a0b\u5e8f\u5728\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u540e\u6267\u884c.\n\n\n\n\n\u4ee5\u4e0aaction\u901a\u8fc7\u7c7b\u4f3cpipeline\u7684\u5f62\u5f0f\u7ec4\u7ec7, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. \u800c\u5728\u5176\u4e2d\u4f20\u9012\u7684\u6570\u636e\u662f\ninstall_plan_\n, \u8be5\u6570\u636e\u5305\u542b\u4e86payload(\u5347\u7ea7\u6570\u636e)\u7684\u6240\u6709\u4fe1\u606f(\u64cd\u4f5c\u5206\u533a, url, \u6821\u9a8c\u4fe1\u606f\u7b49), \u90e8\u5206\u4fe1\u606f\u7531\u540e\u9762\u7684action\u6267\u884c\u540e\u63d0\u4f9b.\n\u6240\u6709\u7684action, \u5176\u6267\u884c\u5165\u53e3\u51fd\u6570\u662f\nPerformAction()\n, \u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570, \u53ef\u4ee5\u66f4\u7ec6\u81f4\u5730\u4e86\u89e3\u8f93\u5165\u8f93\u51fa\u6570\u636e\u548c\u8be5action\u7684\u5177\u4f53\u529f\u80fd.\n\n\n\u672c\u6bb5\u5185\u5bb9\u7740\u91cd\u4ecb\u7ecd\ndownload_action\n, \u5176\u4f59\u6a21\u5757\u5728\u540e\u9762\u4ecb\u7ecd.\n\n\n\n\n\n\n1. \u8bfb\u53d6\u6570\u636e. \u8fd9\u91cc\u5e76\u4e0d\u662f\u6b63\u5e38\u7684read, \u8be5\u51fd\u6570\u662f\u4e2a\u4e0b\u8f7d\u7684Write\u56de\u8c03, \u800c\u8bfb\u53d6\u6570\u636e\u5728\u4ee3\u7801\u4e0a\u7684\u771f\u5b9e\u884c\u4e3a\u662f, \u8fd4\u56de\u9519\u8bef\u8868\u793a\u6570\u636e\u4e0d\u591f, \u7ee7\u7eed\u8bfb\u53d6, \u800c\u5df2\u7ecf\u8bfb\u53d6\u7684\u6570\u636e\u5b58\u653e\u5728buffer\u4e2d.\n2. \u89e3\u6790manifest. \u5c31\u662f\u4e0a\u6587\u4e2dpayload\u7684\u5934, \u5305\u542b\u6821\u9a8c\u4fe1\u606f\u548c\u6267\u884c\u7684\u6307\u4ee4\u96c6, \u8fd8\u6709\u6240\u6709\u64cd\u4f5c\u7684\u5206\u533a\u6821\u9a8c\u503c\u7b49.\n3. \u6253\u5f00\u5206\u533a\u8bbe\u5907. \u6839\u636e\u5347\u7ea7\u7c7b\u578b, \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7(manifest\u4e2d\u5305\u542b\u8be5\u4fe1\u606f), \u5219\u6253\u5f00\u88ab\u5347\u7ea7\u8bbe\u5907\u5206\u533a, \u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u6253\u5f00\u5f53\u524d\u8fd0\u884c\u8bbe\u5907\u5206\u533a\u548c\u88ab\u5347\u7ea7\u76ee\u6807\u5206\u533a.\n4. \u83b7\u53d6\u6307\u4ee4\u5217\u8868. \u662f\u4ecemanifest\u4e2d\u83b7\u53d6. \u4e0d\u540c\u6307\u4ee4, \u683c\u5f0f\u4e0d\u540c, \u4f46\u57fa\u672c\u683c\u5f0f\u662f \nsrc:offset:size\n, \u6307\u5b9a\u64cd\u4f5c\u6e90/\u76ee\u6807, \u504f\u79fb\u548c\u5927\u5c0f.\n5. \u7531\u4e8e1\u63d0\u5230\u7684, \u5728\u6570\u636e\u4e0d\u591f\u65f6\u4f1a\u9000\u51fa, \u6240\u4ee5, \u4f1a\u4fdd\u5b58\u5f53\u524d\u5df2\u7ecf\u6267\u884c\u5230\u7684\u6307\u4ee4, \u5e76\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6307\u4ee4\u4fe1\u606f, \u8fd9\u91cc\u4fe1\u606f\u91cd\u70b9\u662f, \u9700\u8981\u8bfb\u53d6\u7684payload\u4e2doffset\u548csize. \u7531\u4e8epayload\u4e2d\u7684\u5347\u7ea7\u6570\u636e\u662f\u8ddf\u6307\u4ee4\u4e00\u8d77\u751f\u6210\u7684, \u6240\u4ee5, \u5176\u6570\u636e\u7684\u504f\u79fb\u5b8c\u5168\u53ef\u4ee5\u8ddf\u6307\u4ee4\u7684\u987a\u5e8f\u4e00\u81f4, \u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u8bfb\u6307\u9488\u8df3\u52a8, \u4e5f\u5c31\u4e0d\u9700\u8981p2p\u652f\u6301.\n6. \u6267\u884c\u6307\u4ee4. \u57fa\u672c\u6307\u4ee4\u53ef\u4ee5\u67e5\u770b\u4ee3\u7801, \u4e0e\u5757\u5347\u7ea7\u6307\u4ee4\u4e00\u6837.\n\n\n\u4e0b\u9762\u662f\u5347\u7ea7\u65f6\u6570\u636e\u7684\u5408\u6210\u56fe.\n\n\n\n\n\n\u8fd9\u5e45\u56fe\u5c55\u793a\u7684\u662f\u5347\u7ea7\u6570\u636e\u7684\u5408\u6210. \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7, source\u4e3a\u7a7a, \u5219payload\u76f4\u63a5\u5199\u5165target. \u4f46\u4e0e\u4e00\u822c\u5206\u533a\u70e7\u5199\u8fd8\u662f\u6709\u4e9b\u5dee\u5f02, \u5e76\u4e0d\u4f1a\u64e6\u9664target, \u800c\u662f\u6309\u7167\u504f\u79fb\u548c\u5927\u5c0f\u76f4\u63a5\u5199\u5165.\u800c\u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u5219\u662f\u57fa\u4e8e\u5f53\u524d\u8fd0\u884c\u7cfb\u7edf\u4e3asource, \u4e0epayload\u7684\u6570\u636e\u5408\u5e76\u5199\u5165target.\n\n\n\u6240\u4ee5, \u4e0d\u7ba1\u662f\u5168\u91cf\u5347\u7ea7\u8fd8\u662f\u589e\u91cf\u5347\u7ea7, \u65ad\u7535\u540e\u90fd\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u518d\u5347\u7ea7.\n\n\n \u6821\u9a8c \n\n\n\n\n\n\n\n\n\n\n\u83b7\u53d6\u8f93\u5165\u6570\u636e. \u662f\u6307\u83b7\u53d6\u4ece\ndownload_action\n\u5b8c\u6210\u540e\u7684\u6570\u636e, \u5305\u542b\u88ab\u5347\u7ea7\u5206\u533a\u53ca\u5176\u54c8\u5e0c\u503c\u7b49.\n\n\n\u5f00\u59cb\u6821\u9a8c\u88ab\u5347\u7ea7\u5206\u533a. \u5355\u7eaf\u4ece\u5206\u533a\u8bfb\u53d6\u5757\u6570\u636e\u5e76\u4e0epayload\u4e2d\u5b58\u653e\u7684\u8fdb\u884c\u6bd4\u5bf9\u6821\u9a8c.\n\n\n\u5f00\u59cb\u6821\u9a8c\u5f53\u524dslot\u6e90\u5206\u533a. \u8fd9\u4e2a\u662f\u9488\u5bf9\u589e\u91cf\u5347\u7ea7\u7684. \u5728\u6821\u9a8c\u76ee\u6807\u5206\u533a\u5931\u8d25\u540e, \u6821\u9a8c\u6e90\u5206\u533a.\u6b64\u5904\u6821\u9a8c\u7684\u76ee\u7684\u4e0d\u662f\u5224\u65ad\u5f53\u524d\u8fd0\u884c\u7684\u5206\u533a\u662f\u5426\u5408\u6cd5(\u542f\u52a8\u65f6, \u7531\u5176\u4ed6\u6a21\u5757\u6821\u9a8c), \u800c\u662f\u5224\u65ad\u4e0b\u8f7d\u7684payload\u662f\u5426\u4e0e\u5f53\u524d\u7cfb\u7edf\u5339\u914d(\u670d\u52a1\u5668\u7aef\u653e\u9519\u5347\u7ea7\u6587\u4ef6).\n\n\n\u6807\u8bb0\u4f20\u8f93\u5931\u8d25. \u8fd9\u91cc\u662f\u57283\u7684\u57fa\u7840\u4e0a, \u5c06\u5f53\u524dpayload\u7684\u4e0b\u8f7durl\u6807\u8bb0\u5931\u8d25, \u5e76\u589e\u52a0\u5931\u8d25\u6b21\u6570. \u5728\u8fbe\u5230\u4e00\u5b9a\u6b21\u6570\u540e(\u670d\u52a1\u7aef\u914d\u7f6e), \u4e0d\u518d\u4ece\u8be5url\u83b7\u53d6\u5347\u7ea7\u6570\u636e, \u8df3\u5f80\u4e0b\u4e00\u4e2aurl.\n\n\n\n\n post install \n\n\n\u5404\u4e2a\u5206\u533a\u90fd\u53ef\u4ee5\u6307\u5b9apostinstall, \u800cpostinstall\u811a\u672c\u662f\u5728\ndownload_action\n\u89e3\u6790mainifest\u65f6\u89e3\u6790\u5e76\u83b7\u5f97. \u5728\u5b9a\u4e49\u6267\u884cpostinstall\u4f46\u53c8\u65e0\u811a\u672c\u6307\u5b9a\u65f6, \u9ed8\u8ba4postinstall\u811a\u672c\u662f\u5206\u533a\u6839\u76ee\u5f55\u4e0b\u7684\npostinst\n\n\n\u5728Chrome OS\u4e2d, postinstall \u662f\u5141\u8bb8\u5bf9\u5206\u533a\u6267\u884c\u5757\u5199\u5165\u64cd\u4f5c\u7684,\u4f46\u662f\u5728Android, \u6302\u8f7d\u5206\u533a\u88ab\u6267\u884c\u6807\u8bb0\u4e3a\u53ea\u8bfb, \u5e76\u4e14\u4e5f\u6302\u8f7d\u6210\u53ea\u8bfb, \u4e5f\u5c31\u662f\u8bf4, \u4e0d\u5141\u8bb8\u5bf9\u88ab\u5347\u7ea7\u5206\u533a\u505a\u4fee\u6539(\u5c31\u7b97\u4fee\u6539\u4e86, \u4e4b\u540e\u6821\u9a8c\u4f9d\u7136\u53ef\u80fd\u51fa\u9519). postinstall\u7684\u811a\u672c\u662f\u76f4\u63a5\u57fa\u4e8e\u5f53\u524d\u88ab\u5347\u7ea7\u7cfb\u7edf\u6267\u884c, \u5e76\u672achroot, \u6240\u4ee5, postinstall\u811a\u672c\u5fc5\u987b\u80fd\u591f\u88ab\u4fdd\u8bc1\u8fd0\u884c\u5728\u88ab\u5347\u7ea7\u7cfb\u7edf\u4e2d. \u6240\u4ee5, \u4e00\u822c\u662f\u7eaf\u9759\u6001\u7684\u53ef\u6267\u884c\u7a0b\u5e8f, \u800c\u4e14\u5176\u529f\u80fd\u5728android\u4e0a\u4e5f\u88ab\u5f31\u5316\u4e86.\n\n\n odex\u4f18\u5316 \n\n\n\u5728\u4ee5\u4e0a\u5168\u90e8\u5b8c\u6210\u540e, \u7cfb\u7edf\u5c06\u6807\u8bb0slot\u4e3a\u88ab\u5347\u7ea7\u7cfb\u7edf, \u5e76\u5728\u4e0b\u6b21\u91cd\u542f\u540e, \u8fdb\u5165\u5347\u7ea7\u540e\u7684\u7cfb\u7edf, \u6821\u9a8c\u5e76\u4f18\u5316. \u8fd9\u65f6\u5019\u5982\u679c\u6821\u9a8c\u5931\u8d25, \u5219\u8fd8\u4f1a\u56de\u5230\u539f\u5148\u7cfb\u7edf. \u5219\u8be5\u60c5\u51b5\u5b58\u5728data\u4e0b\u5e94\u7528\u6570\u636e\u5df2\u7ecf\u88ab\u4f18\u5316\u4e3a\u65b0\u7248\u672c\u6216\u8005\u4f18\u5316\u5230\u4e00\u534a\u7684\u95ee\u9898. \u8ddf\u4e86\u4e0b\u76f8\u5173\u4ee3\u7801\u548c\u7f51\u4e0a\u7684\u8d44\u6599, \u7ed3\u8bba\u5982\u4e0b.\n\n\n\u5728A/B\u5347\u7ea7\u5b8c\u6210\u8fdb\u5165\u65b0\u7cfb\u7edf\u540e, dexopt\u7684\u53c2\u6570\u662fspeed-profile, \u800c\u8be5\u53c2\u6570\u7684\u542b\u4e49\u5c31\u662f\u6839\u636e\u201c\u70ed\u4ee3\u7801\u201d\u7684profile\u914d\u7f6e\u6765\u7f16\u8bd1. \u90a3\u4e48\u95ee\u9898\u5c31\u662f\u8fd9\u4e2aprofile\u7684\u751f\u6210,\u548c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u589e\u91cf\u7f16\u8bd1.\n\n\n\n\nprofile\u5728\u8fbe\u5230\u4e00\u5b9a\u6761\u4ef6\u540e\u5199\u5165/data/, \u76ee\u524d\u4ece\u4ee3\u7801\u770b, \u5df2\u77e5\u7684\u4e00\u4e2a\u6761\u4ef6\u662f\u5927\u5c0f\n50K\u65f6, \u5199\u5165\u6587\u4ef6. \u800c\u5728\u5df2\u7ecf\u5b58\u5728\u8be5\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b, \u4f1a\u4f18\u5148\u52a0\u8f7d, \u5982\u679c\u52a0\u8f7d\u5931\u8d25, \u5219\u5220\u9664\u5e76\u91cd\u65b0\u751f\u6210.\n\n\n\u6267\u884c\u589e\u91cf\u7f16\u8bd1\u7684\u65f6\u95f4\u662f, \u673a\u5728\u5145\u7535\uff0b\u7a7a\u95f2\uff0b\u56db\u4e2a\u5c0f\u65f6\u95f4\u9694\u7b49\u591a\u4e2a\u6761\u4ef6\u4e0b, \u5728\u540e\u53f0\u5b8c\u6210.\n\n\n\n\n\n\u4e5f\u5c31\u662f\u8bf4, \u5728AB\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u65f6, \u4e0d\u4f1a\u6267\u884c\u7f16\u8bd1, \u53ea\u4f1a\u6267\u884cprofile\u7684\u751f\u6210. \u800c\u5728\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u88ab\u68c0\u6d4b\u5230\u7cfb\u7edf\u6821\u9a8c\u5931\u8d25, \u5219\u4f1a\u56de\u5230\u4e0a\u4e00\u7248\u672c\u7cfb\u7edf.\n\n\nbootloader\u4ea4\u4e92\n\n\n\n\n\u4f20\u7edf\u7684Android\u4e0ebootloader\u901a\u4fe1\u662f\u901a\u8fc7misc\u5206\u533a. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u6570\u636e\u5e76\u4e0d\u662f\u5b58\u5728misc\u5206\u533a, \u800c\u4e14\u5b58\u653e\u4f4d\u7f6e\u7531\u5382\u5546\u5b9a\u4e49, \u63a5\u53e3\u5728\nhardware/libhardware/include/hardware/boot_control.h\n. \u5176\u7ed3\u6784\u4f53\u662f \nboot_control_module_t\n, \u5305\u542b\u4e86\u6240\u6709\u8bbe\u7f6e\u4ee5\u4e0aslot\u72b6\u6001\u7684\u63a5\u53e3.\n\n\n\u4e0b\u9762\u4ecb\u7ecd\u4e0b\u4e0d\u540c\u5382\u5546\nboot_control\n\u7684\u5b9e\u73b0.\n\n\n\nqcom\u7684\u5b9e\u73b0\n\n\n\n\u4ee3\u7801\u4f4d\u7f6e:  \nhardware/qcom/bootctrl/boot_control.cpp\n\nqcom\u7684\u5b9e\u73b0\u662f, \u76f4\u63a5\u5c06A/B\u5206\u533a\u7684\u5c5e\u6027, \u5199\u5165\u7684gpt\u5206\u533a\u8868\u7684boot\u5206\u533a(\nboot_a\n\u548c\nboot_b\n).qcom\u673a\u9876\u76d2gpt\u8868\u7684\u5206\u6790:http://blog.csdn.net/guyongqiangx/article/details/68924436\n\n\n\n\n\n\n\u4e0a\u56fe\u662fqcom\u673a\u9876\u76d2gpt\u5206\u533a\u8868\u7684\u4fe1\u606f, \u5728Entry\u4e2d\u67e5\u627e\u5230\u5206\u533a\nboot_a\n\u548c\nboot_b\n, \u63d0\u53d6\u5176\u5c5e\u6027.\n\u4ece LAB 2 \u5f00\u59cb\u5b58\u653e\u7684\u662fGPT\u5206\u533a\u7684\u8be6\u7ec6\u4fe1\u606f\nPartition Entry\n, \u5355\u4e2a\nPartition Entry\n\u5360128\u4e2a\u5b57\u8282, \u4ece\u7b2c48\u4e2a\u5b57\u8282\u5f00\u59cb\u5b58\u653e\u7684\u662f\u5206\u533a\u5c5e\u6027, \u800cA/B\u7cfb\u7edf\u7684\u5206\u533a\u5c5e\u6027\u4e5f\u662f\u5b58\u653e\u5728\u8fd9\u4e2a\u4f4d\u7f6e.\n\n\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230, qcom\u7684\u5b9e\u73b0, \u6ca1\u6709bootable\u7684\u6807\u8bb0\u4f4d, \u53d6\u800c\u4ee3\u4e4b\u7684\u662funbootable.\n\n\n\ngoogle\u7684\u53c2\u8003\u5b9e\u73b0\n\n\n\n\u4ee3\u7801\u4f4d\u7f6e\nsystem/extras/boot_control_copy/boot_control_copy.c\n\n\ngoogle\u7684\u53c2\u8003\u5b9e\u73b0\u590d\u7528\u4e86misc\u5206\u533a\u7684\nbootloader_message\n(recovery\u4e0ebootloader\u901a\u4fe1\u7684\u5206\u533a). \u6574\u4e2amisc\u5206\u533a\u7684\u6570\u636e\u7ed3\u6784\u56fe\u5982\u4e0b.\n\n\n\n\n\n\n\n\n\nfsmgr\u4f7f\u7528, \u5728\u8bbe\u7f6e\u6307\u5b9aslot\u4e3aactive\u65f6, \u540c\u65f6\u5c06\u5bf9\u5e94\u540e\u7f00\u8bbe\u7f6e\u5230\u8be5\u5b57\u6bb5. fsmgr\u5728\u6302\u8f7d\u5206\u533a\u65f6,\u901a\u8fc7\u8be5\u5b57\u6bb5\u62fc\u6210\u5b8c\u6210\u7684\u5206\u533a\u8def\u5f84.\n\n\nMagic Numbe. \u7528\u6765\u786e\u5b9a\u8be5\u6570\u636e\u7aef\u7684\u5408\u6cd5, \u5fc5\u987b\u662f 'B', 'C' , 'c' (\"\nboot_control\n copy\" \u7684\u7f29\u5199)\n\n\n\u63a5\u53e3\u7248\u672c\u53f7\n\n\nactive\u72b6\u6001\u7684slot\u53f7, \u5728\u8be5\u5b9e\u73b0\u4e2d\u53ea\u6709 0 \u6216 1.\n\n\n0 \u4e3a \u7b2c\u4e00\u4e2aslot, 1 \u4e3a\u7b2c\u4e8c\u4e2aslot, \u8bbe\u7f6eslot\u7684bootable/unbootable\u72b6\u6001.\n\n\n\n\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa, \u5e76\u6ca1\u6709\u53ef\u4ee5\u6807\u8bb0\u4e3asuccessful\u7684\u4f4d, \u901a\u8fc7\u4ee3\u7801\u4e5f\u53d1\u73b0, \u5176\u5b9e\u73b0\u4e3a\u7a7a, \u4e5f\u5c31\u662f\u8bf4, \u5e76\u6ca1\u6709\u5b9e\u73b0\u8be5\u72b6\u6001.\n\n\n\u5982\u679c\u6ce8\u610f\u5230\u4ee3\u7801, \u5728\nmodule_setActiveBootSlot\n\u540e\u534a\u6bb5, \u4f1a\u5c06active\u72b6\u6001\u7684\nboot_X\n\u5206\u533a\u5185\u5bb9\u62f7\u8d1d\u5230boot\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u7cfb\u7edf\u5b58\u5728\u4e09\u4e2a\u5206\u533a(boot, \nboot_a\n, \nboot_b\n), \u88ab\u8bbe\u7f6e\u4e3aactive\u7684\u5206\u533a\u4f1a\u88ab\u62f7\u8d1d\u5230boot\u5206\u533a, \u518d\u7ed3\u5408\nmodule_getCurrentSlot\n\u7684\u5b9e\u73b0(\u4ece/system\u5206\u533a\u83b7\u53d6\u6302\u8f7d\u4fe1\u606f) ,\u4ece\u8fd9\u4e24\u6bb5\u4ee3\u7801\u53ef\u4ee5\u63a8\u6d4b\u51fa\u4e24\u4e2a\u7ed3\u8bba:\n\n\n\n\nA/B\u7cfb\u7edf\u53ef\u4ee5\u4e0d\u5347\u7ea7firmware(bootloader), \u6216\u8005\u8bf4google\u7684\u8be5\u5b9e\u73b0\u6700\u521d\u662f\u4e3a\u4e86\u517c\u5bb9\u8001\u7684bootloader.\n\n\nboot.img\u4e2d\u7684ramdisk\u53ef\u4ee5\u8fd8\u662fboot\u7684ramdisk.\n\n\n\n\n\u4f46\u662f, \u4e0d\u786e\u5b9a\u53c2\u8003\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u8fd0\u884c. \u4f46\u662f\u5355\u7eaf\u4ece\u4ee5\u4e0a\u4ee3\u7801\u770b, \u9664\u4e86\u5206\u533a, A/B\u7cfb\u7edf\u7684\u542f\u52a8, \u6302\u8f7d, \u90fd\u53ef\u4ee5\u5728\u7528\u6237\u5c42\u641e\u5b9a. \u4f46\u662f\u5e26\u6765\u7684\u540e\u679c\u5c31\u662f, \u5982\u679cbootloader\u542f\u52a8boot\u5931\u8d25, \u5219\u65e0\u6cd5\u5207\u6362\u5230\u53e6\u4e00\u4e2aslot.\n\n\n\u5347\u7ea7\u5305\u751f\u6210\n\n\n\u5347\u7ea7\u5305\u5236\u4f5c\u5de5\u5177\u4e0d\u518d\u652f\u6301 \u57fa\u4e8e\u6587\u4ef6\u7684\u5347\u7ea7, \u5f53\u524d\u53ea\u652f\u6301ab\u5347\u7ea7\u548c\u5757\u5347\u7ea7.\n\n\n\u5757\u5347\u7ea7\u548cab\u5347\u7ea7\u5728\u751f\u6210\u6570\u636e\u6587\u4ef6\u548c\u811a\u672c\u4e0a\u539f\u7406\u662f\u4e00\u6837\u7684, \u53ea\u662f\u5728\u751f\u6210\u5347\u7ea7\u6570\u636e\u65f6\u5b58\u5728\u5dee\u5f02.\n\n\nAB\u5347\u7ea7payload\u5236\u4f5c\u903b\u8f91\u5728\u5347\u7ea7\u5305\u5236\u4f5c\u811a\u672c\u7684\nWriteABOTAPackageWithBrilloScript\n, \u800c\u771f\u6b63payload\u751f\u6210\u7684\u903b\u8f91\u5728\u51fd\u6570\nGenerateUpdatePayloadFile\n.\n\n\n\u6d41\u7a0b\u5982\u4e0b:\n\n\n\n\u751f\u6210payload\u6307\u4ee4\u89c4\u5219:\n\n\n\nAB\u5347\u7ea7\u603b\u6d41\u7a0b\u56fe", 
            "title": "AB\u7cfb\u7edf\u5347\u7ea7"
        }, 
        {
            "location": "/Android-AB-system-update/#ab", 
            "text": "\u987e\u540d\u601d\u4e49,  A/B \u7cfb\u7edf\u5c31\u662f\u6307\u7ec8\u7aef\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf,(userdata\u53ea\u6709\u4e00\u4efd, \u88ab\u4e24\u5957\u7cfb\u7edf\u5171\u7528). \u7b80\u5355\u6765\u8bb2, \u53ef\u4ee5\u7406\u89e3\u4e3a, \u5b58\u5728\u4e00\u5957\u7cfb\u7edf\u5206\u533a, \u4e00\u5957\u5907\u4efd\u5206\u533a, \u4e24\u5957\u7cfb\u7edf\u90fd\u53ef\u4ee5\u88ab\u542f\u52a8, \u4e24\u5957\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u53ef\u4ee5\u4e00\u6837, \u4e5f\u53ef\u4ee5\u4e00\u5957\u65e7, \u4e00\u5957\u65b0. \u800c\u5347\u7ea7\u5c31\u662f\u5c06\u65e7\u7684\u7cfb\u7edf\u5347\u7ea7\u5230\u65b0\u7248\u672c.  A/B\u7cfb\u7edf\u5b9e\u73b0\u4e86\u65e0\u7f1d\u5347\u7ea7(Seamless System Updates), \u5b58\u5728\u5982\u4e0b\u7279\u70b9:   \u7ec8\u7aef\u8bbe\u5907\u5728\u51fa\u5382\u65f6\u6709\u4e24\u5957\u8bbe\u5907\u53ef\u4ee5\u5de5\u4f5c, \u5728\u5347\u7ea7\u51fa\u73b0\u5f02\u5e38\u6216\u8005\u51fa\u9519\u65f6, \u59cb\u7ec8\u786e\u4fdd\u7cfb\u7edf\u5b58\u5728\u4e00\u5957\u8bbe\u5907\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c.  \u7cfb\u7edf\u5728\u540e\u53f0\u8fdb\u884c\u5347\u7ea7, \u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf, \u7528\u6237\u4e0d\u4f1a\u88ab\u6253\u65ad. \u5728\u66f4\u65b0\u5b8c\u6210\u540e, \u7528\u6237\u5728\u4e0b\u6b21\u91cd\u542f\u624b\u673a\u65f6, \u5c31\u4f1a\u8fdb\u5165\u65b0\u7cfb\u7edf.  \u5728 dm-verity \u6216\u8005\u5176\u4ed6\u6821\u9a8c\u65b9\u5f0f\u68c0\u6d4b\u5230\u7cfb\u7edf\u987a\u574f\u6216\u5f02\u5e38\u540e, \u53ef\u4ee5\u91cd\u542f\u56de\u5230\u5347\u7ea7\u524d\u7684\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u4f7f\u7528\u4e0d\u53d7\u5f71\u54cd.   Android8.0\u7684\u4ee3\u7801\u7f16\u8bd1\u65f6, \u5728BoardConfig\u6709\u5bf9\u5e94\u7684\u9009\u9879\u6765\u63a7\u5236\u662f\u7f16\u8bd1\u6210A/B\u7cfb\u7edf\u8fd8\u662f\u6b63\u5e38\u5355\u7cfb\u7edf. \u7531\u4e8e\u65b0\u7cfb\u7edf\u8ddf\u539f\u6765\u7684OTA\u5347\u7ea7\u7cfb\u7edf\u5b58\u5728\u5927\u4e0d\u540c, \u5bfc\u81f4\u65e0\u6cd5\u901a\u8fc7\u4ee5\u524d\u7684OTA\u5347\u7ea7\u65b9\u5f0f(\u5b89\u5168\u5730)\u5347\u7ea7\u5230A/B\u7cfb\u7edf.  \u800cA/B\u7cfb\u7edf\u5347\u7ea7, \u662f\u7531\u8fd0\u884c\u4e8eAndroid\u540e\u53f0\u7684 update_engine \u548c  slot a ,  slot b \u4e24\u5957\u7cfb\u7edf\u5171\u540c\u5b8c\u6210. \u5728\u542f\u52a8\u5176\u4e2d\u4e00\u5957\u7cfb\u7edf\u7684\u60c5\u51b5\u4e0b,  update_engine \u5728\u540e\u53f0\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u4e0b\u8f7d\u5347\u7ea7\u6d41\u5e76\u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf.  A/B \u7cfb\u7edf\u5347\u7ea7\u4e3b\u8981\u6d89\u53ca\u5982\u4e0b4\u4e2a\u65b9\u9762:   \u5206\u533a\u9009\u62e9(slots), \u5373\u9009\u62e9\u54ea\u4e2a\u7cfb\u7edf.  update_engine , \u5373\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7  bootloader\u4ea4\u4e92, \u5373\u5982\u4f55\u901a\u77e5bootloader\u5207\u6362slot  ota\u5305\u751f\u6210.", 
            "title": " A/B\u7cfb\u7edf\u7b80\u4ecb "
        }, 
        {
            "location": "/Android-AB-system-update/#_1", 
            "text": "", 
            "title": " \u5206\u533a\u9009\u62e9 "
        }, 
        {
            "location": "/Android-AB-system-update/#_2", 
            "text": "\u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003  Android8 \u5206\u533a\u8868\u548c\u5206\u533a\u76f8\u5173\u64cd\u4f5c . \u8fd9\u91cc\u7b80\u5355\u603b\u7ed3\u4e0b\u5206\u533a\u8868\u4e0a\u8ddf\u5355\u7cfb\u7edf\u7684\u5dee\u5f02.\n\u8fd9\u91cc\u4ee5boot,system, vendor\u548cmodem\u5b58\u5728\u4e24\u5957\u7cfb\u7edf\u4e3a\u4f8b\u5b50, \u5176\u4f59\u5206\u533a\u6309\u7167\u6700\u5c0f\u5206\u533a\u8868.     \u5355\u7cfb\u7edf\u5206\u533a\u8868  A/B\u7cfb\u7edf\u5206\u533a\u8868  \u529f\u80fd\u63cf\u8ff0      bootloader  bootloader  \u5f15\u5bfclinux\u7cfb\u7edf    misc  misc  Android\u7cfb\u7edf\u4e0erecovery, bootloade\u901a\u4fe1\u7684\u6570\u636e    boot  -  \u5b58\u653eAndroid\u7684kernel\u548cramdisk    -  boot_a  \u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk    -  boot_b  \u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk    system  -  Android\u7cfb\u7edf\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6.    -  system_a  \u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6    -  system_b  \u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6    -  vendor_a  \u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4    -  vendor_b  \u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4    cache  -  \u4e34\u65f6\u5b58\u653e\u6570\u636e, \u901a\u5e38\u4e34\u65f6\u5b58\u653e\u4e0b\u8f7d, \u5907\u4efd\u548c\u5347\u7ea7\u5305    recovery  -  \u5b58\u653erecovery\u7cfb\u7edf\u7684kernel\u548cramdisk    userdata  userdata  \u5b58\u653e\u7528\u6237\u6570\u636e     \u6240\u8c13\u7684A/B\u7cfb\u7edf\u5206\u533a, \u5c31\u662f\u5728\u539f\u6709\u5206\u533a\u540d\u5b57\u540e\u5417\u6dfb\u52a0 _a  \u548c  _b , \u5728\u5237\u673a, \u6216\u8005\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019, \u6839\u636ebootloader\u7684\u53c2\u6570\u6dfb\u52a0\u540e\u7f00, \u9009\u62e9\u6b63\u786e\u7684\u7cfb\u7edf. misc\u5206\u533a\u5728A/B\u7cfb\u7edf\u4e2d\u53d8\u6210\u4e00\u4e2a\u53ef\u6709\u53ef\u65e0\u7684\u5b58\u5728, \u56e0\u4e3a\u5176\u529f\u80fd\u53ea\u662f\u4f20\u9012\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u53c2\u6570, \u800crecovery\u7684\u529f\u80fd\u4e5f\u53ea\u5269\u4e0b\u6062\u590d\u51fa\u5382\u8bbe\u7f6e, \u6240\u4ee5, \u672c\u8d28\u4e0a, \u6ca1\u5fc5\u8981\u518d\u57fa\u4e8emisc\u4f20\u9012\u53c2\u6570\u4e86.", 
            "title": "\u5206\u533a\u8868\u548c\u5206\u533a\u5185\u5bb9\u53d8\u5316"
        }, 
        {
            "location": "/Android-AB-system-update/#_3", 
            "text": "bootloader\u4e3a\u4e86\u5224\u65ad\u4e00\u4e2a\u7cfb\u7edf(slot)\u662f\u5426\u4e3a\u53ef\u4ee5\u542f\u52a8\u7684\u72b6\u6001, \u9700\u8981\u4e3a\u5176\u5b9a\u4e49\u5bf9\u5e94\u7684\u5c5e\u6027(\u72b6\u6001). \u5176\u72b6\u6001\u8bf4\u660e\u5982\u4e0b:   active. \u6d3b\u52a8\u5206\u533a\u6807\u8bc6, \u6392\u4ed6, \u4ee3\u8868\u8be5\u5206\u533a\u4e3a\u542f\u52a8\u5206\u533a, bootloader\u603b\u4f1a\u9009\u62e9\u8be5\u5206\u533a.  bootable. \u8868\u793a\u8be5slot\u7684\u5206\u533a\u5b58\u5728\u4e00\u5957\u53ef\u80fd\u53ef\u4ee5\u542f\u52a8\u7684\u7cfb\u7edf.  successful. \u8868\u793a\u8be5slot\u7684\u7cfb\u7edf\u80fd\u6b63\u5e38\u542f\u52a8.  unbootable. \u4ee3\u8868\u8be5\u5206\u533a\u635f\u574f\u7684, \u65e0\u6cd5\u542f\u52a8, \u5728\u5347\u7ea7\u8fc7\u7a0b\u603b\u88ab\u6807\u8bb0, \u8be5\u6807\u8bb0\u7b49\u6548\u4e8e\u4ee5\u4e0a\u6807\u8bb0\u88ab\u6e05\u7a7a. \u800cactive\u6807\u8bb0\u4f1a\u5c06\u8be5\u6807\u8bb0\u6e05\u7a7a.   slot a  \u548c  slot b , \u53ea\u6709\u4e00\u4e2a\u662factive, \u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u6709 bootable \u548c successful \u5c5e\u6027.   bootloader\u68c0\u6d4b\u52301\u4e2a\u6216\u80052\u4e2aslot\u90fd\u662fbootable\u7684\u72b6\u6001.  \u9009\u62e9active\u7684slot\u6216\u8005\u9009\u62e9successful\u7684slot\u8fdb\u884c\u5c1d\u8bd5\u542f\u52a8.  \u542f\u52a8\u6210\u529f\u7684\u6807\u8bb0\u662f, dm-verity \u6210\u529f.  \u7531\u4e8e\u542f\u52a8\u6210\u529f, \u5219\u8be5slot\u88ab\u6807\u8bb0\u4e3asuccessful\u548cactive  \u7531\u4e8e\u542f\u52a8\u5931\u8d25, \u5219\u8bbe\u7f6e\u8be5slot\u4e3aunbootable, \u5e76\u8bbe\u7f6e\u53e6\u4e00\u4e2aslot\u4e3aactive, \u8fdb\u884c\u4e0b\u4e00\u6b21\u5c1d\u8bd5.", 
            "title": "\u7cfb\u7edf\u5206\u533a\u5c5e\u6027"
        }, 
        {
            "location": "/Android-AB-system-update/#_4", 
            "text": "\u9996\u5148, \u6211\u4eec\u770b\u4e0b\u5347\u7ea7\u5305\u7684\u5185\u5bb9. \u5728A/B\u5347\u7ea7\u7684\u60c5\u51b5\u4e0b, \u5347\u7ea7\u5305\u5185\u5bb9\u5982\u4e0b:  Path = aosp_marlin-ota-eng.builder.zip\nType = zip\nComment = signed by SignApk\nPhysical Size = 384694679\n\n   Date      Time    Attr         Size   Compressed  Name\n------------------- ----- ------------ ------------  ------------------------\n2009-01-01 00:00:00 .....          360          360  META-INF/com/android/metadata\n2009-01-01 00:00:00 .....          107          107  care_map.txt\n2009-01-01 00:00:00 .....    384690699    384690699  payload.bin\n2009-01-01 00:00:00 .....          154          154  payload_properties.txt\n2009-01-01 00:00:00 .....         1675          943  META-INF/com/android/otacert\n------------------- ----- ------------ ------------  ------------------------\n                             384692995    384692263  5 files, 0 folders   \u4e0b\u8f7d\u548c\u5347\u7ea7\u7a0b\u5e8f\u662f update_engine , \u6765\u81eachrome os, \u4ee3\u7801\u4e2d\u5927\u91cf\u5b58\u5728dbus\u548cchrome os\u7684\u75d5\u8ff9, \u800cAndroid\u4e0a\u6539\u7a0b\u5e8f\u662f\u57fa\u4e8ebinde\u8fdb\u884c\u901a\u4fe1. \u4e0e\u539f\u5148\u7684ota\u5347\u7ea7\u4e0d\u540c, \u8be5\u5347\u7ea7\u5305\u4e2d\u4e0d\u5305\u542bupdater, \u4e5f\u5c31\u662f\u8bf4, \u5347\u7ea7\u7684\u903b\u8f91\u5728\u8bbe\u5907\u7aef\u800c\u4e0d\u662f\u5728\u5347\u7ea7\u5305\u4e2d. \u5982\u679c\u719f\u6089ota\u5347\u7ea7\u7684\u8bdd, \u8fd9\u4e2a\u5347\u7ea7\u5305\u4e2d\u7684\u6570\u636e\u8ddf\u5757\u5347\u7ea7\u6570\u636e\u51e0\u4e4e\u4e00\u6837, \u521d\u6b65\u5224\u65ad\u7528\u7684\u662f\u5757\u5347\u7ea7.\n\u90a3\u4e48, \u5982\u679c\u6709\u65b0\u7684\u9700\u6c42, \u6bd4\u5982\u6b64\u6b21\u66f4\u65b0\u9700\u8981\u8c03\u6574\u6570\u636e\u5e93, \u662f\u5982\u4f55\u505a\u5230\u7684? \u8bf7\u67e5\u770b\u540e\u6587\u7b2c\u4e8c\u6b65\u5347\u7ea7.  \u6574\u4e2a\u5347\u7ea7\u5206\u4e3a\u4e94\u6b65:   \u4e0b\u8f7d\u5347\u7ea7\u5305, \u6216\u8005\u5347\u7ea7\u6d41. Android8 \u65b0\u652f\u6301\u4e86\u6d41\u5f0f\u5347\u7ea7, \u53ef\u4ee5\u8fb9\u4e0b\u8fb9\u5347.  \u7b2c\u4e00\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f,  update_engine \u6267\u884c\u7684\u5347\u7ea7\u903b\u8f91, \u57fa\u672c\u7684\u6570\u636e\u5199\u5165.  \u6821\u9a8c\u5199\u5165\u6570\u636e. \u786e\u4fdd\u4e0a\u4e00\u6b65\u5199\u5165\u6570\u636e\u53ef\u9760\u5b8c\u6574.  \u7b2c\u4e8c\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f, \u6302\u8f7d\u65b0\u70e7\u5199\u7684\u5206\u533a, \u5e76\u6267\u884c\u5176\u4e2d\u7684\u6307\u5b9a\u811a\u672c(\u7a0b\u5e8f)\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u64cd\u4f5c.  \u5e94\u7528\u4f18\u5316.  \u7531\u4e8e\u5b58\u5728A/B\u65b0\u65e7\u4e24\u5957\u7cfb\u7edf, \u6240\u4ee5, data\u5e95\u4e0b\u4e5f\u5b58\u5728\u4e24\u5957odex/vdex.   \u524d4\u6b65, \u57fa\u4e8e\u4e00\u79cdpipe\u7684\u6846\u67b6\u5b9e\u73b0, \u6bcf\u4e00\u6b65\u90fd\u662f\u4e00\u4e2aaction, \u522b\u94fe\u63a5\u5230actio list\u4e2d, \u524d\u540e\u4e24\u4e2aaction\u901a\u8fc7pipe\u673a\u5236\u8fdb\u884c\u6570\u636e\u901a\u4fe1. \u4e5f\u5c31\u662f\u8bf4, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u9ed8\u8ba4\u53d8\u6210\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. action\u7684\u6267\u884c\u51fd\u6570\u662f PerformAction() . \u901a\u8fc7 HasInputObject() \u548c HasOutputPipe() \u5224\u65ad\u662f\u5426\u6709\u8f93\u5165\u548c\u8f93\u51fa\u6d41, \u800c GetInputObject() \u63a5 SetOutputObject() \u5206\u522b\u662f\u8bfb\u53d6\u548c\u5199\u5165pipe.  update_engine  \u7684 Androidmk\u76ee\u6807, \u4f9d\u8d56\u548c\u5bf9\u5e94\u6e90\u7801\u6587\u4ef6\u5982\u4e0b.  # \u9759\u6001\u5e93\u6a21\u5757\nSTATIC_LIBRARIES:\n    update_metadata-protos      (host, target)\n    libpayload_consumer         (host, target)\n    libupdate_engine_android    (target)\n    libpayload_generator        (host, target)\n\n# \u53ef\u6267\u884c\u6a21\u5757\nEXECUTABLES:\n    update_engine           (target)\n    update_engine_sideload      (target)\n    update_engine_client        (target)\n    delta_generator         (host)\n\n# \u5171\u4eab\u5e93\u6a21\u5757\nSHARED_LIBRARIES:\n    libupdate_engine_client     (target)\n\n# \u9884\u7f16\u8bd1\u6a21\u5757\nPREBUILT:\n    updater.json            (target)\n    brillo_update_payload       (host)  \u4ece\u4e0a\u6587\u7684\u76ee\u6807\u53ef\u4ee5\u83b7\u53d6\u5982\u4e0b\u4fe1\u606f:   payload \u4e2d\u7684\u6587\u4ef6\u7ed3\u6784\u662fprotos  \u53ef\u6267\u884c\u6587\u4ef6\u662f  update_engine , \u800c  update_engine_client  \u662f\u5ba2\u6237\u7aef,  update_engine_sideload  \u662frecovery\u6a21\u5f0f\u4e0b\u901a\u8fc7usb\u66f4\u65b0.  delta_generator  \u7528\u4e8e\u751f\u6210payload  \u5b8c\u6574\u7684Android.mk\u4e2d, \u5b58\u5728\u6807\u8bb0\u4e3a local_use_omaha , \u53ea\u6709\u5728  PRODUCT_IOT  \u7269\u8054\u7f51\u65f6, \u624d\u542f\u7528, \u7f16\u8bd1\u83b7\u5f97\u7684\u662fdbus\u7248\u672c\u7684 update_engine .   \u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b:  update_engine (target)\n  --  libupdate_engine_android\n    --  libpayload_consumer\n      --  update_metadata-protos\n\nupdate_engine_sideload (target)\n  --  update_engine_sideload\n    --  update_metadata-protos\n\nupdate_engine_client (target)\n\ndelta_generator (host)\n  --  libpayload_generator\n    --  libpayload_consumer\n      --  update_metadata-protos  \u6e90\u7801\u5217\u8868\u5982\u4e0b:  update_metadata-protos (STATIC_LIBRARIES)\n  --  update_metadata.proto\n\nlibpayload_consumer (STATIC_LIBRARIES)\n  --  common/action_processor.cc\n      common/boot_control_stub.cc\n      common/clock.cc\n      common/constants.cc\n      common/cpu_limiter.cc\n      common/error_code_utils.cc\n      common/hash_calculator.cc\n      common/http_common.cc\n      common/http_fetcher.cc\n      common/file_fetcher.cc\n      common/hwid_override.cc\n      common/multi_range_http_fetcher.cc\n      common/platform_constants_android.cc\n      common/prefs.cc\n      common/subprocess.cc\n      common/terminator.cc\n      common/utils.cc\n      payload_consumer/bzip_extent_writer.cc\n      payload_consumer/delta_performer.cc\n      payload_consumer/download_action.cc\n      payload_consumer/extent_writer.cc\n      payload_consumer/file_descriptor.cc\n      payload_consumer/file_writer.cc\n      payload_consumer/filesystem_verifier_action.cc\n      payload_consumer/install_plan.cc\n      payload_consumer/payload_constants.cc\n      payload_consumer/payload_verifier.cc\n      payload_consumer/postinstall_runner_action.cc\n      payload_consumer/xz_extent_writer.cc\n\nlibupdate_engine_android (STATIC_LIBRARIES)\n  --  binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      binder_service_android.cc\n      boot_control_android.cc\n      certificate_checker.cc\n      daemon.cc\n      daemon_state_android.cc\n      hardware_android.cc\n      libcurl_http_fetcher.cc\n      network_selector_android.cc\n      proxy_resolver.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n\nupdate_engine (EXECUTABLES)\n  --  main.cc\n\nupdate_engine_sideload (EXECUTABLES)\n  --  boot_control_android.cc\n      hardware_android.cc\n      network_selector_stub.cc\n      proxy_resolver.cc\n      sideload_main.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n      boot_control_recovery_stub.cc\n\nupdate_engine_client (EXECUTABLES)\n  --  binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      common/error_code_utils.cc\n      update_engine_client_android.cc\n      update_status_utils.cc\n\nlibpayload_generator (SHARED_LIBRARIES)\n  --  payload_generator/ab_generator.cc\n      payload_generator/annotated_operation.cc\n      payload_generator/blob_file_writer.cc\n      payload_generator/block_mapping.cc\n      payload_generator/bzip.cc\n      payload_generator/cycle_breaker.cc\n      payload_generator/delta_diff_generator.cc\n      payload_generator/delta_diff_utils.cc\n      payload_generator/ext2_filesystem.cc\n      payload_generator/extent_ranges.cc\n      payload_generator/extent_utils.cc\n      payload_generator/full_update_generator.cc\n      payload_generator/graph_types.cc\n      payload_generator/graph_utils.cc\n      payload_generator/inplace_generator.cc\n      payload_generator/payload_file.cc\n      payload_generator/payload_generation_config.cc\n      payload_generator/payload_signer.cc\n      payload_generator/raw_filesystem.cc\n      payload_generator/tarjan.cc\n      payload_generator/topological_sort.cc\n      payload_generator/xz_android.cc\n\ndelta_generator (EXECUTABLES)\n  --  payload_generator/generate_delta_main.cc", 
            "title": "\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7"
        }, 
        {
            "location": "/Android-AB-system-update/#_5", 
            "text": "\u4e0b\u8f7d\u76f8\u5173\u4e0e\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u903b\u8f91:  delta_performer.cc  \u5347\u7ea7\u6d41(\u5305)\u7684\u4e0b\u8f7d, \u5206\u4e3a\u4e24\u4e2a\u6a21\u5f0f:   \u4e0b\u8f7dzip\u5305\u5230data\u5206\u533a.  \u4e0b\u8f7d\u5347\u7ea7\u6d41, \u8fb9\u4e0b\u8fb9\u5347\u7ea7.   ( \u4ecechrome os\u4ee3\u7801\u770b, \u5176\u5347\u7ea7\u670d\u52a1\u5668\u662fomaha server, \u53ef\u4ee5\u53c2\u8003\u770b\u4e0b\u5bf9\u4e8e\u6211\u4eec\u7684\u5347\u7ea7\u670d\u52a1\u5668\u662f\u5426\u6709\u5e2e\u52a9.\nhttps://github.com/Crystalnix/omaha-server\nhttps://github.com/Crystalnix/omaha-server/wiki\n)  payload \u6570\u636e\u7ed3\u6784:  version 1:\n|  C r A U  | version(8) | manifestSize(8) | manifest(manifestSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |\n\nversion 2:\n|  C r A U  | version(8) | manifestSize(8) | MetadataSignatureSize(4) | manifest(manifestSize) | medatadataSignatureMessage(MetadataSignatureSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |  \u5176\u4e2d medatadataSignatureMessage \u6821\u9a8c\u7684\u662f\u5176\u4e4b\u524d\u7684\u6240\u6709\u6570\u636e, \u800c payloadSignatureMessage \u6821\u9a8c\u7684\u662f payloadSignatureMessageSize \u4e4b\u524d\u7684\u6240\u6709\u6570\u636e.  \u800c manifest \u662fprotobuff, \u5176\u4e2d\u5305\u542b\u4e00\u7ec4\u6307\u4ee4\u96c6, \u4e5f\u5c31\u662f\u4ee5\u524drecovery \u5757\u5347\u7ea7\u7684\u4e00\u7cfb\u5217\u6307\u4ee4. rawData\u662f\u88ab\u66f4\u65b0\u6570\u636e, \u6307\u4ee4\u4f1a\u4ecerawData\u6307\u5b9a\u4f4d\u7f6e\u8bfb\u53d6\u6570\u636e\u5e76\u5e94\u7528\u5230\u76ee\u6807\u5206\u533a\u7684\u6307\u5b9a\u4f4d\u7f6e.  metadata\u7684\u6570\u636e\u662fprotobuf, \u6570\u636e\u7ed3\u6784\u4e3a update_metadata.proto  \u4e0b\u8f7d\u5b58\u5728\u4e24\u79cd\u6a21\u5f0f, p2p\u548c\u666e\u901a\u4e0b\u8f7d.  \u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u903b\u8f91\u4e0e\u4e4b\u524dota\u5347\u7ea7\u4e0b\u8f7d\u5347\u7ea7\u5305\u7684\u903b\u8f91\u4e00\u81f4.  update_engine \u5c06\u5347\u7ea7\u5305\u4e0b\u8f7d\u5230\u672c\u5730.  \u4e0b\u9762\u5148\u4ecb\u7ecd\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u7684\u903b\u8f91.", 
            "title": " \u4e0b\u8f7d "
        }, 
        {
            "location": "/Android-AB-system-update/#data", 
            "text": "\u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u5b9e\u73b0\u4e0d\u518d update_engine \u4e2d, \u800c\u5982\u679c\u662f\u9884\u5148\u4e0b\u8f7d\u5b8c\u6210\u7684payload, \u901a\u8fc7 file:// \u7684url\u4f20\u9012\u7ed9 update_engine , \u540e\u7eed\u903b\u8f91\u4e0e\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u4e00\u6837.  \u800cjava\u5c42\u7684UpdateEngine.java\u7684API, \u66b4\u9732\u5230\u4e86\u7cfb\u7edf\u7684jar\u5305\u4e2d, \u5e76\u672a\u627e\u5230\u8c03\u7528\u8005, \u4e5f\u5c31\u662f\u8bf4, \u8fd9\u5757\u903b\u8f91\u662f\u975e\u5f00\u6e90\u7684, \u6211\u4eec\u65e0\u6cd5\u83b7\u5f97.", 
            "title": "\u4e0b\u8f7d\u5230data\u5206\u533a"
        }, 
        {
            "location": "/Android-AB-system-update/#_6", 
            "text": "\u6240\u8c13\u8fb9\u4e0b\u8fb9\u5347, \u5c31\u662f\u5c06\u5347\u7ea7\u6570\u636e\u4e0b\u8f7d\u5230\u5185\u5b58\u4e2d, \u5e76\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\u76f8\u5e94\u5904\u7406, \u6700\u540e\u5199\u5165\u76ee\u6807\u5206\u533a. \n\u4e0b\u9762\u662f\u8fb9\u4e0b\u8fb9\u5347\u7684\u5ba2\u6237\u7aef\u6267\u884c\u547d\u4ee4.  # update_engine_client \\\n--payload=http://xxx/android/full-ota/payload.bin \\\n--update \\\n--headers= \\\n  FILE_HASH=ozGgyQEddkI5Zax+Wbjo6I/PCR8PEZka9gGd0nWa+oY= \\\n  FILE_SIZE=282344983\n  METADATA_HASH=GLIKfE6KRwylWMHsNadG/Q8iy5f786WTatvMdBlpOPg= \\\n  METADATA_SIZE=26723 \\   \u5728Pixel\u624b\u673a\u4e0a\u5347\u7ea7\u7684\u8f93\u51falog\u5982\u9644\u4ef6 update_engine.log , \u611f\u5174\u8da3\u7684\u7ae5\u978b\u53ef\u4ee5\u770b\u4e0b, \u5176\u4e2d\u5305\u542b\u4e86\u5404\u4e2a\u9636\u6bb5\u7684\u884c\u4e3a.  \u5176\u4e2dheader\u540e\u9762\u7684\u5185\u5bb9, \u8ddf\u5347\u7ea7\u5305\u4e2d\u7684 payload_properties.txt  \u6587\u4ef6\u5185\u5bb9\u4e00\u6837. \u5404\u5b57\u6bb5\u7684\u4f5c\u7528\u53ef\u4ee5\u53c2\u8003\u524d\u6587payload\u7684\u5934\u6570\u636e\u683c\u5f0f\u6765\u7406\u89e3\u5177\u4f53\u6821\u9a8c\u7684\u6570\u636e\u4f4d.  update_engine  \u9996\u5148\u5b9a\u4e49\u4e00\u7cfb\u5217\u7684action:   download_action : \u4e0b\u8f7d\u6a21\u5757, \u8d1f\u8d23\u8fb9\u4e0b\u8fb9\u5347\u7ea7.  filesystem_verifier_action : \u6587\u4ef6\u7cfb\u7edf\u6821\u9a8c\u6a21\u5757, \u8d1f\u8d23\u5347\u7ea7\u5b8c\u6210\u540e\u6821\u9a8c\u6570\u636e\u7684\u5b8c\u6574\u6027  postinstall_runner_action : \u540e\u5347\u7ea7\u6a21\u5757, \u4e00\u4e9b\u811a\u672c\u6216\u53ef\u6267\u884c\u7a0b\u5e8f\u5728\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u540e\u6267\u884c.   \u4ee5\u4e0aaction\u901a\u8fc7\u7c7b\u4f3cpipeline\u7684\u5f62\u5f0f\u7ec4\u7ec7, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. \u800c\u5728\u5176\u4e2d\u4f20\u9012\u7684\u6570\u636e\u662f install_plan_ , \u8be5\u6570\u636e\u5305\u542b\u4e86payload(\u5347\u7ea7\u6570\u636e)\u7684\u6240\u6709\u4fe1\u606f(\u64cd\u4f5c\u5206\u533a, url, \u6821\u9a8c\u4fe1\u606f\u7b49), \u90e8\u5206\u4fe1\u606f\u7531\u540e\u9762\u7684action\u6267\u884c\u540e\u63d0\u4f9b.\n\u6240\u6709\u7684action, \u5176\u6267\u884c\u5165\u53e3\u51fd\u6570\u662f PerformAction() , \u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570, \u53ef\u4ee5\u66f4\u7ec6\u81f4\u5730\u4e86\u89e3\u8f93\u5165\u8f93\u51fa\u6570\u636e\u548c\u8be5action\u7684\u5177\u4f53\u529f\u80fd.  \u672c\u6bb5\u5185\u5bb9\u7740\u91cd\u4ecb\u7ecd download_action , \u5176\u4f59\u6a21\u5757\u5728\u540e\u9762\u4ecb\u7ecd.   \n1. \u8bfb\u53d6\u6570\u636e. \u8fd9\u91cc\u5e76\u4e0d\u662f\u6b63\u5e38\u7684read, \u8be5\u51fd\u6570\u662f\u4e2a\u4e0b\u8f7d\u7684Write\u56de\u8c03, \u800c\u8bfb\u53d6\u6570\u636e\u5728\u4ee3\u7801\u4e0a\u7684\u771f\u5b9e\u884c\u4e3a\u662f, \u8fd4\u56de\u9519\u8bef\u8868\u793a\u6570\u636e\u4e0d\u591f, \u7ee7\u7eed\u8bfb\u53d6, \u800c\u5df2\u7ecf\u8bfb\u53d6\u7684\u6570\u636e\u5b58\u653e\u5728buffer\u4e2d.\n2. \u89e3\u6790manifest. \u5c31\u662f\u4e0a\u6587\u4e2dpayload\u7684\u5934, \u5305\u542b\u6821\u9a8c\u4fe1\u606f\u548c\u6267\u884c\u7684\u6307\u4ee4\u96c6, \u8fd8\u6709\u6240\u6709\u64cd\u4f5c\u7684\u5206\u533a\u6821\u9a8c\u503c\u7b49.\n3. \u6253\u5f00\u5206\u533a\u8bbe\u5907. \u6839\u636e\u5347\u7ea7\u7c7b\u578b, \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7(manifest\u4e2d\u5305\u542b\u8be5\u4fe1\u606f), \u5219\u6253\u5f00\u88ab\u5347\u7ea7\u8bbe\u5907\u5206\u533a, \u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u6253\u5f00\u5f53\u524d\u8fd0\u884c\u8bbe\u5907\u5206\u533a\u548c\u88ab\u5347\u7ea7\u76ee\u6807\u5206\u533a.\n4. \u83b7\u53d6\u6307\u4ee4\u5217\u8868. \u662f\u4ecemanifest\u4e2d\u83b7\u53d6. \u4e0d\u540c\u6307\u4ee4, \u683c\u5f0f\u4e0d\u540c, \u4f46\u57fa\u672c\u683c\u5f0f\u662f  src:offset:size , \u6307\u5b9a\u64cd\u4f5c\u6e90/\u76ee\u6807, \u504f\u79fb\u548c\u5927\u5c0f.\n5. \u7531\u4e8e1\u63d0\u5230\u7684, \u5728\u6570\u636e\u4e0d\u591f\u65f6\u4f1a\u9000\u51fa, \u6240\u4ee5, \u4f1a\u4fdd\u5b58\u5f53\u524d\u5df2\u7ecf\u6267\u884c\u5230\u7684\u6307\u4ee4, \u5e76\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6307\u4ee4\u4fe1\u606f, \u8fd9\u91cc\u4fe1\u606f\u91cd\u70b9\u662f, \u9700\u8981\u8bfb\u53d6\u7684payload\u4e2doffset\u548csize. \u7531\u4e8epayload\u4e2d\u7684\u5347\u7ea7\u6570\u636e\u662f\u8ddf\u6307\u4ee4\u4e00\u8d77\u751f\u6210\u7684, \u6240\u4ee5, \u5176\u6570\u636e\u7684\u504f\u79fb\u5b8c\u5168\u53ef\u4ee5\u8ddf\u6307\u4ee4\u7684\u987a\u5e8f\u4e00\u81f4, \u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u8bfb\u6307\u9488\u8df3\u52a8, \u4e5f\u5c31\u4e0d\u9700\u8981p2p\u652f\u6301.\n6. \u6267\u884c\u6307\u4ee4. \u57fa\u672c\u6307\u4ee4\u53ef\u4ee5\u67e5\u770b\u4ee3\u7801, \u4e0e\u5757\u5347\u7ea7\u6307\u4ee4\u4e00\u6837. \n\u4e0b\u9762\u662f\u5347\u7ea7\u65f6\u6570\u636e\u7684\u5408\u6210\u56fe.   \u8fd9\u5e45\u56fe\u5c55\u793a\u7684\u662f\u5347\u7ea7\u6570\u636e\u7684\u5408\u6210. \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7, source\u4e3a\u7a7a, \u5219payload\u76f4\u63a5\u5199\u5165target. \u4f46\u4e0e\u4e00\u822c\u5206\u533a\u70e7\u5199\u8fd8\u662f\u6709\u4e9b\u5dee\u5f02, \u5e76\u4e0d\u4f1a\u64e6\u9664target, \u800c\u662f\u6309\u7167\u504f\u79fb\u548c\u5927\u5c0f\u76f4\u63a5\u5199\u5165.\u800c\u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u5219\u662f\u57fa\u4e8e\u5f53\u524d\u8fd0\u884c\u7cfb\u7edf\u4e3asource, \u4e0epayload\u7684\u6570\u636e\u5408\u5e76\u5199\u5165target.  \u6240\u4ee5, \u4e0d\u7ba1\u662f\u5168\u91cf\u5347\u7ea7\u8fd8\u662f\u589e\u91cf\u5347\u7ea7, \u65ad\u7535\u540e\u90fd\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u518d\u5347\u7ea7.", 
            "title": "\u8fb9\u4e0b\u8fb9\u5347"
        }, 
        {
            "location": "/Android-AB-system-update/#_7", 
            "text": "\u83b7\u53d6\u8f93\u5165\u6570\u636e. \u662f\u6307\u83b7\u53d6\u4ece download_action \u5b8c\u6210\u540e\u7684\u6570\u636e, \u5305\u542b\u88ab\u5347\u7ea7\u5206\u533a\u53ca\u5176\u54c8\u5e0c\u503c\u7b49.  \u5f00\u59cb\u6821\u9a8c\u88ab\u5347\u7ea7\u5206\u533a. \u5355\u7eaf\u4ece\u5206\u533a\u8bfb\u53d6\u5757\u6570\u636e\u5e76\u4e0epayload\u4e2d\u5b58\u653e\u7684\u8fdb\u884c\u6bd4\u5bf9\u6821\u9a8c.  \u5f00\u59cb\u6821\u9a8c\u5f53\u524dslot\u6e90\u5206\u533a. \u8fd9\u4e2a\u662f\u9488\u5bf9\u589e\u91cf\u5347\u7ea7\u7684. \u5728\u6821\u9a8c\u76ee\u6807\u5206\u533a\u5931\u8d25\u540e, \u6821\u9a8c\u6e90\u5206\u533a.\u6b64\u5904\u6821\u9a8c\u7684\u76ee\u7684\u4e0d\u662f\u5224\u65ad\u5f53\u524d\u8fd0\u884c\u7684\u5206\u533a\u662f\u5426\u5408\u6cd5(\u542f\u52a8\u65f6, \u7531\u5176\u4ed6\u6a21\u5757\u6821\u9a8c), \u800c\u662f\u5224\u65ad\u4e0b\u8f7d\u7684payload\u662f\u5426\u4e0e\u5f53\u524d\u7cfb\u7edf\u5339\u914d(\u670d\u52a1\u5668\u7aef\u653e\u9519\u5347\u7ea7\u6587\u4ef6).  \u6807\u8bb0\u4f20\u8f93\u5931\u8d25. \u8fd9\u91cc\u662f\u57283\u7684\u57fa\u7840\u4e0a, \u5c06\u5f53\u524dpayload\u7684\u4e0b\u8f7durl\u6807\u8bb0\u5931\u8d25, \u5e76\u589e\u52a0\u5931\u8d25\u6b21\u6570. \u5728\u8fbe\u5230\u4e00\u5b9a\u6b21\u6570\u540e(\u670d\u52a1\u7aef\u914d\u7f6e), \u4e0d\u518d\u4ece\u8be5url\u83b7\u53d6\u5347\u7ea7\u6570\u636e, \u8df3\u5f80\u4e0b\u4e00\u4e2aurl.", 
            "title": " \u6821\u9a8c "
        }, 
        {
            "location": "/Android-AB-system-update/#post-install", 
            "text": "\u5404\u4e2a\u5206\u533a\u90fd\u53ef\u4ee5\u6307\u5b9apostinstall, \u800cpostinstall\u811a\u672c\u662f\u5728 download_action \u89e3\u6790mainifest\u65f6\u89e3\u6790\u5e76\u83b7\u5f97. \u5728\u5b9a\u4e49\u6267\u884cpostinstall\u4f46\u53c8\u65e0\u811a\u672c\u6307\u5b9a\u65f6, \u9ed8\u8ba4postinstall\u811a\u672c\u662f\u5206\u533a\u6839\u76ee\u5f55\u4e0b\u7684 postinst  \u5728Chrome OS\u4e2d, postinstall \u662f\u5141\u8bb8\u5bf9\u5206\u533a\u6267\u884c\u5757\u5199\u5165\u64cd\u4f5c\u7684,\u4f46\u662f\u5728Android, \u6302\u8f7d\u5206\u533a\u88ab\u6267\u884c\u6807\u8bb0\u4e3a\u53ea\u8bfb, \u5e76\u4e14\u4e5f\u6302\u8f7d\u6210\u53ea\u8bfb, \u4e5f\u5c31\u662f\u8bf4, \u4e0d\u5141\u8bb8\u5bf9\u88ab\u5347\u7ea7\u5206\u533a\u505a\u4fee\u6539(\u5c31\u7b97\u4fee\u6539\u4e86, \u4e4b\u540e\u6821\u9a8c\u4f9d\u7136\u53ef\u80fd\u51fa\u9519). postinstall\u7684\u811a\u672c\u662f\u76f4\u63a5\u57fa\u4e8e\u5f53\u524d\u88ab\u5347\u7ea7\u7cfb\u7edf\u6267\u884c, \u5e76\u672achroot, \u6240\u4ee5, postinstall\u811a\u672c\u5fc5\u987b\u80fd\u591f\u88ab\u4fdd\u8bc1\u8fd0\u884c\u5728\u88ab\u5347\u7ea7\u7cfb\u7edf\u4e2d. \u6240\u4ee5, \u4e00\u822c\u662f\u7eaf\u9759\u6001\u7684\u53ef\u6267\u884c\u7a0b\u5e8f, \u800c\u4e14\u5176\u529f\u80fd\u5728android\u4e0a\u4e5f\u88ab\u5f31\u5316\u4e86.", 
            "title": " post install "
        }, 
        {
            "location": "/Android-AB-system-update/#odex", 
            "text": "\u5728\u4ee5\u4e0a\u5168\u90e8\u5b8c\u6210\u540e, \u7cfb\u7edf\u5c06\u6807\u8bb0slot\u4e3a\u88ab\u5347\u7ea7\u7cfb\u7edf, \u5e76\u5728\u4e0b\u6b21\u91cd\u542f\u540e, \u8fdb\u5165\u5347\u7ea7\u540e\u7684\u7cfb\u7edf, \u6821\u9a8c\u5e76\u4f18\u5316. \u8fd9\u65f6\u5019\u5982\u679c\u6821\u9a8c\u5931\u8d25, \u5219\u8fd8\u4f1a\u56de\u5230\u539f\u5148\u7cfb\u7edf. \u5219\u8be5\u60c5\u51b5\u5b58\u5728data\u4e0b\u5e94\u7528\u6570\u636e\u5df2\u7ecf\u88ab\u4f18\u5316\u4e3a\u65b0\u7248\u672c\u6216\u8005\u4f18\u5316\u5230\u4e00\u534a\u7684\u95ee\u9898. \u8ddf\u4e86\u4e0b\u76f8\u5173\u4ee3\u7801\u548c\u7f51\u4e0a\u7684\u8d44\u6599, \u7ed3\u8bba\u5982\u4e0b. \n\u5728A/B\u5347\u7ea7\u5b8c\u6210\u8fdb\u5165\u65b0\u7cfb\u7edf\u540e, dexopt\u7684\u53c2\u6570\u662fspeed-profile, \u800c\u8be5\u53c2\u6570\u7684\u542b\u4e49\u5c31\u662f\u6839\u636e\u201c\u70ed\u4ee3\u7801\u201d\u7684profile\u914d\u7f6e\u6765\u7f16\u8bd1. \u90a3\u4e48\u95ee\u9898\u5c31\u662f\u8fd9\u4e2aprofile\u7684\u751f\u6210,\u548c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u589e\u91cf\u7f16\u8bd1.   profile\u5728\u8fbe\u5230\u4e00\u5b9a\u6761\u4ef6\u540e\u5199\u5165/data/, \u76ee\u524d\u4ece\u4ee3\u7801\u770b, \u5df2\u77e5\u7684\u4e00\u4e2a\u6761\u4ef6\u662f\u5927\u5c0f 50K\u65f6, \u5199\u5165\u6587\u4ef6. \u800c\u5728\u5df2\u7ecf\u5b58\u5728\u8be5\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b, \u4f1a\u4f18\u5148\u52a0\u8f7d, \u5982\u679c\u52a0\u8f7d\u5931\u8d25, \u5219\u5220\u9664\u5e76\u91cd\u65b0\u751f\u6210.  \u6267\u884c\u589e\u91cf\u7f16\u8bd1\u7684\u65f6\u95f4\u662f, \u673a\u5728\u5145\u7535\uff0b\u7a7a\u95f2\uff0b\u56db\u4e2a\u5c0f\u65f6\u95f4\u9694\u7b49\u591a\u4e2a\u6761\u4ef6\u4e0b, \u5728\u540e\u53f0\u5b8c\u6210.   \u4e5f\u5c31\u662f\u8bf4, \u5728AB\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u65f6, \u4e0d\u4f1a\u6267\u884c\u7f16\u8bd1, \u53ea\u4f1a\u6267\u884cprofile\u7684\u751f\u6210. \u800c\u5728\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u88ab\u68c0\u6d4b\u5230\u7cfb\u7edf\u6821\u9a8c\u5931\u8d25, \u5219\u4f1a\u56de\u5230\u4e0a\u4e00\u7248\u672c\u7cfb\u7edf.", 
            "title": " odex\u4f18\u5316 "
        }, 
        {
            "location": "/Android-AB-system-update/#bootloader", 
            "text": "\u4f20\u7edf\u7684Android\u4e0ebootloader\u901a\u4fe1\u662f\u901a\u8fc7misc\u5206\u533a. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u6570\u636e\u5e76\u4e0d\u662f\u5b58\u5728misc\u5206\u533a, \u800c\u4e14\u5b58\u653e\u4f4d\u7f6e\u7531\u5382\u5546\u5b9a\u4e49, \u63a5\u53e3\u5728 hardware/libhardware/include/hardware/boot_control.h . \u5176\u7ed3\u6784\u4f53\u662f  boot_control_module_t , \u5305\u542b\u4e86\u6240\u6709\u8bbe\u7f6e\u4ee5\u4e0aslot\u72b6\u6001\u7684\u63a5\u53e3.  \u4e0b\u9762\u4ecb\u7ecd\u4e0b\u4e0d\u540c\u5382\u5546 boot_control \u7684\u5b9e\u73b0.", 
            "title": "bootloader\u4ea4\u4e92"
        }, 
        {
            "location": "/Android-AB-system-update/#qcom", 
            "text": "\u4ee3\u7801\u4f4d\u7f6e:   hardware/qcom/bootctrl/boot_control.cpp \nqcom\u7684\u5b9e\u73b0\u662f, \u76f4\u63a5\u5c06A/B\u5206\u533a\u7684\u5c5e\u6027, \u5199\u5165\u7684gpt\u5206\u533a\u8868\u7684boot\u5206\u533a( boot_a \u548c boot_b ).qcom\u673a\u9876\u76d2gpt\u8868\u7684\u5206\u6790:http://blog.csdn.net/guyongqiangx/article/details/68924436   \n\u4e0a\u56fe\u662fqcom\u673a\u9876\u76d2gpt\u5206\u533a\u8868\u7684\u4fe1\u606f, \u5728Entry\u4e2d\u67e5\u627e\u5230\u5206\u533a boot_a \u548c boot_b , \u63d0\u53d6\u5176\u5c5e\u6027.\n\u4ece LAB 2 \u5f00\u59cb\u5b58\u653e\u7684\u662fGPT\u5206\u533a\u7684\u8be6\u7ec6\u4fe1\u606f Partition Entry , \u5355\u4e2a Partition Entry \u5360128\u4e2a\u5b57\u8282, \u4ece\u7b2c48\u4e2a\u5b57\u8282\u5f00\u59cb\u5b58\u653e\u7684\u662f\u5206\u533a\u5c5e\u6027, \u800cA/B\u7cfb\u7edf\u7684\u5206\u533a\u5c5e\u6027\u4e5f\u662f\u5b58\u653e\u5728\u8fd9\u4e2a\u4f4d\u7f6e.  \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230, qcom\u7684\u5b9e\u73b0, \u6ca1\u6709bootable\u7684\u6807\u8bb0\u4f4d, \u53d6\u800c\u4ee3\u4e4b\u7684\u662funbootable.", 
            "title": "qcom\u7684\u5b9e\u73b0"
        }, 
        {
            "location": "/Android-AB-system-update/#google", 
            "text": "\u4ee3\u7801\u4f4d\u7f6e system/extras/boot_control_copy/boot_control_copy.c  google\u7684\u53c2\u8003\u5b9e\u73b0\u590d\u7528\u4e86misc\u5206\u533a\u7684 bootloader_message (recovery\u4e0ebootloader\u901a\u4fe1\u7684\u5206\u533a). \u6574\u4e2amisc\u5206\u533a\u7684\u6570\u636e\u7ed3\u6784\u56fe\u5982\u4e0b.     fsmgr\u4f7f\u7528, \u5728\u8bbe\u7f6e\u6307\u5b9aslot\u4e3aactive\u65f6, \u540c\u65f6\u5c06\u5bf9\u5e94\u540e\u7f00\u8bbe\u7f6e\u5230\u8be5\u5b57\u6bb5. fsmgr\u5728\u6302\u8f7d\u5206\u533a\u65f6,\u901a\u8fc7\u8be5\u5b57\u6bb5\u62fc\u6210\u5b8c\u6210\u7684\u5206\u533a\u8def\u5f84.  Magic Numbe. \u7528\u6765\u786e\u5b9a\u8be5\u6570\u636e\u7aef\u7684\u5408\u6cd5, \u5fc5\u987b\u662f 'B', 'C' , 'c' (\" boot_control  copy\" \u7684\u7f29\u5199)  \u63a5\u53e3\u7248\u672c\u53f7  active\u72b6\u6001\u7684slot\u53f7, \u5728\u8be5\u5b9e\u73b0\u4e2d\u53ea\u6709 0 \u6216 1.  0 \u4e3a \u7b2c\u4e00\u4e2aslot, 1 \u4e3a\u7b2c\u4e8c\u4e2aslot, \u8bbe\u7f6eslot\u7684bootable/unbootable\u72b6\u6001.   \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa, \u5e76\u6ca1\u6709\u53ef\u4ee5\u6807\u8bb0\u4e3asuccessful\u7684\u4f4d, \u901a\u8fc7\u4ee3\u7801\u4e5f\u53d1\u73b0, \u5176\u5b9e\u73b0\u4e3a\u7a7a, \u4e5f\u5c31\u662f\u8bf4, \u5e76\u6ca1\u6709\u5b9e\u73b0\u8be5\u72b6\u6001.  \u5982\u679c\u6ce8\u610f\u5230\u4ee3\u7801, \u5728 module_setActiveBootSlot \u540e\u534a\u6bb5, \u4f1a\u5c06active\u72b6\u6001\u7684 boot_X \u5206\u533a\u5185\u5bb9\u62f7\u8d1d\u5230boot\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u7cfb\u7edf\u5b58\u5728\u4e09\u4e2a\u5206\u533a(boot,  boot_a ,  boot_b ), \u88ab\u8bbe\u7f6e\u4e3aactive\u7684\u5206\u533a\u4f1a\u88ab\u62f7\u8d1d\u5230boot\u5206\u533a, \u518d\u7ed3\u5408 module_getCurrentSlot \u7684\u5b9e\u73b0(\u4ece/system\u5206\u533a\u83b7\u53d6\u6302\u8f7d\u4fe1\u606f) ,\u4ece\u8fd9\u4e24\u6bb5\u4ee3\u7801\u53ef\u4ee5\u63a8\u6d4b\u51fa\u4e24\u4e2a\u7ed3\u8bba:   A/B\u7cfb\u7edf\u53ef\u4ee5\u4e0d\u5347\u7ea7firmware(bootloader), \u6216\u8005\u8bf4google\u7684\u8be5\u5b9e\u73b0\u6700\u521d\u662f\u4e3a\u4e86\u517c\u5bb9\u8001\u7684bootloader.  boot.img\u4e2d\u7684ramdisk\u53ef\u4ee5\u8fd8\u662fboot\u7684ramdisk.   \u4f46\u662f, \u4e0d\u786e\u5b9a\u53c2\u8003\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u8fd0\u884c. \u4f46\u662f\u5355\u7eaf\u4ece\u4ee5\u4e0a\u4ee3\u7801\u770b, \u9664\u4e86\u5206\u533a, A/B\u7cfb\u7edf\u7684\u542f\u52a8, \u6302\u8f7d, \u90fd\u53ef\u4ee5\u5728\u7528\u6237\u5c42\u641e\u5b9a. \u4f46\u662f\u5e26\u6765\u7684\u540e\u679c\u5c31\u662f, \u5982\u679cbootloader\u542f\u52a8boot\u5931\u8d25, \u5219\u65e0\u6cd5\u5207\u6362\u5230\u53e6\u4e00\u4e2aslot.", 
            "title": "google\u7684\u53c2\u8003\u5b9e\u73b0"
        }, 
        {
            "location": "/Android-AB-system-update/#_8", 
            "text": "\u5347\u7ea7\u5305\u5236\u4f5c\u5de5\u5177\u4e0d\u518d\u652f\u6301 \u57fa\u4e8e\u6587\u4ef6\u7684\u5347\u7ea7, \u5f53\u524d\u53ea\u652f\u6301ab\u5347\u7ea7\u548c\u5757\u5347\u7ea7.  \u5757\u5347\u7ea7\u548cab\u5347\u7ea7\u5728\u751f\u6210\u6570\u636e\u6587\u4ef6\u548c\u811a\u672c\u4e0a\u539f\u7406\u662f\u4e00\u6837\u7684, \u53ea\u662f\u5728\u751f\u6210\u5347\u7ea7\u6570\u636e\u65f6\u5b58\u5728\u5dee\u5f02.  AB\u5347\u7ea7payload\u5236\u4f5c\u903b\u8f91\u5728\u5347\u7ea7\u5305\u5236\u4f5c\u811a\u672c\u7684 WriteABOTAPackageWithBrilloScript , \u800c\u771f\u6b63payload\u751f\u6210\u7684\u903b\u8f91\u5728\u51fd\u6570 GenerateUpdatePayloadFile .  \u6d41\u7a0b\u5982\u4e0b:  \u751f\u6210payload\u6307\u4ee4\u89c4\u5219:", 
            "title": "\u5347\u7ea7\u5305\u751f\u6210"
        }, 
        {
            "location": "/Android-AB-system-update/#ab_1", 
            "text": "", 
            "title": "AB\u5347\u7ea7\u603b\u6d41\u7a0b\u56fe"
        }, 
        {
            "location": "/Android-memory-debug/", 
            "text": "Android\u5185\u5b58\u8c03\u8bd5\u5de5\u5177\u603b\u7ed3\n\n\n\u7d22\u5f15\n\n\n\n\n\u7cfb\u7edf\u5185\u5b58\u5206\u6790, \u6240\u6709\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\n\n\n\u57fa\u672c\u7684\nlogcat\n\u8f93\u51fa\u4e2d\u53ef\u80fd\u5305\u542b\u7684GC\u76f8\u5173\u4fe1\u606f, \u53ef\u4ee5\u4f5c\u4e3a\u7cfb\u7edf\u6216\u67d0\u4e9b\u5e94\u7528\u5185\u5b58\u72b6\u51b5\u7684\u53c2\u8003\u4f9d\u636e.\n\n\n\u5728SystemServer\u542f\u52a8\u7684\u60c5\u51b5\u4e0b, \u8fd8\u53ef\u4ee5\u901a\u8fc7 \ndumpsys meminfo\n \u4eceframework\u5c42\u89d2\u5ea6\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u7684\u72b6\u51b5, \u8be5\u90e8\u5206\u4fe1\u606f\u4e0e\u4ece\u7cfb\u7edf\u89d2\u5ea6\u83b7\u53d6\u7684\u4fe1\u606f\u5b58\u5728\u5dee\u5f02.\n\n\n\u5bf9\u4e8e\u9700\u8981\u6392\u5e8f\u5e76\u67e5\u627e\u5185\u5b58\u5360\u7528\u6700\u591a\u7684\u8fdb\u7a0b, \u63a8\u8350\u4f7f\u7528\u547d\u4ee4 \nprocrank\n\n\n\u5728\u5b9e\u5728\u7f3a\u5c11\u5de5\u5177, \u6216\u8005RD\u77e5\u9053\u9700\u8981\u4ec0\u4e48\u4fe1\u606f\u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u67e5\u770b\n/proc/meminfo\n\n\n\u5982\u679c\u9700\u8981\u8fde\u7eed\u76d1\u63a7\u7cfb\u7edf\u7684\u72b6\u6001(\u5185\u5b58/CPU\u7b49), \u53ef\u4ee5\u8003\u8651\u5de5\u5177\nvmstat\n\n\n\u5982\u679c\u9700\u8981\u4ece\u5171\u4eab\u5e93\u6216\u8005\u5171\u4eab\u5185\u5b58\u7684\u89d2\u5ea6\u5206\u6790\u5176\u5185\u5b58\u5360\u7528\u7684\u60c5\u51b5, \u53ef\u4ee5\u8003\u8651\u7528 \nlibrank\n, \u5f53\u7136, \u5982\u679c\u5b58\u5728host\u7aef\u7684\u5206\u6790\u5de5\u5177, \u5219\u8be5\u5de5\u5177\u7684\u8f93\u51fa\u53ef\u4ee5\u9876\u66ff\nprocrank\n\u548c\nprocmem\n.\n\n\n\u5982\u679c\u9700\u8981\u67e5\u770b\u7cfb\u7edf\u4e2d\u54ea\u4e9b\u5171\u4eab\u6587\u4ef6\u522b\u901a\u8fc7\u7f3a\u9875\u9519\u8bef\u7684\u65b9\u5f0f\u8bfb\u5230\u5185\u5b58, \u53ef\u4ee5\u4f7f\u7528\u5de5\u5177\ndumpcache\n\n\n\u5982\u679c\u5b9e\u5728\u4e0d\u77e5\u9053bug\u539f\u56e0\u6216\u8005\u95ee\u9898\u53ef\u80fd\u8ddf\u81ea\u5df1\u65e0\u5173, \u5efa\u8bae\u4f7f\u7528 \nbugreport\n, \u4f9b\u5176\u4ed6RD\u534f\u52a9\u5206\u6790\u95ee\u9898.\n\n\n\n\n\n\n\u6307\u5b9a\u5e94\u7528(dalvik\u8fdb\u7a0b)\u5185\u5b58\u5206\u6790\n\n\ndumpsys meminfo \u5e94\u7528\u5185\u5b58\n \u8f93\u51fa\u5f53\u524d\u8fdb\u7a0b/\u5e94\u7528\u7684\u6240\u6709\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u5efa\u8bae\u53ea\u9488\u5bf9dalvik\u5c42\u7684\u8fdb\u7a0b.\n\n\n\n\n\n\n\u6307\u5b9anative\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\n\n\nnative\u7684\u5355\u4e2a\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\u5efa\u8bae\u4f7f\u7528 \nprocmem\n\u548c \nshowmap\n. \nshowmap\n \u989d\u5916\u8f93\u51fa\u4e86\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4, \u53ef\u4ee5\u8f85\u52a9\u67e5\u770b\u7531\u4e8e\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f15\u8d77\u7684\u5185\u5b58\u95ee\u9898.\n\n\n\n\n\n\n\u5e94\u7528\u5185\u5b58\u6cc4\u9732\n\n\n\u5c11\u90e8\u5206\u7684\u6cc4\u9732, \u6bd4\u5982\u6570\u636e\u5e93/activity\u7b49, \u901a\u8fc7\ndumpsys meminfo \u5e94\u7528\u5185\u5b58\n, \u4f46\u53ea\u80fd\u77e5\u9053\u5b58\u5728\u6cc4\u9732.\n\n\n\u5e94\u7528\u5728\u5f00\u542f \nstrictmode\n \u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u53d1\u73b0\u66f4\u591a\u7684\u8d44\u6e90\u6cc4\u9732\u60c5\u51b5. \u4f46\u4ec5\u9650\u4e8e\u53d1\u73b0.\n\n\n\u4e00\u4e2a\u6bd4\u8f83\u63a8\u8350\u7684\u7528\u4e8e\u5b9a\u4e49\u5e94\u7528\u5185\u5b58\u6cc4\u9732\u7684\u5de5\u5177\u662f \nLeakCanary\n\n\n\n\n\n\nnative\u8fdb\u7a0b\u5185\u5b58\u6cc4\u9732\n\n\n\u57fa\u4e8ebionic\u7684\u5185\u5b58\u6cc4\u9732\u5206\u6790\u5de5\u5177\n, \u8be5\u5de5\u5177\u5bf9\u4e8eRD\u4f7f\u7528\u8981\u6c42\u504f\u9ad8.\n\n\n\n\n\n\nbugreport \u4fe1\u606f\u5206\u6790\n\n\n\u89c1\u5916\u90e8\u6587\u6863.\n\n\n\n\n\n\n\n\n\u57fa\u7840\u6982\u5ff5\n\n\nVSS - Virtual Set Size \u865a\u62df\u8017\u7528\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nRSS - Resident Set Size \u5b9e\u9645\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nPSS - Proportional Set Size \u5b9e\u9645\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58, USS + \u6bd4\u4f8b\u5206\u914d\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff08[\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u7684\u5185\u5b58(RSS - USS)] / [\u5206\u4eab\u5171\u4eab\u5185\u5b58\u7684\u8fdb\u7a0b\u6570\u91cf]\uff09.\nUSS - Unique Set Size \u8fdb\u7a0b\u72ec\u81ea\u5360\u7528\u7684\u7269\u7406\u5185\u5b58\uff08\u4e0d\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u5982\u679c\u770b\u8fdb\u7a0b\u72ec\u5360\u5185\u5b58\uff0c\u3000\u5219\u4f7f\u7528USS. \u4f46\u662f\u4e00\u822c\u8003\u8651\u5230\u5171\u4eab\u5185\u5b58\u7684\u60c5\u51b5, \u5927\u90e8\u5206\u90fd\u662f\u4f9d\u636ePSS\u67e5\u770b\u5bf9\u5e94\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528.\n\n\n\nshared clean: \u5e72\u51c0\u7684\u5171\u4eab\u6570\u636e, \u4e5f\u5c31\u662f\u8bf4, \u5f53\u524d\u6709\u591a\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6307\u5411\u8be5\u7269\u7406\u7a7a\u95f4, \u4e14\u5f53\u524d\u8fdb\u7a0b\u7a7a\u95f4\u8be5\u6570\u636e\u4e0edisk\u4e0a\u4e00\u81f4.\nshared dirty: \u810f\u5171\u4eab\u6570\u636e, \u4e0e\u4e0a\u9762\u5bf9\u5e94, \u8be5\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5171\u4eab\u6570\u636e\u4e0edisk\u4e0a\u6570\u636e\u4e0d\u4e00\u81f4.\nprivate clean: \u8fdb\u7a0b\u79c1\u6709\u5e72\u51c0\u6570\u636e, \u4e0edisk\u6570\u636e\u4e00\u81f4.\nprivate dirty: \u8fdb\u7a0b\u79c1\u6709\u810f\u6570\u636e, \u4e0edisk\u6570\u636e\u4e0d\u4e00\u81f4.\n\n\n\n\n\n\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\u5206\u6790\n\n\nlogcat \u8f93\u51fa \n\n\ndalvik\u65e5\u5fd7\u6253\u5370\n\n\n\u573a\u666f: \u5728\u5e94\u7528\u968f\u673a\u51fa\u73b0\u6162\u65f6, \u53ef\u4ee5\u770b\u770b\u90a3\u6bb5\u65f6\u95f4logcat\u7684\u8f93\u51fa, \u662f\u5426\u5305\u542bGC\u7684\u4e00\u4e9b\u4fe1\u606f. GC\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u6162, \u800c\u7cfb\u7edf\u53d1\u8d77\u7684GC\u5219\u610f\u5473\u7740\u5185\u5b58\u4e0d\u591f, \u53ef\u80fd\u51fa\u73b0\u4ece\u78c1\u76d8\u52a0\u8f7d\u7684\u60c5\u51b5.\n\n\n\u5728logcat\u4e2d\u4f1a\u6253\u5370dalvik\u7684\u5783\u573e\u56de\u6536\u4fe1\u606f.\n\n\nD/dalvikvm: \nGC_Reason\n \nAmount_freed\n, \nHeap_stats\n, \nExternal_memory_stats\n, \nPause_time\n\nD/dalvikvm( 9050): GC_CONCURRENT freed 2049K, 65% free 3571K/9991K, external 4703K/5261K, paused 2ms+2ms\n\n\n\n\n\n\n\nGC_Reason\n:\n\n\n\nGC_CONCURRENT\n\n    \u5728\u60a8\u7684\u5806\u5f00\u59cb\u5360\u7528\u5185\u5b58\u65f6\u53ef\u4ee5\u91ca\u653e\u5185\u5b58\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\n\nGC_FOR_MALLOC\n\n    \u5806\u5df2\u6ee1\u800c\u7cfb\u7edf\u4e0d\u5f97\u4e0d\u505c\u6b62\u60a8\u7684\u5e94\u7528\u5e76\u56de\u6536\u5185\u5b58\u65f6\uff0c\u60a8\u7684\u5e94\u7528\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u800c\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002\n\nGC_HPROF_DUMP_HEAP\n\n    \u5f53\u60a8\u8bf7\u6c42\u521b\u5efa HPROF \u6587\u4ef6\u6765\u5206\u6790\u5806\u65f6\u51fa\u73b0\u7684\u5783\u573e\u56de\u6536\u3002\n\nGC_EXPLICIT\n\n    \u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\u5f53\u60a8\u8c03\u7528 gc() \u65f6\uff08\u60a8\u5e94\u907f\u514d\u8c03\u7528\uff0c\u800c\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u4f1a\u6839\u636e\u9700\u8981\u8fd0\u884c\uff09\u3002\n\nGC_EXTERNAL_ALLOC\n\n    \u8fd9\u4ec5\u9002\u7528\u4e8e API \u7ea7\u522b 10 \u53ca\u66f4\u4f4e\u7ea7\u522b\uff08\u66f4\u65b0\u7248\u672c\u4f1a\u5728 Dalvik \u5806\u4e2d\u5206\u914d\u4efb\u4f55\u5185\u5b58\uff09\u3002\u5916\u90e8\u5206\u914d\u5185\u5b58\u7684\u5783\u573e\u56de\u6536\uff08\u4f8b\u5982\u5b58\u50a8\u5728\u539f\u751f\u5185\u5b58\u6216 NIO \u5b57\u8282\u7f13\u51b2\u533a\u4e2d\u7684\u50cf\u7d20\u6570\u636e\uff09\u3002 \n\n\n\nAmount_freed\n:\n\n\n\u4ece\u6b64\u6b21\u5783\u573e\u56de\u6536\u4e2d\u56de\u6536\u7684\u5185\u5b58\u91cf\u3002\n\n\n\nHeap_stats\n:\n\n\n\n\u5806\u7684\u53ef\u7528\u7a7a\u95f4\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002\n\n\n\n\nExternal_memory_stats\n:\n\n\n\nAPI \u7ea7\u522b 10 (Android3.0 \u4ee5\u4e0b)\u53ca\u66f4\u4f4e\u7ea7\u522b\u7684\u5916\u90e8\u5206\u914d\u5185\u5b58\uff08\u5df2\u5206\u914d\u5185\u5b58\u91cf\uff09/\uff08\u53d1\u751f\u56de\u6536\u7684\u9650\u503c\uff09. \u800c\u65b0API\u4e2d, \u7edf\u4e00\u7531dalvik\u7ba1\u7406.\n\n\n\n\nPause_time\n\n\n\n\n\u5806\u8d8a\u5927\uff0c\u6682\u505c\u65f6\u95f4\u8d8a\u957f\u3002\u5e76\u53d1\u6682\u505c\u65f6\u95f4\u663e\u793a\u4e86\u4e24\u4e2a\u6682\u505c\uff1a\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5f00\u59cb\u65f6\uff0c\u53e6\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5feb\u8981\u5b8c\u6210\u65f6\u3002\n\n\n\nart\u65e5\u5fd7\u6253\u5370\n\n\n\u4e0e Dalvik \u4e0d\u540c\uff0cART \u4e0d\u4f1a\u4e3a\u672a\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\u8bb0\u5f55\u6d88\u606f\u3002\u53ea\u6709\u5728\u8ba4\u4e3a\u5783\u573e\u56de\u6536\u901f\u5ea6\u8f83\u6162\u65f6\u624d\u4f1a\u6253\u5370\u5783\u573e\u56de\u6536\u3002\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u4ec5\u5728\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8d85\u8fc7 5ms \u6216\u5783\u573e\u56de\u6536\u6301\u7eed\u65f6\u95f4\u8d85\u8fc7 100ms \u65f6\u3002\u5982\u679c\u5e94\u7528\u672a\u5904\u4e8e\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\uff0c\u90a3\u4e48\u5176\u5783\u573e\u56de\u6536\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u8f83\u6162\u3002\u59cb\u7ec8\u4f1a\u8bb0\u5f55\u663e\u5f0f\u5783\u573e\u56de\u6536\u3002\n\n\nI/art: \nGC_Reason\n \nGC_Name\n \nObjects_freed\n(\nSize_freed\n) AllocSpace Objects, \nLarge_objects_freed\n(\nLarge_object_size_freed\n) \nHeap_stats\n LOS objects, \nPause_time(s)\n\n\nI/art : Explicit concurrent mark sweep GC freed 104710(7MB) AllocSpace objects, 21(416KB) LOS objects, 33% free, 25MB/38MB, paused 1.230ms total 67.216ms\n\n\n\n\n\nGC_Reason\n:\n\n\n\nConcurrent\n\n    \u4e0d\u4f1a\u6682\u505c\u5e94\u7528\u7ebf\u7a0b\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\u6b64\u5783\u573e\u56de\u6536\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u800c\u4e14\u4e0d\u4f1a\u963b\u6b62\u5206\u914d\u3002\n\nAlloc\n\n    \u60a8\u7684\u5e94\u7528\u5728\u5806\u5df2\u6ee1\u65f6\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5206\u914d\u7ebf\u7a0b\u4e2d\u53d1\u751f\u4e86\u5783\u573e\u56de\u6536\u3002\n\nExplicit\n\n    \u7531\u5e94\u7528\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\uff0c\u901a\u8fc7\u8c03\u7528 gc() \u6216 gc()\u3002\u4e0e Dalvik \u76f8\u540c\uff0c\u5728 ART \u4e2d\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u60a8\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u5e76\u907f\u514d\u8bf7\u6c42\u663e\u5f0f\u5783\u573e\u56de\u6536\uff08\u5982\u679c\u53ef\u80fd\uff09\u3002\u4e0d\u5efa\u8bae\u4f7f\u7528\u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u963b\u6b62\u5206\u914d\u7ebf\u7a0b\u5e76\u4e0d\u5fc5\u8981\u5730\u6d6a\u8d39 CPU \u5468\u671f\u3002\u5982\u679c\u663e\u5f0f\u5783\u573e\u56de\u6536\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u88ab\u62a2\u5360\uff0c\u90a3\u4e48\u5b83\u4eec\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\uff08\u5e94\u7528\u4e2d\u51fa\u73b0\u95f4\u65ad\u3001\u6296\u52a8\u6216\u6682\u505c\uff09\u3002\n\nNativeAlloc\n\n    \u539f\u751f\u5206\u914d\uff08\u5982\u4f4d\u56fe\u6216 RenderScript \u5206\u914d\u5bf9\u8c61\uff09\u5bfc\u81f4\u51fa\u73b0\u539f\u751f\u5185\u5b58\u538b\u529b\uff0c\u8fdb\u800c\u5f15\u8d77\u7684\u56de\u6536\u3002\n\nCollectorTransition\n\n    \u7531\u5806\u8f6c\u6362\u5f15\u8d77\u7684\u56de\u6536\uff1b\u6b64\u56de\u6536\u7531\u8fd0\u884c\u65f6\u5207\u6362\u5783\u573e\u56de\u6536\u5f15\u8d77\u3002\u56de\u6536\u5668\u8f6c\u6362\u5305\u62ec\u5c06\u6240\u6709\u5bf9\u8c61\u4ece\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u590d\u5236\u5230\u78b0\u649e\u6307\u9488\u7a7a\u95f4\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002\u5f53\u524d\uff0c\u56de\u6536\u5668\u8f6c\u6362\u4ec5\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u51fa\u73b0\uff1a\u5728 RAM \u8f83\u5c0f\u7684\u8bbe\u5907\u4e0a\uff0c\u5e94\u7528\u5c06\u8fdb\u7a0b\u72b6\u6001\u4ece\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u72b6\u6001\u53d8\u66f4\u4e3a\u53ef\u5bdf\u89c9\u7684\u975e\u6682\u505c\u72b6\u6001\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002 \n\nHomogeneousSpaceCompact\n\n    \u9f50\u6027\u7a7a\u95f4\u538b\u7f29\u662f\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u5230\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u538b\u7f29\uff0c\u901a\u5e38\u5728\u5e94\u7528\u8fdb\u5165\u5230\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\u65f6\u53d1\u751f\u3002\u8fd9\u6837\u505a\u7684\u4e3b\u8981\u539f\u56e0\u662f\u51cf\u5c11 RAM \u4f7f\u7528\u91cf\u5e76\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\u3002 \n\nDisableMovingGc\n\n    \u8fd9\u4e0d\u662f\u771f\u6b63\u7684\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u53d1\u751f\u5e76\u53d1\u5806\u538b\u7f29\u65f6\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86 GetPrimitiveArrayCritical\uff0c\u56de\u6536\u906d\u5230\u963b\u6b62\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 GetPrimitiveArrayCritical\uff0c\u56e0\u4e3a\u5b83\u5728\u79fb\u52a8\u56de\u6536\u5668\u65b9\u9762\u5177\u6709\u9650\u5236\u3002 \n\nHeapTrim\n\n    \u8fd9\u4e0d\u662f\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5806\u4fee\u526a\u5b8c\u6210\u4e4b\u524d\u56de\u6536\u4f1a\u4e00\u76f4\u53d7\u5230\u963b\u6b62\u3002 \n\n\nGC_Name\n:\n\n\n\nART \u5177\u6709\u53ef\u4ee5\u8fd0\u884c\u7684\u591a\u79cd\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u3002 \n\n\nConcurrent mark sweep (CMS)\n\n    \u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u91ca\u653e\u548c\u56de\u6536\u6620\u50cf\u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002\n\nConcurrent partial mark sweep\n\n    \u51e0\u4e4e\u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u56de\u6536\u9664\u4e86\u6620\u50cf\u7a7a\u95f4\u548c zygote \u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002 \n\nConcurrent sticky mark sweep\n\n    \u751f\u6210\u56de\u6536\u5668\uff0c\u53ea\u80fd\u91ca\u653e\u81ea\u4e0a\u6b21\u5783\u573e\u56de\u6536\u4ee5\u6765\u5206\u914d\u7684\u5bf9\u8c61\u3002\u6b64\u5783\u573e\u56de\u6536\u6bd4\u5b8c\u6574\u6216\u90e8\u5206\u6807\u8bb0\u6e05\u9664\u8fd0\u884c\u5f97\u66f4\u9891\u7e41\uff0c\u56e0\u4e3a\u5b83\u66f4\u5feb\u901f\u4e14\u6682\u505c\u65f6\u95f4\u66f4\u77ed\u3002 \n\nMarksweep + semispace\n\n    \u975e\u5e76\u53d1\u3001\u590d\u5236\u5783\u573e\u56de\u6536\uff0c\u7528\u4e8e\u5806\u8f6c\u6362\u4ee5\u53ca\u9f50\u6027\u7a7a\u95f4\u538b\u7f29\uff08\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002 \n\n\nObjects_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002\n\n\nSize_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002\n\n\nLarge_objects_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002\n\n\nLarge_object_size_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002\n\n\nHeap_stats\n\n\n\u7a7a\u95f2\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002\n\n\nPause_time(s)\n\n\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6682\u505c\u65f6\u95f4\u4e0e\u5783\u573e\u56de\u6536\u8fd0\u884c\u65f6\u4fee\u6539\u7684\u5bf9\u8c61\u5f15\u7528\u6570\u91cf\u6210\u6b63\u6bd4\u3002\u5f53\u524d\uff0cART CMS \u5783\u573e\u56de\u6536\u4ec5\u5728\u5783\u573e\u56de\u6536\u5373\u5c06\u5b8c\u6210\u65f6\u6682\u505c\u4e00\u6b21\u3002\u79fb\u52a8\u7684\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8f83\u957f\uff0c\u4f1a\u5728\u5927\u90e8\u5206\u5783\u573e\u56de\u6536\u671f\u95f4\u6301\u7eed\u51fa\u73b0\u3002\n\n\nandroid\u81ea\u5e26\u5de5\u5177\n\n\ndumpsys meminfo \n\n\nhttps://developer.android.com/studio/profile/investigate-ram.html\nhttp://gityuan.com/2016/01/02/memory-analysis-command/\n\n\n\u573a\u666f: \u67e5\u770bdalvik\u7b49\u533a\u57df\u5185\u5b58\u60c5\u51b5.\n\n\nroot@zx1800:/data # dumpsys meminfo\nApplications Memory Usage (kB):                                           --- \u4ee5\u4e0b\u5185\u5b58\u5355\u4f4d\nUptime: 618252294 Realtime: 618252294                                     --- Realtime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u5305\u542b\u4f11\u7720, \u51c6\u786e\u6027\u4f9d\u8d56\u9a71\u52a8\u5b9e\u73b0. \u5728\u9a71\u52a8\u65e0\u5b9e\u73b0\u65f6, \u4f7f\u7528Uptime.\n                                                                          --- Uptime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u4e0d\u5305\u542b\u4f11\u7720.\n\nTotal PSS by process:                                                     --- \u6240\u6709\u8fdb\u7a0b PSS \u5360\u7528\u6392\u5e8f\n    24712 kB: system (pid 445)\n    19600 kB: com.china_liantong.upgrade (pid 2660)\n    17500 kB: com.china_liantong.video (pid 3002 / activities)\n    11100 kB: com.china_liantong.oam (pid 999)\n    10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n     8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n     8394 kB: com.china_liantong.ocnadservice (pid 942)\n     7622 kB: com.android.systemui (pid 677)\n     6708 kB: dhcpcd (pid 639)\n     6541 kB: com.china_liantong.epg (pid 1235)\n     6286 kB: android.process.media (pid 2041)\n     5691 kB: com.china_liantong.airsharingservice (pid 2063)\n     4466 kB: dvbserver (pid 211)\n     4041 kB: mediaserver (pid 196)\n     3890 kB: com.china_liantong.xmppservice (pid 887)\n     3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n     3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     2466 kB: surfaceflinger (pid 183)\n     2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n     1955 kB: logd (pid 178)\n     1943 kB: com.china_liantong.tvframe (pid 1066)\n     1847 kB: com.china_liantong.playback (pid 923)\n     1640 kB: zygote (pid 220)\n      615 kB: sdcard (pid 1698)\n      473 kB: netd (pid 191)\n      415 kB: sysinfod (pid 184)\n      392 kB: vold (pid 182)\n      364 kB: developed (pid 222)\n      356 kB: adbd (pid 224)\n      350 kB: sh (pid 12684)\n      285 kB: /init (pid 1)\n      279 kB: dvbresourceserver (pid 210)\n      261 kB: sdcard (pid 223)\n      258 kB: avsettingd (pid 215)\n      240 kB: sh (pid 1325)\n      164 kB: ueventd (pid 159)\n      135 kB: keystore (pid 201)\n       82 kB: servicemanager (pid 181)\n       81 kB: installd (pid 199)\n       76 kB: healthd (pid 179)\n       62 kB: lmkd (pid 180)\n       26 kB: drmserver (pid 195)\n       26 kB: systemtaskd (pid 202)\n       22 kB: frontpaneld (pid 207)\n       15 kB: common_time (pid 189)\n       15 kB: frontpadserver (pid 216)\n       15 kB: dcaseventsvr (pid 219)\n        9 kB: sh (pid 190)\n        9 kB: debuggerd (pid 192)\n\nTotal PSS by OOM adjustment:                                              --- \u4ee5OOM\u7c7b\u522b\u5212\u5206(TODO: \u6bcf\u4e2a\u7c7b\u522b\u4f9d\u636e\u548c\u542b\u4e49)\n    26301 kB: Native\n                6708 kB: dhcpcd (pid 639)\n                4466 kB: dvbserver (pid 211)\n                4041 kB: mediaserver (pid 196)\n                2466 kB: surfaceflinger (pid 183)\n                1955 kB: logd (pid 178)\n                1640 kB: zygote (pid 220)\n                 615 kB: sdcard (pid 1698)\n                 473 kB: netd (pid 191)\n                 415 kB: sysinfod (pid 184)\n                 392 kB: vold (pid 182)\n                 364 kB: developed (pid 222)\n                 356 kB: adbd (pid 224)\n                 350 kB: sh (pid 12684)\n                 285 kB: /init (pid 1)\n                 279 kB: dvbresourceserver (pid 210)\n                 261 kB: sdcard (pid 223)\n                 258 kB: avsettingd (pid 215)\n                 240 kB: sh (pid 1325)\n                 164 kB: ueventd (pid 159)\n                 135 kB: keystore (pid 201)\n                  82 kB: servicemanager (pid 181)\n                  81 kB: installd (pid 199)\n                  76 kB: healthd (pid 179)\n                  62 kB: lmkd (pid 180)\n                  26 kB: drmserver (pid 195)\n                  26 kB: systemtaskd (pid 202)\n                  22 kB: frontpaneld (pid 207)\n                  15 kB: common_time (pid 189)\n                  15 kB: frontpadserver (pid 216)\n                  15 kB: dcaseventsvr (pid 219)\n                   9 kB: sh (pid 190)\n                   9 kB: debuggerd (pid 192)\n    24712 kB: System\n               24712 kB: system (pid 445)\n    48956 kB: Persistent\n               11100 kB: com.china_liantong.oam (pid 999)\n               10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n                8394 kB: com.china_liantong.ocnadservice (pid 942)\n                7622 kB: com.android.systemui (pid 677)\n                3890 kB: com.china_liantong.xmppservice (pid 887)\n                3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n                2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n                1847 kB: com.china_liantong.playback (pid 923)\n    27280 kB: Foreground\n               17500 kB: com.china_liantong.video (pid 3002 / activities)\n                6541 kB: com.china_liantong.epg (pid 1235)\n                3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     1943 kB: Visible\n                1943 kB: com.china_liantong.tvframe (pid 1066)\n     2214 kB: Perceptible\n                2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     6286 kB: Home\n                6286 kB: android.process.media (pid 2041)\n    34024 kB: B Services  (\u6ce8\u91ca: \u8001\u65e7\u7684, \u4e0d\u592a\u53ef\u80fd\u88ab\u4f7f\u7528\u5230\u7684\u670d\u52a1\u8fdb\u7a0b)\n               19600 kB: com.china_liantong.upgrade (pid 2660)\n                8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n                5691 kB: com.china_liantong.airsharingservice (pid 2063)\n\nTotal PSS by category:                                               --- \u4ee5 category \u5212\u5206\n    49530 kB: Native\n    35318 kB: Dalvik\n    26569 kB: .so mmap\n    17158 kB: .oat mmap\n    16357 kB: .art mmap\n     8144 kB: .dex mmap\n     6671 kB: Stack\n     2822 kB: Dalvik Other\n     2635 kB: Other mmap\n     2160 kB: .ttf mmap\n     1892 kB: Other dev\n     1581 kB: Unknown\n      843 kB: .apk mmap\n       36 kB: EGL mtrack\n        0 kB: Cursor\n        0 kB: Ashmem\n        0 kB: Gfx dev\n        0 kB: .jar mmap\n        0 kB: GL mtrack\n        0 kB: Other mtrack\n\nTotal RAM: 443652 kB (status critical)\n Free RAM: 137634 kB (40310 cached pss + 9492 cached kernel + 87832 free)\n Used RAM: 168782 kB (131406 used pss + 37376 kernel)\n Lost RAM: 137236 kB\n     ZRAM: 10684 kB physical used for 32252 kB in swap (196604 kB total swap)\n           \u538b\u7f29\u540e\u5185\u5b58\u5360\u7528             \u88ab\u538b\u7f29\u5185\u5b58\n      KSM: 39500 kB saved from shared 5844 kB\n           85420 kB unshared; 99276 kB volatile\n   Tuning: 96 (large 96), oom 10240 kB, restore limit 3413 kB (low-ram)\n\n\n\n\n\nprocrank \n\n\n\u573a\u666f: \u67e5\u770b\u5404\u4e2a\u8fdb\u7a0b\u7684PSS/USS \u5e76\u6bd4\u8f83\n\n\nshell@zx1800:/ # procrank\n  PID       Vss      Rss      Pss      Uss  cmdline\n  884   589628K   89320K   30444K   23128K  com.china_liantong.launcher\n  447   617060K   74620K   25695K   20904K  system_server\n 1139   572780K   61160K   14848K   10160K  com.china_liantong.browserreceiver\n  209   125160K   25312K   13834K   12696K  /system/bin/dvbserver\n 1180   549556K   65992K   12433K    6192K  com.china_liantong.upgrade\n  807   554556K   48092K    9636K    7160K  com.china_liantong.ocnadservice\n  222   516596K   54256K    8960K    3152K  zygote\n  864   547692K   47220K    8431K    6024K  com.china_liantong.oam\n  827   552092K   46208K    8180K    5840K  com.china_liantong.channelmanagerservice\n  223    71580K   18580K    7156K    3928K  /system/bin/developed\n  955   529948K   44620K    6591K    4000K  com.china_liantong.epg\n  534   525112K   41324K    6233K    3816K  com.android.systemui\n  516   523764K   39424K    5949K    3884K  android.process.media\n  183    55092K   17936K    5935K    4284K  /system/bin/surfaceflinger\n 1066   525392K   41296K    5140K    2712K  com.china_liantong.live.service.LiveService\n  771   529900K   40224K    4864K    2888K  com.china_liantong.tvmediaplayerservice\n  753   525476K   37228K    4681K    2804K  com.china_liantong.xmppservice\n  201    53500K   12232K    4421K    3460K  /system/bin/mediaserver\n 1206   521008K   36324K    4288K    2580K  com.china_liantong.mytv\n  979   527892K   36256K    4201K    2080K  com.china_liantong.launcher:SettingContentProvider\n 1095   526240K   36480K    4145K    2368K  com.china_liantong.airsharingservice\n  601   518952K   37128K    3898K    1984K  com.china_liantong.inputmethod.pinyin\n  789   526912K   32468K    3309K    1832K  com.china_liantong.playback\n 1048   520468K   32616K    2799K     968K  com.china_liantong.live\n  846   525972K   32620K    2787K    1336K  com.china_liantong.dtvsyskeyservice\n 1252   519376K   31716K    2687K    1260K  com.china_liantong.video\n  907   524920K   32120K    2676K    1236K  com.china_liantong.tvframe\n  511    19896K    5168K    2350K    1208K  /system/bin/dhcpcd\n  210    25496K    6480K    1662K    1316K  /system/bin/avsettingd\n  178    18252K    2596K    1509K    1476K  /system/bin/logd\n  199    23564K    4880K    1273K    1004K  /system/bin/drmserver\n  217    18936K    2864K     826K     740K  /system/bin/frontpadserver\n  182    19568K    3176K     816K     636K  /system/bin/vold\n  205    12508K    2804K     718K     572K  /system/bin/keystore\n  184    16580K    2580K     681K     536K  /system/bin/sysinfod\n  197    21796K    1672K     538K     480K  /system/bin/netd\n 2135     9192K    1100K     532K     520K  procrank\n  189    17484K    1748K     481K     420K  /system/bin/common_time\n  208    17492K    1792K     479K     436K  /system/bin/dvbresourceserver\n  220    16400K    1672K     434K     388K  /system/bin/dcaseventsvr\n  225    16980K     508K     416K     416K  /sbin/adbd\n  224    15412K    1048K     356K     336K  /system/bin/sdcard\n 1434     9324K    1020K     338K     244K  sh\n  186    14820K     428K     336K     332K  /sbin/watchdog\n    1     8860K     396K     327K     316K  /init\n 1428     9324K    1008K     326K     232K  /system/bin/sh\n  206    14460K    1036K     310K     288K  /system/bin/systemtaskd\n  203     9412K    1012K     272K     248K  /system/bin/installd\n  207    14456K     992K     266K     244K  /system/bin/frontpaneld\n  179     9828K     316K     260K     256K  /sbin/healthd\n  180    10624K    1664K     184K     116K  /system/bin/lmkd\n  181     9460K     792K      98K      76K  /system/bin/servicemanager\n  198    10056K    1108K      64K      28K  /system/bin/debuggerd\n  160     8852K      56K      11K       4K  /sbin/ueventd\n                           ------   ------  ------\n                          230106K  155544K  TOTAL\n\nRAM: 443652K total, 38684K free, 0K buffers, 98768K cached, 1384K shmem, 21560K slab\n\n\n\n\n\ncat /proc/meminfo \n\n\n\u573a\u666f: \u7cfb\u7edf\u5185\u5b58\u8be6\u7ec6\u4fe1\u606f\n\n\nshell@zx1800:/ # cat /proc/meminfo                                             \nMemTotal:         443652 kB                      --- \u7cfb\u7edf\u53ef\u89c1\u7684\u603b\u7269\u7406\u5185\u5b58\nMemFree:           38584 kB                      --- \u7cfb\u7edf\u4e2d\u672a\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\nMemAvailable:     125556 kB                      --- \u53ef\u7528\u5185\u5b58 = MemFree + Cached + Buffers\nBuffers:               0 kB                      --- \u7528\u4e8e\u6587\u4ef6\u7f13\u51b2\u7684\u5185\u5b58\u5927\u5c0f\nCached:            98768 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\nSwapCached:          128 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684swap\u5927\u5c0f\nActive:           143160 kB                      --- \u6d3b\u8dc3\u4f7f\u7528\u4e2d\u7684\u5185\u5b58, \u4e00\u822c\u4e0d\u4f1a\u56de\u6536. = anon + file\nInactive:          87104 kB                      --- \u6700\u8fd1\u672a\u88ab\u4f7f\u7528\u7684\u5185\u5b58, \u53ef\u4ee5\u88ab\u56de\u6536. = anon + file\nActive(anon):      94348 kB\nInactive(anon):    38532 kB\nActive(file):      48812 kB\nInactive(file):    48572 kB\nUnevictable:           0 kB                      \nMlocked:               0 kB\nHighTotal:             0 kB                      \nHighFree:              0 kB\nLowTotal:         443652 kB\nLowFree:           38584 kB\nSwapTotal:        196604 kB                      --- swap\u5206\u533a\u5927\u5c0f\nSwapFree:         193784 kB                      --- swap\u5206\u533a\u5269\u4f59\u7a7a\u95f4\nDirty:                 0 kB                      \nWriteback:             0 kB\nAnonPages:        131492 kB                      --- \u533f\u540d\u9875\nMapped:            90688 kB                      --- map\u7684\u5185\u5b58\nShmem:              1384 kB                      --- \u5171\u4eab\u5185\u5b58, \u8ddf\u6587\u4ef6\u65e0\u5173\u7684\nSlab:              21604 kB                      --- kernel slab\u5206\u914d\u5668\nSReclaimable:       5464 kB\nSUnreclaim:        16140 kB\nKernelStack:        5424 kB                      --- \u5185\u6838\u6808\nPageTables:         7932 kB                      --- \u7ba1\u7406\u9875\u7684\u6570\u636e\u7ed3\u6784\u5927\u5c0f\nNFS_Unstable:          0 kB\nBounce:                0 kB\nWritebackTmp:          0 kB\nCommitLimit:      418428 kB\nCommitted_AS:    8764944 kB\nVmallocTotal:     565248 kB\nVmallocUsed:       55952 kB\nVmallocChunk:     472068 kB\n\n\n\n\n\nvmstat \n\n\n\u573a\u666f: \u76d1\u63a7\u7cfb\u7edf\u72b6\u6001.\n\n\n\u8be5\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f, \u8fdb\u7a0b\u961f\u5217, \u7cfb\u7edf\u5207\u6362, CPU\u65f6\u95f4\u5360\u6bd4\u7b49\u4fe1\u606f, \u5468\u671f\u6027\u52a8\u6001\u8f93\u51fa.\n\n\nprocs  memory                       system          cpu              \n r  b    free mapped   anon   slab    in   cs  flt  us ni sy id wa ir\n \n0\n  \n0\n   \n38628\n  \n90844\n \n131992\n  \n21688\n  \n5268\n \n10257\n    \n0\n   \n5\n  \n0\n  \n6\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132008\n  \n21688\n  \n5271\n \n10367\n    \n0\n   \n8\n  \n0\n  \n9\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132048\n  \n21688\n  \n5150\n \n10497\n    \n0\n  \n10\n  \n1\n  \n8\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132100\n  \n21688\n  \n5112\n \n10180\n    \n0\n   \n8\n  \n0\n  \n3\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132120\n  \n21688\n  \n5221\n \n10289\n    \n0\n   \n8\n  \n0\n  \n4\n \n99\n  \n0\n  \n0\n\n\n\n\n\n\n\u603b\u517115\u5217\u53c2\u6570, \u4e2a\u53c2\u6570\u542b\u4e49\u5982\u4e0b:\n\n\n\n\nprocs(\u8fdb\u7a0b)\n\n\nr: Running\u961f\u5217\u4e2d\u8fdb\u7a0b\u6570, \u8fd9\u4e2a\u503c\u8d85\u8fc7cpu\u4e2a\u6570\u5c31\u4f1a\u51fa\u73b0cpu\u74f6\u9888.\n\n\nb: IO wait \u7684\u8fdb\u7a0b\u6570, \u8be5\u503c\u8fc7\u5927, \u53ef\u80fd\u662f\u7b49\u5f85\u6587\u4ef6\u64cd\u4f5c\u7684\u8fdb\u7a0b\u591a\u6216\u8005\u6587\u4ef6\u8bfb\u5199\u6162.\n\n\n\n\n\n\nmemory(\u5185\u5b58)\n\n\nfree: \u53ef\u7528\u5185\u5b58\u5927\u5c0f\n\n\nmapped: mmap\u6620\u5c04\u7684\u5185\u5b58\u5927\u5c0f\n\n\nanon: \u533f\u540d\u5185\u5b58\u5927\u5c0f, \u4e00\u822c\u7531malloc\u5f15\u8d77, \u6216\u8005\u533f\u540dmmap.\n\n\nslab: slab\u7684\u5185\u5b58\u5927\u5c0f.\n\n\n\n\n\n\nsystem(\u7cfb\u7edf)\n\n\nin: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u7684\u4e2d\u65ad\u6b21\u6570(\u5305\u62ec\u65f6\u949f\u4e2d\u65ad), \u8fd9\u4e2a\u503c\u8d8a\u5927, \u5185\u6838\u6d88\u8017\u7684cpu\u65f6\u95f4\u8d8a\u591a.\u9700\u8981\u67e5\u770b\n/proc/interrupts\n\u4e0b\u4e2d\u65ad\u589e\u957f\u60c5\u51b5.\n\n\ncs: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570\n\n\nflt: major page faults. \u9700\u8981\u4ecedisk\u8bfb\u53d6\u6570\u636e\u7684\u7f3a\u9875\u9519\u8bef.\n\n\n\n\n\n\nCPU (\u5904\u7406\u5668)\n\n\nus: user time, \u6bd4\u8f83\u9ad8\u65f6\uff0c\u8bf4\u660e\u7528\u6237\u8fdb\u7a0b\u6d88\u8017\u7684cpu\u65f6\u95f4\u591a.\n\n\nni: nice time, \u88ab\u964d\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u5728\u7528\u6237\u6a21\u5f0f\u4e0b\u7684\u6267\u884cCPU\u65f6\u95f4\u767e\u5206\u6bd4.\n\n\nsy: system time, \u7cfb\u7edf\u5185\u6838\u6d88\u8017\u7684CPU\u767e\u5206\u6bd4\n\n\nid: idle time, \u7cfb\u7edf\u7a7a\u95f2\u65f6\u95f4\u767e\u5206\u6bd4\n\n\nwa: iowait time, CPU\u5728\u7b49\u5f85IO\u5b8c\u6210\u65f6\u95f4\u5360\u6bd4\n\n\nir: interrupt time, \u7cfb\u7edf\u4e2d\u65ad\u8017\u65f6\u5360CPU\u767e\u5206\u6bd4\n\n\n\n\n\n\n\n\n\u66f4\u591a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f, \u8bf7\u76f4\u63a5\u67e5\u770b \n/proc/vmstat\n\nhttp://blog.csdn.net/macky0668/article/details/6839498\n\n\nlibrank \n\n\n\u573a\u666f: \u4e0eprocrank\u4e92\u8865\u4f7f\u7528, \u662fprocmem\u7684\u6269\u5c55. \u663e\u793a\u6240\u6709\u8fdb\u7a0b\u7684\u4fe1\u606f, \u9700\u8981\u5de5\u5177\u7edf\u8ba1\u5206\u7c7b. \u4e5f\u53ef\u4ee5\u7528\u6765\u67e5\u770b\u6bcf\u4e2a\u5e93\u6216\u5171\u4eab\u6587\u4ef6\u771f\u5b9e\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f.\n\n\n\u6570\u636e\u6765\u6e90\u4e0eprocmem\u4e00\u6837, \u4f46\u662fprocmem\u9488\u5bf9\u7684\u662f\u5355\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u800clibrank\u662f\u663e\u793a\u67d0\u4e2a\u5e93\u6216\u8005\u6587\u4ef6\u88ab\u54ea\u4e9b\u8fdb\u7a0b\u5171\u4eab, \u5e76\u663e\u793a\u5360\u7528\u5927\u5c0f. \u5982\u4e0b\u56fe\u6240\u793a.\n\n\n\n\n\n\n\n\ndumpcache \n\n\n\u8be5\u5de5\u5177\u662fandroid7.0\u4e4b\u540e\u624d\u6709\u7684\u5de5\u5177,\u7528\u4e8e\u67e5\u770b\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u6bcf\u4e2a\u6587\u4ef6\u88abcache\u5230\u5185\u5b58\u7684\u5927\u5c0f. \u8be5\u6587\u4ef6\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u7f3a\u9875\u9519\u8bef\u65f6\u52a0\u8f7d\u7684\u6587\u4ef6.\n\n\n\u5728Launcher\u754c\u9762\u65f6\u7684\u8f93\u51fa\u5982\u4e0b:\n\n\n\n\n\u7a33\u5b9a\u64ad\u653e1080P\u89c6\u9891\u65f6:\n\n\n\n\u6309\u4e0b\u9065\u63a7\u5668\u786e\u5b9a\u952e\u663e\u793aUI\u65f6:\n\n\n\n\u5bf9\u6bd4, \u53ef\u4ee5\u77e5\u9053\u5728\u64ad\u653e\u8fc7\u7a0b\u4e2d, \u663e\u793aUI\u65f6\u4e3b\u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u662f:\n\n\n\nbugreport \u4fe1\u606f\u5206\u6790 \n\n\nAndroid\u7cfb\u7edf\u60f3\u8981\u6210\u4e3a\u4e00\u4e2a\u529f\u80fd\u5b8c\u5907\uff0c\u751f\u6001\u7e41\u8363\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u90a3\u5c31\u5fc5\u987b\u63d0\u4f9b\u5b8c\u6574\u7684\u5e94\u7528\u5f00\u53d1\u73af\u5883\u3002\u800c\u5728\u5e94\u7528\u5f00\u53d1\u4e2d\uff0capp\u7a0b\u5e8f\u7684\u8c03\u8bd5\u5206\u6790\u662f\u65e5\u5e38\u751f\u4ea7\u4e2d\u8fdb\u7a0b\u4f1a\u8fdb\u884c\u7684\u5de5\u4f5c\u3002Android\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u5206\u6790\u6574\u4e2a\u7cfb\u7edf\u5e73\u53f0\u548c\u67d0\u4e2aapp\u5728\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u5185\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e13\u95e8\u5f00\u53d1\u4e86bugreport\u5de5\u5177\u3002\n\n\n\n\u8be5\u5de5\u5177\u7684\u7f3a\u70b9\u662f: \n1. \u8017\u65f6\u8fc7\u957f, \u53ea\u80fd\u6293\u53d6\u5f53\u524d\u72b6\u6001.\n2. \u6293\u53d6\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u5bfc\u81f4\u7cfb\u7edf\u5f02\u5e38, \u56e0\u4e3a\u5176oom\u4f1a\u88ab\u8c03\u9ad8, \u5728\u5185\u5b58\u4e0d\u8db3\u65f6\u5bfc\u81f4\u7cfb\u7edf\u5176\u4ed6\u5e94\u7528\u88abkill.\n3. \u7531\u4e8ebugreport\u7684\u6743\u9650\u4f1a\u964d\u4f4e\u5230shell, \u800c\u5f88\u591a\u670d\u52a1\u5728\u4f1a\u62d2\u7edddumpsys\u7684\u64cd\u4f5c, \u5bfc\u81f4\u90e8\u5206\u4fe1\u606f\u65e0\u6cd5\u6293\u53d6. \n\n\n\n\n\u4f7f\u7528\u65b9\u6cd5:\n\n\n\n\n\n\n\u901a\u8fc7bugreport\u547d\u4ee4\u6293\u53d6\u4e00\u4efdbugreport\u539f\u59cb\u7684\u6587\u672clog\uff1a\n    \nshell# bugreport\ngt;/data/local/tmp/bugreport.txt\n\n\n\n\n\n\n\u5c06\u4e0a\u9762\u547d\u4ee4\u6293\u53d6\u7684bugreport.txt\u6587\u672c\u6587\u4ef6\u62f7\u8d1d\u51fa\u6765\uff0c\u4e0a\u4f20\u5230bugreport\u5206\u6790\u670d\u52a1\u5668\u4e0a\u9762\uff0c\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u5f53\u524d\u72b6\u6001\u5feb\u7167\uff0c\u4e0a\u4f20\u65b9\u6cd5\u5982\u4e0b\uff1a\n  a. \u901a\u8fc7\u6d4f\u89c8\u5668\u8fdb\u5165\u670d\u52a1\u5668\u5730\u5740\uff1ahttp://10.27.254.108:8080/,\u5982\u4e0b\u56fe\uff1a\n  \n\n\n\n\n\n\nb. \u70b9\u51fbbroswer\u6d4f\u89c8report.txt\u6587\u672c\u6587\u4ef6\uff0c\u7136\u540e\u70b9\u51fbupload\u6309\u94ae\u4e0a\u4f20\u6587\u4ef6\uff0c\u4e0a\u4f20\u540e\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u72b6\u6001\u5feb\u7167\uff0c\u5feb\u7167\u540d\u79f0\u5bf9\u5e94\u5230\u4e0a\u4f20\u65f6\u95f4\uff0c\u70b9\u51fb\u5feb\u7167\u540d\u79f0\u8fdb\u5165\u7cfb\u7edf\u5206\u6790\u9875\u9762\uff0c\u5982\u4e0b\uff1a\n  \n\n\n\u8be5\u7f51\u9875\u670d\u52a1\u5668\u7684dockerfile\u5982\u4e0b:\n\n\nFROM ubuntu:14.04\n MAINTAINER wertherzhang \nwerther0331@gmail.com\n\n\n RUN apt-get update\n\n RUN apt-get -y install openjdk-7-jdk openjdk-7-jre\n RUN apt-get -y install python\n\n RUN mkdir -p /root/chkbugreport\n RUN apt-get -y install wget\n RUN wget http://10.27.8.54/chkbugreport.tgz -O /root/chkbugreport.tgz\n RUN tar xvf /root/chkbugreport.tgz -C /tmp/\n RUN mkdir -p /root/bin\n\n ADD server.py /root/chkbugreport/\n ADD chkbugreport.jar /root/bin/\n ADD chkbugreport /usr/local/bin/\n ADD ddmlib.jar /root/bin/\n\n RUN apt-get clean\n\n ENV JAVA_HOME /usr/lib/jvm/java-7-openjdk-amd64\n ENV PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n WORKDIR /root/chkbugreport/\n\n CMD [\npython\n, \nserver.py\n]\n\n\n\n\n\n\u9644\u4ef6: \nchkbugreport-server.zip\n\n\n\u5e94\u7528\u5185\u5b58\u5206\u6790\n\n\nandroid\u81ea\u5e26\u5de5\u5177\n\n\ndumpsys meminfo \u5e94\u7528\u5185\u5b58 \n\n\n\u573a\u666f: \u67e5\u770bjava\u8fdb\u7a0b\u7684\u4e0d\u540c\u7c7b\u522b\u5185\u5b58\u5360\u7528\u60c5\u51b5, \u7279\u522b\u662f\u786e\u5b9aactivity\u662f\u5426\u6cc4\u9732\u7b49\u4fe1\u606f.\n\n\n\u547d\u4ee4 \ndumpsys meminfo com.china_liantong.launcher -d\n\n\n\u8f93\u51fa:\n\n\nshell@zx1800:/ \n# dumpsys meminfo com.china_liantong.launcher -d                \n\nApplications Memory Usage \n(\nkB\n)\n:\nUptime: \n2612261\n Realtime: \n2612261\n\n\n** MEMINFO in pid \n884\n \n[\ncom.china_liantong.launcher\n]\n **\n                   Pss  Private  Private  Swapped     Heap     Heap     Heap\n                 Total    Dirty    Clean    Dirty     Size    Alloc     Free\n                ------   ------   ------   ------   ------   ------   ------\n  Native Heap     \n5915\n     \n5440\n        \n0\n        \n0\n    \n24576\n    \n16208\n     \n8367\n\n  Dalvik Heap    \n13764\n    \n13364\n        \n0\n        \n0\n    \n26989\n    \n20896\n     \n6093\n\n Dalvik Other      \n248\n      \n248\n        \n0\n        \n0\n                           \n        Stack      \n513\n      \n512\n        \n0\n        \n0\n                           \n    Other dev        \n4\n        \n0\n        \n4\n        \n0\n                           \n     .so mmap     \n3392\n      \n424\n      \n472\n        \n0\n                           \n    .apk mmap       \n94\n        \n0\n        \n4\n        \n0\n                           \n    .ttf mmap     \n1573\n        \n0\n      \n568\n        \n0\n                           \n    .dex mmap     \n1188\n        \n0\n      \n752\n        \n0\n                           \n    .oat mmap     \n1419\n        \n0\n      \n260\n        \n0\n                           \n    .art mmap      \n979\n      \n616\n        \n0\n        \n0\n                           \n   Other mmap       \n80\n        \n4\n        \n0\n        \n0\n                           \n   EGL mtrack       \n17\n       \n17\n        \n0\n        \n0\n                           \n      Unknown      \n134\n      \n128\n        \n0\n        \n0\n                           \n        TOTAL    \n29320\n    \n20753\n     \n2060\n        \n0\n    \n51565\n    \n37104\n    \n14460\n\n\n Objects\n               Views:     \n1192\n         ViewRootImpl:        \n1\n\n         AppContexts:        \n3\n           Activities:        \n1\n\n              Assets:        \n2\n        AssetManagers:        \n2\n\n       Local Binders:       \n41\n        Proxy Binders:      \n220\n\n       Parcel memory:        \n7\n         Parcel count:       \n14\n\n    Death Recipients:       \n10\n      OpenSSL Sockets:        \n0\n\n\n SQL\n         MEMORY_USED:        \n0\n\n  PAGECACHE_OVERFLOW:        \n0\n          MALLOC_SIZE:        \n0\n\n\n\n\n\n\nNative Heap\n: native\u5206\u914d\u5360\u7528\u7684RAM, \u901a\u8fc7malloc\u7533\u8bf7\u7684\u5185\u5b58. \nHeap Size\n \u662f\u5185\u5b58\u6c60\u603b\u5927\u5c0f(\u5411\u7cfb\u7edf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f). \nHeap Alloc\n \u5df2\u7ecf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f(\u5e94\u7528\u5411dlmalloc\u7533\u8bf7\u7684\u5185\u5b58). \nHeap Free\n \u5185\u5b58\u6c60\u5269\u4f59\u53ef\u5206\u914d\u5185\u5b58\u5927\u5c0f.\n\n\nDalvik Heap\n: \u5e94\u7528\u4e2dDalvi\u5206\u914d\u5360\u7528\u7684RAM. \nPss Total\n: \u5305\u542b\u6240\u6709Zygote\u5206\u914d(\u901a\u8fc7\u8fdb\u7a0b\u95f4\u5171\u4eab\u5360\u7528). \nPrivate Dirty\n: \u4ec5\u5206\u914d\u5230\u5e94\u7528\u7684\u5b9e\u9645RAM, \u7531\u5e94\u7528\u5206\u914d\u6216\u8005zygote\u5206\u914d\u9875, \u8fd9\u4e9b\u9875\u81ea\u4ecezygote fork\u5e94\u7528\u8fdb\u7a0b\u540e\u88ab\u4fee\u6539\u8fc7.\n\n\n.so map\n \u548c \n.dex map\n: mmap\u7684.so\u548c.dex(Dalvik\u6216ART)\u4ee3\u7801\u5360\u7528\u7684RAM. \nPss Total\n \u6570\u503c\u5305\u62ec\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\u7684\u5e73\u53f0\u4ee3\u7801\uff1b\nPrivate Clean\n \u662f\u60a8\u7684\u5e94\u7528\u81ea\u5df1\u7684\u4ee3\u7801\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u6620\u5c04\u7684\u5185\u5b58\u66f4\u5927 - \u6b64\u5904\u7684 RAM \u4ec5\u4e3a\u5e94\u7528\u6267\u884c\u7684\u4ee3\u7801\u5f53\u524d\u6240\u9700\u7684 RAM\u3002\u4e0d\u8fc7\uff0c.so mmap \u5177\u6709\u8f83\u5927\u7684\u79c1\u6709\u810f RAM\uff0c\u56e0\u4e3a\u5728\u52a0\u8f7d\u5230\u5176\u6700\u7ec8\u5730\u5740\u65f6\u5bf9\u539f\u751f\u4ee3\u7801\u8fdb\u884c\u4e86\u4fee\u6539(GOT?!)\u3002 \n\n\n.oat mmap\n: \u4ee3\u7801\u6620\u50cf\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6587\u4ef6\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002 \n\n\n.art mmap\n: \u5806\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6620\u50cf\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002\u5c3d\u7ba1 ART \u6620\u50cf\u5305\u542b Object \u5b9e\u4f8b\uff0c\u5b83\u4ecd\u7136\u4e0d\u4f1a\u8ba1\u5165\u60a8\u7684\u5806\u5927\u5c0f\u3002 \n\n\nUnknown\n: \u7cfb\u7edf\u65e0\u6cd5\u5c06\u5176\u5206\u7c7b\u5230\u5176\u4ed6\u66f4\u5177\u4f53\u7684\u4e00\u4e2a\u9879\u4e2d\u7684\u4efb\u4f55 RAM \u9875\u3002 \u5176 \nPss Total\n \u4e0e Zygote\u5171\u4eab.\n\n\nTOTAL\n: \u4e0a\u65b9\u6240\u6709 PSS \u5b57\u6bb5\u7684\u603b\u548c\u3002\u8868\u793a\u60a8\u7684\u8fdb\u7a0b\u5360\u7528\u7684\u5185\u5b58\u91cf\u5360\u6574\u4f53\u5185\u5b58\u7684\u6bd4. \nPrivate Dirty\n \u548c \nPrivate Clean\n \u662f\u60a8\u7684\u8fdb\u7a0b\u4e2d\u7684\u603b\u5206\u914d\uff0c\u672a\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u3002\u5b83\u4eec\uff08\u5c24\u5176\u662f Private Dirty\uff09\u7b49\u4e8e\u60a8\u7684\u8fdb\u7a0b\u88ab\u7834\u574f\u540e\u5c06\u91ca\u653e\u56de\u7cfb\u7edf\u4e2d\u7684 RAM \u91cf\u3002\nDirty\n\u56e0\u4e3a\u5df2\u88ab\u4fee\u6539\u800c\u5fc5\u987b\u4fdd\u6301\u5728 RAM \u4e2d\u7684 RAM \u9875\uff08\u56e0\u4e3a\u6ca1\u6709\u4ea4\u6362\uff09\uff1b\nClean\n \u662f\u5df2\u4ece\u67d0\u4e2a\u6301\u4e45\u6027\u6587\u4ef6\uff08\u4f8b\u5982\u6b63\u5728\u6267\u884c\u7684\u4ee3\u7801\uff09\u6620\u5c04\u7684 RAM \u9875\uff0c\u5982\u679c\u4e00\u6bb5\u65f6\u95f4\u4e0d\u7528\uff0c\u53ef\u4ee5\u79fb\u51fa\u5206\u9875\u3002\n\n\nViewRootImpl\n: \u8fdb\u7a0b\u4e2d\u5f53\u524d\u6d3b\u52a8\u7684\u6839\u89c6\u56fe\u6570\u91cf\u3002\u6bcf\u4e2a\u6839\u89c6\u56fe\u90fd\u4e0e\u4e00\u4e2a\u7a97\u53e3\u5173\u8054\uff0c\u56e0\u6b64\u6709\u52a9\u4e8e\u786e\u5b9a\u6d89\u53ca\u5bf9\u8bdd\u6846\u6216\u5176\u4ed6\u7a97\u53e3\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \n\n\nAppContexts\n \u548c \nActivities\n: \u5f53\u524d\u6d3b\u52a8\u7684\u5e94\u7528 Context \u548c Activity \u5bf9\u8c61\u6570\u91cf\u3002\u5feb\u901f\u786e\u5b9a\u7531\u4e8e\u5b58\u5728\u9759\u6001\u5f15\u7528\uff08\u6bd4\u8f83\u5e38\u89c1\uff09\u800c\u65e0\u6cd5\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u5df2\u6cc4\u6f0f Activity \u5bf9\u8c61\u3002\u8fd9\u4e9b\u5bf9\u8c61\u7ecf\u5e38\u62e5\u6709\u5f88\u591a\u5173\u8054\u7684\u5176\u4ed6\u5206\u914d\uff0c\u56e0\u6b64\u6210\u4e3a\u8ddf\u8e2a\u5927\u578b\u5185\u5b58\u6cc4\u6f0f\u7684\u4e00\u79cd\u4e0d\u9519\u7684\u65b9\u5f0f\u3002\n\n\n\u4f8b\u5b50\u89c1\u5185\u5b58\u6cc4\u9732\u90e8\u5206.\n\n\nprocmem  \n\n\n\u573a\u666f: \u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u5404\u90e8\u5206\u5185\u5b58\u5360\u7528\u60c5\u51b5.\n\u547d\u4ee4: \nprocmem \npid\n\n\u4f8b\u5b50: \nprocmem 2509\n\n\u6570\u636e\u6765\u6e90: \n/proc/\npid\n/maps\n \u548c \n/proc/\npid\n/pagemap\n\n\nVss      Rss      Pss      Uss     ShCl     ShDi     PrCl     PrDi  Name\n\n\n\n\n\u5404\u5b57\u6bb5\u542b\u4e49:\n\n\nShCl  --  shared clean\nShDi  --  shared dirty\nPrCl  --  private clean\nPrDi  --  private dirty\n\n\n\n\n\nshowmap \n\n\n\u573a\u666f: \u8fdb\u7a0b\u865a\u62df\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5185\u5b58\u5206\u914d\u60c5\u51b5 \u548c \u8be6\u7ec6\u7684\u5e72\u51c0\u810f\u6570\u636e\u4fe1\u606f.\n\n\n\u4ece \n/proc/[pid]/smaps\n \u83b7\u53d6\u6570\u636e\u5e76\u7edf\u8ba1\u7684\u5de5\u5177.\n\n\n\u547d\u4ee4: \nshowmap [-a] [-t] [-v] \npid\n\n\u4f8b\u5b50: \nshowmap -a 884\n\n\u8f93\u51fa\u5355\u4f4d: KB\n\n\n\n\n\u7531\u4e8e\u73b0\u5728\u5185\u6838\u90fd\u4f7f\u7528\u4e86\u52a8\u6001\u5185\u5b58\u5206\u914d\u7684\u673a\u5236, \u5728\u5927\u91cf\u7533\u8bf7\u5c0f\u5185\u5b58\u7684\u60c5\u51b5\u4e0b, \u4ece\u7cfb\u7edf\u770b\u5185\u5b58\u6709\u5269\u4f59, \u4f46\u662f\u8fdb\u7a0b\u5374\u65e0\u6cd5\u5206\u914d\u51fa\u9700\u8981\u7684\u5185\u5b58, \u8fd9\u5c31\u6709\u53ef\u80fd\u662f\u7531\u4e8e\u865a\u62df\u5730\u5740\u7684\u5185\u5b58\u788e\u7247\u5f15\u8d77, \u65e0\u6cd5\u627e\u5230\u4e00\u6bb5\u5927\u4e8e\u6240\u8bf7\u6c42\u5185\u5b58\u5927\u5c0f\u7684\u5730\u5740\u7a7a\u95f4. \n\n\n\u4f8b\u5b50:\n\n\nAndroid \u5e94\u7528 OOM\n\n\n\u89e6\u53d1OOM\u7684\u539f\u56e0\u662f, java\u5c42\u5185\u5b58\u5206\u914d\u5931\u8d25\u4e86.\n\n\n\u9020\u6210\u5185\u5b58\u5206\u914d\u5931\u8d25\u7684\u53ef\u80fd\u539f\u56e0\u5982\u4e0b:\n\n\n\n\n\u5185\u5b58\u6ea2\u51fa. \u7533\u8bf7\u7684\u5185\u5b58\u8d85\u51fa\u4e86\u865a\u62df\u673a\u6700\u5927\u5185\u5b58.\n\n\n\u788e\u7247, \u5bfc\u81f4\u65e0\u6cd5\u627e\u5230\u8fde\u7eed\u7a7a\u95f4\u6ee1\u8db3\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f.\n\n\n\u8d44\u6e90\u95ee\u9898, \u6bd4\u5982\u6587\u4ef6\u8282\u70b9\u8d85\u8fc7\u9650\u5236, \u5bfc\u81f4\u533f\u540d\u5185\u5b58\u7533\u8bf7\u51fa\u9519, \u9519\u8bef\u4fe1\u606f\u4e3a \"Too many open files\"\n\n\n\u865a\u62df\u7a7a\u95f4\u5730\u5740\u7a7a\u95f4\u88ab\u5360\u6ee1, \u5bfc\u81f4OOM.\n\n\n\n\n\u4ee5\u4e0a\u4e3a\u7f51\u4e0a\u7684\u7ed3\u8bba, \u5728android5.1.1\u4e0a\u6d4b\u8bd5\u53d1\u73b0:\n\n\nfd\u95ee\u9898\u5e76\u4e0d\u4f1a\u5bfc\u81f4OOM\n\n\n\u4ee3\u7801\u590d\u7528\u4e0b\u9762\u5185\u5b58\u6cc4\u9732\u7684\u4ee3\u7801,\u5728asynctask\u4e2d\u6267\u884c\u6587\u4ef6\u6253\u5f00\u64cd\u4f5c.\n\n\n\n\nlogcat\u4e2d\u8f93\u51fa\u5982\u4e0b, \u5e76\u6ca1\u6709OOM\u8f93\u51fa:\n\n\n\n\n\u4f46\u662f\u8fd9\u6bb5\u4ee3\u7801\u7684\u786e\u8bc1\u660e\u4e86\u6253\u5f00\u6587\u4ef6\u592a\u591a\u4f1a\u5bfc\u81f4shmem\u521b\u5efa\u5931\u8d25.\n\n\n\u5185\u5b58\u6cc4\u9732\u5206\u6790\n\n\nactivity \u6cc4\u9732 \n\n\nactivity \u7684\u6cc4\u9732\u57fa\u4e8eandroid\u81ea\u5e26\u5de5\u5177, \u53ef\u4ee5\u5feb\u901f\u786e\u5b9a, \u4f46\u662f\u5177\u4f53\u6cc4\u9732\u7684activity, \u9700\u8981\u4f9d\u8d56\u5de5\u5177 LeakCanary.\n\n\n\u4ee3\u7801:\n\n\n\n\u754c\u9762:\n\n\n\n\n\u5728\u7b2c\u4e00\u6b21\u8fdb\u5165\u8be5\u5e94\u7528\u65f6:\n\n\n\n\n\u6309\u4e0bBUTTON, \u7136\u540e\u9000\u51fa\u5e94\u7528:\n\n\n\n\n\u7b2c\u4e8c\u6b21\u8fdb\u5165\u8be5\u5e94\u7528:\n\n\n\n\n\u7b2c\u4e8c\u6b21\u6309\u4e0bBUTTON:\n\n\n\n\n\u7b2c\u4e8c\u6b21\u9000\u51fa\u5e94\u7528:\n\n\n\n\n\u57fa\u4e8e \ndumpsys meminfo\n \u786e\u8ba4\u5e94\u7528\u6709activity\u6cc4\u9732\u540e, \u5355\u7eaf\u901a\u8fc7UI\u64cd\u4f5c\u57fa\u672c\u4e5f\u53ef\u4ee5\u5224\u65ad\u51fa\u6765\u54ea\u4e2aactivity\u6cc4\u9732, \u66f4\u51c6\u786e\u7684\u6cc4\u9732\u68c0\u6d4b\u5de5\u5177\u662f LeakCanary, \u8be5\u5de5\u5177\u4e3a\u7b2c\u4e09\u65b9\u5de5\u5177. \n\n\u5177\u4f53\u7528\u6cd5: https://www.liaohuqiu.net/cn/posts/leak-canary-read-me/\n\n\n\u8fd8\u662f\u4ee5\u4e0a\u7684\u4f8b\u5b50, \u989d\u5916\u589e\u52a0\u5982\u4e0b\u4ee3\u7801. \n\n\n\u5728MainActivity\u589e\u52a0\u5982\u4e0b\u4ee3\u7801, \u8be5\u4ee3\u7801\u7684\u542b\u4e49\u662f, \u5728activity\u89e6\u53d1onDestroy\u65f6, \u76d1\u63a7\u8be5activity\u5bf9\u8c61.\n\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        LeakApplication.getRefWatcher().watch(this);\n\n    }\n\n\n\n\n\n\u589e\u52a0application, \u5982\u4e0b:\n\n\n\n\u7f16\u8bd1\u8fd0\u884c, \u6267\u884c\u4e0a\u9762\u540c\u6837\u7684\u64cd\u4f5c. \u5728\u901a\u77e5\u4e2d\u5fc3\u6709\u5982\u4e0b\u663e\u793a:\n\n\n\n\n\u70b9\u51fb\u540e\u53ef\u4ee5\u67e5\u770b\u8be6\u7ec6\u7684\u5806\u6808:\n\n\n\n\n\u540c\u6837\u5728logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:\n\n\n\n\nStrictMode\u68c0\u6d4b\u5e94\u7528\u5185\u5b58\u6cc4\u9732 \n\n\n\u540c\u6837\u662f\u4e0a\u9762\u7684\u4f8b\u5b50, \u4fee\u6539\u4ee3\u7801\u5982\u4e0b, \u589e\u52a0strickmode\u7684\u8c03\u7528:\n\n\n\n\n\u540c\u6837\u7684\u4e0a\u9762\u64cd\u4f5c\u65b9\u6cd5, logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:\n\n\n\n\n\u57fa\u4e8elibc\u8c03\u8bd5\u5185\u5b58\u6cc4\u9732 \n\n\n\u5185\u5b58\u6cc4\u9732\u7684\u68c0\u6d4b\u4f9d\u636e\u662f, \u8fdb\u7a0b\u9000\u51fa\u65f6, \u8fd8\u6709\u672a\u91ca\u653e\u7684\u5185\u5b58. \u6240\u4ee5, valgrind\u5305\u62ecbionic libc\u4e2d, \u80fd\u7cbe\u786e\u68c0\u6d4b\u5230\u6cc4\u9732\u7684\u524d\u63d0\u6761\u4ef6\u5c31\u662f\u8fdb\u7a0b\u9000\u51fa. \u4f46\u662f\u8fd9\u4e2a\u5bf9\u4e8e\u7cfb\u7edf\u7ea7\u522b\u7684\u8fdb\u7a0b\u662f\u65e0\u7528\u7684, \u56e0\u4e3a\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u5e76\u4e0d\u4f1a\u9000\u51fa. \u4eceRD\u89d2\u5ea6, \u5224\u65ad\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u662f\u5426\u6cc4\u9732\u7684\u4f9d\u636e\u662f\u5185\u5b58\u662f\u5426\u6301\u7eed\u589e\u957f, \u7279\u522b\u662f\u5728\u538b\u529b\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b. \u6240\u4ee5, \u8fd9\u4e2a\u90e8\u5206\u4ecb\u7ecd\u7684\u5de5\u5177, \u5b9e\u9645\u4e0a\u662f\u6293\u53d6\u4e86\u6301\u7eed\u589e\u957f\u7684\u5185\u5b58\u4fe1\u606f, \u8fd9\u4e9b\u4fe1\u606f, \u53ef\u80fd\u662f\u5185\u5b58\u6cc4\u9732, \u4e5f\u53ef\u80fd\u662f\u8fdb\u7a0b\u6b63\u5e38\u7533\u8bf7\u7684\u5185\u5b58, \u9700\u8981RD\u4ecb\u5165\u5224\u65ad.\n\n\n\u9644\u4ef6: \nMemleak_tools_android.zip\n\n\n\u4f9d\u8d56\u5de5\u5177:\n\n\n\n\nlibc_malloc_debug_leak.so\n , bionic\u6e90\u7801\u4e0b, \u9700\u8981\u7f16\u8bd1\u5e76push\u5230\u7cfb\u7edf\u4e2d\n\n\nlibmemleakutils.so\n, \u4eceandroid\u63d0\u53d6\u5e76\u66f4\u6539. \u4ece\u9644\u4ef6\u6e90\u7801\u4e0b\u8f7d\u7f16\u8bd1, \u9700\u8981push\u5230\u7cfb\u7edf\u4e2d.\n\n\naddr2func.py, \u8be5\u811a\u672c\u80fd\u81ea\u52a8\u5c06\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808. \u5728\u9644\u4ef6\u4e2d.\n\n\nmemincrease.py, \u8be5\u811a\u672c\u80fd\u5c06\u4e0a\u4e00\u811a\u672c\u7684\u8f93\u51fa, \u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f,  \u6309\u5185\u5b58\u589e\u52a0\u4ece\u5927\u5230\u5c0f\u6392\u5e8f. \u57fa\u672c\u6700\u9876\u4e0a\u7684\u662f\u5b58\u5728\u95ee\u9898\u7684. \u5728\u9644\u4ef6\u4e2d.\n\n\n\n\n\u5c40\u9650:\n\n\n\n\n\u53ea\u80fd\u8c03\u8bd5native\u8fdb\u7a0b.\n\n\n\u8fdb\u7a0b\u4e0d\u80fd\u91cd\u542f.\n\n\n\u9700\u8981\u538b\u529b\u6d4b\u8bd5, \u957f\u65f6\u95f4\u8fd0\u884c\n\n\n\u9700\u8981RD\u4ecb\u5165\u5224\u65ad\u662f\u5426\u5b58\u5728\u6cc4\u9732.\n\n\n\n\n\u7528\u6cd5:\n\n\n\n\n\u5c06libmemleakutils.so\u5e93\u94fe\u63a5\u5230\u88ab\u8c03\u8bd5\u7a0b\u5e8f\u4e2d, \u8c03\u7528\u51fd\u6570\nstart_memleak_watcher(memstep)\n, \u5176\u4e2dmemstep\u8868\u793a, pss\u6bcf\u589e\u52a0memstep, \u5219\u6293\u53d6\u4e00\u6b21\u5f53\u524d\u5185\u5b58\u5206\u914d\u4fe1\u606f.\n\n\n\u5c06libmemleakutils.so \u548c \nlibc_malloc_debug_leak.so\n push\u5230/system/lib/\u4e0b.\n\n\n\u5c06\u88ab\u8c03\u8bd5\u7a0b\u5e8fpush\u5230 /system/bin/ \u4e0b.\n\n\n\u8bbe\u7f6e property \nlibc.debug.malloc.program\n \u4e3a \u4f60\u7684\u8c03\u8bd5\u8fdb\u7a0b\u540d\u5b57.\n\n\n\u8bbe\u7f6e property \nlibc.debug.malloc\n \u4e3a 1\n\n\nstop \u6216\u8005 kill \u88ab\u8c03\u8bd5\u8fdb\u7a0b.\n\n\nstart \u6216\u8005 \u542f\u52a8 \u88ab\u8c03\u8bd5\u8fdb\u7a0b.\n\n\n\u538b\u529b\u6d4b\u8bd5\u540e, \u68c0\u67e5 /data/local/tmp/ \u5e95\u4e0b\u5b58\u5728\u6587\u4ef6 \nmem_snapshot_$pid_$memsize.log\n, \u4e14\u4e2a\u6570\u5927\u4e8e2\u4e2a(\u8d8a\u591a\u8d8a\u597d).\n\n\ncp /proc/${pid}/maps /data/local/tmp/\n\n\n\u5c06 /data/local/tmp/ \u5e95\u4e0b\u6240\u6709\u6587\u4ef6\u590d\u5236\u5230host\u673a\u5668.\n\n\n\u7528 diff \u547d\u4ee4\u6bd4\u8f83 \u4e24\u4e2a \nmem_snapshot_$pid_$memsize.log\n, \u5e76\u4fdd\u5b58\u8f93\u51fa\u4e3a \ndiff_$pid_$memsize1_$memsize2.log\n\n\n\u6267\u884c \n./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_$pid_$memsize1_$memsize2.log \n mem_stack_$pid_$memsize1_$memsize2.log\n, \u8be5\u8fc7\u7a0b\u662f\u5c06diff\u751f\u6210\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808\u4fe1\u606f.\n\n\n\u6267\u884c \n./memincrease.py mem_stack_$pi_$memsize1_$memsize2.log incr_$pid_$memsize1_$memsize2.log\n, \u8be5\u8fc7\u7a0b\u662f\u5bf912\u751f\u6210\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f, \u4ece\u5927\u5230\u5c0f\u6392\u5e8f.\n\n\n\n\n\u4f8b\u5b50:\n\n\n\n\n\u8fd0\u884c\u4e00\u4f1a\u513f\u540e, \u5728 /data/local/tmp/\u76ee\u5f55\u4e0b\u5b58\u5728\u6587\u4ef6:\n\n\nmem_snapshot_2158_1.log\nmem_snapshot_2158_2.log\nmem_snapshot_2158_3.log\nmem_snapshot_2158_4.log\n\n\n\n\n\n\u5176\u5185\u5bb9\u5982\u4e0b:\n\n\n Allocation count \n5\n\n Total memory \n6293072\n\nsize  \n5242880\n, dup    \n1\n, 0xb6ed36b2, 0xb6f4cd4e, 0xb6f1da44, 0xb6f1de38, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92\nsize  \n1048576\n, dup    \n1\n, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\nsize     \n1024\n, dup    \n1\n, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\nsize      \n580\n, dup    \n1\n, 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f510c8, 0xb6f1decc, 0xb6fc838c, 0xb6f4ce68, 0xb6fc8400\nsize       \n12\n, dup    \n1\n, 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f14c46, 0xb6f1dd98, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92\n\n\n\n\n\n\u6267\u884cdiff\u547d\u4ee4:\n\n\n# diff ./mem_snapshot_2158_1.log ./mem_snapshot_2158_2.log \n diff_2158_1_2.log\n\n\n# \n\n\n# diff ./mem_snapshot_2158_3.log ./mem_snapshot_2158_4.log \n diff_2158_3_4.log\n\n\n#\n\n\n\n\n\n\n\u5f97\u5230\u4e00\u4e2aPSS\u4ece1M\u589e\u957f\u52302M\u548c3M\u589e\u957f\u52304M\u7684\u4e24\u4e2adiff\u6587\u4ef6. \u5185\u5bb9\u5982\u4e0b:\n\n\n2c2\n\n  Total memory 6293072\n---\n\n  Total memory 7342672\n4,5c4,5\n\n size  1048576, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\n\n size     1024, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\n---\n\n size  1048576, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\n\n size     1024, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\n\n\n\n\n\n\n\u6267\u884c addr2func.py :\n\n\n# ./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_2158_3_4.log \n mem_stack_2158_3_4.log\n\n\n\n\n\n\n\u751f\u6210\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b:\n\n\n2c2                                                                                                                                                                              \n[\n0\n/59466\n]\n\n\n\n  Total memory \n8392272\n\n\n---\n\n\n  Total memory \n9441872\n\n\n\n4\n,5c4,5\n\n\n size  \n1048576\n, dup    \n3\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n size     \n1024\n, dup    \n3\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n---\n\n\n size  \n1048576\n, dup    \n4\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n size     \n1024\n, dup    \n4\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n\n\n\n\n\u6240\u6709\u7684\u5730\u5740\u88ab\u8f6c\u6362\u6210\u4e86\u961f\u957f.\n\n\n\u6700\u540e\u6267\u884c memincrease.py :\n\n\n./memincrease.py mem_stack_2158_3_4.log incr_2158_3_4.log\n\n\n\n\n\n\u751f\u6210\u7684\u6587\u4ef6 incr_2158_3_4.log \u5185\u5bb9\u5982\u4e0b:\n\n\nMemory increase \n1048576\n bytes                   \n### \u5185\u5b58\u589e\u52a0\u4e86 1048576 bytes\n\n98990365afa0d71d62949620cc7e3753f386e4e3\nold size \n1048576\n count \n3\n, total memory \n3145728\n       \n### \u4ece 3145728\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n98990365afa0d71d62949620cc7e3753f386e4e3\nnew size \n1048576\n count \n4\n, total memory \n4194304\n      \n### \u589e\u52a0\u5230 4194304\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\nMemory increase \n1024\n bytes\n833f23c991cc75facaa41fb74f7466b91c27917b\nold size \n1024\n count \n3\n, total memory \n3072\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n833f23c991cc75facaa41fb74f7466b91c27917b\nnew size \n1024\n count \n4\n, total memory \n4096\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n\n\n\n\n\u57fa\u672c\u4e0a, \u5c06\u6700\u9876\u4e0a\u7684\u51e0\u4e2a\u5806\u6808\u786e\u8ba4\u4e0b\u662f\u5426\u5185\u5b58\u6cc4\u9732\u5373\u53ef.\n\n\n\u7279\u522b\u6ce8\u610f:\n\n\n\n\n\u7c7b\u6cc4\u9732\u65f6, \u5728\u5806\u6808\u4e0a\u7684\u8868\u73b0\u662f\u5176\u6210\u5458\u5185\u5b58\u6cc4\u9732. \u9700\u8981\u67e5\u770b\u5806\u6808\u662f\u5426\u6709\u8be5\u7c7b\u5bf9\u8c61\u7684new\u65b9\u6cd5, \u5e76\u4e14\u8be5\u65b9\u6cd5\u662f\u5426\u5728\u591a\u5904\u5b58\u5728.\n\n\n\n\nvalgrind \u8c03\u8bd5\u5185\u5b58\u6cc4\u9732\n\n\n\u573a\u666f: \u5bf9\u4e8e\u53ef\u9000\u51fa\u7684\u8fdb\u7a0b\u8fdb\u884c\u8c03\u8bd5\u6bd4\u8f83\u5408\u9002, \u53ef\u4ee5\u5bf9\u5e94\u7528\u7684native\u4ee3\u7801\u8fdb\u884c\u8c03\u8bd5.\n\n\n\u76ee\u524dhdtv\u4ee3\u7801\u4e0a\u7684 valgrind \u65e0\u6cd5\u83b7\u53d6\u88ab\u8c03\u8bd5\u8fdb\u7a0b\u7684\u5806\u6808, \u53ea\u80fd\u83b7\u53d6\u5b83\u81ea\u5df1\u5e93\u7684\u5806\u6808, \u5b58\u5728\u95ee\u9898. \u6682\u65f6\u65e0\u6cd5\u4f7f\u7528.", 
            "title": "Android\u5185\u5b58\u8c03\u8bd5\u603b\u7ed3"
        }, 
        {
            "location": "/Android-memory-debug/#android", 
            "text": "", 
            "title": "Android\u5185\u5b58\u8c03\u8bd5\u5de5\u5177\u603b\u7ed3"
        }, 
        {
            "location": "/Android-memory-debug/#_1", 
            "text": "\u7cfb\u7edf\u5185\u5b58\u5206\u6790, \u6240\u6709\u8fdb\u7a0b\u5185\u5b58\u5206\u6790  \u57fa\u672c\u7684 logcat \u8f93\u51fa\u4e2d\u53ef\u80fd\u5305\u542b\u7684GC\u76f8\u5173\u4fe1\u606f, \u53ef\u4ee5\u4f5c\u4e3a\u7cfb\u7edf\u6216\u67d0\u4e9b\u5e94\u7528\u5185\u5b58\u72b6\u51b5\u7684\u53c2\u8003\u4f9d\u636e.  \u5728SystemServer\u542f\u52a8\u7684\u60c5\u51b5\u4e0b, \u8fd8\u53ef\u4ee5\u901a\u8fc7  dumpsys meminfo  \u4eceframework\u5c42\u89d2\u5ea6\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u7684\u72b6\u51b5, \u8be5\u90e8\u5206\u4fe1\u606f\u4e0e\u4ece\u7cfb\u7edf\u89d2\u5ea6\u83b7\u53d6\u7684\u4fe1\u606f\u5b58\u5728\u5dee\u5f02.  \u5bf9\u4e8e\u9700\u8981\u6392\u5e8f\u5e76\u67e5\u627e\u5185\u5b58\u5360\u7528\u6700\u591a\u7684\u8fdb\u7a0b, \u63a8\u8350\u4f7f\u7528\u547d\u4ee4  procrank  \u5728\u5b9e\u5728\u7f3a\u5c11\u5de5\u5177, \u6216\u8005RD\u77e5\u9053\u9700\u8981\u4ec0\u4e48\u4fe1\u606f\u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u67e5\u770b /proc/meminfo  \u5982\u679c\u9700\u8981\u8fde\u7eed\u76d1\u63a7\u7cfb\u7edf\u7684\u72b6\u6001(\u5185\u5b58/CPU\u7b49), \u53ef\u4ee5\u8003\u8651\u5de5\u5177 vmstat  \u5982\u679c\u9700\u8981\u4ece\u5171\u4eab\u5e93\u6216\u8005\u5171\u4eab\u5185\u5b58\u7684\u89d2\u5ea6\u5206\u6790\u5176\u5185\u5b58\u5360\u7528\u7684\u60c5\u51b5, \u53ef\u4ee5\u8003\u8651\u7528  librank , \u5f53\u7136, \u5982\u679c\u5b58\u5728host\u7aef\u7684\u5206\u6790\u5de5\u5177, \u5219\u8be5\u5de5\u5177\u7684\u8f93\u51fa\u53ef\u4ee5\u9876\u66ff procrank \u548c procmem .  \u5982\u679c\u9700\u8981\u67e5\u770b\u7cfb\u7edf\u4e2d\u54ea\u4e9b\u5171\u4eab\u6587\u4ef6\u522b\u901a\u8fc7\u7f3a\u9875\u9519\u8bef\u7684\u65b9\u5f0f\u8bfb\u5230\u5185\u5b58, \u53ef\u4ee5\u4f7f\u7528\u5de5\u5177 dumpcache  \u5982\u679c\u5b9e\u5728\u4e0d\u77e5\u9053bug\u539f\u56e0\u6216\u8005\u95ee\u9898\u53ef\u80fd\u8ddf\u81ea\u5df1\u65e0\u5173, \u5efa\u8bae\u4f7f\u7528  bugreport , \u4f9b\u5176\u4ed6RD\u534f\u52a9\u5206\u6790\u95ee\u9898.    \u6307\u5b9a\u5e94\u7528(dalvik\u8fdb\u7a0b)\u5185\u5b58\u5206\u6790  dumpsys meminfo \u5e94\u7528\u5185\u5b58  \u8f93\u51fa\u5f53\u524d\u8fdb\u7a0b/\u5e94\u7528\u7684\u6240\u6709\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u5efa\u8bae\u53ea\u9488\u5bf9dalvik\u5c42\u7684\u8fdb\u7a0b.    \u6307\u5b9anative\u8fdb\u7a0b\u5185\u5b58\u5206\u6790  native\u7684\u5355\u4e2a\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\u5efa\u8bae\u4f7f\u7528  procmem \u548c  showmap .  showmap  \u989d\u5916\u8f93\u51fa\u4e86\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4, \u53ef\u4ee5\u8f85\u52a9\u67e5\u770b\u7531\u4e8e\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f15\u8d77\u7684\u5185\u5b58\u95ee\u9898.    \u5e94\u7528\u5185\u5b58\u6cc4\u9732  \u5c11\u90e8\u5206\u7684\u6cc4\u9732, \u6bd4\u5982\u6570\u636e\u5e93/activity\u7b49, \u901a\u8fc7 dumpsys meminfo \u5e94\u7528\u5185\u5b58 , \u4f46\u53ea\u80fd\u77e5\u9053\u5b58\u5728\u6cc4\u9732.  \u5e94\u7528\u5728\u5f00\u542f  strictmode  \u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u53d1\u73b0\u66f4\u591a\u7684\u8d44\u6e90\u6cc4\u9732\u60c5\u51b5. \u4f46\u4ec5\u9650\u4e8e\u53d1\u73b0.  \u4e00\u4e2a\u6bd4\u8f83\u63a8\u8350\u7684\u7528\u4e8e\u5b9a\u4e49\u5e94\u7528\u5185\u5b58\u6cc4\u9732\u7684\u5de5\u5177\u662f  LeakCanary    native\u8fdb\u7a0b\u5185\u5b58\u6cc4\u9732  \u57fa\u4e8ebionic\u7684\u5185\u5b58\u6cc4\u9732\u5206\u6790\u5de5\u5177 , \u8be5\u5de5\u5177\u5bf9\u4e8eRD\u4f7f\u7528\u8981\u6c42\u504f\u9ad8.    bugreport \u4fe1\u606f\u5206\u6790  \u89c1\u5916\u90e8\u6587\u6863.", 
            "title": "\u7d22\u5f15"
        }, 
        {
            "location": "/Android-memory-debug/#_2", 
            "text": "VSS - Virtual Set Size \u865a\u62df\u8017\u7528\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nRSS - Resident Set Size \u5b9e\u9645\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nPSS - Proportional Set Size \u5b9e\u9645\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58, USS + \u6bd4\u4f8b\u5206\u914d\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff08[\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u7684\u5185\u5b58(RSS - USS)] / [\u5206\u4eab\u5171\u4eab\u5185\u5b58\u7684\u8fdb\u7a0b\u6570\u91cf]\uff09.\nUSS - Unique Set Size \u8fdb\u7a0b\u72ec\u81ea\u5360\u7528\u7684\u7269\u7406\u5185\u5b58\uff08\u4e0d\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09      \n\u5982\u679c\u770b\u8fdb\u7a0b\u72ec\u5360\u5185\u5b58\uff0c\u3000\u5219\u4f7f\u7528USS. \u4f46\u662f\u4e00\u822c\u8003\u8651\u5230\u5171\u4eab\u5185\u5b58\u7684\u60c5\u51b5, \u5927\u90e8\u5206\u90fd\u662f\u4f9d\u636ePSS\u67e5\u770b\u5bf9\u5e94\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528.  shared clean: \u5e72\u51c0\u7684\u5171\u4eab\u6570\u636e, \u4e5f\u5c31\u662f\u8bf4, \u5f53\u524d\u6709\u591a\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6307\u5411\u8be5\u7269\u7406\u7a7a\u95f4, \u4e14\u5f53\u524d\u8fdb\u7a0b\u7a7a\u95f4\u8be5\u6570\u636e\u4e0edisk\u4e0a\u4e00\u81f4.\nshared dirty: \u810f\u5171\u4eab\u6570\u636e, \u4e0e\u4e0a\u9762\u5bf9\u5e94, \u8be5\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5171\u4eab\u6570\u636e\u4e0edisk\u4e0a\u6570\u636e\u4e0d\u4e00\u81f4.\nprivate clean: \u8fdb\u7a0b\u79c1\u6709\u5e72\u51c0\u6570\u636e, \u4e0edisk\u6570\u636e\u4e00\u81f4.\nprivate dirty: \u8fdb\u7a0b\u79c1\u6709\u810f\u6570\u636e, \u4e0edisk\u6570\u636e\u4e0d\u4e00\u81f4.", 
            "title": "\u57fa\u7840\u6982\u5ff5"
        }, 
        {
            "location": "/Android-memory-debug/#_3", 
            "text": "", 
            "title": "\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\u5206\u6790"
        }, 
        {
            "location": "/Android-memory-debug/#logcat", 
            "text": "", 
            "title": "logcat \u8f93\u51fa "
        }, 
        {
            "location": "/Android-memory-debug/#dalvik", 
            "text": "\u573a\u666f: \u5728\u5e94\u7528\u968f\u673a\u51fa\u73b0\u6162\u65f6, \u53ef\u4ee5\u770b\u770b\u90a3\u6bb5\u65f6\u95f4logcat\u7684\u8f93\u51fa, \u662f\u5426\u5305\u542bGC\u7684\u4e00\u4e9b\u4fe1\u606f. GC\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u6162, \u800c\u7cfb\u7edf\u53d1\u8d77\u7684GC\u5219\u610f\u5473\u7740\u5185\u5b58\u4e0d\u591f, \u53ef\u80fd\u51fa\u73b0\u4ece\u78c1\u76d8\u52a0\u8f7d\u7684\u60c5\u51b5.  \u5728logcat\u4e2d\u4f1a\u6253\u5370dalvik\u7684\u5783\u573e\u56de\u6536\u4fe1\u606f.  D/dalvikvm:  GC_Reason   Amount_freed ,  Heap_stats ,  External_memory_stats ,  Pause_time \nD/dalvikvm( 9050): GC_CONCURRENT freed 2049K, 65% free 3571K/9991K, external 4703K/5261K, paused 2ms+2ms   GC_Reason :  GC_CONCURRENT \n    \u5728\u60a8\u7684\u5806\u5f00\u59cb\u5360\u7528\u5185\u5b58\u65f6\u53ef\u4ee5\u91ca\u653e\u5185\u5b58\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002 GC_FOR_MALLOC \n    \u5806\u5df2\u6ee1\u800c\u7cfb\u7edf\u4e0d\u5f97\u4e0d\u505c\u6b62\u60a8\u7684\u5e94\u7528\u5e76\u56de\u6536\u5185\u5b58\u65f6\uff0c\u60a8\u7684\u5e94\u7528\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u800c\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002 GC_HPROF_DUMP_HEAP \n    \u5f53\u60a8\u8bf7\u6c42\u521b\u5efa HPROF \u6587\u4ef6\u6765\u5206\u6790\u5806\u65f6\u51fa\u73b0\u7684\u5783\u573e\u56de\u6536\u3002 GC_EXPLICIT \n    \u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\u5f53\u60a8\u8c03\u7528 gc() \u65f6\uff08\u60a8\u5e94\u907f\u514d\u8c03\u7528\uff0c\u800c\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u4f1a\u6839\u636e\u9700\u8981\u8fd0\u884c\uff09\u3002 GC_EXTERNAL_ALLOC \n    \u8fd9\u4ec5\u9002\u7528\u4e8e API \u7ea7\u522b 10 \u53ca\u66f4\u4f4e\u7ea7\u522b\uff08\u66f4\u65b0\u7248\u672c\u4f1a\u5728 Dalvik \u5806\u4e2d\u5206\u914d\u4efb\u4f55\u5185\u5b58\uff09\u3002\u5916\u90e8\u5206\u914d\u5185\u5b58\u7684\u5783\u573e\u56de\u6536\uff08\u4f8b\u5982\u5b58\u50a8\u5728\u539f\u751f\u5185\u5b58\u6216 NIO \u5b57\u8282\u7f13\u51b2\u533a\u4e2d\u7684\u50cf\u7d20\u6570\u636e\uff09\u3002   Amount_freed : \n\u4ece\u6b64\u6b21\u5783\u573e\u56de\u6536\u4e2d\u56de\u6536\u7684\u5185\u5b58\u91cf\u3002  Heap_stats :  \u5806\u7684\u53ef\u7528\u7a7a\u95f4\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002   External_memory_stats :  API \u7ea7\u522b 10 (Android3.0 \u4ee5\u4e0b)\u53ca\u66f4\u4f4e\u7ea7\u522b\u7684\u5916\u90e8\u5206\u914d\u5185\u5b58\uff08\u5df2\u5206\u914d\u5185\u5b58\u91cf\uff09/\uff08\u53d1\u751f\u56de\u6536\u7684\u9650\u503c\uff09. \u800c\u65b0API\u4e2d, \u7edf\u4e00\u7531dalvik\u7ba1\u7406.   Pause_time   \u5806\u8d8a\u5927\uff0c\u6682\u505c\u65f6\u95f4\u8d8a\u957f\u3002\u5e76\u53d1\u6682\u505c\u65f6\u95f4\u663e\u793a\u4e86\u4e24\u4e2a\u6682\u505c\uff1a\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5f00\u59cb\u65f6\uff0c\u53e6\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5feb\u8981\u5b8c\u6210\u65f6\u3002", 
            "title": "dalvik\u65e5\u5fd7\u6253\u5370"
        }, 
        {
            "location": "/Android-memory-debug/#art", 
            "text": "\u4e0e Dalvik \u4e0d\u540c\uff0cART \u4e0d\u4f1a\u4e3a\u672a\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\u8bb0\u5f55\u6d88\u606f\u3002\u53ea\u6709\u5728\u8ba4\u4e3a\u5783\u573e\u56de\u6536\u901f\u5ea6\u8f83\u6162\u65f6\u624d\u4f1a\u6253\u5370\u5783\u573e\u56de\u6536\u3002\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u4ec5\u5728\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8d85\u8fc7 5ms \u6216\u5783\u573e\u56de\u6536\u6301\u7eed\u65f6\u95f4\u8d85\u8fc7 100ms \u65f6\u3002\u5982\u679c\u5e94\u7528\u672a\u5904\u4e8e\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\uff0c\u90a3\u4e48\u5176\u5783\u573e\u56de\u6536\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u8f83\u6162\u3002\u59cb\u7ec8\u4f1a\u8bb0\u5f55\u663e\u5f0f\u5783\u573e\u56de\u6536\u3002  I/art:  GC_Reason   GC_Name   Objects_freed ( Size_freed ) AllocSpace Objects,  Large_objects_freed ( Large_object_size_freed )  Heap_stats  LOS objects,  Pause_time(s) \n\nI/art : Explicit concurrent mark sweep GC freed 104710(7MB) AllocSpace objects, 21(416KB) LOS objects, 33% free, 25MB/38MB, paused 1.230ms total 67.216ms  GC_Reason :  Concurrent \n    \u4e0d\u4f1a\u6682\u505c\u5e94\u7528\u7ebf\u7a0b\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\u6b64\u5783\u573e\u56de\u6536\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u800c\u4e14\u4e0d\u4f1a\u963b\u6b62\u5206\u914d\u3002 Alloc \n    \u60a8\u7684\u5e94\u7528\u5728\u5806\u5df2\u6ee1\u65f6\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5206\u914d\u7ebf\u7a0b\u4e2d\u53d1\u751f\u4e86\u5783\u573e\u56de\u6536\u3002 Explicit \n    \u7531\u5e94\u7528\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\uff0c\u901a\u8fc7\u8c03\u7528 gc() \u6216 gc()\u3002\u4e0e Dalvik \u76f8\u540c\uff0c\u5728 ART \u4e2d\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u60a8\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u5e76\u907f\u514d\u8bf7\u6c42\u663e\u5f0f\u5783\u573e\u56de\u6536\uff08\u5982\u679c\u53ef\u80fd\uff09\u3002\u4e0d\u5efa\u8bae\u4f7f\u7528\u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u963b\u6b62\u5206\u914d\u7ebf\u7a0b\u5e76\u4e0d\u5fc5\u8981\u5730\u6d6a\u8d39 CPU \u5468\u671f\u3002\u5982\u679c\u663e\u5f0f\u5783\u573e\u56de\u6536\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u88ab\u62a2\u5360\uff0c\u90a3\u4e48\u5b83\u4eec\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\uff08\u5e94\u7528\u4e2d\u51fa\u73b0\u95f4\u65ad\u3001\u6296\u52a8\u6216\u6682\u505c\uff09\u3002 NativeAlloc \n    \u539f\u751f\u5206\u914d\uff08\u5982\u4f4d\u56fe\u6216 RenderScript \u5206\u914d\u5bf9\u8c61\uff09\u5bfc\u81f4\u51fa\u73b0\u539f\u751f\u5185\u5b58\u538b\u529b\uff0c\u8fdb\u800c\u5f15\u8d77\u7684\u56de\u6536\u3002 CollectorTransition \n    \u7531\u5806\u8f6c\u6362\u5f15\u8d77\u7684\u56de\u6536\uff1b\u6b64\u56de\u6536\u7531\u8fd0\u884c\u65f6\u5207\u6362\u5783\u573e\u56de\u6536\u5f15\u8d77\u3002\u56de\u6536\u5668\u8f6c\u6362\u5305\u62ec\u5c06\u6240\u6709\u5bf9\u8c61\u4ece\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u590d\u5236\u5230\u78b0\u649e\u6307\u9488\u7a7a\u95f4\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002\u5f53\u524d\uff0c\u56de\u6536\u5668\u8f6c\u6362\u4ec5\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u51fa\u73b0\uff1a\u5728 RAM \u8f83\u5c0f\u7684\u8bbe\u5907\u4e0a\uff0c\u5e94\u7528\u5c06\u8fdb\u7a0b\u72b6\u6001\u4ece\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u72b6\u6001\u53d8\u66f4\u4e3a\u53ef\u5bdf\u89c9\u7684\u975e\u6682\u505c\u72b6\u6001\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002  HomogeneousSpaceCompact \n    \u9f50\u6027\u7a7a\u95f4\u538b\u7f29\u662f\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u5230\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u538b\u7f29\uff0c\u901a\u5e38\u5728\u5e94\u7528\u8fdb\u5165\u5230\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\u65f6\u53d1\u751f\u3002\u8fd9\u6837\u505a\u7684\u4e3b\u8981\u539f\u56e0\u662f\u51cf\u5c11 RAM \u4f7f\u7528\u91cf\u5e76\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\u3002  DisableMovingGc \n    \u8fd9\u4e0d\u662f\u771f\u6b63\u7684\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u53d1\u751f\u5e76\u53d1\u5806\u538b\u7f29\u65f6\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86 GetPrimitiveArrayCritical\uff0c\u56de\u6536\u906d\u5230\u963b\u6b62\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 GetPrimitiveArrayCritical\uff0c\u56e0\u4e3a\u5b83\u5728\u79fb\u52a8\u56de\u6536\u5668\u65b9\u9762\u5177\u6709\u9650\u5236\u3002  HeapTrim \n    \u8fd9\u4e0d\u662f\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5806\u4fee\u526a\u5b8c\u6210\u4e4b\u524d\u56de\u6536\u4f1a\u4e00\u76f4\u53d7\u5230\u963b\u6b62\u3002   GC_Name :  ART \u5177\u6709\u53ef\u4ee5\u8fd0\u884c\u7684\u591a\u79cd\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u3002   Concurrent mark sweep (CMS) \n    \u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u91ca\u653e\u548c\u56de\u6536\u6620\u50cf\u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002 Concurrent partial mark sweep \n    \u51e0\u4e4e\u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u56de\u6536\u9664\u4e86\u6620\u50cf\u7a7a\u95f4\u548c zygote \u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002  Concurrent sticky mark sweep \n    \u751f\u6210\u56de\u6536\u5668\uff0c\u53ea\u80fd\u91ca\u653e\u81ea\u4e0a\u6b21\u5783\u573e\u56de\u6536\u4ee5\u6765\u5206\u914d\u7684\u5bf9\u8c61\u3002\u6b64\u5783\u573e\u56de\u6536\u6bd4\u5b8c\u6574\u6216\u90e8\u5206\u6807\u8bb0\u6e05\u9664\u8fd0\u884c\u5f97\u66f4\u9891\u7e41\uff0c\u56e0\u4e3a\u5b83\u66f4\u5feb\u901f\u4e14\u6682\u505c\u65f6\u95f4\u66f4\u77ed\u3002  Marksweep + semispace \n    \u975e\u5e76\u53d1\u3001\u590d\u5236\u5783\u573e\u56de\u6536\uff0c\u7528\u4e8e\u5806\u8f6c\u6362\u4ee5\u53ca\u9f50\u6027\u7a7a\u95f4\u538b\u7f29\uff08\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002   Objects_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002  Size_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002  Large_objects_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002  Large_object_size_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002  Heap_stats  \u7a7a\u95f2\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002  Pause_time(s)  \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6682\u505c\u65f6\u95f4\u4e0e\u5783\u573e\u56de\u6536\u8fd0\u884c\u65f6\u4fee\u6539\u7684\u5bf9\u8c61\u5f15\u7528\u6570\u91cf\u6210\u6b63\u6bd4\u3002\u5f53\u524d\uff0cART CMS \u5783\u573e\u56de\u6536\u4ec5\u5728\u5783\u573e\u56de\u6536\u5373\u5c06\u5b8c\u6210\u65f6\u6682\u505c\u4e00\u6b21\u3002\u79fb\u52a8\u7684\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8f83\u957f\uff0c\u4f1a\u5728\u5927\u90e8\u5206\u5783\u573e\u56de\u6536\u671f\u95f4\u6301\u7eed\u51fa\u73b0\u3002", 
            "title": "art\u65e5\u5fd7\u6253\u5370"
        }, 
        {
            "location": "/Android-memory-debug/#android_1", 
            "text": "", 
            "title": "android\u81ea\u5e26\u5de5\u5177"
        }, 
        {
            "location": "/Android-memory-debug/#dumpsys-meminfo", 
            "text": "https://developer.android.com/studio/profile/investigate-ram.html\nhttp://gityuan.com/2016/01/02/memory-analysis-command/  \u573a\u666f: \u67e5\u770bdalvik\u7b49\u533a\u57df\u5185\u5b58\u60c5\u51b5.  root@zx1800:/data # dumpsys meminfo\nApplications Memory Usage (kB):                                           --- \u4ee5\u4e0b\u5185\u5b58\u5355\u4f4d\nUptime: 618252294 Realtime: 618252294                                     --- Realtime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u5305\u542b\u4f11\u7720, \u51c6\u786e\u6027\u4f9d\u8d56\u9a71\u52a8\u5b9e\u73b0. \u5728\u9a71\u52a8\u65e0\u5b9e\u73b0\u65f6, \u4f7f\u7528Uptime.\n                                                                          --- Uptime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u4e0d\u5305\u542b\u4f11\u7720.\n\nTotal PSS by process:                                                     --- \u6240\u6709\u8fdb\u7a0b PSS \u5360\u7528\u6392\u5e8f\n    24712 kB: system (pid 445)\n    19600 kB: com.china_liantong.upgrade (pid 2660)\n    17500 kB: com.china_liantong.video (pid 3002 / activities)\n    11100 kB: com.china_liantong.oam (pid 999)\n    10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n     8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n     8394 kB: com.china_liantong.ocnadservice (pid 942)\n     7622 kB: com.android.systemui (pid 677)\n     6708 kB: dhcpcd (pid 639)\n     6541 kB: com.china_liantong.epg (pid 1235)\n     6286 kB: android.process.media (pid 2041)\n     5691 kB: com.china_liantong.airsharingservice (pid 2063)\n     4466 kB: dvbserver (pid 211)\n     4041 kB: mediaserver (pid 196)\n     3890 kB: com.china_liantong.xmppservice (pid 887)\n     3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n     3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     2466 kB: surfaceflinger (pid 183)\n     2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n     1955 kB: logd (pid 178)\n     1943 kB: com.china_liantong.tvframe (pid 1066)\n     1847 kB: com.china_liantong.playback (pid 923)\n     1640 kB: zygote (pid 220)\n      615 kB: sdcard (pid 1698)\n      473 kB: netd (pid 191)\n      415 kB: sysinfod (pid 184)\n      392 kB: vold (pid 182)\n      364 kB: developed (pid 222)\n      356 kB: adbd (pid 224)\n      350 kB: sh (pid 12684)\n      285 kB: /init (pid 1)\n      279 kB: dvbresourceserver (pid 210)\n      261 kB: sdcard (pid 223)\n      258 kB: avsettingd (pid 215)\n      240 kB: sh (pid 1325)\n      164 kB: ueventd (pid 159)\n      135 kB: keystore (pid 201)\n       82 kB: servicemanager (pid 181)\n       81 kB: installd (pid 199)\n       76 kB: healthd (pid 179)\n       62 kB: lmkd (pid 180)\n       26 kB: drmserver (pid 195)\n       26 kB: systemtaskd (pid 202)\n       22 kB: frontpaneld (pid 207)\n       15 kB: common_time (pid 189)\n       15 kB: frontpadserver (pid 216)\n       15 kB: dcaseventsvr (pid 219)\n        9 kB: sh (pid 190)\n        9 kB: debuggerd (pid 192)\n\nTotal PSS by OOM adjustment:                                              --- \u4ee5OOM\u7c7b\u522b\u5212\u5206(TODO: \u6bcf\u4e2a\u7c7b\u522b\u4f9d\u636e\u548c\u542b\u4e49)\n    26301 kB: Native\n                6708 kB: dhcpcd (pid 639)\n                4466 kB: dvbserver (pid 211)\n                4041 kB: mediaserver (pid 196)\n                2466 kB: surfaceflinger (pid 183)\n                1955 kB: logd (pid 178)\n                1640 kB: zygote (pid 220)\n                 615 kB: sdcard (pid 1698)\n                 473 kB: netd (pid 191)\n                 415 kB: sysinfod (pid 184)\n                 392 kB: vold (pid 182)\n                 364 kB: developed (pid 222)\n                 356 kB: adbd (pid 224)\n                 350 kB: sh (pid 12684)\n                 285 kB: /init (pid 1)\n                 279 kB: dvbresourceserver (pid 210)\n                 261 kB: sdcard (pid 223)\n                 258 kB: avsettingd (pid 215)\n                 240 kB: sh (pid 1325)\n                 164 kB: ueventd (pid 159)\n                 135 kB: keystore (pid 201)\n                  82 kB: servicemanager (pid 181)\n                  81 kB: installd (pid 199)\n                  76 kB: healthd (pid 179)\n                  62 kB: lmkd (pid 180)\n                  26 kB: drmserver (pid 195)\n                  26 kB: systemtaskd (pid 202)\n                  22 kB: frontpaneld (pid 207)\n                  15 kB: common_time (pid 189)\n                  15 kB: frontpadserver (pid 216)\n                  15 kB: dcaseventsvr (pid 219)\n                   9 kB: sh (pid 190)\n                   9 kB: debuggerd (pid 192)\n    24712 kB: System\n               24712 kB: system (pid 445)\n    48956 kB: Persistent\n               11100 kB: com.china_liantong.oam (pid 999)\n               10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n                8394 kB: com.china_liantong.ocnadservice (pid 942)\n                7622 kB: com.android.systemui (pid 677)\n                3890 kB: com.china_liantong.xmppservice (pid 887)\n                3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n                2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n                1847 kB: com.china_liantong.playback (pid 923)\n    27280 kB: Foreground\n               17500 kB: com.china_liantong.video (pid 3002 / activities)\n                6541 kB: com.china_liantong.epg (pid 1235)\n                3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     1943 kB: Visible\n                1943 kB: com.china_liantong.tvframe (pid 1066)\n     2214 kB: Perceptible\n                2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     6286 kB: Home\n                6286 kB: android.process.media (pid 2041)\n    34024 kB: B Services  (\u6ce8\u91ca: \u8001\u65e7\u7684, \u4e0d\u592a\u53ef\u80fd\u88ab\u4f7f\u7528\u5230\u7684\u670d\u52a1\u8fdb\u7a0b)\n               19600 kB: com.china_liantong.upgrade (pid 2660)\n                8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n                5691 kB: com.china_liantong.airsharingservice (pid 2063)\n\nTotal PSS by category:                                               --- \u4ee5 category \u5212\u5206\n    49530 kB: Native\n    35318 kB: Dalvik\n    26569 kB: .so mmap\n    17158 kB: .oat mmap\n    16357 kB: .art mmap\n     8144 kB: .dex mmap\n     6671 kB: Stack\n     2822 kB: Dalvik Other\n     2635 kB: Other mmap\n     2160 kB: .ttf mmap\n     1892 kB: Other dev\n     1581 kB: Unknown\n      843 kB: .apk mmap\n       36 kB: EGL mtrack\n        0 kB: Cursor\n        0 kB: Ashmem\n        0 kB: Gfx dev\n        0 kB: .jar mmap\n        0 kB: GL mtrack\n        0 kB: Other mtrack\n\nTotal RAM: 443652 kB (status critical)\n Free RAM: 137634 kB (40310 cached pss + 9492 cached kernel + 87832 free)\n Used RAM: 168782 kB (131406 used pss + 37376 kernel)\n Lost RAM: 137236 kB\n     ZRAM: 10684 kB physical used for 32252 kB in swap (196604 kB total swap)\n           \u538b\u7f29\u540e\u5185\u5b58\u5360\u7528             \u88ab\u538b\u7f29\u5185\u5b58\n      KSM: 39500 kB saved from shared 5844 kB\n           85420 kB unshared; 99276 kB volatile\n   Tuning: 96 (large 96), oom 10240 kB, restore limit 3413 kB (low-ram)", 
            "title": "dumpsys meminfo "
        }, 
        {
            "location": "/Android-memory-debug/#procrank", 
            "text": "\u573a\u666f: \u67e5\u770b\u5404\u4e2a\u8fdb\u7a0b\u7684PSS/USS \u5e76\u6bd4\u8f83  shell@zx1800:/ # procrank\n  PID       Vss      Rss      Pss      Uss  cmdline\n  884   589628K   89320K   30444K   23128K  com.china_liantong.launcher\n  447   617060K   74620K   25695K   20904K  system_server\n 1139   572780K   61160K   14848K   10160K  com.china_liantong.browserreceiver\n  209   125160K   25312K   13834K   12696K  /system/bin/dvbserver\n 1180   549556K   65992K   12433K    6192K  com.china_liantong.upgrade\n  807   554556K   48092K    9636K    7160K  com.china_liantong.ocnadservice\n  222   516596K   54256K    8960K    3152K  zygote\n  864   547692K   47220K    8431K    6024K  com.china_liantong.oam\n  827   552092K   46208K    8180K    5840K  com.china_liantong.channelmanagerservice\n  223    71580K   18580K    7156K    3928K  /system/bin/developed\n  955   529948K   44620K    6591K    4000K  com.china_liantong.epg\n  534   525112K   41324K    6233K    3816K  com.android.systemui\n  516   523764K   39424K    5949K    3884K  android.process.media\n  183    55092K   17936K    5935K    4284K  /system/bin/surfaceflinger\n 1066   525392K   41296K    5140K    2712K  com.china_liantong.live.service.LiveService\n  771   529900K   40224K    4864K    2888K  com.china_liantong.tvmediaplayerservice\n  753   525476K   37228K    4681K    2804K  com.china_liantong.xmppservice\n  201    53500K   12232K    4421K    3460K  /system/bin/mediaserver\n 1206   521008K   36324K    4288K    2580K  com.china_liantong.mytv\n  979   527892K   36256K    4201K    2080K  com.china_liantong.launcher:SettingContentProvider\n 1095   526240K   36480K    4145K    2368K  com.china_liantong.airsharingservice\n  601   518952K   37128K    3898K    1984K  com.china_liantong.inputmethod.pinyin\n  789   526912K   32468K    3309K    1832K  com.china_liantong.playback\n 1048   520468K   32616K    2799K     968K  com.china_liantong.live\n  846   525972K   32620K    2787K    1336K  com.china_liantong.dtvsyskeyservice\n 1252   519376K   31716K    2687K    1260K  com.china_liantong.video\n  907   524920K   32120K    2676K    1236K  com.china_liantong.tvframe\n  511    19896K    5168K    2350K    1208K  /system/bin/dhcpcd\n  210    25496K    6480K    1662K    1316K  /system/bin/avsettingd\n  178    18252K    2596K    1509K    1476K  /system/bin/logd\n  199    23564K    4880K    1273K    1004K  /system/bin/drmserver\n  217    18936K    2864K     826K     740K  /system/bin/frontpadserver\n  182    19568K    3176K     816K     636K  /system/bin/vold\n  205    12508K    2804K     718K     572K  /system/bin/keystore\n  184    16580K    2580K     681K     536K  /system/bin/sysinfod\n  197    21796K    1672K     538K     480K  /system/bin/netd\n 2135     9192K    1100K     532K     520K  procrank\n  189    17484K    1748K     481K     420K  /system/bin/common_time\n  208    17492K    1792K     479K     436K  /system/bin/dvbresourceserver\n  220    16400K    1672K     434K     388K  /system/bin/dcaseventsvr\n  225    16980K     508K     416K     416K  /sbin/adbd\n  224    15412K    1048K     356K     336K  /system/bin/sdcard\n 1434     9324K    1020K     338K     244K  sh\n  186    14820K     428K     336K     332K  /sbin/watchdog\n    1     8860K     396K     327K     316K  /init\n 1428     9324K    1008K     326K     232K  /system/bin/sh\n  206    14460K    1036K     310K     288K  /system/bin/systemtaskd\n  203     9412K    1012K     272K     248K  /system/bin/installd\n  207    14456K     992K     266K     244K  /system/bin/frontpaneld\n  179     9828K     316K     260K     256K  /sbin/healthd\n  180    10624K    1664K     184K     116K  /system/bin/lmkd\n  181     9460K     792K      98K      76K  /system/bin/servicemanager\n  198    10056K    1108K      64K      28K  /system/bin/debuggerd\n  160     8852K      56K      11K       4K  /sbin/ueventd\n                           ------   ------  ------\n                          230106K  155544K  TOTAL\n\nRAM: 443652K total, 38684K free, 0K buffers, 98768K cached, 1384K shmem, 21560K slab", 
            "title": "procrank "
        }, 
        {
            "location": "/Android-memory-debug/#cat-procmeminfo", 
            "text": "\u573a\u666f: \u7cfb\u7edf\u5185\u5b58\u8be6\u7ec6\u4fe1\u606f  shell@zx1800:/ # cat /proc/meminfo                                             \nMemTotal:         443652 kB                      --- \u7cfb\u7edf\u53ef\u89c1\u7684\u603b\u7269\u7406\u5185\u5b58\nMemFree:           38584 kB                      --- \u7cfb\u7edf\u4e2d\u672a\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\nMemAvailable:     125556 kB                      --- \u53ef\u7528\u5185\u5b58 = MemFree + Cached + Buffers\nBuffers:               0 kB                      --- \u7528\u4e8e\u6587\u4ef6\u7f13\u51b2\u7684\u5185\u5b58\u5927\u5c0f\nCached:            98768 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\nSwapCached:          128 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684swap\u5927\u5c0f\nActive:           143160 kB                      --- \u6d3b\u8dc3\u4f7f\u7528\u4e2d\u7684\u5185\u5b58, \u4e00\u822c\u4e0d\u4f1a\u56de\u6536. = anon + file\nInactive:          87104 kB                      --- \u6700\u8fd1\u672a\u88ab\u4f7f\u7528\u7684\u5185\u5b58, \u53ef\u4ee5\u88ab\u56de\u6536. = anon + file\nActive(anon):      94348 kB\nInactive(anon):    38532 kB\nActive(file):      48812 kB\nInactive(file):    48572 kB\nUnevictable:           0 kB                      \nMlocked:               0 kB\nHighTotal:             0 kB                      \nHighFree:              0 kB\nLowTotal:         443652 kB\nLowFree:           38584 kB\nSwapTotal:        196604 kB                      --- swap\u5206\u533a\u5927\u5c0f\nSwapFree:         193784 kB                      --- swap\u5206\u533a\u5269\u4f59\u7a7a\u95f4\nDirty:                 0 kB                      \nWriteback:             0 kB\nAnonPages:        131492 kB                      --- \u533f\u540d\u9875\nMapped:            90688 kB                      --- map\u7684\u5185\u5b58\nShmem:              1384 kB                      --- \u5171\u4eab\u5185\u5b58, \u8ddf\u6587\u4ef6\u65e0\u5173\u7684\nSlab:              21604 kB                      --- kernel slab\u5206\u914d\u5668\nSReclaimable:       5464 kB\nSUnreclaim:        16140 kB\nKernelStack:        5424 kB                      --- \u5185\u6838\u6808\nPageTables:         7932 kB                      --- \u7ba1\u7406\u9875\u7684\u6570\u636e\u7ed3\u6784\u5927\u5c0f\nNFS_Unstable:          0 kB\nBounce:                0 kB\nWritebackTmp:          0 kB\nCommitLimit:      418428 kB\nCommitted_AS:    8764944 kB\nVmallocTotal:     565248 kB\nVmallocUsed:       55952 kB\nVmallocChunk:     472068 kB", 
            "title": "cat /proc/meminfo "
        }, 
        {
            "location": "/Android-memory-debug/#vmstat", 
            "text": "\u573a\u666f: \u76d1\u63a7\u7cfb\u7edf\u72b6\u6001.  \u8be5\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f, \u8fdb\u7a0b\u961f\u5217, \u7cfb\u7edf\u5207\u6362, CPU\u65f6\u95f4\u5360\u6bd4\u7b49\u4fe1\u606f, \u5468\u671f\u6027\u52a8\u6001\u8f93\u51fa.  procs  memory                       system          cpu              \n r  b    free mapped   anon   slab    in   cs  flt  us ni sy id wa ir\n  0    0     38628    90844   131992    21688    5268   10257      0     5    0    6   99    0    0 \n  0    0     38628    90844   132008    21688    5271   10367      0     8    0    9   99    0    0 \n  0    0     38628    90844   132048    21688    5150   10497      0    10    1    8   99    0    0 \n  0    0     38628    90844   132100    21688    5112   10180      0     8    0    3   99    0    0 \n  0    0     38628    90844   132120    21688    5221   10289      0     8    0    4   99    0    0   \u603b\u517115\u5217\u53c2\u6570, \u4e2a\u53c2\u6570\u542b\u4e49\u5982\u4e0b:   procs(\u8fdb\u7a0b)  r: Running\u961f\u5217\u4e2d\u8fdb\u7a0b\u6570, \u8fd9\u4e2a\u503c\u8d85\u8fc7cpu\u4e2a\u6570\u5c31\u4f1a\u51fa\u73b0cpu\u74f6\u9888.  b: IO wait \u7684\u8fdb\u7a0b\u6570, \u8be5\u503c\u8fc7\u5927, \u53ef\u80fd\u662f\u7b49\u5f85\u6587\u4ef6\u64cd\u4f5c\u7684\u8fdb\u7a0b\u591a\u6216\u8005\u6587\u4ef6\u8bfb\u5199\u6162.    memory(\u5185\u5b58)  free: \u53ef\u7528\u5185\u5b58\u5927\u5c0f  mapped: mmap\u6620\u5c04\u7684\u5185\u5b58\u5927\u5c0f  anon: \u533f\u540d\u5185\u5b58\u5927\u5c0f, \u4e00\u822c\u7531malloc\u5f15\u8d77, \u6216\u8005\u533f\u540dmmap.  slab: slab\u7684\u5185\u5b58\u5927\u5c0f.    system(\u7cfb\u7edf)  in: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u7684\u4e2d\u65ad\u6b21\u6570(\u5305\u62ec\u65f6\u949f\u4e2d\u65ad), \u8fd9\u4e2a\u503c\u8d8a\u5927, \u5185\u6838\u6d88\u8017\u7684cpu\u65f6\u95f4\u8d8a\u591a.\u9700\u8981\u67e5\u770b /proc/interrupts \u4e0b\u4e2d\u65ad\u589e\u957f\u60c5\u51b5.  cs: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570  flt: major page faults. \u9700\u8981\u4ecedisk\u8bfb\u53d6\u6570\u636e\u7684\u7f3a\u9875\u9519\u8bef.    CPU (\u5904\u7406\u5668)  us: user time, \u6bd4\u8f83\u9ad8\u65f6\uff0c\u8bf4\u660e\u7528\u6237\u8fdb\u7a0b\u6d88\u8017\u7684cpu\u65f6\u95f4\u591a.  ni: nice time, \u88ab\u964d\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u5728\u7528\u6237\u6a21\u5f0f\u4e0b\u7684\u6267\u884cCPU\u65f6\u95f4\u767e\u5206\u6bd4.  sy: system time, \u7cfb\u7edf\u5185\u6838\u6d88\u8017\u7684CPU\u767e\u5206\u6bd4  id: idle time, \u7cfb\u7edf\u7a7a\u95f2\u65f6\u95f4\u767e\u5206\u6bd4  wa: iowait time, CPU\u5728\u7b49\u5f85IO\u5b8c\u6210\u65f6\u95f4\u5360\u6bd4  ir: interrupt time, \u7cfb\u7edf\u4e2d\u65ad\u8017\u65f6\u5360CPU\u767e\u5206\u6bd4     \u66f4\u591a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f, \u8bf7\u76f4\u63a5\u67e5\u770b  /proc/vmstat \nhttp://blog.csdn.net/macky0668/article/details/6839498", 
            "title": "vmstat "
        }, 
        {
            "location": "/Android-memory-debug/#librank", 
            "text": "\u573a\u666f: \u4e0eprocrank\u4e92\u8865\u4f7f\u7528, \u662fprocmem\u7684\u6269\u5c55. \u663e\u793a\u6240\u6709\u8fdb\u7a0b\u7684\u4fe1\u606f, \u9700\u8981\u5de5\u5177\u7edf\u8ba1\u5206\u7c7b. \u4e5f\u53ef\u4ee5\u7528\u6765\u67e5\u770b\u6bcf\u4e2a\u5e93\u6216\u5171\u4eab\u6587\u4ef6\u771f\u5b9e\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f.  \u6570\u636e\u6765\u6e90\u4e0eprocmem\u4e00\u6837, \u4f46\u662fprocmem\u9488\u5bf9\u7684\u662f\u5355\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u800clibrank\u662f\u663e\u793a\u67d0\u4e2a\u5e93\u6216\u8005\u6587\u4ef6\u88ab\u54ea\u4e9b\u8fdb\u7a0b\u5171\u4eab, \u5e76\u663e\u793a\u5360\u7528\u5927\u5c0f. \u5982\u4e0b\u56fe\u6240\u793a.", 
            "title": "librank "
        }, 
        {
            "location": "/Android-memory-debug/#dumpcache", 
            "text": "\u8be5\u5de5\u5177\u662fandroid7.0\u4e4b\u540e\u624d\u6709\u7684\u5de5\u5177,\u7528\u4e8e\u67e5\u770b\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u6bcf\u4e2a\u6587\u4ef6\u88abcache\u5230\u5185\u5b58\u7684\u5927\u5c0f. \u8be5\u6587\u4ef6\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u7f3a\u9875\u9519\u8bef\u65f6\u52a0\u8f7d\u7684\u6587\u4ef6.  \u5728Launcher\u754c\u9762\u65f6\u7684\u8f93\u51fa\u5982\u4e0b:   \u7a33\u5b9a\u64ad\u653e1080P\u89c6\u9891\u65f6:  \u6309\u4e0b\u9065\u63a7\u5668\u786e\u5b9a\u952e\u663e\u793aUI\u65f6:  \u5bf9\u6bd4, \u53ef\u4ee5\u77e5\u9053\u5728\u64ad\u653e\u8fc7\u7a0b\u4e2d, \u663e\u793aUI\u65f6\u4e3b\u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u662f:", 
            "title": "dumpcache "
        }, 
        {
            "location": "/Android-memory-debug/#bugreport", 
            "text": "Android\u7cfb\u7edf\u60f3\u8981\u6210\u4e3a\u4e00\u4e2a\u529f\u80fd\u5b8c\u5907\uff0c\u751f\u6001\u7e41\u8363\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u90a3\u5c31\u5fc5\u987b\u63d0\u4f9b\u5b8c\u6574\u7684\u5e94\u7528\u5f00\u53d1\u73af\u5883\u3002\u800c\u5728\u5e94\u7528\u5f00\u53d1\u4e2d\uff0capp\u7a0b\u5e8f\u7684\u8c03\u8bd5\u5206\u6790\u662f\u65e5\u5e38\u751f\u4ea7\u4e2d\u8fdb\u7a0b\u4f1a\u8fdb\u884c\u7684\u5de5\u4f5c\u3002Android\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u5206\u6790\u6574\u4e2a\u7cfb\u7edf\u5e73\u53f0\u548c\u67d0\u4e2aapp\u5728\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u5185\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e13\u95e8\u5f00\u53d1\u4e86bugreport\u5de5\u5177\u3002  \n\u8be5\u5de5\u5177\u7684\u7f3a\u70b9\u662f: \n1. \u8017\u65f6\u8fc7\u957f, \u53ea\u80fd\u6293\u53d6\u5f53\u524d\u72b6\u6001.\n2. \u6293\u53d6\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u5bfc\u81f4\u7cfb\u7edf\u5f02\u5e38, \u56e0\u4e3a\u5176oom\u4f1a\u88ab\u8c03\u9ad8, \u5728\u5185\u5b58\u4e0d\u8db3\u65f6\u5bfc\u81f4\u7cfb\u7edf\u5176\u4ed6\u5e94\u7528\u88abkill.\n3. \u7531\u4e8ebugreport\u7684\u6743\u9650\u4f1a\u964d\u4f4e\u5230shell, \u800c\u5f88\u591a\u670d\u52a1\u5728\u4f1a\u62d2\u7edddumpsys\u7684\u64cd\u4f5c, \u5bfc\u81f4\u90e8\u5206\u4fe1\u606f\u65e0\u6cd5\u6293\u53d6.    \u4f7f\u7528\u65b9\u6cd5:    \u901a\u8fc7bugreport\u547d\u4ee4\u6293\u53d6\u4e00\u4efdbugreport\u539f\u59cb\u7684\u6587\u672clog\uff1a\n     shell# bugreport gt;/data/local/tmp/bugreport.txt    \u5c06\u4e0a\u9762\u547d\u4ee4\u6293\u53d6\u7684bugreport.txt\u6587\u672c\u6587\u4ef6\u62f7\u8d1d\u51fa\u6765\uff0c\u4e0a\u4f20\u5230bugreport\u5206\u6790\u670d\u52a1\u5668\u4e0a\u9762\uff0c\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u5f53\u524d\u72b6\u6001\u5feb\u7167\uff0c\u4e0a\u4f20\u65b9\u6cd5\u5982\u4e0b\uff1a\n  a. \u901a\u8fc7\u6d4f\u89c8\u5668\u8fdb\u5165\u670d\u52a1\u5668\u5730\u5740\uff1ahttp://10.27.254.108:8080/,\u5982\u4e0b\u56fe\uff1a\n      b. \u70b9\u51fbbroswer\u6d4f\u89c8report.txt\u6587\u672c\u6587\u4ef6\uff0c\u7136\u540e\u70b9\u51fbupload\u6309\u94ae\u4e0a\u4f20\u6587\u4ef6\uff0c\u4e0a\u4f20\u540e\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u72b6\u6001\u5feb\u7167\uff0c\u5feb\u7167\u540d\u79f0\u5bf9\u5e94\u5230\u4e0a\u4f20\u65f6\u95f4\uff0c\u70b9\u51fb\u5feb\u7167\u540d\u79f0\u8fdb\u5165\u7cfb\u7edf\u5206\u6790\u9875\u9762\uff0c\u5982\u4e0b\uff1a\n    \u8be5\u7f51\u9875\u670d\u52a1\u5668\u7684dockerfile\u5982\u4e0b:  FROM ubuntu:14.04\n MAINTAINER wertherzhang  werther0331@gmail.com \n\n RUN apt-get update\n\n RUN apt-get -y install openjdk-7-jdk openjdk-7-jre\n RUN apt-get -y install python\n\n RUN mkdir -p /root/chkbugreport\n RUN apt-get -y install wget\n RUN wget http://10.27.8.54/chkbugreport.tgz -O /root/chkbugreport.tgz\n RUN tar xvf /root/chkbugreport.tgz -C /tmp/\n RUN mkdir -p /root/bin\n\n ADD server.py /root/chkbugreport/\n ADD chkbugreport.jar /root/bin/\n ADD chkbugreport /usr/local/bin/\n ADD ddmlib.jar /root/bin/\n\n RUN apt-get clean\n\n ENV JAVA_HOME /usr/lib/jvm/java-7-openjdk-amd64\n ENV PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n WORKDIR /root/chkbugreport/\n\n CMD [ python ,  server.py ]  \u9644\u4ef6:  chkbugreport-server.zip", 
            "title": "bugreport \u4fe1\u606f\u5206\u6790 "
        }, 
        {
            "location": "/Android-memory-debug/#_4", 
            "text": "", 
            "title": "\u5e94\u7528\u5185\u5b58\u5206\u6790"
        }, 
        {
            "location": "/Android-memory-debug/#android_2", 
            "text": "", 
            "title": "android\u81ea\u5e26\u5de5\u5177"
        }, 
        {
            "location": "/Android-memory-debug/#dumpsys-meminfo_1", 
            "text": "\u573a\u666f: \u67e5\u770bjava\u8fdb\u7a0b\u7684\u4e0d\u540c\u7c7b\u522b\u5185\u5b58\u5360\u7528\u60c5\u51b5, \u7279\u522b\u662f\u786e\u5b9aactivity\u662f\u5426\u6cc4\u9732\u7b49\u4fe1\u606f.  \u547d\u4ee4  dumpsys meminfo com.china_liantong.launcher -d  \u8f93\u51fa:  shell@zx1800:/  # dumpsys meminfo com.china_liantong.launcher -d                 \nApplications Memory Usage  ( kB ) :\nUptime:  2612261  Realtime:  2612261 \n\n** MEMINFO in pid  884   [ com.china_liantong.launcher ]  **\n                   Pss  Private  Private  Swapped     Heap     Heap     Heap\n                 Total    Dirty    Clean    Dirty     Size    Alloc     Free\n                ------   ------   ------   ------   ------   ------   ------\n  Native Heap      5915       5440          0          0      24576      16208       8367 \n  Dalvik Heap     13764      13364          0          0      26989      20896       6093 \n Dalvik Other       248        248          0          0                            \n        Stack       513        512          0          0                            \n    Other dev         4          0          4          0                            \n     .so mmap      3392        424        472          0                            \n    .apk mmap        94          0          4          0                            \n    .ttf mmap      1573          0        568          0                            \n    .dex mmap      1188          0        752          0                            \n    .oat mmap      1419          0        260          0                            \n    .art mmap       979        616          0          0                            \n   Other mmap        80          4          0          0                            \n   EGL mtrack        17         17          0          0                            \n      Unknown       134        128          0          0                            \n        TOTAL     29320      20753       2060          0      51565      37104      14460 \n\n Objects\n               Views:      1192          ViewRootImpl:         1 \n         AppContexts:         3            Activities:         1 \n              Assets:         2         AssetManagers:         2 \n       Local Binders:        41         Proxy Binders:       220 \n       Parcel memory:         7          Parcel count:        14 \n    Death Recipients:        10       OpenSSL Sockets:         0 \n\n SQL\n         MEMORY_USED:         0 \n  PAGECACHE_OVERFLOW:         0           MALLOC_SIZE:         0   Native Heap : native\u5206\u914d\u5360\u7528\u7684RAM, \u901a\u8fc7malloc\u7533\u8bf7\u7684\u5185\u5b58.  Heap Size  \u662f\u5185\u5b58\u6c60\u603b\u5927\u5c0f(\u5411\u7cfb\u7edf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f).  Heap Alloc  \u5df2\u7ecf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f(\u5e94\u7528\u5411dlmalloc\u7533\u8bf7\u7684\u5185\u5b58).  Heap Free  \u5185\u5b58\u6c60\u5269\u4f59\u53ef\u5206\u914d\u5185\u5b58\u5927\u5c0f.  Dalvik Heap : \u5e94\u7528\u4e2dDalvi\u5206\u914d\u5360\u7528\u7684RAM.  Pss Total : \u5305\u542b\u6240\u6709Zygote\u5206\u914d(\u901a\u8fc7\u8fdb\u7a0b\u95f4\u5171\u4eab\u5360\u7528).  Private Dirty : \u4ec5\u5206\u914d\u5230\u5e94\u7528\u7684\u5b9e\u9645RAM, \u7531\u5e94\u7528\u5206\u914d\u6216\u8005zygote\u5206\u914d\u9875, \u8fd9\u4e9b\u9875\u81ea\u4ecezygote fork\u5e94\u7528\u8fdb\u7a0b\u540e\u88ab\u4fee\u6539\u8fc7.  .so map  \u548c  .dex map : mmap\u7684.so\u548c.dex(Dalvik\u6216ART)\u4ee3\u7801\u5360\u7528\u7684RAM.  Pss Total  \u6570\u503c\u5305\u62ec\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\u7684\u5e73\u53f0\u4ee3\u7801\uff1b Private Clean  \u662f\u60a8\u7684\u5e94\u7528\u81ea\u5df1\u7684\u4ee3\u7801\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u6620\u5c04\u7684\u5185\u5b58\u66f4\u5927 - \u6b64\u5904\u7684 RAM \u4ec5\u4e3a\u5e94\u7528\u6267\u884c\u7684\u4ee3\u7801\u5f53\u524d\u6240\u9700\u7684 RAM\u3002\u4e0d\u8fc7\uff0c.so mmap \u5177\u6709\u8f83\u5927\u7684\u79c1\u6709\u810f RAM\uff0c\u56e0\u4e3a\u5728\u52a0\u8f7d\u5230\u5176\u6700\u7ec8\u5730\u5740\u65f6\u5bf9\u539f\u751f\u4ee3\u7801\u8fdb\u884c\u4e86\u4fee\u6539(GOT?!)\u3002   .oat mmap : \u4ee3\u7801\u6620\u50cf\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6587\u4ef6\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002   .art mmap : \u5806\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6620\u50cf\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002\u5c3d\u7ba1 ART \u6620\u50cf\u5305\u542b Object \u5b9e\u4f8b\uff0c\u5b83\u4ecd\u7136\u4e0d\u4f1a\u8ba1\u5165\u60a8\u7684\u5806\u5927\u5c0f\u3002   Unknown : \u7cfb\u7edf\u65e0\u6cd5\u5c06\u5176\u5206\u7c7b\u5230\u5176\u4ed6\u66f4\u5177\u4f53\u7684\u4e00\u4e2a\u9879\u4e2d\u7684\u4efb\u4f55 RAM \u9875\u3002 \u5176  Pss Total  \u4e0e Zygote\u5171\u4eab.  TOTAL : \u4e0a\u65b9\u6240\u6709 PSS \u5b57\u6bb5\u7684\u603b\u548c\u3002\u8868\u793a\u60a8\u7684\u8fdb\u7a0b\u5360\u7528\u7684\u5185\u5b58\u91cf\u5360\u6574\u4f53\u5185\u5b58\u7684\u6bd4.  Private Dirty  \u548c  Private Clean  \u662f\u60a8\u7684\u8fdb\u7a0b\u4e2d\u7684\u603b\u5206\u914d\uff0c\u672a\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u3002\u5b83\u4eec\uff08\u5c24\u5176\u662f Private Dirty\uff09\u7b49\u4e8e\u60a8\u7684\u8fdb\u7a0b\u88ab\u7834\u574f\u540e\u5c06\u91ca\u653e\u56de\u7cfb\u7edf\u4e2d\u7684 RAM \u91cf\u3002 Dirty \u56e0\u4e3a\u5df2\u88ab\u4fee\u6539\u800c\u5fc5\u987b\u4fdd\u6301\u5728 RAM \u4e2d\u7684 RAM \u9875\uff08\u56e0\u4e3a\u6ca1\u6709\u4ea4\u6362\uff09\uff1b Clean  \u662f\u5df2\u4ece\u67d0\u4e2a\u6301\u4e45\u6027\u6587\u4ef6\uff08\u4f8b\u5982\u6b63\u5728\u6267\u884c\u7684\u4ee3\u7801\uff09\u6620\u5c04\u7684 RAM \u9875\uff0c\u5982\u679c\u4e00\u6bb5\u65f6\u95f4\u4e0d\u7528\uff0c\u53ef\u4ee5\u79fb\u51fa\u5206\u9875\u3002  ViewRootImpl : \u8fdb\u7a0b\u4e2d\u5f53\u524d\u6d3b\u52a8\u7684\u6839\u89c6\u56fe\u6570\u91cf\u3002\u6bcf\u4e2a\u6839\u89c6\u56fe\u90fd\u4e0e\u4e00\u4e2a\u7a97\u53e3\u5173\u8054\uff0c\u56e0\u6b64\u6709\u52a9\u4e8e\u786e\u5b9a\u6d89\u53ca\u5bf9\u8bdd\u6846\u6216\u5176\u4ed6\u7a97\u53e3\u7684\u5185\u5b58\u6cc4\u6f0f\u3002   AppContexts  \u548c  Activities : \u5f53\u524d\u6d3b\u52a8\u7684\u5e94\u7528 Context \u548c Activity \u5bf9\u8c61\u6570\u91cf\u3002\u5feb\u901f\u786e\u5b9a\u7531\u4e8e\u5b58\u5728\u9759\u6001\u5f15\u7528\uff08\u6bd4\u8f83\u5e38\u89c1\uff09\u800c\u65e0\u6cd5\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u5df2\u6cc4\u6f0f Activity \u5bf9\u8c61\u3002\u8fd9\u4e9b\u5bf9\u8c61\u7ecf\u5e38\u62e5\u6709\u5f88\u591a\u5173\u8054\u7684\u5176\u4ed6\u5206\u914d\uff0c\u56e0\u6b64\u6210\u4e3a\u8ddf\u8e2a\u5927\u578b\u5185\u5b58\u6cc4\u6f0f\u7684\u4e00\u79cd\u4e0d\u9519\u7684\u65b9\u5f0f\u3002  \u4f8b\u5b50\u89c1\u5185\u5b58\u6cc4\u9732\u90e8\u5206.", 
            "title": "dumpsys meminfo \u5e94\u7528\u5185\u5b58 "
        }, 
        {
            "location": "/Android-memory-debug/#procmem", 
            "text": "\u573a\u666f: \u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u5404\u90e8\u5206\u5185\u5b58\u5360\u7528\u60c5\u51b5.\n\u547d\u4ee4:  procmem  pid \n\u4f8b\u5b50:  procmem 2509 \n\u6570\u636e\u6765\u6e90:  /proc/ pid /maps  \u548c  /proc/ pid /pagemap  Vss      Rss      Pss      Uss     ShCl     ShDi     PrCl     PrDi  Name   \u5404\u5b57\u6bb5\u542b\u4e49:  ShCl  --  shared clean\nShDi  --  shared dirty\nPrCl  --  private clean\nPrDi  --  private dirty", 
            "title": "procmem  "
        }, 
        {
            "location": "/Android-memory-debug/#showmap", 
            "text": "\u573a\u666f: \u8fdb\u7a0b\u865a\u62df\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5185\u5b58\u5206\u914d\u60c5\u51b5 \u548c \u8be6\u7ec6\u7684\u5e72\u51c0\u810f\u6570\u636e\u4fe1\u606f.  \u4ece  /proc/[pid]/smaps  \u83b7\u53d6\u6570\u636e\u5e76\u7edf\u8ba1\u7684\u5de5\u5177.  \u547d\u4ee4:  showmap [-a] [-t] [-v]  pid \n\u4f8b\u5b50:  showmap -a 884 \n\u8f93\u51fa\u5355\u4f4d: KB   \u7531\u4e8e\u73b0\u5728\u5185\u6838\u90fd\u4f7f\u7528\u4e86\u52a8\u6001\u5185\u5b58\u5206\u914d\u7684\u673a\u5236, \u5728\u5927\u91cf\u7533\u8bf7\u5c0f\u5185\u5b58\u7684\u60c5\u51b5\u4e0b, \u4ece\u7cfb\u7edf\u770b\u5185\u5b58\u6709\u5269\u4f59, \u4f46\u662f\u8fdb\u7a0b\u5374\u65e0\u6cd5\u5206\u914d\u51fa\u9700\u8981\u7684\u5185\u5b58, \u8fd9\u5c31\u6709\u53ef\u80fd\u662f\u7531\u4e8e\u865a\u62df\u5730\u5740\u7684\u5185\u5b58\u788e\u7247\u5f15\u8d77, \u65e0\u6cd5\u627e\u5230\u4e00\u6bb5\u5927\u4e8e\u6240\u8bf7\u6c42\u5185\u5b58\u5927\u5c0f\u7684\u5730\u5740\u7a7a\u95f4.   \u4f8b\u5b50:", 
            "title": "showmap "
        }, 
        {
            "location": "/Android-memory-debug/#android-oom", 
            "text": "\u89e6\u53d1OOM\u7684\u539f\u56e0\u662f, java\u5c42\u5185\u5b58\u5206\u914d\u5931\u8d25\u4e86.  \u9020\u6210\u5185\u5b58\u5206\u914d\u5931\u8d25\u7684\u53ef\u80fd\u539f\u56e0\u5982\u4e0b:   \u5185\u5b58\u6ea2\u51fa. \u7533\u8bf7\u7684\u5185\u5b58\u8d85\u51fa\u4e86\u865a\u62df\u673a\u6700\u5927\u5185\u5b58.  \u788e\u7247, \u5bfc\u81f4\u65e0\u6cd5\u627e\u5230\u8fde\u7eed\u7a7a\u95f4\u6ee1\u8db3\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f.  \u8d44\u6e90\u95ee\u9898, \u6bd4\u5982\u6587\u4ef6\u8282\u70b9\u8d85\u8fc7\u9650\u5236, \u5bfc\u81f4\u533f\u540d\u5185\u5b58\u7533\u8bf7\u51fa\u9519, \u9519\u8bef\u4fe1\u606f\u4e3a \"Too many open files\"  \u865a\u62df\u7a7a\u95f4\u5730\u5740\u7a7a\u95f4\u88ab\u5360\u6ee1, \u5bfc\u81f4OOM.   \u4ee5\u4e0a\u4e3a\u7f51\u4e0a\u7684\u7ed3\u8bba, \u5728android5.1.1\u4e0a\u6d4b\u8bd5\u53d1\u73b0:  fd\u95ee\u9898\u5e76\u4e0d\u4f1a\u5bfc\u81f4OOM  \u4ee3\u7801\u590d\u7528\u4e0b\u9762\u5185\u5b58\u6cc4\u9732\u7684\u4ee3\u7801,\u5728asynctask\u4e2d\u6267\u884c\u6587\u4ef6\u6253\u5f00\u64cd\u4f5c.   logcat\u4e2d\u8f93\u51fa\u5982\u4e0b, \u5e76\u6ca1\u6709OOM\u8f93\u51fa:   \u4f46\u662f\u8fd9\u6bb5\u4ee3\u7801\u7684\u786e\u8bc1\u660e\u4e86\u6253\u5f00\u6587\u4ef6\u592a\u591a\u4f1a\u5bfc\u81f4shmem\u521b\u5efa\u5931\u8d25.", 
            "title": "Android \u5e94\u7528 OOM"
        }, 
        {
            "location": "/Android-memory-debug/#_5", 
            "text": "", 
            "title": "\u5185\u5b58\u6cc4\u9732\u5206\u6790"
        }, 
        {
            "location": "/Android-memory-debug/#activity", 
            "text": "activity \u7684\u6cc4\u9732\u57fa\u4e8eandroid\u81ea\u5e26\u5de5\u5177, \u53ef\u4ee5\u5feb\u901f\u786e\u5b9a, \u4f46\u662f\u5177\u4f53\u6cc4\u9732\u7684activity, \u9700\u8981\u4f9d\u8d56\u5de5\u5177 LeakCanary.  \u4ee3\u7801:  \u754c\u9762:   \u5728\u7b2c\u4e00\u6b21\u8fdb\u5165\u8be5\u5e94\u7528\u65f6:   \u6309\u4e0bBUTTON, \u7136\u540e\u9000\u51fa\u5e94\u7528:   \u7b2c\u4e8c\u6b21\u8fdb\u5165\u8be5\u5e94\u7528:   \u7b2c\u4e8c\u6b21\u6309\u4e0bBUTTON:   \u7b2c\u4e8c\u6b21\u9000\u51fa\u5e94\u7528:   \u57fa\u4e8e  dumpsys meminfo  \u786e\u8ba4\u5e94\u7528\u6709activity\u6cc4\u9732\u540e, \u5355\u7eaf\u901a\u8fc7UI\u64cd\u4f5c\u57fa\u672c\u4e5f\u53ef\u4ee5\u5224\u65ad\u51fa\u6765\u54ea\u4e2aactivity\u6cc4\u9732, \u66f4\u51c6\u786e\u7684\u6cc4\u9732\u68c0\u6d4b\u5de5\u5177\u662f LeakCanary, \u8be5\u5de5\u5177\u4e3a\u7b2c\u4e09\u65b9\u5de5\u5177.  \n\u5177\u4f53\u7528\u6cd5: https://www.liaohuqiu.net/cn/posts/leak-canary-read-me/  \u8fd8\u662f\u4ee5\u4e0a\u7684\u4f8b\u5b50, \u989d\u5916\u589e\u52a0\u5982\u4e0b\u4ee3\u7801.   \u5728MainActivity\u589e\u52a0\u5982\u4e0b\u4ee3\u7801, \u8be5\u4ee3\u7801\u7684\u542b\u4e49\u662f, \u5728activity\u89e6\u53d1onDestroy\u65f6, \u76d1\u63a7\u8be5activity\u5bf9\u8c61.      @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        LeakApplication.getRefWatcher().watch(this);\n\n    }  \u589e\u52a0application, \u5982\u4e0b:  \u7f16\u8bd1\u8fd0\u884c, \u6267\u884c\u4e0a\u9762\u540c\u6837\u7684\u64cd\u4f5c. \u5728\u901a\u77e5\u4e2d\u5fc3\u6709\u5982\u4e0b\u663e\u793a:   \u70b9\u51fb\u540e\u53ef\u4ee5\u67e5\u770b\u8be6\u7ec6\u7684\u5806\u6808:   \u540c\u6837\u5728logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:", 
            "title": "activity \u6cc4\u9732 "
        }, 
        {
            "location": "/Android-memory-debug/#strictmode", 
            "text": "\u540c\u6837\u662f\u4e0a\u9762\u7684\u4f8b\u5b50, \u4fee\u6539\u4ee3\u7801\u5982\u4e0b, \u589e\u52a0strickmode\u7684\u8c03\u7528:   \u540c\u6837\u7684\u4e0a\u9762\u64cd\u4f5c\u65b9\u6cd5, logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:", 
            "title": "StrictMode\u68c0\u6d4b\u5e94\u7528\u5185\u5b58\u6cc4\u9732 "
        }, 
        {
            "location": "/Android-memory-debug/#libc", 
            "text": "\u5185\u5b58\u6cc4\u9732\u7684\u68c0\u6d4b\u4f9d\u636e\u662f, \u8fdb\u7a0b\u9000\u51fa\u65f6, \u8fd8\u6709\u672a\u91ca\u653e\u7684\u5185\u5b58. \u6240\u4ee5, valgrind\u5305\u62ecbionic libc\u4e2d, \u80fd\u7cbe\u786e\u68c0\u6d4b\u5230\u6cc4\u9732\u7684\u524d\u63d0\u6761\u4ef6\u5c31\u662f\u8fdb\u7a0b\u9000\u51fa. \u4f46\u662f\u8fd9\u4e2a\u5bf9\u4e8e\u7cfb\u7edf\u7ea7\u522b\u7684\u8fdb\u7a0b\u662f\u65e0\u7528\u7684, \u56e0\u4e3a\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u5e76\u4e0d\u4f1a\u9000\u51fa. \u4eceRD\u89d2\u5ea6, \u5224\u65ad\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u662f\u5426\u6cc4\u9732\u7684\u4f9d\u636e\u662f\u5185\u5b58\u662f\u5426\u6301\u7eed\u589e\u957f, \u7279\u522b\u662f\u5728\u538b\u529b\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b. \u6240\u4ee5, \u8fd9\u4e2a\u90e8\u5206\u4ecb\u7ecd\u7684\u5de5\u5177, \u5b9e\u9645\u4e0a\u662f\u6293\u53d6\u4e86\u6301\u7eed\u589e\u957f\u7684\u5185\u5b58\u4fe1\u606f, \u8fd9\u4e9b\u4fe1\u606f, \u53ef\u80fd\u662f\u5185\u5b58\u6cc4\u9732, \u4e5f\u53ef\u80fd\u662f\u8fdb\u7a0b\u6b63\u5e38\u7533\u8bf7\u7684\u5185\u5b58, \u9700\u8981RD\u4ecb\u5165\u5224\u65ad.  \u9644\u4ef6:  Memleak_tools_android.zip  \u4f9d\u8d56\u5de5\u5177:   libc_malloc_debug_leak.so  , bionic\u6e90\u7801\u4e0b, \u9700\u8981\u7f16\u8bd1\u5e76push\u5230\u7cfb\u7edf\u4e2d  libmemleakutils.so , \u4eceandroid\u63d0\u53d6\u5e76\u66f4\u6539. \u4ece\u9644\u4ef6\u6e90\u7801\u4e0b\u8f7d\u7f16\u8bd1, \u9700\u8981push\u5230\u7cfb\u7edf\u4e2d.  addr2func.py, \u8be5\u811a\u672c\u80fd\u81ea\u52a8\u5c06\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808. \u5728\u9644\u4ef6\u4e2d.  memincrease.py, \u8be5\u811a\u672c\u80fd\u5c06\u4e0a\u4e00\u811a\u672c\u7684\u8f93\u51fa, \u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f,  \u6309\u5185\u5b58\u589e\u52a0\u4ece\u5927\u5230\u5c0f\u6392\u5e8f. \u57fa\u672c\u6700\u9876\u4e0a\u7684\u662f\u5b58\u5728\u95ee\u9898\u7684. \u5728\u9644\u4ef6\u4e2d.   \u5c40\u9650:   \u53ea\u80fd\u8c03\u8bd5native\u8fdb\u7a0b.  \u8fdb\u7a0b\u4e0d\u80fd\u91cd\u542f.  \u9700\u8981\u538b\u529b\u6d4b\u8bd5, \u957f\u65f6\u95f4\u8fd0\u884c  \u9700\u8981RD\u4ecb\u5165\u5224\u65ad\u662f\u5426\u5b58\u5728\u6cc4\u9732.   \u7528\u6cd5:   \u5c06libmemleakutils.so\u5e93\u94fe\u63a5\u5230\u88ab\u8c03\u8bd5\u7a0b\u5e8f\u4e2d, \u8c03\u7528\u51fd\u6570 start_memleak_watcher(memstep) , \u5176\u4e2dmemstep\u8868\u793a, pss\u6bcf\u589e\u52a0memstep, \u5219\u6293\u53d6\u4e00\u6b21\u5f53\u524d\u5185\u5b58\u5206\u914d\u4fe1\u606f.  \u5c06libmemleakutils.so \u548c  libc_malloc_debug_leak.so  push\u5230/system/lib/\u4e0b.  \u5c06\u88ab\u8c03\u8bd5\u7a0b\u5e8fpush\u5230 /system/bin/ \u4e0b.  \u8bbe\u7f6e property  libc.debug.malloc.program  \u4e3a \u4f60\u7684\u8c03\u8bd5\u8fdb\u7a0b\u540d\u5b57.  \u8bbe\u7f6e property  libc.debug.malloc  \u4e3a 1  stop \u6216\u8005 kill \u88ab\u8c03\u8bd5\u8fdb\u7a0b.  start \u6216\u8005 \u542f\u52a8 \u88ab\u8c03\u8bd5\u8fdb\u7a0b.  \u538b\u529b\u6d4b\u8bd5\u540e, \u68c0\u67e5 /data/local/tmp/ \u5e95\u4e0b\u5b58\u5728\u6587\u4ef6  mem_snapshot_$pid_$memsize.log , \u4e14\u4e2a\u6570\u5927\u4e8e2\u4e2a(\u8d8a\u591a\u8d8a\u597d).  cp /proc/${pid}/maps /data/local/tmp/  \u5c06 /data/local/tmp/ \u5e95\u4e0b\u6240\u6709\u6587\u4ef6\u590d\u5236\u5230host\u673a\u5668.  \u7528 diff \u547d\u4ee4\u6bd4\u8f83 \u4e24\u4e2a  mem_snapshot_$pid_$memsize.log , \u5e76\u4fdd\u5b58\u8f93\u51fa\u4e3a  diff_$pid_$memsize1_$memsize2.log  \u6267\u884c  ./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_$pid_$memsize1_$memsize2.log   mem_stack_$pid_$memsize1_$memsize2.log , \u8be5\u8fc7\u7a0b\u662f\u5c06diff\u751f\u6210\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808\u4fe1\u606f.  \u6267\u884c  ./memincrease.py mem_stack_$pi_$memsize1_$memsize2.log incr_$pid_$memsize1_$memsize2.log , \u8be5\u8fc7\u7a0b\u662f\u5bf912\u751f\u6210\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f, \u4ece\u5927\u5230\u5c0f\u6392\u5e8f.   \u4f8b\u5b50:   \u8fd0\u884c\u4e00\u4f1a\u513f\u540e, \u5728 /data/local/tmp/\u76ee\u5f55\u4e0b\u5b58\u5728\u6587\u4ef6:  mem_snapshot_2158_1.log\nmem_snapshot_2158_2.log\nmem_snapshot_2158_3.log\nmem_snapshot_2158_4.log  \u5176\u5185\u5bb9\u5982\u4e0b:   Allocation count  5 \n Total memory  6293072 \nsize   5242880 , dup     1 , 0xb6ed36b2, 0xb6f4cd4e, 0xb6f1da44, 0xb6f1de38, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92\nsize   1048576 , dup     1 , 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\nsize      1024 , dup     1 , 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\nsize       580 , dup     1 , 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f510c8, 0xb6f1decc, 0xb6fc838c, 0xb6f4ce68, 0xb6fc8400\nsize        12 , dup     1 , 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f14c46, 0xb6f1dd98, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92  \u6267\u884cdiff\u547d\u4ee4:  # diff ./mem_snapshot_2158_1.log ./mem_snapshot_2158_2.log   diff_2158_1_2.log  #   # diff ./mem_snapshot_2158_3.log ./mem_snapshot_2158_4.log   diff_2158_3_4.log  #   \u5f97\u5230\u4e00\u4e2aPSS\u4ece1M\u589e\u957f\u52302M\u548c3M\u589e\u957f\u52304M\u7684\u4e24\u4e2adiff\u6587\u4ef6. \u5185\u5bb9\u5982\u4e0b:  2c2   Total memory 6293072\n---   Total memory 7342672\n4,5c4,5  size  1048576, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400  size     1024, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\n---  size  1048576, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400  size     1024, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400  \n\u6267\u884c addr2func.py :  # ./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_2158_3_4.log   mem_stack_2158_3_4.log   \u751f\u6210\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b:  2c2                                                                                                                                                                               [ 0 /59466 ]    Total memory  8392272 \n\n---   Total memory  9441872  4 ,5c4,5  size   1048576 , dup     3 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  size      1024 , dup     3 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n---  size   1048576 , dup     4 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  size      1024 , dup     4 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  \u6240\u6709\u7684\u5730\u5740\u88ab\u8f6c\u6362\u6210\u4e86\u961f\u957f. \n\u6700\u540e\u6267\u884c memincrease.py :  ./memincrease.py mem_stack_2158_3_4.log incr_2158_3_4.log  \u751f\u6210\u7684\u6587\u4ef6 incr_2158_3_4.log \u5185\u5bb9\u5982\u4e0b:  Memory increase  1048576  bytes                    ### \u5185\u5b58\u589e\u52a0\u4e86 1048576 bytes \n98990365afa0d71d62949620cc7e3753f386e4e3\nold size  1048576  count  3 , total memory  3145728         ### \u4ece 3145728 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n98990365afa0d71d62949620cc7e3753f386e4e3\nnew size  1048576  count  4 , total memory  4194304        ### \u589e\u52a0\u5230 4194304 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\nMemory increase  1024  bytes\n833f23c991cc75facaa41fb74f7466b91c27917b\nold size  1024  count  3 , total memory  3072 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n833f23c991cc75facaa41fb74f7466b91c27917b\nnew size  1024  count  4 , total memory  4096 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  \u57fa\u672c\u4e0a, \u5c06\u6700\u9876\u4e0a\u7684\u51e0\u4e2a\u5806\u6808\u786e\u8ba4\u4e0b\u662f\u5426\u5185\u5b58\u6cc4\u9732\u5373\u53ef.  \u7279\u522b\u6ce8\u610f:   \u7c7b\u6cc4\u9732\u65f6, \u5728\u5806\u6808\u4e0a\u7684\u8868\u73b0\u662f\u5176\u6210\u5458\u5185\u5b58\u6cc4\u9732. \u9700\u8981\u67e5\u770b\u5806\u6808\u662f\u5426\u6709\u8be5\u7c7b\u5bf9\u8c61\u7684new\u65b9\u6cd5, \u5e76\u4e14\u8be5\u65b9\u6cd5\u662f\u5426\u5728\u591a\u5904\u5b58\u5728.", 
            "title": "\u57fa\u4e8elibc\u8c03\u8bd5\u5185\u5b58\u6cc4\u9732 "
        }, 
        {
            "location": "/Android-memory-debug/#valgrind", 
            "text": "\u573a\u666f: \u5bf9\u4e8e\u53ef\u9000\u51fa\u7684\u8fdb\u7a0b\u8fdb\u884c\u8c03\u8bd5\u6bd4\u8f83\u5408\u9002, \u53ef\u4ee5\u5bf9\u5e94\u7528\u7684native\u4ee3\u7801\u8fdb\u884c\u8c03\u8bd5.  \u76ee\u524dhdtv\u4ee3\u7801\u4e0a\u7684 valgrind \u65e0\u6cd5\u83b7\u53d6\u88ab\u8c03\u8bd5\u8fdb\u7a0b\u7684\u5806\u6808, \u53ea\u80fd\u83b7\u53d6\u5b83\u81ea\u5df1\u5e93\u7684\u5806\u6808, \u5b58\u5728\u95ee\u9898. \u6682\u65f6\u65e0\u6cd5\u4f7f\u7528.", 
            "title": "valgrind \u8c03\u8bd5\u5185\u5b58\u6cc4\u9732"
        }, 
        {
            "location": "/slackbot/", 
            "text": "slackbot \u6846\u67b6\n\n\nslackbot, \u987e\u540d\u601d\u4e49, \u662f\u57fa\u4e8eslack\u7684bot\u7a0b\u5e8f, \u4f7f\u7528python\u5b9e\u73b0. \u4e2a\u4eba\u5728\nlins05/slackbot\n\u7684\u57fa\u7840\u4e0a, \u8fdb\u884c\u4e86\u4e8c\u6b21\u5f00\u53d1,\u7528\u4e8e\u6811\u8393\u6d3e\u7684\u63a7\u5236\u4e2d\u5fc3\u548c\u667a\u80fd\u5bb6\u5c45\u7684\u63a7\u5236\u4e2d\u5fc3. \u6700\u521d\u9009\u4e2d\u5b83\u7684\u539f\u56e0\u662f, \u5728\u7f51\u4e0a\u770b\u5230\u5927\u91cf\u7684\u4f8b\u5b50\u57fa\u4e8eslack\u505a\u8fdc\u7a0b\u8fd0\u7ef4\u7684\u4f8b\u5b50.\n\n\n\u4e0b\u6587\u4ecb\u7ecd\u7684slackbot\u6846\u67b6, \u662f\u5305\u542b\nlins05/slackbot\n\u548c\u4e2a\u4eba\u4e8c\u6b21\u5f00\u53d1\u4e4b\u540e\u7684\u5185\u5bb9.\u4e8c\u6b21\u5f00\u53d1\u7684\u6838\u5fc3\u5728\u4e8e\u63d2\u4ef6\u548c\u7ec4\u4ef6\u6269\u5145.\n\n\n\u7531\u4e8e\u7528\u4e86\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u6a21\u5f0f, \u5bfc\u81f4\u53ef\u4ee5\u6dfb\u52a0\u4efb\u610f\u591a\u529f\u80fd\u7684\u63d2\u4ef6\u548c\u7ec4\u4ef6. \u6240\u4ee5, \u529f\u80fd\u8fd8\u5728\u6301\u7eed\u5f00\u53d1\u4e2d.\n\n\n\u8ba1\u5212: \u63d2\u4ef6\u548c\u7ec4\u4ef6\u8ddfpython-fire\u7ed3\u5408, \u671f\u671b\u5b9e\u73b0\u81ea\u52a8\u89e3\u6790\u7ec4\u4ef6\u7684\u63a5\u53e3, \u800c\u4e0d\u9700\u8981\u4e13\u95e8\u5c01\u88c5\u63d2\u4ef6.\n\n\n\u6846\u67b6\u56fe\n\n\n\n\n\u8be5\u6a21\u5f0f\u662f\u5178\u578b\u7684\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b, \u751f\u4ea7\u8005\u67092\u4e2a, \u4e00\u4e2a\u662f\u4eceslack\u5b98\u7f51\u63a5\u6536\u6d88\u606f\u5e76\u653e\u5165\u961f\u5217, \u53e6\u4e00\u4e2a\u662f\u5b9a\u65f6\u4efb\u52a1,\u9694\u4e00\u5b9a\u65f6\u95f4\u5f80\u961f\u5217\u4e2d\u5b58\u5165\u6307\u4ee4. \u6d88\u8d39\u8005\u670910\u4e2a(10\u7ebf\u7a0b\u7b49\u5f85\u5728\u961f\u5217\u4e0a), \u5176\u529f\u80fd\u5c31\u662f\u5206\u522b\u5904\u7406\u5b9a\u65f6\u4efb\u52a1, \u5404\u79cd\u6d88\u606f.\n\n\n\u63d2\u4ef6\u7c7b\u662f\u7531PluginManager\u7ba1\u7406\u548c\u52a0\u8f7d, \u4ece\u63d2\u4ef6\u76ee\u5f55\u4e2d\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u89c4\u5219\u52a0\u8f7d\u6307\u5b9a\u7684\u63d2\u4ef6\u7c7b, \u5e76\u6839\u636e\u63d2\u4ef6\u7c7b\u7684\u4fee\u9970\u51fd\u6570\u83b7\u53d6\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570(\u5b9a\u65f6\u5904\u7406\u51fd\u6570, \u6d88\u606f\u5904\u7406\u51fd\u6570).\n\n\n\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u5b9e\u73b0\n\n\n\u7531\u4e8e\u4f7f\u7528\u4e86\u4fee\u9970\u51fd\u6570, \u5219\u88ab\u8c03\u7528\u51fd\u6570\u65e0\u6cd5\u662f\u7c7b\u6210\u5458\u51fd\u6570. \u867d\u7136\u5728\u5199\u63d2\u4ef6\u4e0a\u66f4\u65b9\u4fbf, \u4f46\u662f\u5bf9\u4e8e\u63d2\u4ef6\u529f\u80fd\u5f3a\u5927\u7684\u5b9e\u73b0, \u5219\u9700\u8981\u989d\u5916\u5c01\u88c5.\n\n\n\u5728\u6b64\u57fa\u7840\u4e0a, \u65b0\u6dfb\u52a0\u4e86\u7ec4\u4ef6\u6982\u5ff5, \u7ec4\u4ef6\u53ef\u4ee5\u662f\u4efb\u610f\u7684\u7b2c\u4e09\u65b9\u5e93\u6216\u5b9e\u73b0(\u7eaf\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0), \u7136\u540e\u5728\u63d2\u4ef6\u76ee\u5f55\u4e0b\u5b9e\u73b0\u5bf9\u5e94\u7684\u63d2\u4ef6\u8c03\u7528\u8be5\u7ec4\u4ef6\u7ec4\u6210\u529f\u80fd. \u8fd9\u5c31\u662fpi\u4e0a\u667a\u80fd\u5bb6\u5c45\u63a7\u5236\u4e2d\u7684\u57fa\u7840. \u540e\u7eed\u7684\u63a7\u5236\u5b9e\u73b0\u90fd\u5728\u8be5\u57fa\u7840\u4e0a\u6269\u5c55, \u7279\u522b\u662f\u5b9a\u65f6\u4efb\u52a1.\n\n\n\u7ec4\u4ef6\u4e2d\u4f1a\u51fa\u73b0\u591a\u4e2a\u6a21\u5757\u88ab\u4e0d\u540c\u63d2\u4ef6\u8c03\u7528\u7684\u573a\u666f, \u8fd9\u5c31\u9700\u8981\u7ec4\u4ef6\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f(\u7ec4\u4ef6\u521d\u59cb\u5316\u53c2\u6570\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a). \u5355\u4f8b\u6a21\u5f0f\u7684\u5b9e\u73b0,\u5728python2\u548cpython3\u4e0a\u4e0d\u540c, \u7531\u4e8e\u76ee\u524d\u5168\u4f53\u5207\u6362\u5230python3\u4e0a, \u5b9e\u73b0\u4e0a\u4f7f\u7528\u4e86metaclass, \u4f46\u662f\u5b9e\u9645\u4e0a\u91cd\u5199new\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e5f\u662f\u53ef\u4ee5\u7684. \u7279\u522b\u6ce8\u610f, \u5355\u4f8b\u5b9e\u9645\u4e0a\u662f\u76f4\u63a5\u8fd4\u56de\u4e86\u5185\u5b58\u5bf9\u8c61, \u4f46\u4f9d\u7136\u4f1a\u7ee7\u7eed\u540e\u7eed\u7684\n__init__\n, \u6240\u4ee5\u5fc5\u987b\u6dfb\u52a0\u6807\u8bb0\u6765\u8868\u793a\u5df2\u7ecf\u521d\u59cb\u5316\u53d8\u91cf.\n\n\n\u63d2\u4ef6\u5217\u8868\n\n\n\u667a\u80fd\u5bb6\u5c45\u7684\u4e3b\u63a7\u4e3ahomeassistant, \u8fd9\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u6846\u67b6, \u5e76\u4e14\u652f\u6301\u5f00\u6e90\u534f\u8bae, \u5c0f\u7c73\u7cfb\u5217\u548cyeelight\u7cfb\u5217\u5927\u90e8\u5206\u90fd\u80fd\u76f4\u63a5\u6dfb\u52a0, \u5c11\u91cf\u9700\u8981hack\u4e0b.\n\n\n\u6240\u6709\u667a\u80fd\u5bb6\u5c45\u6a21\u5757\u5b58\u653e\u5728 \ncomponent/ha/\n, slackbot\u4e0ehomeassistant\u901a\u8fc7rest API \u901a\u4fe1. \u6240\u6709\u7684\u8bf7\u6c42\u90fd\u662fslackbot\u8bf7\u6c42\u53d1\u8d77. \n\n\n\u6240\u6709\u7684\u667a\u80fd\u5bb6\u5c45\u8bbe\u5907\u90fd\u53ef\u4ee5\u901a\u8fc7slackbot\u8fdc\u7a0b\u63a7\u5236\u5f00\u5173.\n\n\n\u540e\u9762\u5217\u51fa\u7684\u662f\u7ec4\u4ef6\u5217\u8868, \u5217\u8868\u4e2d\u7ec4\u4ef6\u7ec4\u5408\u4e0d\u540c\u53ef\u4ee5\u4ea7\u751f\u4e0d\u540c\u7684\u63d2\u4ef6, \u6bd4\u5982:\n\n\n\n\n\u65e5\u7167\u72b6\u6001 + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 + \u706f\u5177\u63a7\u5236 = \u592a\u9633\u4e0b\u5c71\u5ba2\u5385\u6709\u4eba\u81ea\u52a8\u5f00\u706f, \u5ba2\u5385\u6ca1\u4eba\u81ea\u52a8\u5173\u706f\n\n\n\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 = \u5bb6\u91cc\u6ca1\u4eba, \u4e14\u5b9a\u65f6\u4efb\u52a1\u5230, \u81ea\u52a8\u5f00\u59cb\u626b\u5730\n\n\n\u5f55\u5236\u6a21\u5757 + \u64ad\u653e\u6a21\u5757 + \u8bed\u97f3\u8f6c\u6587\u5b57\u6a21\u5757 + \u6587\u5b57\u8f6c\u8bed\u97f3\u6a21\u5757 = \u8ddf\u795e\u7ecf\u51b0\u804a\u5929\u5e76\u53d1\u5e03\u4efb\u52a1\u7684\u529f\u80fd\n\n\n\n\nhomeassistant\u63d0\u4f9b\u7684\u529f\u80fd\u5217\u8868\n\n\n\u5bb6\u5ead\u4eba\u5458\u5728\u5bb6\u72b6\u6001\n\n\n\u83b7\u53d6\u5bb6\u5ead\u4eba\u5458\u662f\u5426\u5728\u5bb6, \u8be5\u5b9e\u73b0\u5176\u5b9e\u662f\u68c0\u6d4b\u5bb6\u5ead\u6210\u5458\u624b\u673a\u7684mac\u5730\u5740\u5224\u65ad\u662f\u5426\u8fde\u63a5\u4e0a\u8def\u7531\u5668.\n\n\n\u706f\u5177\u63a7\u5236\n\n\n\u8fdc\u7a0b\u63a7\u5236\u6307\u5b9a\u706f\u5177\u7684\u5f00\u5173\n\n\n\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba\n\n\n\u63a5\u5165\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba, \u9ed8\u8ba4\u6bcf\u5468\u4e00\u4e09\u4e94\u542f\u52a8\u6e05\u626b, \u4f4624\u5c0f\u65f6\u5185\u4e0d\u91cd\u542f\u542f\u52a8\u6e05\u626b.\n\n\n\u65e5\u7167\u72b6\u6001\n\n\n\u4e5f\u5c31\u662f\u592a\u9633\u4e0b\u5c71\u4e0e\u5426\u7684\u72b6\u6001.\n\n\n\u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001\n\n\n\u8be5\u72b6\u6001\u7684\u5b58\u5728\u610f\u4e49\u662f, \u4e2a\u4eba\u671f\u671b\u5bb6\u5ead\u6210\u5458\u5728\u5ba2\u5385\u65f6, \u81ea\u52a8\u6253\u5f00\u5ba2\u5385\u706f, \u79bb\u5f00\u5ba2\u5385\u65f6, \u81ea\u52a8\u5173\u95ed\u5ba2\u5385\u7684.\n\n\n\u5728\u521d\u671f\u5b66\u4e60\u9636\u6bb5, \u89e3\u9664\u5230\u7684\u4e3b\u8981\u6709\u84dd\u7259\u5e7f\u64ad\u548cRFID, \u90fd\u662f\u901a\u8fc7\u4e09\u70b9\u6cd5\u6765\u5b9a\u4f4d(\u76f8\u5173\u4fe1\u606f\u53ef\u4ee5\u767e\u5ea6\u5ba4\u5185\u5b9a\u4f4d). \u9996\u5148, \u57fa\u4e8e\u82af\u7247\u7684\u5b9a\u4f4d(\u4ed3\u5e93\u5b9a\u4f4d)\u4e0d\u9002\u5408\u5bb6\u5ead\u4f7f\u7528, \u56e0\u4e3a\u5bb6\u5ead\u4e0d\u53ef\u80fd\u4f1a\u5e26\u7740\u5c04\u9891\u82af\u7247.\u800c\u84dd\u7259\u5e7f\u64ad\u53ea\u6709\u63a5\u6536\u7aef\u624d\u80fd\u77e5\u9053\u81ea\u5df1\u4e0e\u53d1\u9001\u7aef\u7684\u8ddd\u79bb(\u4fe1\u53f7\u8870\u51cf), \u4e14\u9700\u8981\u4e09\u4e2a\u84dd\u7259\u5b9a\u4f4d. \u8003\u8651\u5230\u4e0e\u84dd\u7259\u7c7b\u4f3c, \u4f46\u6536\u5230\u73af\u5883\u5f71\u54cd\u66f4\u5927\u7684wifi, \u6d4b\u8bd5\u5c0f\u7c73\u8def\u7531\u5668\u4e0a\u53ef\u4ee5\u83b7\u53d6\u5230\u76ee\u6807\u624b\u673a\u7684\u4fe1\u53f7\u5f3a\u5ea6, \u5219\u51b3\u5b9a\u6539\u7528wifi\u5212\u5b9a\u4e24\u4e2a\u5706\u5f27\u533a\u57df. \u5c0f\u5706\u5f27\u533a\u57df\u5185\u5f00\u706f, \u5927\u5706\u5f27\u533a\u57df\u5916\u5173\u706f, \u800c\u4e24\u4e2a\u5706\u5f27\u533a\u57df\u4e2d\u95f4\u4fdd\u6301\u539f\u72b6\u6001\u4e0d\u53d8. \n\n\n\n\u804a\u5929\u673a\u5668\u4eba\n\n\n\u5206\u522b\u6709 ibot, tuling, xiaoi, emotibot. \u4f46\u4e0d\u662f\u6240\u6709\u7684\u90fd\u542f\u7528, \u5728\u804a\u5929\u63d2\u4ef6\u4e2d, \u9009\u62e9\u5176\u4e2d\u7684\u4e00\u4e2a\u542f\u52a8\u5e76\u4ea4\u4e92.\n\n\n\u6587\u4ef6\u7ba1\u7406\u5668\n\n\n\u6240\u8c13\u7684\u6587\u4ef6\u7ba1\u7406\u5668, \u53ea\u662f\u4e00\u4e2a\u6587\u4ef6\u7d22\u5f15\u52a0\u4e0a\u6587\u4ef6\u67e5\u627e\u7684\u5de5\u5177, \u989d\u5916\u589e\u52a0\u4e86\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u7684\u529f\u80fd. \u6587\u4ef6\u7d22\u5f15\u4f7f\u7528\u7684\u662fjieba\u548cwhoos. \u53ef\u4ee5\u901a\u8fc7slackbot\u5feb\u901f\u67e5\u627e\u67d0\u4e2a\u6587\u4ef6\u6216\u8005\u67d0\u672c\u4e66(\u7535\u5b50\u4e66\u591a\u5230\u81ea\u5df1\u4e5f\u4e0d\u77e5\u9053\u6709\u591a\u5c11\u672c).\n\n\n\u8ffd\u5267\u6a21\u5757\n\n\n\u4e0d\u53ea\u662f\u8ffd\u5267, \u4e5f\u662f\u8ffd\u7535\u5f71. \u7535\u5f71\u8c46\u74e37.0\u4ee5\u4e0a\u624d\u63a8\u9001, \u800c\u5267\u662f\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u65e5\u5267, \u5168\u63a8((\u2299\ufe4f\u2299)b),\u540e\u6765\u56e0\u4e3a\u67d0\u4e9b\u6bd4\u8f83\u65e0\u5948\u7684\u539f\u56e0,  \u8fd9\u8d27\u5f00\u59cb\u63a8\u4e00\u4e9b\u8001\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u5267, \u5c31\u6309\u9700\u52a0\u4e86\u4e2a\u529f\u80fd, \u9ed1\u767d\u540d\u5355. \u679c\u7136\u8001\u5a46\u662f\u7b2c\u4e00\u751f\u4ea7\u529b.\n\n\n\u5c0f\u8bf4\u6a21\u5757\n\n\n\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u722c\u866b, \u4e0d\u505c\u5730\u722c\u53d6\u6307\u5b9a\u5c0f\u8bf4\u5224\u65ad\u662f\u5426\u5b58\u5728\u66f4\u65b0. \u5728\u4e2a\u4eba\u7684\u4e3b\u9875\u4ecb\u7ecd\u4e2d\u4ecb\u7ecd\u4e86\u559c\u6b22\u5386\u53f2\u5c0f\u8bf4, \u6240\u4ee5\u5927\u90e8\u5206\u90fd\u662f\u5386\u53f2\u7c7b\u5c0f\u8bf4\n\n\n\u64ad\u653e\u6a21\u5757\n\n\n\u8c03\u7528mplayer\u64ad\u653e\n\n\n\u5f55\u5236\u6a21\u5757\n\n\n\u8c03\u7528arecord\u5f55\u97f3\n\n\n\u8bed\u97f3\u8f6c\u6587\u5b57\n\n\n\u7528\u4e86\u767e\u5ea6\u7684api\n\n\n\u6587\u5b57\u8f6c\u8bed\n\n\n\u7528\u4e86iflytek\u7684API, \u4e0d\u5f97\u4e0d\u8bf4\u5b83\u4eec\u5bb6\u8bed\u97f3\u505a\u5f97\u597d, \u5404\u79cd\u4eba\u7269\u53ef\u9009.\n\n\n\u5de5\u5177\n\n\n\u5305\u542b\u4e86\u6a21\u4eff\u6d4f\u89c8\u5668\u6253\u5f00\u7684\u4ee3\u7801(cookie\u7b49), \u5b9e\u73b0\u4e86\u4ee3\u7406\u6c60, \u5e76\u53ef\u4ee3\u7406\u8bbf\u95ee.", 
            "title": "slackbot\u8be6\u7ec6\u8bf4\u660e"
        }, 
        {
            "location": "/slackbot/#slackbot", 
            "text": "slackbot, \u987e\u540d\u601d\u4e49, \u662f\u57fa\u4e8eslack\u7684bot\u7a0b\u5e8f, \u4f7f\u7528python\u5b9e\u73b0. \u4e2a\u4eba\u5728 lins05/slackbot \u7684\u57fa\u7840\u4e0a, \u8fdb\u884c\u4e86\u4e8c\u6b21\u5f00\u53d1,\u7528\u4e8e\u6811\u8393\u6d3e\u7684\u63a7\u5236\u4e2d\u5fc3\u548c\u667a\u80fd\u5bb6\u5c45\u7684\u63a7\u5236\u4e2d\u5fc3. \u6700\u521d\u9009\u4e2d\u5b83\u7684\u539f\u56e0\u662f, \u5728\u7f51\u4e0a\u770b\u5230\u5927\u91cf\u7684\u4f8b\u5b50\u57fa\u4e8eslack\u505a\u8fdc\u7a0b\u8fd0\u7ef4\u7684\u4f8b\u5b50.  \u4e0b\u6587\u4ecb\u7ecd\u7684slackbot\u6846\u67b6, \u662f\u5305\u542b lins05/slackbot \u548c\u4e2a\u4eba\u4e8c\u6b21\u5f00\u53d1\u4e4b\u540e\u7684\u5185\u5bb9.\u4e8c\u6b21\u5f00\u53d1\u7684\u6838\u5fc3\u5728\u4e8e\u63d2\u4ef6\u548c\u7ec4\u4ef6\u6269\u5145.  \u7531\u4e8e\u7528\u4e86\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u6a21\u5f0f, \u5bfc\u81f4\u53ef\u4ee5\u6dfb\u52a0\u4efb\u610f\u591a\u529f\u80fd\u7684\u63d2\u4ef6\u548c\u7ec4\u4ef6. \u6240\u4ee5, \u529f\u80fd\u8fd8\u5728\u6301\u7eed\u5f00\u53d1\u4e2d.  \u8ba1\u5212: \u63d2\u4ef6\u548c\u7ec4\u4ef6\u8ddfpython-fire\u7ed3\u5408, \u671f\u671b\u5b9e\u73b0\u81ea\u52a8\u89e3\u6790\u7ec4\u4ef6\u7684\u63a5\u53e3, \u800c\u4e0d\u9700\u8981\u4e13\u95e8\u5c01\u88c5\u63d2\u4ef6.", 
            "title": "slackbot \u6846\u67b6"
        }, 
        {
            "location": "/slackbot/#_1", 
            "text": "\u8be5\u6a21\u5f0f\u662f\u5178\u578b\u7684\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b, \u751f\u4ea7\u8005\u67092\u4e2a, \u4e00\u4e2a\u662f\u4eceslack\u5b98\u7f51\u63a5\u6536\u6d88\u606f\u5e76\u653e\u5165\u961f\u5217, \u53e6\u4e00\u4e2a\u662f\u5b9a\u65f6\u4efb\u52a1,\u9694\u4e00\u5b9a\u65f6\u95f4\u5f80\u961f\u5217\u4e2d\u5b58\u5165\u6307\u4ee4. \u6d88\u8d39\u8005\u670910\u4e2a(10\u7ebf\u7a0b\u7b49\u5f85\u5728\u961f\u5217\u4e0a), \u5176\u529f\u80fd\u5c31\u662f\u5206\u522b\u5904\u7406\u5b9a\u65f6\u4efb\u52a1, \u5404\u79cd\u6d88\u606f.  \u63d2\u4ef6\u7c7b\u662f\u7531PluginManager\u7ba1\u7406\u548c\u52a0\u8f7d, \u4ece\u63d2\u4ef6\u76ee\u5f55\u4e2d\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u89c4\u5219\u52a0\u8f7d\u6307\u5b9a\u7684\u63d2\u4ef6\u7c7b, \u5e76\u6839\u636e\u63d2\u4ef6\u7c7b\u7684\u4fee\u9970\u51fd\u6570\u83b7\u53d6\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570(\u5b9a\u65f6\u5904\u7406\u51fd\u6570, \u6d88\u606f\u5904\u7406\u51fd\u6570).", 
            "title": "\u6846\u67b6\u56fe"
        }, 
        {
            "location": "/slackbot/#_2", 
            "text": "\u7531\u4e8e\u4f7f\u7528\u4e86\u4fee\u9970\u51fd\u6570, \u5219\u88ab\u8c03\u7528\u51fd\u6570\u65e0\u6cd5\u662f\u7c7b\u6210\u5458\u51fd\u6570. \u867d\u7136\u5728\u5199\u63d2\u4ef6\u4e0a\u66f4\u65b9\u4fbf, \u4f46\u662f\u5bf9\u4e8e\u63d2\u4ef6\u529f\u80fd\u5f3a\u5927\u7684\u5b9e\u73b0, \u5219\u9700\u8981\u989d\u5916\u5c01\u88c5.  \u5728\u6b64\u57fa\u7840\u4e0a, \u65b0\u6dfb\u52a0\u4e86\u7ec4\u4ef6\u6982\u5ff5, \u7ec4\u4ef6\u53ef\u4ee5\u662f\u4efb\u610f\u7684\u7b2c\u4e09\u65b9\u5e93\u6216\u5b9e\u73b0(\u7eaf\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0), \u7136\u540e\u5728\u63d2\u4ef6\u76ee\u5f55\u4e0b\u5b9e\u73b0\u5bf9\u5e94\u7684\u63d2\u4ef6\u8c03\u7528\u8be5\u7ec4\u4ef6\u7ec4\u6210\u529f\u80fd. \u8fd9\u5c31\u662fpi\u4e0a\u667a\u80fd\u5bb6\u5c45\u63a7\u5236\u4e2d\u7684\u57fa\u7840. \u540e\u7eed\u7684\u63a7\u5236\u5b9e\u73b0\u90fd\u5728\u8be5\u57fa\u7840\u4e0a\u6269\u5c55, \u7279\u522b\u662f\u5b9a\u65f6\u4efb\u52a1.  \u7ec4\u4ef6\u4e2d\u4f1a\u51fa\u73b0\u591a\u4e2a\u6a21\u5757\u88ab\u4e0d\u540c\u63d2\u4ef6\u8c03\u7528\u7684\u573a\u666f, \u8fd9\u5c31\u9700\u8981\u7ec4\u4ef6\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f(\u7ec4\u4ef6\u521d\u59cb\u5316\u53c2\u6570\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a). \u5355\u4f8b\u6a21\u5f0f\u7684\u5b9e\u73b0,\u5728python2\u548cpython3\u4e0a\u4e0d\u540c, \u7531\u4e8e\u76ee\u524d\u5168\u4f53\u5207\u6362\u5230python3\u4e0a, \u5b9e\u73b0\u4e0a\u4f7f\u7528\u4e86metaclass, \u4f46\u662f\u5b9e\u9645\u4e0a\u91cd\u5199new\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e5f\u662f\u53ef\u4ee5\u7684. \u7279\u522b\u6ce8\u610f, \u5355\u4f8b\u5b9e\u9645\u4e0a\u662f\u76f4\u63a5\u8fd4\u56de\u4e86\u5185\u5b58\u5bf9\u8c61, \u4f46\u4f9d\u7136\u4f1a\u7ee7\u7eed\u540e\u7eed\u7684 __init__ , \u6240\u4ee5\u5fc5\u987b\u6dfb\u52a0\u6807\u8bb0\u6765\u8868\u793a\u5df2\u7ecf\u521d\u59cb\u5316\u53d8\u91cf.", 
            "title": "\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u5b9e\u73b0"
        }, 
        {
            "location": "/slackbot/#_3", 
            "text": "\u667a\u80fd\u5bb6\u5c45\u7684\u4e3b\u63a7\u4e3ahomeassistant, \u8fd9\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u6846\u67b6, \u5e76\u4e14\u652f\u6301\u5f00\u6e90\u534f\u8bae, \u5c0f\u7c73\u7cfb\u5217\u548cyeelight\u7cfb\u5217\u5927\u90e8\u5206\u90fd\u80fd\u76f4\u63a5\u6dfb\u52a0, \u5c11\u91cf\u9700\u8981hack\u4e0b.  \u6240\u6709\u667a\u80fd\u5bb6\u5c45\u6a21\u5757\u5b58\u653e\u5728  component/ha/ , slackbot\u4e0ehomeassistant\u901a\u8fc7rest API \u901a\u4fe1. \u6240\u6709\u7684\u8bf7\u6c42\u90fd\u662fslackbot\u8bf7\u6c42\u53d1\u8d77.   \u6240\u6709\u7684\u667a\u80fd\u5bb6\u5c45\u8bbe\u5907\u90fd\u53ef\u4ee5\u901a\u8fc7slackbot\u8fdc\u7a0b\u63a7\u5236\u5f00\u5173.  \u540e\u9762\u5217\u51fa\u7684\u662f\u7ec4\u4ef6\u5217\u8868, \u5217\u8868\u4e2d\u7ec4\u4ef6\u7ec4\u5408\u4e0d\u540c\u53ef\u4ee5\u4ea7\u751f\u4e0d\u540c\u7684\u63d2\u4ef6, \u6bd4\u5982:   \u65e5\u7167\u72b6\u6001 + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 + \u706f\u5177\u63a7\u5236 = \u592a\u9633\u4e0b\u5c71\u5ba2\u5385\u6709\u4eba\u81ea\u52a8\u5f00\u706f, \u5ba2\u5385\u6ca1\u4eba\u81ea\u52a8\u5173\u706f  \u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 = \u5bb6\u91cc\u6ca1\u4eba, \u4e14\u5b9a\u65f6\u4efb\u52a1\u5230, \u81ea\u52a8\u5f00\u59cb\u626b\u5730  \u5f55\u5236\u6a21\u5757 + \u64ad\u653e\u6a21\u5757 + \u8bed\u97f3\u8f6c\u6587\u5b57\u6a21\u5757 + \u6587\u5b57\u8f6c\u8bed\u97f3\u6a21\u5757 = \u8ddf\u795e\u7ecf\u51b0\u804a\u5929\u5e76\u53d1\u5e03\u4efb\u52a1\u7684\u529f\u80fd", 
            "title": "\u63d2\u4ef6\u5217\u8868"
        }, 
        {
            "location": "/slackbot/#homeassistant", 
            "text": "", 
            "title": "homeassistant\u63d0\u4f9b\u7684\u529f\u80fd\u5217\u8868"
        }, 
        {
            "location": "/slackbot/#_4", 
            "text": "\u83b7\u53d6\u5bb6\u5ead\u4eba\u5458\u662f\u5426\u5728\u5bb6, \u8be5\u5b9e\u73b0\u5176\u5b9e\u662f\u68c0\u6d4b\u5bb6\u5ead\u6210\u5458\u624b\u673a\u7684mac\u5730\u5740\u5224\u65ad\u662f\u5426\u8fde\u63a5\u4e0a\u8def\u7531\u5668.", 
            "title": "\u5bb6\u5ead\u4eba\u5458\u5728\u5bb6\u72b6\u6001"
        }, 
        {
            "location": "/slackbot/#_5", 
            "text": "\u8fdc\u7a0b\u63a7\u5236\u6307\u5b9a\u706f\u5177\u7684\u5f00\u5173", 
            "title": "\u706f\u5177\u63a7\u5236"
        }, 
        {
            "location": "/slackbot/#_6", 
            "text": "\u63a5\u5165\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba, \u9ed8\u8ba4\u6bcf\u5468\u4e00\u4e09\u4e94\u542f\u52a8\u6e05\u626b, \u4f4624\u5c0f\u65f6\u5185\u4e0d\u91cd\u542f\u542f\u52a8\u6e05\u626b.", 
            "title": "\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba"
        }, 
        {
            "location": "/slackbot/#_7", 
            "text": "\u4e5f\u5c31\u662f\u592a\u9633\u4e0b\u5c71\u4e0e\u5426\u7684\u72b6\u6001.", 
            "title": "\u65e5\u7167\u72b6\u6001"
        }, 
        {
            "location": "/slackbot/#_8", 
            "text": "\u8be5\u72b6\u6001\u7684\u5b58\u5728\u610f\u4e49\u662f, \u4e2a\u4eba\u671f\u671b\u5bb6\u5ead\u6210\u5458\u5728\u5ba2\u5385\u65f6, \u81ea\u52a8\u6253\u5f00\u5ba2\u5385\u706f, \u79bb\u5f00\u5ba2\u5385\u65f6, \u81ea\u52a8\u5173\u95ed\u5ba2\u5385\u7684.  \u5728\u521d\u671f\u5b66\u4e60\u9636\u6bb5, \u89e3\u9664\u5230\u7684\u4e3b\u8981\u6709\u84dd\u7259\u5e7f\u64ad\u548cRFID, \u90fd\u662f\u901a\u8fc7\u4e09\u70b9\u6cd5\u6765\u5b9a\u4f4d(\u76f8\u5173\u4fe1\u606f\u53ef\u4ee5\u767e\u5ea6\u5ba4\u5185\u5b9a\u4f4d). \u9996\u5148, \u57fa\u4e8e\u82af\u7247\u7684\u5b9a\u4f4d(\u4ed3\u5e93\u5b9a\u4f4d)\u4e0d\u9002\u5408\u5bb6\u5ead\u4f7f\u7528, \u56e0\u4e3a\u5bb6\u5ead\u4e0d\u53ef\u80fd\u4f1a\u5e26\u7740\u5c04\u9891\u82af\u7247.\u800c\u84dd\u7259\u5e7f\u64ad\u53ea\u6709\u63a5\u6536\u7aef\u624d\u80fd\u77e5\u9053\u81ea\u5df1\u4e0e\u53d1\u9001\u7aef\u7684\u8ddd\u79bb(\u4fe1\u53f7\u8870\u51cf), \u4e14\u9700\u8981\u4e09\u4e2a\u84dd\u7259\u5b9a\u4f4d. \u8003\u8651\u5230\u4e0e\u84dd\u7259\u7c7b\u4f3c, \u4f46\u6536\u5230\u73af\u5883\u5f71\u54cd\u66f4\u5927\u7684wifi, \u6d4b\u8bd5\u5c0f\u7c73\u8def\u7531\u5668\u4e0a\u53ef\u4ee5\u83b7\u53d6\u5230\u76ee\u6807\u624b\u673a\u7684\u4fe1\u53f7\u5f3a\u5ea6, \u5219\u51b3\u5b9a\u6539\u7528wifi\u5212\u5b9a\u4e24\u4e2a\u5706\u5f27\u533a\u57df. \u5c0f\u5706\u5f27\u533a\u57df\u5185\u5f00\u706f, \u5927\u5706\u5f27\u533a\u57df\u5916\u5173\u706f, \u800c\u4e24\u4e2a\u5706\u5f27\u533a\u57df\u4e2d\u95f4\u4fdd\u6301\u539f\u72b6\u6001\u4e0d\u53d8.", 
            "title": "\u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001"
        }, 
        {
            "location": "/slackbot/#_9", 
            "text": "\u5206\u522b\u6709 ibot, tuling, xiaoi, emotibot. \u4f46\u4e0d\u662f\u6240\u6709\u7684\u90fd\u542f\u7528, \u5728\u804a\u5929\u63d2\u4ef6\u4e2d, \u9009\u62e9\u5176\u4e2d\u7684\u4e00\u4e2a\u542f\u52a8\u5e76\u4ea4\u4e92.", 
            "title": "\u804a\u5929\u673a\u5668\u4eba"
        }, 
        {
            "location": "/slackbot/#_10", 
            "text": "\u6240\u8c13\u7684\u6587\u4ef6\u7ba1\u7406\u5668, \u53ea\u662f\u4e00\u4e2a\u6587\u4ef6\u7d22\u5f15\u52a0\u4e0a\u6587\u4ef6\u67e5\u627e\u7684\u5de5\u5177, \u989d\u5916\u589e\u52a0\u4e86\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u7684\u529f\u80fd. \u6587\u4ef6\u7d22\u5f15\u4f7f\u7528\u7684\u662fjieba\u548cwhoos. \u53ef\u4ee5\u901a\u8fc7slackbot\u5feb\u901f\u67e5\u627e\u67d0\u4e2a\u6587\u4ef6\u6216\u8005\u67d0\u672c\u4e66(\u7535\u5b50\u4e66\u591a\u5230\u81ea\u5df1\u4e5f\u4e0d\u77e5\u9053\u6709\u591a\u5c11\u672c).", 
            "title": "\u6587\u4ef6\u7ba1\u7406\u5668"
        }, 
        {
            "location": "/slackbot/#_11", 
            "text": "\u4e0d\u53ea\u662f\u8ffd\u5267, \u4e5f\u662f\u8ffd\u7535\u5f71. \u7535\u5f71\u8c46\u74e37.0\u4ee5\u4e0a\u624d\u63a8\u9001, \u800c\u5267\u662f\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u65e5\u5267, \u5168\u63a8((\u2299\ufe4f\u2299)b),\u540e\u6765\u56e0\u4e3a\u67d0\u4e9b\u6bd4\u8f83\u65e0\u5948\u7684\u539f\u56e0,  \u8fd9\u8d27\u5f00\u59cb\u63a8\u4e00\u4e9b\u8001\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u5267, \u5c31\u6309\u9700\u52a0\u4e86\u4e2a\u529f\u80fd, \u9ed1\u767d\u540d\u5355. \u679c\u7136\u8001\u5a46\u662f\u7b2c\u4e00\u751f\u4ea7\u529b.", 
            "title": "\u8ffd\u5267\u6a21\u5757"
        }, 
        {
            "location": "/slackbot/#_12", 
            "text": "\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u722c\u866b, \u4e0d\u505c\u5730\u722c\u53d6\u6307\u5b9a\u5c0f\u8bf4\u5224\u65ad\u662f\u5426\u5b58\u5728\u66f4\u65b0. \u5728\u4e2a\u4eba\u7684\u4e3b\u9875\u4ecb\u7ecd\u4e2d\u4ecb\u7ecd\u4e86\u559c\u6b22\u5386\u53f2\u5c0f\u8bf4, \u6240\u4ee5\u5927\u90e8\u5206\u90fd\u662f\u5386\u53f2\u7c7b\u5c0f\u8bf4", 
            "title": "\u5c0f\u8bf4\u6a21\u5757"
        }, 
        {
            "location": "/slackbot/#_13", 
            "text": "\u8c03\u7528mplayer\u64ad\u653e", 
            "title": "\u64ad\u653e\u6a21\u5757"
        }, 
        {
            "location": "/slackbot/#_14", 
            "text": "\u8c03\u7528arecord\u5f55\u97f3", 
            "title": "\u5f55\u5236\u6a21\u5757"
        }, 
        {
            "location": "/slackbot/#_15", 
            "text": "\u7528\u4e86\u767e\u5ea6\u7684api", 
            "title": "\u8bed\u97f3\u8f6c\u6587\u5b57"
        }, 
        {
            "location": "/slackbot/#_16", 
            "text": "\u7528\u4e86iflytek\u7684API, \u4e0d\u5f97\u4e0d\u8bf4\u5b83\u4eec\u5bb6\u8bed\u97f3\u505a\u5f97\u597d, \u5404\u79cd\u4eba\u7269\u53ef\u9009.", 
            "title": "\u6587\u5b57\u8f6c\u8bed"
        }, 
        {
            "location": "/slackbot/#_17", 
            "text": "\u5305\u542b\u4e86\u6a21\u4eff\u6d4f\u89c8\u5668\u6253\u5f00\u7684\u4ee3\u7801(cookie\u7b49), \u5b9e\u73b0\u4e86\u4ee3\u7406\u6c60, \u5e76\u53ef\u4ee3\u7406\u8bbf\u95ee.", 
            "title": "\u5de5\u5177"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/", 
            "text": "Android\u5185\u5b58\u8c03\u8bd5\u5de5\u5177\u603b\u7ed3\n\n\n\u7d22\u5f15\n\n\n\n\n\u7cfb\u7edf\u5185\u5b58\u5206\u6790, \u6240\u6709\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\n\n\n\u57fa\u672c\u7684\nlogcat\n\u8f93\u51fa\u4e2d\u53ef\u80fd\u5305\u542b\u7684GC\u76f8\u5173\u4fe1\u606f, \u53ef\u4ee5\u4f5c\u4e3a\u7cfb\u7edf\u6216\u67d0\u4e9b\u5e94\u7528\u5185\u5b58\u72b6\u51b5\u7684\u53c2\u8003\u4f9d\u636e.\n\n\n\u5728SystemServer\u542f\u52a8\u7684\u60c5\u51b5\u4e0b, \u8fd8\u53ef\u4ee5\u901a\u8fc7 \ndumpsys meminfo\n \u4eceframework\u5c42\u89d2\u5ea6\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u7684\u72b6\u51b5, \u8be5\u90e8\u5206\u4fe1\u606f\u4e0e\u4ece\u7cfb\u7edf\u89d2\u5ea6\u83b7\u53d6\u7684\u4fe1\u606f\u5b58\u5728\u5dee\u5f02.\n\n\n\u5bf9\u4e8e\u9700\u8981\u6392\u5e8f\u5e76\u67e5\u627e\u5185\u5b58\u5360\u7528\u6700\u591a\u7684\u8fdb\u7a0b, \u63a8\u8350\u4f7f\u7528\u547d\u4ee4 \nprocrank\n\n\n\u5728\u5b9e\u5728\u7f3a\u5c11\u5de5\u5177, \u6216\u8005RD\u77e5\u9053\u9700\u8981\u4ec0\u4e48\u4fe1\u606f\u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u67e5\u770b\n/proc/meminfo\n\n\n\u5982\u679c\u9700\u8981\u8fde\u7eed\u76d1\u63a7\u7cfb\u7edf\u7684\u72b6\u6001(\u5185\u5b58/CPU\u7b49), \u53ef\u4ee5\u8003\u8651\u5de5\u5177\nvmstat\n\n\n\u5982\u679c\u9700\u8981\u4ece\u5171\u4eab\u5e93\u6216\u8005\u5171\u4eab\u5185\u5b58\u7684\u89d2\u5ea6\u5206\u6790\u5176\u5185\u5b58\u5360\u7528\u7684\u60c5\u51b5, \u53ef\u4ee5\u8003\u8651\u7528 \nlibrank\n, \u5f53\u7136, \u5982\u679c\u5b58\u5728host\u7aef\u7684\u5206\u6790\u5de5\u5177, \u5219\u8be5\u5de5\u5177\u7684\u8f93\u51fa\u53ef\u4ee5\u9876\u66ff\nprocrank\n\u548c\nprocmem\n.\n\n\n\u5982\u679c\u9700\u8981\u67e5\u770b\u7cfb\u7edf\u4e2d\u54ea\u4e9b\u5171\u4eab\u6587\u4ef6\u522b\u901a\u8fc7\u7f3a\u9875\u9519\u8bef\u7684\u65b9\u5f0f\u8bfb\u5230\u5185\u5b58, \u53ef\u4ee5\u4f7f\u7528\u5de5\u5177\ndumpcache\n\n\n\u5982\u679c\u5b9e\u5728\u4e0d\u77e5\u9053bug\u539f\u56e0\u6216\u8005\u95ee\u9898\u53ef\u80fd\u8ddf\u81ea\u5df1\u65e0\u5173, \u5efa\u8bae\u4f7f\u7528 \nbugreport\n, \u4f9b\u5176\u4ed6RD\u534f\u52a9\u5206\u6790\u95ee\u9898.\n\n\n\n\n\n\n\u6307\u5b9a\u5e94\u7528(dalvik\u8fdb\u7a0b)\u5185\u5b58\u5206\u6790\n\n\ndumpsys meminfo \u5e94\u7528\u5185\u5b58\n \u8f93\u51fa\u5f53\u524d\u8fdb\u7a0b/\u5e94\u7528\u7684\u6240\u6709\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u5efa\u8bae\u53ea\u9488\u5bf9dalvik\u5c42\u7684\u8fdb\u7a0b.\n\n\n\n\n\n\n\u6307\u5b9anative\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\n\n\nnative\u7684\u5355\u4e2a\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\u5efa\u8bae\u4f7f\u7528 \nprocmem\n\u548c \nshowmap\n. \nshowmap\n \u989d\u5916\u8f93\u51fa\u4e86\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4, \u53ef\u4ee5\u8f85\u52a9\u67e5\u770b\u7531\u4e8e\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f15\u8d77\u7684\u5185\u5b58\u95ee\u9898.\n\n\n\n\n\n\n\u5e94\u7528\u5185\u5b58\u6cc4\u9732\n\n\n\u5c11\u90e8\u5206\u7684\u6cc4\u9732, \u6bd4\u5982\u6570\u636e\u5e93/activity\u7b49, \u901a\u8fc7\ndumpsys meminfo \u5e94\u7528\u5185\u5b58\n, \u4f46\u53ea\u80fd\u77e5\u9053\u5b58\u5728\u6cc4\u9732.\n\n\n\u5e94\u7528\u5728\u5f00\u542f \nstrictmode\n \u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u53d1\u73b0\u66f4\u591a\u7684\u8d44\u6e90\u6cc4\u9732\u60c5\u51b5. \u4f46\u4ec5\u9650\u4e8e\u53d1\u73b0.\n\n\n\u4e00\u4e2a\u6bd4\u8f83\u63a8\u8350\u7684\u7528\u4e8e\u5b9a\u4e49\u5e94\u7528\u5185\u5b58\u6cc4\u9732\u7684\u5de5\u5177\u662f \nLeakCanary\n\n\n\n\n\n\nnative\u8fdb\u7a0b\u5185\u5b58\u6cc4\u9732\n\n\n\u57fa\u4e8ebionic\u7684\u5185\u5b58\u6cc4\u9732\u5206\u6790\u5de5\u5177\n, \u8be5\u5de5\u5177\u5bf9\u4e8eRD\u4f7f\u7528\u8981\u6c42\u504f\u9ad8.\n\n\n\n\n\n\nbugreport \u4fe1\u606f\u5206\u6790\n\n\n\u89c1\u5916\u90e8\u6587\u6863.\n\n\n\n\n\n\n\n\n\u57fa\u7840\u6982\u5ff5\n\n\nVSS - Virtual Set Size \u865a\u62df\u8017\u7528\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nRSS - Resident Set Size \u5b9e\u9645\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nPSS - Proportional Set Size \u5b9e\u9645\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58, USS + \u6bd4\u4f8b\u5206\u914d\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff08[\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u7684\u5185\u5b58(RSS - USS)] / [\u5206\u4eab\u5171\u4eab\u5185\u5b58\u7684\u8fdb\u7a0b\u6570\u91cf]\uff09.\nUSS - Unique Set Size \u8fdb\u7a0b\u72ec\u81ea\u5360\u7528\u7684\u7269\u7406\u5185\u5b58\uff08\u4e0d\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u5982\u679c\u770b\u8fdb\u7a0b\u72ec\u5360\u5185\u5b58\uff0c\u3000\u5219\u4f7f\u7528USS. \u4f46\u662f\u4e00\u822c\u8003\u8651\u5230\u5171\u4eab\u5185\u5b58\u7684\u60c5\u51b5, \u5927\u90e8\u5206\u90fd\u662f\u4f9d\u636ePSS\u67e5\u770b\u5bf9\u5e94\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528.\n\n\n\nshared clean: \u5e72\u51c0\u7684\u5171\u4eab\u6570\u636e, \u4e5f\u5c31\u662f\u8bf4, \u5f53\u524d\u6709\u591a\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6307\u5411\u8be5\u7269\u7406\u7a7a\u95f4, \u4e14\u5f53\u524d\u8fdb\u7a0b\u7a7a\u95f4\u8be5\u6570\u636e\u4e0edisk\u4e0a\u4e00\u81f4.\nshared dirty: \u810f\u5171\u4eab\u6570\u636e, \u4e0e\u4e0a\u9762\u5bf9\u5e94, \u8be5\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5171\u4eab\u6570\u636e\u4e0edisk\u4e0a\u6570\u636e\u4e0d\u4e00\u81f4.\nprivate clean: \u8fdb\u7a0b\u79c1\u6709\u5e72\u51c0\u6570\u636e, \u4e0edisk\u6570\u636e\u4e00\u81f4.\nprivate dirty: \u8fdb\u7a0b\u79c1\u6709\u810f\u6570\u636e, \u4e0edisk\u6570\u636e\u4e0d\u4e00\u81f4.\n\n\n\n\n\n\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\u5206\u6790\n\n\nlogcat \u8f93\u51fa \n\n\ndalvik\u65e5\u5fd7\u6253\u5370\n\n\n\u573a\u666f: \u5728\u5e94\u7528\u968f\u673a\u51fa\u73b0\u6162\u65f6, \u53ef\u4ee5\u770b\u770b\u90a3\u6bb5\u65f6\u95f4logcat\u7684\u8f93\u51fa, \u662f\u5426\u5305\u542bGC\u7684\u4e00\u4e9b\u4fe1\u606f. GC\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u6162, \u800c\u7cfb\u7edf\u53d1\u8d77\u7684GC\u5219\u610f\u5473\u7740\u5185\u5b58\u4e0d\u591f, \u53ef\u80fd\u51fa\u73b0\u4ece\u78c1\u76d8\u52a0\u8f7d\u7684\u60c5\u51b5.\n\n\n\u5728logcat\u4e2d\u4f1a\u6253\u5370dalvik\u7684\u5783\u573e\u56de\u6536\u4fe1\u606f.\n\n\nD/dalvikvm: \nGC_Reason\n \nAmount_freed\n, \nHeap_stats\n, \nExternal_memory_stats\n, \nPause_time\n\nD/dalvikvm( 9050): GC_CONCURRENT freed 2049K, 65% free 3571K/9991K, external 4703K/5261K, paused 2ms+2ms\n\n\n\n\n\n\n\nGC_Reason\n:\n\n\n\nGC_CONCURRENT\n\n    \u5728\u60a8\u7684\u5806\u5f00\u59cb\u5360\u7528\u5185\u5b58\u65f6\u53ef\u4ee5\u91ca\u653e\u5185\u5b58\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\n\nGC_FOR_MALLOC\n\n    \u5806\u5df2\u6ee1\u800c\u7cfb\u7edf\u4e0d\u5f97\u4e0d\u505c\u6b62\u60a8\u7684\u5e94\u7528\u5e76\u56de\u6536\u5185\u5b58\u65f6\uff0c\u60a8\u7684\u5e94\u7528\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u800c\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002\n\nGC_HPROF_DUMP_HEAP\n\n    \u5f53\u60a8\u8bf7\u6c42\u521b\u5efa HPROF \u6587\u4ef6\u6765\u5206\u6790\u5806\u65f6\u51fa\u73b0\u7684\u5783\u573e\u56de\u6536\u3002\n\nGC_EXPLICIT\n\n    \u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\u5f53\u60a8\u8c03\u7528 gc() \u65f6\uff08\u60a8\u5e94\u907f\u514d\u8c03\u7528\uff0c\u800c\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u4f1a\u6839\u636e\u9700\u8981\u8fd0\u884c\uff09\u3002\n\nGC_EXTERNAL_ALLOC\n\n    \u8fd9\u4ec5\u9002\u7528\u4e8e API \u7ea7\u522b 10 \u53ca\u66f4\u4f4e\u7ea7\u522b\uff08\u66f4\u65b0\u7248\u672c\u4f1a\u5728 Dalvik \u5806\u4e2d\u5206\u914d\u4efb\u4f55\u5185\u5b58\uff09\u3002\u5916\u90e8\u5206\u914d\u5185\u5b58\u7684\u5783\u573e\u56de\u6536\uff08\u4f8b\u5982\u5b58\u50a8\u5728\u539f\u751f\u5185\u5b58\u6216 NIO \u5b57\u8282\u7f13\u51b2\u533a\u4e2d\u7684\u50cf\u7d20\u6570\u636e\uff09\u3002 \n\n\n\nAmount_freed\n:\n\n\n\u4ece\u6b64\u6b21\u5783\u573e\u56de\u6536\u4e2d\u56de\u6536\u7684\u5185\u5b58\u91cf\u3002\n\n\n\nHeap_stats\n:\n\n\n\n\u5806\u7684\u53ef\u7528\u7a7a\u95f4\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002\n\n\n\n\nExternal_memory_stats\n:\n\n\n\nAPI \u7ea7\u522b 10 (Android3.0 \u4ee5\u4e0b)\u53ca\u66f4\u4f4e\u7ea7\u522b\u7684\u5916\u90e8\u5206\u914d\u5185\u5b58\uff08\u5df2\u5206\u914d\u5185\u5b58\u91cf\uff09/\uff08\u53d1\u751f\u56de\u6536\u7684\u9650\u503c\uff09. \u800c\u65b0API\u4e2d, \u7edf\u4e00\u7531dalvik\u7ba1\u7406.\n\n\n\n\nPause_time\n\n\n\n\n\u5806\u8d8a\u5927\uff0c\u6682\u505c\u65f6\u95f4\u8d8a\u957f\u3002\u5e76\u53d1\u6682\u505c\u65f6\u95f4\u663e\u793a\u4e86\u4e24\u4e2a\u6682\u505c\uff1a\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5f00\u59cb\u65f6\uff0c\u53e6\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5feb\u8981\u5b8c\u6210\u65f6\u3002\n\n\n\nart\u65e5\u5fd7\u6253\u5370\n\n\n\u4e0e Dalvik \u4e0d\u540c\uff0cART \u4e0d\u4f1a\u4e3a\u672a\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\u8bb0\u5f55\u6d88\u606f\u3002\u53ea\u6709\u5728\u8ba4\u4e3a\u5783\u573e\u56de\u6536\u901f\u5ea6\u8f83\u6162\u65f6\u624d\u4f1a\u6253\u5370\u5783\u573e\u56de\u6536\u3002\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u4ec5\u5728\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8d85\u8fc7 5ms \u6216\u5783\u573e\u56de\u6536\u6301\u7eed\u65f6\u95f4\u8d85\u8fc7 100ms \u65f6\u3002\u5982\u679c\u5e94\u7528\u672a\u5904\u4e8e\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\uff0c\u90a3\u4e48\u5176\u5783\u573e\u56de\u6536\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u8f83\u6162\u3002\u59cb\u7ec8\u4f1a\u8bb0\u5f55\u663e\u5f0f\u5783\u573e\u56de\u6536\u3002\n\n\nI/art: \nGC_Reason\n \nGC_Name\n \nObjects_freed\n(\nSize_freed\n) AllocSpace Objects, \nLarge_objects_freed\n(\nLarge_object_size_freed\n) \nHeap_stats\n LOS objects, \nPause_time(s)\n\n\nI/art : Explicit concurrent mark sweep GC freed 104710(7MB) AllocSpace objects, 21(416KB) LOS objects, 33% free, 25MB/38MB, paused 1.230ms total 67.216ms\n\n\n\n\n\nGC_Reason\n:\n\n\n\nConcurrent\n\n    \u4e0d\u4f1a\u6682\u505c\u5e94\u7528\u7ebf\u7a0b\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\u6b64\u5783\u573e\u56de\u6536\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u800c\u4e14\u4e0d\u4f1a\u963b\u6b62\u5206\u914d\u3002\n\nAlloc\n\n    \u60a8\u7684\u5e94\u7528\u5728\u5806\u5df2\u6ee1\u65f6\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5206\u914d\u7ebf\u7a0b\u4e2d\u53d1\u751f\u4e86\u5783\u573e\u56de\u6536\u3002\n\nExplicit\n\n    \u7531\u5e94\u7528\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\uff0c\u901a\u8fc7\u8c03\u7528 gc() \u6216 gc()\u3002\u4e0e Dalvik \u76f8\u540c\uff0c\u5728 ART \u4e2d\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u60a8\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u5e76\u907f\u514d\u8bf7\u6c42\u663e\u5f0f\u5783\u573e\u56de\u6536\uff08\u5982\u679c\u53ef\u80fd\uff09\u3002\u4e0d\u5efa\u8bae\u4f7f\u7528\u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u963b\u6b62\u5206\u914d\u7ebf\u7a0b\u5e76\u4e0d\u5fc5\u8981\u5730\u6d6a\u8d39 CPU \u5468\u671f\u3002\u5982\u679c\u663e\u5f0f\u5783\u573e\u56de\u6536\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u88ab\u62a2\u5360\uff0c\u90a3\u4e48\u5b83\u4eec\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\uff08\u5e94\u7528\u4e2d\u51fa\u73b0\u95f4\u65ad\u3001\u6296\u52a8\u6216\u6682\u505c\uff09\u3002\n\nNativeAlloc\n\n    \u539f\u751f\u5206\u914d\uff08\u5982\u4f4d\u56fe\u6216 RenderScript \u5206\u914d\u5bf9\u8c61\uff09\u5bfc\u81f4\u51fa\u73b0\u539f\u751f\u5185\u5b58\u538b\u529b\uff0c\u8fdb\u800c\u5f15\u8d77\u7684\u56de\u6536\u3002\n\nCollectorTransition\n\n    \u7531\u5806\u8f6c\u6362\u5f15\u8d77\u7684\u56de\u6536\uff1b\u6b64\u56de\u6536\u7531\u8fd0\u884c\u65f6\u5207\u6362\u5783\u573e\u56de\u6536\u5f15\u8d77\u3002\u56de\u6536\u5668\u8f6c\u6362\u5305\u62ec\u5c06\u6240\u6709\u5bf9\u8c61\u4ece\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u590d\u5236\u5230\u78b0\u649e\u6307\u9488\u7a7a\u95f4\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002\u5f53\u524d\uff0c\u56de\u6536\u5668\u8f6c\u6362\u4ec5\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u51fa\u73b0\uff1a\u5728 RAM \u8f83\u5c0f\u7684\u8bbe\u5907\u4e0a\uff0c\u5e94\u7528\u5c06\u8fdb\u7a0b\u72b6\u6001\u4ece\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u72b6\u6001\u53d8\u66f4\u4e3a\u53ef\u5bdf\u89c9\u7684\u975e\u6682\u505c\u72b6\u6001\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002 \n\nHomogeneousSpaceCompact\n\n    \u9f50\u6027\u7a7a\u95f4\u538b\u7f29\u662f\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u5230\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u538b\u7f29\uff0c\u901a\u5e38\u5728\u5e94\u7528\u8fdb\u5165\u5230\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\u65f6\u53d1\u751f\u3002\u8fd9\u6837\u505a\u7684\u4e3b\u8981\u539f\u56e0\u662f\u51cf\u5c11 RAM \u4f7f\u7528\u91cf\u5e76\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\u3002 \n\nDisableMovingGc\n\n    \u8fd9\u4e0d\u662f\u771f\u6b63\u7684\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u53d1\u751f\u5e76\u53d1\u5806\u538b\u7f29\u65f6\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86 GetPrimitiveArrayCritical\uff0c\u56de\u6536\u906d\u5230\u963b\u6b62\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 GetPrimitiveArrayCritical\uff0c\u56e0\u4e3a\u5b83\u5728\u79fb\u52a8\u56de\u6536\u5668\u65b9\u9762\u5177\u6709\u9650\u5236\u3002 \n\nHeapTrim\n\n    \u8fd9\u4e0d\u662f\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5806\u4fee\u526a\u5b8c\u6210\u4e4b\u524d\u56de\u6536\u4f1a\u4e00\u76f4\u53d7\u5230\u963b\u6b62\u3002 \n\n\nGC_Name\n:\n\n\n\nART \u5177\u6709\u53ef\u4ee5\u8fd0\u884c\u7684\u591a\u79cd\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u3002 \n\n\nConcurrent mark sweep (CMS)\n\n    \u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u91ca\u653e\u548c\u56de\u6536\u6620\u50cf\u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002\n\nConcurrent partial mark sweep\n\n    \u51e0\u4e4e\u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u56de\u6536\u9664\u4e86\u6620\u50cf\u7a7a\u95f4\u548c zygote \u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002 \n\nConcurrent sticky mark sweep\n\n    \u751f\u6210\u56de\u6536\u5668\uff0c\u53ea\u80fd\u91ca\u653e\u81ea\u4e0a\u6b21\u5783\u573e\u56de\u6536\u4ee5\u6765\u5206\u914d\u7684\u5bf9\u8c61\u3002\u6b64\u5783\u573e\u56de\u6536\u6bd4\u5b8c\u6574\u6216\u90e8\u5206\u6807\u8bb0\u6e05\u9664\u8fd0\u884c\u5f97\u66f4\u9891\u7e41\uff0c\u56e0\u4e3a\u5b83\u66f4\u5feb\u901f\u4e14\u6682\u505c\u65f6\u95f4\u66f4\u77ed\u3002 \n\nMarksweep + semispace\n\n    \u975e\u5e76\u53d1\u3001\u590d\u5236\u5783\u573e\u56de\u6536\uff0c\u7528\u4e8e\u5806\u8f6c\u6362\u4ee5\u53ca\u9f50\u6027\u7a7a\u95f4\u538b\u7f29\uff08\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002 \n\n\nObjects_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002\n\n\nSize_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002\n\n\nLarge_objects_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002\n\n\nLarge_object_size_freed\n:\n\n\n\u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002\n\n\nHeap_stats\n\n\n\u7a7a\u95f2\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002\n\n\nPause_time(s)\n\n\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6682\u505c\u65f6\u95f4\u4e0e\u5783\u573e\u56de\u6536\u8fd0\u884c\u65f6\u4fee\u6539\u7684\u5bf9\u8c61\u5f15\u7528\u6570\u91cf\u6210\u6b63\u6bd4\u3002\u5f53\u524d\uff0cART CMS \u5783\u573e\u56de\u6536\u4ec5\u5728\u5783\u573e\u56de\u6536\u5373\u5c06\u5b8c\u6210\u65f6\u6682\u505c\u4e00\u6b21\u3002\u79fb\u52a8\u7684\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8f83\u957f\uff0c\u4f1a\u5728\u5927\u90e8\u5206\u5783\u573e\u56de\u6536\u671f\u95f4\u6301\u7eed\u51fa\u73b0\u3002\n\n\nandroid\u81ea\u5e26\u5de5\u5177\n\n\ndumpsys meminfo \n\n\nhttps://developer.android.com/studio/profile/investigate-ram.html\nhttp://gityuan.com/2016/01/02/memory-analysis-command/\n\n\n\u573a\u666f: \u67e5\u770bdalvik\u7b49\u533a\u57df\u5185\u5b58\u60c5\u51b5.\n\n\nroot@zx1800:/data # dumpsys meminfo\nApplications Memory Usage (kB):                                           --- \u4ee5\u4e0b\u5185\u5b58\u5355\u4f4d\nUptime: 618252294 Realtime: 618252294                                     --- Realtime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u5305\u542b\u4f11\u7720, \u51c6\u786e\u6027\u4f9d\u8d56\u9a71\u52a8\u5b9e\u73b0. \u5728\u9a71\u52a8\u65e0\u5b9e\u73b0\u65f6, \u4f7f\u7528Uptime.\n                                                                          --- Uptime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u4e0d\u5305\u542b\u4f11\u7720.\n\nTotal PSS by process:                                                     --- \u6240\u6709\u8fdb\u7a0b PSS \u5360\u7528\u6392\u5e8f\n    24712 kB: system (pid 445)\n    19600 kB: com.china_liantong.upgrade (pid 2660)\n    17500 kB: com.china_liantong.video (pid 3002 / activities)\n    11100 kB: com.china_liantong.oam (pid 999)\n    10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n     8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n     8394 kB: com.china_liantong.ocnadservice (pid 942)\n     7622 kB: com.android.systemui (pid 677)\n     6708 kB: dhcpcd (pid 639)\n     6541 kB: com.china_liantong.epg (pid 1235)\n     6286 kB: android.process.media (pid 2041)\n     5691 kB: com.china_liantong.airsharingservice (pid 2063)\n     4466 kB: dvbserver (pid 211)\n     4041 kB: mediaserver (pid 196)\n     3890 kB: com.china_liantong.xmppservice (pid 887)\n     3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n     3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     2466 kB: surfaceflinger (pid 183)\n     2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n     1955 kB: logd (pid 178)\n     1943 kB: com.china_liantong.tvframe (pid 1066)\n     1847 kB: com.china_liantong.playback (pid 923)\n     1640 kB: zygote (pid 220)\n      615 kB: sdcard (pid 1698)\n      473 kB: netd (pid 191)\n      415 kB: sysinfod (pid 184)\n      392 kB: vold (pid 182)\n      364 kB: developed (pid 222)\n      356 kB: adbd (pid 224)\n      350 kB: sh (pid 12684)\n      285 kB: /init (pid 1)\n      279 kB: dvbresourceserver (pid 210)\n      261 kB: sdcard (pid 223)\n      258 kB: avsettingd (pid 215)\n      240 kB: sh (pid 1325)\n      164 kB: ueventd (pid 159)\n      135 kB: keystore (pid 201)\n       82 kB: servicemanager (pid 181)\n       81 kB: installd (pid 199)\n       76 kB: healthd (pid 179)\n       62 kB: lmkd (pid 180)\n       26 kB: drmserver (pid 195)\n       26 kB: systemtaskd (pid 202)\n       22 kB: frontpaneld (pid 207)\n       15 kB: common_time (pid 189)\n       15 kB: frontpadserver (pid 216)\n       15 kB: dcaseventsvr (pid 219)\n        9 kB: sh (pid 190)\n        9 kB: debuggerd (pid 192)\n\nTotal PSS by OOM adjustment:                                              --- \u4ee5OOM\u7c7b\u522b\u5212\u5206(TODO: \u6bcf\u4e2a\u7c7b\u522b\u4f9d\u636e\u548c\u542b\u4e49)\n    26301 kB: Native\n                6708 kB: dhcpcd (pid 639)\n                4466 kB: dvbserver (pid 211)\n                4041 kB: mediaserver (pid 196)\n                2466 kB: surfaceflinger (pid 183)\n                1955 kB: logd (pid 178)\n                1640 kB: zygote (pid 220)\n                 615 kB: sdcard (pid 1698)\n                 473 kB: netd (pid 191)\n                 415 kB: sysinfod (pid 184)\n                 392 kB: vold (pid 182)\n                 364 kB: developed (pid 222)\n                 356 kB: adbd (pid 224)\n                 350 kB: sh (pid 12684)\n                 285 kB: /init (pid 1)\n                 279 kB: dvbresourceserver (pid 210)\n                 261 kB: sdcard (pid 223)\n                 258 kB: avsettingd (pid 215)\n                 240 kB: sh (pid 1325)\n                 164 kB: ueventd (pid 159)\n                 135 kB: keystore (pid 201)\n                  82 kB: servicemanager (pid 181)\n                  81 kB: installd (pid 199)\n                  76 kB: healthd (pid 179)\n                  62 kB: lmkd (pid 180)\n                  26 kB: drmserver (pid 195)\n                  26 kB: systemtaskd (pid 202)\n                  22 kB: frontpaneld (pid 207)\n                  15 kB: common_time (pid 189)\n                  15 kB: frontpadserver (pid 216)\n                  15 kB: dcaseventsvr (pid 219)\n                   9 kB: sh (pid 190)\n                   9 kB: debuggerd (pid 192)\n    24712 kB: System\n               24712 kB: system (pid 445)\n    48956 kB: Persistent\n               11100 kB: com.china_liantong.oam (pid 999)\n               10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n                8394 kB: com.china_liantong.ocnadservice (pid 942)\n                7622 kB: com.android.systemui (pid 677)\n                3890 kB: com.china_liantong.xmppservice (pid 887)\n                3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n                2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n                1847 kB: com.china_liantong.playback (pid 923)\n    27280 kB: Foreground\n               17500 kB: com.china_liantong.video (pid 3002 / activities)\n                6541 kB: com.china_liantong.epg (pid 1235)\n                3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     1943 kB: Visible\n                1943 kB: com.china_liantong.tvframe (pid 1066)\n     2214 kB: Perceptible\n                2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     6286 kB: Home\n                6286 kB: android.process.media (pid 2041)\n    34024 kB: B Services  (\u6ce8\u91ca: \u8001\u65e7\u7684, \u4e0d\u592a\u53ef\u80fd\u88ab\u4f7f\u7528\u5230\u7684\u670d\u52a1\u8fdb\u7a0b)\n               19600 kB: com.china_liantong.upgrade (pid 2660)\n                8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n                5691 kB: com.china_liantong.airsharingservice (pid 2063)\n\nTotal PSS by category:                                               --- \u4ee5 category \u5212\u5206\n    49530 kB: Native\n    35318 kB: Dalvik\n    26569 kB: .so mmap\n    17158 kB: .oat mmap\n    16357 kB: .art mmap\n     8144 kB: .dex mmap\n     6671 kB: Stack\n     2822 kB: Dalvik Other\n     2635 kB: Other mmap\n     2160 kB: .ttf mmap\n     1892 kB: Other dev\n     1581 kB: Unknown\n      843 kB: .apk mmap\n       36 kB: EGL mtrack\n        0 kB: Cursor\n        0 kB: Ashmem\n        0 kB: Gfx dev\n        0 kB: .jar mmap\n        0 kB: GL mtrack\n        0 kB: Other mtrack\n\nTotal RAM: 443652 kB (status critical)\n Free RAM: 137634 kB (40310 cached pss + 9492 cached kernel + 87832 free)\n Used RAM: 168782 kB (131406 used pss + 37376 kernel)\n Lost RAM: 137236 kB\n     ZRAM: 10684 kB physical used for 32252 kB in swap (196604 kB total swap)\n           \u538b\u7f29\u540e\u5185\u5b58\u5360\u7528             \u88ab\u538b\u7f29\u5185\u5b58\n      KSM: 39500 kB saved from shared 5844 kB\n           85420 kB unshared; 99276 kB volatile\n   Tuning: 96 (large 96), oom 10240 kB, restore limit 3413 kB (low-ram)\n\n\n\n\n\nprocrank \n\n\n\u573a\u666f: \u67e5\u770b\u5404\u4e2a\u8fdb\u7a0b\u7684PSS/USS \u5e76\u6bd4\u8f83\n\n\nshell@zx1800:/ # procrank\n  PID       Vss      Rss      Pss      Uss  cmdline\n  884   589628K   89320K   30444K   23128K  com.china_liantong.launcher\n  447   617060K   74620K   25695K   20904K  system_server\n 1139   572780K   61160K   14848K   10160K  com.china_liantong.browserreceiver\n  209   125160K   25312K   13834K   12696K  /system/bin/dvbserver\n 1180   549556K   65992K   12433K    6192K  com.china_liantong.upgrade\n  807   554556K   48092K    9636K    7160K  com.china_liantong.ocnadservice\n  222   516596K   54256K    8960K    3152K  zygote\n  864   547692K   47220K    8431K    6024K  com.china_liantong.oam\n  827   552092K   46208K    8180K    5840K  com.china_liantong.channelmanagerservice\n  223    71580K   18580K    7156K    3928K  /system/bin/developed\n  955   529948K   44620K    6591K    4000K  com.china_liantong.epg\n  534   525112K   41324K    6233K    3816K  com.android.systemui\n  516   523764K   39424K    5949K    3884K  android.process.media\n  183    55092K   17936K    5935K    4284K  /system/bin/surfaceflinger\n 1066   525392K   41296K    5140K    2712K  com.china_liantong.live.service.LiveService\n  771   529900K   40224K    4864K    2888K  com.china_liantong.tvmediaplayerservice\n  753   525476K   37228K    4681K    2804K  com.china_liantong.xmppservice\n  201    53500K   12232K    4421K    3460K  /system/bin/mediaserver\n 1206   521008K   36324K    4288K    2580K  com.china_liantong.mytv\n  979   527892K   36256K    4201K    2080K  com.china_liantong.launcher:SettingContentProvider\n 1095   526240K   36480K    4145K    2368K  com.china_liantong.airsharingservice\n  601   518952K   37128K    3898K    1984K  com.china_liantong.inputmethod.pinyin\n  789   526912K   32468K    3309K    1832K  com.china_liantong.playback\n 1048   520468K   32616K    2799K     968K  com.china_liantong.live\n  846   525972K   32620K    2787K    1336K  com.china_liantong.dtvsyskeyservice\n 1252   519376K   31716K    2687K    1260K  com.china_liantong.video\n  907   524920K   32120K    2676K    1236K  com.china_liantong.tvframe\n  511    19896K    5168K    2350K    1208K  /system/bin/dhcpcd\n  210    25496K    6480K    1662K    1316K  /system/bin/avsettingd\n  178    18252K    2596K    1509K    1476K  /system/bin/logd\n  199    23564K    4880K    1273K    1004K  /system/bin/drmserver\n  217    18936K    2864K     826K     740K  /system/bin/frontpadserver\n  182    19568K    3176K     816K     636K  /system/bin/vold\n  205    12508K    2804K     718K     572K  /system/bin/keystore\n  184    16580K    2580K     681K     536K  /system/bin/sysinfod\n  197    21796K    1672K     538K     480K  /system/bin/netd\n 2135     9192K    1100K     532K     520K  procrank\n  189    17484K    1748K     481K     420K  /system/bin/common_time\n  208    17492K    1792K     479K     436K  /system/bin/dvbresourceserver\n  220    16400K    1672K     434K     388K  /system/bin/dcaseventsvr\n  225    16980K     508K     416K     416K  /sbin/adbd\n  224    15412K    1048K     356K     336K  /system/bin/sdcard\n 1434     9324K    1020K     338K     244K  sh\n  186    14820K     428K     336K     332K  /sbin/watchdog\n    1     8860K     396K     327K     316K  /init\n 1428     9324K    1008K     326K     232K  /system/bin/sh\n  206    14460K    1036K     310K     288K  /system/bin/systemtaskd\n  203     9412K    1012K     272K     248K  /system/bin/installd\n  207    14456K     992K     266K     244K  /system/bin/frontpaneld\n  179     9828K     316K     260K     256K  /sbin/healthd\n  180    10624K    1664K     184K     116K  /system/bin/lmkd\n  181     9460K     792K      98K      76K  /system/bin/servicemanager\n  198    10056K    1108K      64K      28K  /system/bin/debuggerd\n  160     8852K      56K      11K       4K  /sbin/ueventd\n                           ------   ------  ------\n                          230106K  155544K  TOTAL\n\nRAM: 443652K total, 38684K free, 0K buffers, 98768K cached, 1384K shmem, 21560K slab\n\n\n\n\n\ncat /proc/meminfo \n\n\n\u573a\u666f: \u7cfb\u7edf\u5185\u5b58\u8be6\u7ec6\u4fe1\u606f\n\n\nshell@zx1800:/ # cat /proc/meminfo                                             \nMemTotal:         443652 kB                      --- \u7cfb\u7edf\u53ef\u89c1\u7684\u603b\u7269\u7406\u5185\u5b58\nMemFree:           38584 kB                      --- \u7cfb\u7edf\u4e2d\u672a\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\nMemAvailable:     125556 kB                      --- \u53ef\u7528\u5185\u5b58 = MemFree + Cached + Buffers\nBuffers:               0 kB                      --- \u7528\u4e8e\u6587\u4ef6\u7f13\u51b2\u7684\u5185\u5b58\u5927\u5c0f\nCached:            98768 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\nSwapCached:          128 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684swap\u5927\u5c0f\nActive:           143160 kB                      --- \u6d3b\u8dc3\u4f7f\u7528\u4e2d\u7684\u5185\u5b58, \u4e00\u822c\u4e0d\u4f1a\u56de\u6536. = anon + file\nInactive:          87104 kB                      --- \u6700\u8fd1\u672a\u88ab\u4f7f\u7528\u7684\u5185\u5b58, \u53ef\u4ee5\u88ab\u56de\u6536. = anon + file\nActive(anon):      94348 kB\nInactive(anon):    38532 kB\nActive(file):      48812 kB\nInactive(file):    48572 kB\nUnevictable:           0 kB                      \nMlocked:               0 kB\nHighTotal:             0 kB                      \nHighFree:              0 kB\nLowTotal:         443652 kB\nLowFree:           38584 kB\nSwapTotal:        196604 kB                      --- swap\u5206\u533a\u5927\u5c0f\nSwapFree:         193784 kB                      --- swap\u5206\u533a\u5269\u4f59\u7a7a\u95f4\nDirty:                 0 kB                      \nWriteback:             0 kB\nAnonPages:        131492 kB                      --- \u533f\u540d\u9875\nMapped:            90688 kB                      --- map\u7684\u5185\u5b58\nShmem:              1384 kB                      --- \u5171\u4eab\u5185\u5b58, \u8ddf\u6587\u4ef6\u65e0\u5173\u7684\nSlab:              21604 kB                      --- kernel slab\u5206\u914d\u5668\nSReclaimable:       5464 kB\nSUnreclaim:        16140 kB\nKernelStack:        5424 kB                      --- \u5185\u6838\u6808\nPageTables:         7932 kB                      --- \u7ba1\u7406\u9875\u7684\u6570\u636e\u7ed3\u6784\u5927\u5c0f\nNFS_Unstable:          0 kB\nBounce:                0 kB\nWritebackTmp:          0 kB\nCommitLimit:      418428 kB\nCommitted_AS:    8764944 kB\nVmallocTotal:     565248 kB\nVmallocUsed:       55952 kB\nVmallocChunk:     472068 kB\n\n\n\n\n\nvmstat \n\n\n\u573a\u666f: \u76d1\u63a7\u7cfb\u7edf\u72b6\u6001.\n\n\n\u8be5\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f, \u8fdb\u7a0b\u961f\u5217, \u7cfb\u7edf\u5207\u6362, CPU\u65f6\u95f4\u5360\u6bd4\u7b49\u4fe1\u606f, \u5468\u671f\u6027\u52a8\u6001\u8f93\u51fa.\n\n\nprocs  memory                       system          cpu              \n r  b    free mapped   anon   slab    in   cs  flt  us ni sy id wa ir\n \n0\n  \n0\n   \n38628\n  \n90844\n \n131992\n  \n21688\n  \n5268\n \n10257\n    \n0\n   \n5\n  \n0\n  \n6\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132008\n  \n21688\n  \n5271\n \n10367\n    \n0\n   \n8\n  \n0\n  \n9\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132048\n  \n21688\n  \n5150\n \n10497\n    \n0\n  \n10\n  \n1\n  \n8\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132100\n  \n21688\n  \n5112\n \n10180\n    \n0\n   \n8\n  \n0\n  \n3\n \n99\n  \n0\n  \n0\n\n \n0\n  \n0\n   \n38628\n  \n90844\n \n132120\n  \n21688\n  \n5221\n \n10289\n    \n0\n   \n8\n  \n0\n  \n4\n \n99\n  \n0\n  \n0\n\n\n\n\n\n\n\u603b\u517115\u5217\u53c2\u6570, \u4e2a\u53c2\u6570\u542b\u4e49\u5982\u4e0b:\n\n\n\n\nprocs(\u8fdb\u7a0b)\n\n\nr: Running\u961f\u5217\u4e2d\u8fdb\u7a0b\u6570, \u8fd9\u4e2a\u503c\u8d85\u8fc7cpu\u4e2a\u6570\u5c31\u4f1a\u51fa\u73b0cpu\u74f6\u9888.\n\n\nb: IO wait \u7684\u8fdb\u7a0b\u6570, \u8be5\u503c\u8fc7\u5927, \u53ef\u80fd\u662f\u7b49\u5f85\u6587\u4ef6\u64cd\u4f5c\u7684\u8fdb\u7a0b\u591a\u6216\u8005\u6587\u4ef6\u8bfb\u5199\u6162.\n\n\n\n\n\n\nmemory(\u5185\u5b58)\n\n\nfree: \u53ef\u7528\u5185\u5b58\u5927\u5c0f\n\n\nmapped: mmap\u6620\u5c04\u7684\u5185\u5b58\u5927\u5c0f\n\n\nanon: \u533f\u540d\u5185\u5b58\u5927\u5c0f, \u4e00\u822c\u7531malloc\u5f15\u8d77, \u6216\u8005\u533f\u540dmmap.\n\n\nslab: slab\u7684\u5185\u5b58\u5927\u5c0f.\n\n\n\n\n\n\nsystem(\u7cfb\u7edf)\n\n\nin: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u7684\u4e2d\u65ad\u6b21\u6570(\u5305\u62ec\u65f6\u949f\u4e2d\u65ad), \u8fd9\u4e2a\u503c\u8d8a\u5927, \u5185\u6838\u6d88\u8017\u7684cpu\u65f6\u95f4\u8d8a\u591a.\u9700\u8981\u67e5\u770b\n/proc/interrupts\n\u4e0b\u4e2d\u65ad\u589e\u957f\u60c5\u51b5.\n\n\ncs: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570\n\n\nflt: major page faults. \u9700\u8981\u4ecedisk\u8bfb\u53d6\u6570\u636e\u7684\u7f3a\u9875\u9519\u8bef.\n\n\n\n\n\n\nCPU (\u5904\u7406\u5668)\n\n\nus: user time, \u6bd4\u8f83\u9ad8\u65f6\uff0c\u8bf4\u660e\u7528\u6237\u8fdb\u7a0b\u6d88\u8017\u7684cpu\u65f6\u95f4\u591a.\n\n\nni: nice time, \u88ab\u964d\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u5728\u7528\u6237\u6a21\u5f0f\u4e0b\u7684\u6267\u884cCPU\u65f6\u95f4\u767e\u5206\u6bd4.\n\n\nsy: system time, \u7cfb\u7edf\u5185\u6838\u6d88\u8017\u7684CPU\u767e\u5206\u6bd4\n\n\nid: idle time, \u7cfb\u7edf\u7a7a\u95f2\u65f6\u95f4\u767e\u5206\u6bd4\n\n\nwa: iowait time, CPU\u5728\u7b49\u5f85IO\u5b8c\u6210\u65f6\u95f4\u5360\u6bd4\n\n\nir: interrupt time, \u7cfb\u7edf\u4e2d\u65ad\u8017\u65f6\u5360CPU\u767e\u5206\u6bd4\n\n\n\n\n\n\n\n\n\u66f4\u591a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f, \u8bf7\u76f4\u63a5\u67e5\u770b \n/proc/vmstat\n\nhttp://blog.csdn.net/macky0668/article/details/6839498\n\n\nlibrank \n\n\n\u573a\u666f: \u4e0eprocrank\u4e92\u8865\u4f7f\u7528, \u662fprocmem\u7684\u6269\u5c55. \u663e\u793a\u6240\u6709\u8fdb\u7a0b\u7684\u4fe1\u606f, \u9700\u8981\u5de5\u5177\u7edf\u8ba1\u5206\u7c7b. \u4e5f\u53ef\u4ee5\u7528\u6765\u67e5\u770b\u6bcf\u4e2a\u5e93\u6216\u5171\u4eab\u6587\u4ef6\u771f\u5b9e\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f.\n\n\n\u6570\u636e\u6765\u6e90\u4e0eprocmem\u4e00\u6837, \u4f46\u662fprocmem\u9488\u5bf9\u7684\u662f\u5355\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u800clibrank\u662f\u663e\u793a\u67d0\u4e2a\u5e93\u6216\u8005\u6587\u4ef6\u88ab\u54ea\u4e9b\u8fdb\u7a0b\u5171\u4eab, \u5e76\u663e\u793a\u5360\u7528\u5927\u5c0f. \u5982\u4e0b\u56fe\u6240\u793a.\n\n\n\n\n\n\n\n\ndumpcache \n\n\n\u8be5\u5de5\u5177\u662fandroid7.0\u4e4b\u540e\u624d\u6709\u7684\u5de5\u5177,\u7528\u4e8e\u67e5\u770b\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u6bcf\u4e2a\u6587\u4ef6\u88abcache\u5230\u5185\u5b58\u7684\u5927\u5c0f. \u8be5\u6587\u4ef6\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u7f3a\u9875\u9519\u8bef\u65f6\u52a0\u8f7d\u7684\u6587\u4ef6.\n\n\n\u5728Launcher\u754c\u9762\u65f6\u7684\u8f93\u51fa\u5982\u4e0b:\n\n\n\n\n\u7a33\u5b9a\u64ad\u653e1080P\u89c6\u9891\u65f6:\n\n\n\n\u6309\u4e0b\u9065\u63a7\u5668\u786e\u5b9a\u952e\u663e\u793aUI\u65f6:\n\n\n\n\u5bf9\u6bd4, \u53ef\u4ee5\u77e5\u9053\u5728\u64ad\u653e\u8fc7\u7a0b\u4e2d, \u663e\u793aUI\u65f6\u4e3b\u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u662f:\n\n\n\nbugreport \u4fe1\u606f\u5206\u6790 \n\n\nAndroid\u7cfb\u7edf\u60f3\u8981\u6210\u4e3a\u4e00\u4e2a\u529f\u80fd\u5b8c\u5907\uff0c\u751f\u6001\u7e41\u8363\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u90a3\u5c31\u5fc5\u987b\u63d0\u4f9b\u5b8c\u6574\u7684\u5e94\u7528\u5f00\u53d1\u73af\u5883\u3002\u800c\u5728\u5e94\u7528\u5f00\u53d1\u4e2d\uff0capp\u7a0b\u5e8f\u7684\u8c03\u8bd5\u5206\u6790\u662f\u65e5\u5e38\u751f\u4ea7\u4e2d\u8fdb\u7a0b\u4f1a\u8fdb\u884c\u7684\u5de5\u4f5c\u3002Android\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u5206\u6790\u6574\u4e2a\u7cfb\u7edf\u5e73\u53f0\u548c\u67d0\u4e2aapp\u5728\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u5185\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e13\u95e8\u5f00\u53d1\u4e86bugreport\u5de5\u5177\u3002\n\n\n\n\u8be5\u5de5\u5177\u7684\u7f3a\u70b9\u662f: \n1. \u8017\u65f6\u8fc7\u957f, \u53ea\u80fd\u6293\u53d6\u5f53\u524d\u72b6\u6001.\n2. \u6293\u53d6\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u5bfc\u81f4\u7cfb\u7edf\u5f02\u5e38, \u56e0\u4e3a\u5176oom\u4f1a\u88ab\u8c03\u9ad8, \u5728\u5185\u5b58\u4e0d\u8db3\u65f6\u5bfc\u81f4\u7cfb\u7edf\u5176\u4ed6\u5e94\u7528\u88abkill.\n3. \u7531\u4e8ebugreport\u7684\u6743\u9650\u4f1a\u964d\u4f4e\u5230shell, \u800c\u5f88\u591a\u670d\u52a1\u5728\u4f1a\u62d2\u7edddumpsys\u7684\u64cd\u4f5c, \u5bfc\u81f4\u90e8\u5206\u4fe1\u606f\u65e0\u6cd5\u6293\u53d6. \n\n\n\n\n\u4f7f\u7528\u65b9\u6cd5:\n\n\n\n\n\n\n\u901a\u8fc7bugreport\u547d\u4ee4\u6293\u53d6\u4e00\u4efdbugreport\u539f\u59cb\u7684\u6587\u672clog\uff1a\n    \nshell# bugreport\ngt;/data/local/tmp/bugreport.txt\n\n\n\n\n\n\n\u5c06\u4e0a\u9762\u547d\u4ee4\u6293\u53d6\u7684bugreport.txt\u6587\u672c\u6587\u4ef6\u62f7\u8d1d\u51fa\u6765\uff0c\u4e0a\u4f20\u5230bugreport\u5206\u6790\u670d\u52a1\u5668\u4e0a\u9762\uff0c\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u5f53\u524d\u72b6\u6001\u5feb\u7167\uff0c\u4e0a\u4f20\u65b9\u6cd5\u5982\u4e0b\uff1a\n  a. \u901a\u8fc7\u6d4f\u89c8\u5668\u8fdb\u5165\u670d\u52a1\u5668\u5730\u5740\uff1ahttp://10.27.254.108:8080/,\u5982\u4e0b\u56fe\uff1a\n  \n\n\n\n\n\n\nb. \u70b9\u51fbbroswer\u6d4f\u89c8report.txt\u6587\u672c\u6587\u4ef6\uff0c\u7136\u540e\u70b9\u51fbupload\u6309\u94ae\u4e0a\u4f20\u6587\u4ef6\uff0c\u4e0a\u4f20\u540e\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u72b6\u6001\u5feb\u7167\uff0c\u5feb\u7167\u540d\u79f0\u5bf9\u5e94\u5230\u4e0a\u4f20\u65f6\u95f4\uff0c\u70b9\u51fb\u5feb\u7167\u540d\u79f0\u8fdb\u5165\u7cfb\u7edf\u5206\u6790\u9875\u9762\uff0c\u5982\u4e0b\uff1a\n  \n\n\n\u8be5\u7f51\u9875\u670d\u52a1\u5668\u7684dockerfile\u5982\u4e0b:\n\n\nFROM ubuntu:14.04\n MAINTAINER wertherzhang \nwerther0331@gmail.com\n\n\n RUN apt-get update\n\n RUN apt-get -y install openjdk-7-jdk openjdk-7-jre\n RUN apt-get -y install python\n\n RUN mkdir -p /root/chkbugreport\n RUN apt-get -y install wget\n RUN wget http://10.27.8.54/chkbugreport.tgz -O /root/chkbugreport.tgz\n RUN tar xvf /root/chkbugreport.tgz -C /tmp/\n RUN mkdir -p /root/bin\n\n ADD server.py /root/chkbugreport/\n ADD chkbugreport.jar /root/bin/\n ADD chkbugreport /usr/local/bin/\n ADD ddmlib.jar /root/bin/\n\n RUN apt-get clean\n\n ENV JAVA_HOME /usr/lib/jvm/java-7-openjdk-amd64\n ENV PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n WORKDIR /root/chkbugreport/\n\n CMD [\npython\n, \nserver.py\n]\n\n\n\n\n\n\u9644\u4ef6: \nchkbugreport-server.zip\n\n\n\u5e94\u7528\u5185\u5b58\u5206\u6790\n\n\nandroid\u81ea\u5e26\u5de5\u5177\n\n\ndumpsys meminfo \u5e94\u7528\u5185\u5b58 \n\n\n\u573a\u666f: \u67e5\u770bjava\u8fdb\u7a0b\u7684\u4e0d\u540c\u7c7b\u522b\u5185\u5b58\u5360\u7528\u60c5\u51b5, \u7279\u522b\u662f\u786e\u5b9aactivity\u662f\u5426\u6cc4\u9732\u7b49\u4fe1\u606f.\n\n\n\u547d\u4ee4 \ndumpsys meminfo com.china_liantong.launcher -d\n\n\n\u8f93\u51fa:\n\n\nshell@zx1800:/ \n# dumpsys meminfo com.china_liantong.launcher -d                \n\nApplications Memory Usage \n(\nkB\n)\n:\nUptime: \n2612261\n Realtime: \n2612261\n\n\n** MEMINFO in pid \n884\n \n[\ncom.china_liantong.launcher\n]\n **\n                   Pss  Private  Private  Swapped     Heap     Heap     Heap\n                 Total    Dirty    Clean    Dirty     Size    Alloc     Free\n                ------   ------   ------   ------   ------   ------   ------\n  Native Heap     \n5915\n     \n5440\n        \n0\n        \n0\n    \n24576\n    \n16208\n     \n8367\n\n  Dalvik Heap    \n13764\n    \n13364\n        \n0\n        \n0\n    \n26989\n    \n20896\n     \n6093\n\n Dalvik Other      \n248\n      \n248\n        \n0\n        \n0\n                           \n        Stack      \n513\n      \n512\n        \n0\n        \n0\n                           \n    Other dev        \n4\n        \n0\n        \n4\n        \n0\n                           \n     .so mmap     \n3392\n      \n424\n      \n472\n        \n0\n                           \n    .apk mmap       \n94\n        \n0\n        \n4\n        \n0\n                           \n    .ttf mmap     \n1573\n        \n0\n      \n568\n        \n0\n                           \n    .dex mmap     \n1188\n        \n0\n      \n752\n        \n0\n                           \n    .oat mmap     \n1419\n        \n0\n      \n260\n        \n0\n                           \n    .art mmap      \n979\n      \n616\n        \n0\n        \n0\n                           \n   Other mmap       \n80\n        \n4\n        \n0\n        \n0\n                           \n   EGL mtrack       \n17\n       \n17\n        \n0\n        \n0\n                           \n      Unknown      \n134\n      \n128\n        \n0\n        \n0\n                           \n        TOTAL    \n29320\n    \n20753\n     \n2060\n        \n0\n    \n51565\n    \n37104\n    \n14460\n\n\n Objects\n               Views:     \n1192\n         ViewRootImpl:        \n1\n\n         AppContexts:        \n3\n           Activities:        \n1\n\n              Assets:        \n2\n        AssetManagers:        \n2\n\n       Local Binders:       \n41\n        Proxy Binders:      \n220\n\n       Parcel memory:        \n7\n         Parcel count:       \n14\n\n    Death Recipients:       \n10\n      OpenSSL Sockets:        \n0\n\n\n SQL\n         MEMORY_USED:        \n0\n\n  PAGECACHE_OVERFLOW:        \n0\n          MALLOC_SIZE:        \n0\n\n\n\n\n\n\nNative Heap\n: native\u5206\u914d\u5360\u7528\u7684RAM, \u901a\u8fc7malloc\u7533\u8bf7\u7684\u5185\u5b58. \nHeap Size\n \u662f\u5185\u5b58\u6c60\u603b\u5927\u5c0f(\u5411\u7cfb\u7edf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f). \nHeap Alloc\n \u5df2\u7ecf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f(\u5e94\u7528\u5411dlmalloc\u7533\u8bf7\u7684\u5185\u5b58). \nHeap Free\n \u5185\u5b58\u6c60\u5269\u4f59\u53ef\u5206\u914d\u5185\u5b58\u5927\u5c0f.\n\n\nDalvik Heap\n: \u5e94\u7528\u4e2dDalvi\u5206\u914d\u5360\u7528\u7684RAM. \nPss Total\n: \u5305\u542b\u6240\u6709Zygote\u5206\u914d(\u901a\u8fc7\u8fdb\u7a0b\u95f4\u5171\u4eab\u5360\u7528). \nPrivate Dirty\n: \u4ec5\u5206\u914d\u5230\u5e94\u7528\u7684\u5b9e\u9645RAM, \u7531\u5e94\u7528\u5206\u914d\u6216\u8005zygote\u5206\u914d\u9875, \u8fd9\u4e9b\u9875\u81ea\u4ecezygote fork\u5e94\u7528\u8fdb\u7a0b\u540e\u88ab\u4fee\u6539\u8fc7.\n\n\n.so map\n \u548c \n.dex map\n: mmap\u7684.so\u548c.dex(Dalvik\u6216ART)\u4ee3\u7801\u5360\u7528\u7684RAM. \nPss Total\n \u6570\u503c\u5305\u62ec\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\u7684\u5e73\u53f0\u4ee3\u7801\uff1b\nPrivate Clean\n \u662f\u60a8\u7684\u5e94\u7528\u81ea\u5df1\u7684\u4ee3\u7801\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u6620\u5c04\u7684\u5185\u5b58\u66f4\u5927 - \u6b64\u5904\u7684 RAM \u4ec5\u4e3a\u5e94\u7528\u6267\u884c\u7684\u4ee3\u7801\u5f53\u524d\u6240\u9700\u7684 RAM\u3002\u4e0d\u8fc7\uff0c.so mmap \u5177\u6709\u8f83\u5927\u7684\u79c1\u6709\u810f RAM\uff0c\u56e0\u4e3a\u5728\u52a0\u8f7d\u5230\u5176\u6700\u7ec8\u5730\u5740\u65f6\u5bf9\u539f\u751f\u4ee3\u7801\u8fdb\u884c\u4e86\u4fee\u6539(GOT?!)\u3002 \n\n\n.oat mmap\n: \u4ee3\u7801\u6620\u50cf\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6587\u4ef6\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002 \n\n\n.art mmap\n: \u5806\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6620\u50cf\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002\u5c3d\u7ba1 ART \u6620\u50cf\u5305\u542b Object \u5b9e\u4f8b\uff0c\u5b83\u4ecd\u7136\u4e0d\u4f1a\u8ba1\u5165\u60a8\u7684\u5806\u5927\u5c0f\u3002 \n\n\nUnknown\n: \u7cfb\u7edf\u65e0\u6cd5\u5c06\u5176\u5206\u7c7b\u5230\u5176\u4ed6\u66f4\u5177\u4f53\u7684\u4e00\u4e2a\u9879\u4e2d\u7684\u4efb\u4f55 RAM \u9875\u3002 \u5176 \nPss Total\n \u4e0e Zygote\u5171\u4eab.\n\n\nTOTAL\n: \u4e0a\u65b9\u6240\u6709 PSS \u5b57\u6bb5\u7684\u603b\u548c\u3002\u8868\u793a\u60a8\u7684\u8fdb\u7a0b\u5360\u7528\u7684\u5185\u5b58\u91cf\u5360\u6574\u4f53\u5185\u5b58\u7684\u6bd4. \nPrivate Dirty\n \u548c \nPrivate Clean\n \u662f\u60a8\u7684\u8fdb\u7a0b\u4e2d\u7684\u603b\u5206\u914d\uff0c\u672a\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u3002\u5b83\u4eec\uff08\u5c24\u5176\u662f Private Dirty\uff09\u7b49\u4e8e\u60a8\u7684\u8fdb\u7a0b\u88ab\u7834\u574f\u540e\u5c06\u91ca\u653e\u56de\u7cfb\u7edf\u4e2d\u7684 RAM \u91cf\u3002\nDirty\n\u56e0\u4e3a\u5df2\u88ab\u4fee\u6539\u800c\u5fc5\u987b\u4fdd\u6301\u5728 RAM \u4e2d\u7684 RAM \u9875\uff08\u56e0\u4e3a\u6ca1\u6709\u4ea4\u6362\uff09\uff1b\nClean\n \u662f\u5df2\u4ece\u67d0\u4e2a\u6301\u4e45\u6027\u6587\u4ef6\uff08\u4f8b\u5982\u6b63\u5728\u6267\u884c\u7684\u4ee3\u7801\uff09\u6620\u5c04\u7684 RAM \u9875\uff0c\u5982\u679c\u4e00\u6bb5\u65f6\u95f4\u4e0d\u7528\uff0c\u53ef\u4ee5\u79fb\u51fa\u5206\u9875\u3002\n\n\nViewRootImpl\n: \u8fdb\u7a0b\u4e2d\u5f53\u524d\u6d3b\u52a8\u7684\u6839\u89c6\u56fe\u6570\u91cf\u3002\u6bcf\u4e2a\u6839\u89c6\u56fe\u90fd\u4e0e\u4e00\u4e2a\u7a97\u53e3\u5173\u8054\uff0c\u56e0\u6b64\u6709\u52a9\u4e8e\u786e\u5b9a\u6d89\u53ca\u5bf9\u8bdd\u6846\u6216\u5176\u4ed6\u7a97\u53e3\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \n\n\nAppContexts\n \u548c \nActivities\n: \u5f53\u524d\u6d3b\u52a8\u7684\u5e94\u7528 Context \u548c Activity \u5bf9\u8c61\u6570\u91cf\u3002\u5feb\u901f\u786e\u5b9a\u7531\u4e8e\u5b58\u5728\u9759\u6001\u5f15\u7528\uff08\u6bd4\u8f83\u5e38\u89c1\uff09\u800c\u65e0\u6cd5\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u5df2\u6cc4\u6f0f Activity \u5bf9\u8c61\u3002\u8fd9\u4e9b\u5bf9\u8c61\u7ecf\u5e38\u62e5\u6709\u5f88\u591a\u5173\u8054\u7684\u5176\u4ed6\u5206\u914d\uff0c\u56e0\u6b64\u6210\u4e3a\u8ddf\u8e2a\u5927\u578b\u5185\u5b58\u6cc4\u6f0f\u7684\u4e00\u79cd\u4e0d\u9519\u7684\u65b9\u5f0f\u3002\n\n\n\u4f8b\u5b50\u89c1\u5185\u5b58\u6cc4\u9732\u90e8\u5206.\n\n\nprocmem  \n\n\n\u573a\u666f: \u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u5404\u90e8\u5206\u5185\u5b58\u5360\u7528\u60c5\u51b5.\n\u547d\u4ee4: \nprocmem \npid\n\n\u4f8b\u5b50: \nprocmem 2509\n\n\u6570\u636e\u6765\u6e90: \n/proc/\npid\n/maps\n \u548c \n/proc/\npid\n/pagemap\n\n\nVss      Rss      Pss      Uss     ShCl     ShDi     PrCl     PrDi  Name\n\n\n\n\n\u5404\u5b57\u6bb5\u542b\u4e49:\n\n\nShCl  --  shared clean\nShDi  --  shared dirty\nPrCl  --  private clean\nPrDi  --  private dirty\n\n\n\n\n\nshowmap \n\n\n\u573a\u666f: \u8fdb\u7a0b\u865a\u62df\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5185\u5b58\u5206\u914d\u60c5\u51b5 \u548c \u8be6\u7ec6\u7684\u5e72\u51c0\u810f\u6570\u636e\u4fe1\u606f.\n\n\n\u4ece \n/proc/[pid]/smaps\n \u83b7\u53d6\u6570\u636e\u5e76\u7edf\u8ba1\u7684\u5de5\u5177.\n\n\n\u547d\u4ee4: \nshowmap [-a] [-t] [-v] \npid\n\n\u4f8b\u5b50: \nshowmap -a 884\n\n\u8f93\u51fa\u5355\u4f4d: KB\n\n\n\n\n\u7531\u4e8e\u73b0\u5728\u5185\u6838\u90fd\u4f7f\u7528\u4e86\u52a8\u6001\u5185\u5b58\u5206\u914d\u7684\u673a\u5236, \u5728\u5927\u91cf\u7533\u8bf7\u5c0f\u5185\u5b58\u7684\u60c5\u51b5\u4e0b, \u4ece\u7cfb\u7edf\u770b\u5185\u5b58\u6709\u5269\u4f59, \u4f46\u662f\u8fdb\u7a0b\u5374\u65e0\u6cd5\u5206\u914d\u51fa\u9700\u8981\u7684\u5185\u5b58, \u8fd9\u5c31\u6709\u53ef\u80fd\u662f\u7531\u4e8e\u865a\u62df\u5730\u5740\u7684\u5185\u5b58\u788e\u7247\u5f15\u8d77, \u65e0\u6cd5\u627e\u5230\u4e00\u6bb5\u5927\u4e8e\u6240\u8bf7\u6c42\u5185\u5b58\u5927\u5c0f\u7684\u5730\u5740\u7a7a\u95f4. \n\n\n\u4f8b\u5b50:\n\n\nAndroid \u5e94\u7528 OOM\n\n\n\u89e6\u53d1OOM\u7684\u539f\u56e0\u662f, java\u5c42\u5185\u5b58\u5206\u914d\u5931\u8d25\u4e86.\n\n\n\u9020\u6210\u5185\u5b58\u5206\u914d\u5931\u8d25\u7684\u53ef\u80fd\u539f\u56e0\u5982\u4e0b:\n\n\n\n\n\u5185\u5b58\u6ea2\u51fa. \u7533\u8bf7\u7684\u5185\u5b58\u8d85\u51fa\u4e86\u865a\u62df\u673a\u6700\u5927\u5185\u5b58.\n\n\n\u788e\u7247, \u5bfc\u81f4\u65e0\u6cd5\u627e\u5230\u8fde\u7eed\u7a7a\u95f4\u6ee1\u8db3\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f.\n\n\n\u8d44\u6e90\u95ee\u9898, \u6bd4\u5982\u6587\u4ef6\u8282\u70b9\u8d85\u8fc7\u9650\u5236, \u5bfc\u81f4\u533f\u540d\u5185\u5b58\u7533\u8bf7\u51fa\u9519, \u9519\u8bef\u4fe1\u606f\u4e3a \"Too many open files\"\n\n\n\u865a\u62df\u7a7a\u95f4\u5730\u5740\u7a7a\u95f4\u88ab\u5360\u6ee1, \u5bfc\u81f4OOM.\n\n\n\n\n\u4ee5\u4e0a\u4e3a\u7f51\u4e0a\u7684\u7ed3\u8bba, \u5728android5.1.1\u4e0a\u6d4b\u8bd5\u53d1\u73b0:\n\n\nfd\u95ee\u9898\u5e76\u4e0d\u4f1a\u5bfc\u81f4OOM\n\n\n\u4ee3\u7801\u590d\u7528\u4e0b\u9762\u5185\u5b58\u6cc4\u9732\u7684\u4ee3\u7801,\u5728asynctask\u4e2d\u6267\u884c\u6587\u4ef6\u6253\u5f00\u64cd\u4f5c.\n\n\n\n\nlogcat\u4e2d\u8f93\u51fa\u5982\u4e0b, \u5e76\u6ca1\u6709OOM\u8f93\u51fa:\n\n\n\n\n\u4f46\u662f\u8fd9\u6bb5\u4ee3\u7801\u7684\u786e\u8bc1\u660e\u4e86\u6253\u5f00\u6587\u4ef6\u592a\u591a\u4f1a\u5bfc\u81f4shmem\u521b\u5efa\u5931\u8d25.\n\n\n\u5185\u5b58\u6cc4\u9732\u5206\u6790\n\n\nactivity \u6cc4\u9732 \n\n\nactivity \u7684\u6cc4\u9732\u57fa\u4e8eandroid\u81ea\u5e26\u5de5\u5177, \u53ef\u4ee5\u5feb\u901f\u786e\u5b9a, \u4f46\u662f\u5177\u4f53\u6cc4\u9732\u7684activity, \u9700\u8981\u4f9d\u8d56\u5de5\u5177 LeakCanary.\n\n\n\u4ee3\u7801:\n\n\n\n\u754c\u9762:\n\n\n\n\n\u5728\u7b2c\u4e00\u6b21\u8fdb\u5165\u8be5\u5e94\u7528\u65f6:\n\n\n\n\n\u6309\u4e0bBUTTON, \u7136\u540e\u9000\u51fa\u5e94\u7528:\n\n\n\n\n\u7b2c\u4e8c\u6b21\u8fdb\u5165\u8be5\u5e94\u7528:\n\n\n\n\n\u7b2c\u4e8c\u6b21\u6309\u4e0bBUTTON:\n\n\n\n\n\u7b2c\u4e8c\u6b21\u9000\u51fa\u5e94\u7528:\n\n\n\n\n\u57fa\u4e8e \ndumpsys meminfo\n \u786e\u8ba4\u5e94\u7528\u6709activity\u6cc4\u9732\u540e, \u5355\u7eaf\u901a\u8fc7UI\u64cd\u4f5c\u57fa\u672c\u4e5f\u53ef\u4ee5\u5224\u65ad\u51fa\u6765\u54ea\u4e2aactivity\u6cc4\u9732, \u66f4\u51c6\u786e\u7684\u6cc4\u9732\u68c0\u6d4b\u5de5\u5177\u662f LeakCanary, \u8be5\u5de5\u5177\u4e3a\u7b2c\u4e09\u65b9\u5de5\u5177. \n\n\u5177\u4f53\u7528\u6cd5: https://www.liaohuqiu.net/cn/posts/leak-canary-read-me/\n\n\n\u8fd8\u662f\u4ee5\u4e0a\u7684\u4f8b\u5b50, \u989d\u5916\u589e\u52a0\u5982\u4e0b\u4ee3\u7801. \n\n\n\u5728MainActivity\u589e\u52a0\u5982\u4e0b\u4ee3\u7801, \u8be5\u4ee3\u7801\u7684\u542b\u4e49\u662f, \u5728activity\u89e6\u53d1onDestroy\u65f6, \u76d1\u63a7\u8be5activity\u5bf9\u8c61.\n\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        LeakApplication.getRefWatcher().watch(this);\n\n    }\n\n\n\n\n\n\u589e\u52a0application, \u5982\u4e0b:\n\n\n\n\u7f16\u8bd1\u8fd0\u884c, \u6267\u884c\u4e0a\u9762\u540c\u6837\u7684\u64cd\u4f5c. \u5728\u901a\u77e5\u4e2d\u5fc3\u6709\u5982\u4e0b\u663e\u793a:\n\n\n\n\n\u70b9\u51fb\u540e\u53ef\u4ee5\u67e5\u770b\u8be6\u7ec6\u7684\u5806\u6808:\n\n\n\n\n\u540c\u6837\u5728logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:\n\n\n\n\nStrictMode\u68c0\u6d4b\u5e94\u7528\u5185\u5b58\u6cc4\u9732 \n\n\n\u540c\u6837\u662f\u4e0a\u9762\u7684\u4f8b\u5b50, \u4fee\u6539\u4ee3\u7801\u5982\u4e0b, \u589e\u52a0strickmode\u7684\u8c03\u7528:\n\n\n\n\n\u540c\u6837\u7684\u4e0a\u9762\u64cd\u4f5c\u65b9\u6cd5, logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:\n\n\n\n\n\u57fa\u4e8elibc\u8c03\u8bd5\u5185\u5b58\u6cc4\u9732 \n\n\n\u5185\u5b58\u6cc4\u9732\u7684\u68c0\u6d4b\u4f9d\u636e\u662f, \u8fdb\u7a0b\u9000\u51fa\u65f6, \u8fd8\u6709\u672a\u91ca\u653e\u7684\u5185\u5b58. \u6240\u4ee5, valgrind\u5305\u62ecbionic libc\u4e2d, \u80fd\u7cbe\u786e\u68c0\u6d4b\u5230\u6cc4\u9732\u7684\u524d\u63d0\u6761\u4ef6\u5c31\u662f\u8fdb\u7a0b\u9000\u51fa. \u4f46\u662f\u8fd9\u4e2a\u5bf9\u4e8e\u7cfb\u7edf\u7ea7\u522b\u7684\u8fdb\u7a0b\u662f\u65e0\u7528\u7684, \u56e0\u4e3a\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u5e76\u4e0d\u4f1a\u9000\u51fa. \u4eceRD\u89d2\u5ea6, \u5224\u65ad\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u662f\u5426\u6cc4\u9732\u7684\u4f9d\u636e\u662f\u5185\u5b58\u662f\u5426\u6301\u7eed\u589e\u957f, \u7279\u522b\u662f\u5728\u538b\u529b\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b. \u6240\u4ee5, \u8fd9\u4e2a\u90e8\u5206\u4ecb\u7ecd\u7684\u5de5\u5177, \u5b9e\u9645\u4e0a\u662f\u6293\u53d6\u4e86\u6301\u7eed\u589e\u957f\u7684\u5185\u5b58\u4fe1\u606f, \u8fd9\u4e9b\u4fe1\u606f, \u53ef\u80fd\u662f\u5185\u5b58\u6cc4\u9732, \u4e5f\u53ef\u80fd\u662f\u8fdb\u7a0b\u6b63\u5e38\u7533\u8bf7\u7684\u5185\u5b58, \u9700\u8981RD\u4ecb\u5165\u5224\u65ad.\n\n\n\u9644\u4ef6: \nMemleak_tools_android.zip\n\n\n\u4f9d\u8d56\u5de5\u5177:\n\n\n\n\nlibc_malloc_debug_leak.so\n , bionic\u6e90\u7801\u4e0b, \u9700\u8981\u7f16\u8bd1\u5e76push\u5230\u7cfb\u7edf\u4e2d\n\n\nlibmemleakutils.so\n, \u4eceandroid\u63d0\u53d6\u5e76\u66f4\u6539. \u4ece\u9644\u4ef6\u6e90\u7801\u4e0b\u8f7d\u7f16\u8bd1, \u9700\u8981push\u5230\u7cfb\u7edf\u4e2d.\n\n\naddr2func.py, \u8be5\u811a\u672c\u80fd\u81ea\u52a8\u5c06\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808. \u5728\u9644\u4ef6\u4e2d.\n\n\nmemincrease.py, \u8be5\u811a\u672c\u80fd\u5c06\u4e0a\u4e00\u811a\u672c\u7684\u8f93\u51fa, \u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f,  \u6309\u5185\u5b58\u589e\u52a0\u4ece\u5927\u5230\u5c0f\u6392\u5e8f. \u57fa\u672c\u6700\u9876\u4e0a\u7684\u662f\u5b58\u5728\u95ee\u9898\u7684. \u5728\u9644\u4ef6\u4e2d.\n\n\n\n\n\u5c40\u9650:\n\n\n\n\n\u53ea\u80fd\u8c03\u8bd5native\u8fdb\u7a0b.\n\n\n\u8fdb\u7a0b\u4e0d\u80fd\u91cd\u542f.\n\n\n\u9700\u8981\u538b\u529b\u6d4b\u8bd5, \u957f\u65f6\u95f4\u8fd0\u884c\n\n\n\u9700\u8981RD\u4ecb\u5165\u5224\u65ad\u662f\u5426\u5b58\u5728\u6cc4\u9732.\n\n\n\n\n\u7528\u6cd5:\n\n\n\n\n\u5c06libmemleakutils.so\u5e93\u94fe\u63a5\u5230\u88ab\u8c03\u8bd5\u7a0b\u5e8f\u4e2d, \u8c03\u7528\u51fd\u6570\nstart_memleak_watcher(memstep)\n, \u5176\u4e2dmemstep\u8868\u793a, pss\u6bcf\u589e\u52a0memstep, \u5219\u6293\u53d6\u4e00\u6b21\u5f53\u524d\u5185\u5b58\u5206\u914d\u4fe1\u606f.\n\n\n\u5c06libmemleakutils.so \u548c \nlibc_malloc_debug_leak.so\n push\u5230/system/lib/\u4e0b.\n\n\n\u5c06\u88ab\u8c03\u8bd5\u7a0b\u5e8fpush\u5230 /system/bin/ \u4e0b.\n\n\n\u8bbe\u7f6e property \nlibc.debug.malloc.program\n \u4e3a \u4f60\u7684\u8c03\u8bd5\u8fdb\u7a0b\u540d\u5b57.\n\n\n\u8bbe\u7f6e property \nlibc.debug.malloc\n \u4e3a 1\n\n\nstop \u6216\u8005 kill \u88ab\u8c03\u8bd5\u8fdb\u7a0b.\n\n\nstart \u6216\u8005 \u542f\u52a8 \u88ab\u8c03\u8bd5\u8fdb\u7a0b.\n\n\n\u538b\u529b\u6d4b\u8bd5\u540e, \u68c0\u67e5 /data/local/tmp/ \u5e95\u4e0b\u5b58\u5728\u6587\u4ef6 \nmem_snapshot_$pid_$memsize.log\n, \u4e14\u4e2a\u6570\u5927\u4e8e2\u4e2a(\u8d8a\u591a\u8d8a\u597d).\n\n\ncp /proc/${pid}/maps /data/local/tmp/\n\n\n\u5c06 /data/local/tmp/ \u5e95\u4e0b\u6240\u6709\u6587\u4ef6\u590d\u5236\u5230host\u673a\u5668.\n\n\n\u7528 diff \u547d\u4ee4\u6bd4\u8f83 \u4e24\u4e2a \nmem_snapshot_$pid_$memsize.log\n, \u5e76\u4fdd\u5b58\u8f93\u51fa\u4e3a \ndiff_$pid_$memsize1_$memsize2.log\n\n\n\u6267\u884c \n./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_$pid_$memsize1_$memsize2.log \n mem_stack_$pid_$memsize1_$memsize2.log\n, \u8be5\u8fc7\u7a0b\u662f\u5c06diff\u751f\u6210\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808\u4fe1\u606f.\n\n\n\u6267\u884c \n./memincrease.py mem_stack_$pi_$memsize1_$memsize2.log incr_$pid_$memsize1_$memsize2.log\n, \u8be5\u8fc7\u7a0b\u662f\u5bf912\u751f\u6210\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f, \u4ece\u5927\u5230\u5c0f\u6392\u5e8f.\n\n\n\n\n\u4f8b\u5b50:\n\n\n\n\n\u8fd0\u884c\u4e00\u4f1a\u513f\u540e, \u5728 /data/local/tmp/\u76ee\u5f55\u4e0b\u5b58\u5728\u6587\u4ef6:\n\n\nmem_snapshot_2158_1.log\nmem_snapshot_2158_2.log\nmem_snapshot_2158_3.log\nmem_snapshot_2158_4.log\n\n\n\n\n\n\u5176\u5185\u5bb9\u5982\u4e0b:\n\n\n Allocation count \n5\n\n Total memory \n6293072\n\nsize  \n5242880\n, dup    \n1\n, 0xb6ed36b2, 0xb6f4cd4e, 0xb6f1da44, 0xb6f1de38, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92\nsize  \n1048576\n, dup    \n1\n, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\nsize     \n1024\n, dup    \n1\n, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\nsize      \n580\n, dup    \n1\n, 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f510c8, 0xb6f1decc, 0xb6fc838c, 0xb6f4ce68, 0xb6fc8400\nsize       \n12\n, dup    \n1\n, 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f14c46, 0xb6f1dd98, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92\n\n\n\n\n\n\u6267\u884cdiff\u547d\u4ee4:\n\n\n# diff ./mem_snapshot_2158_1.log ./mem_snapshot_2158_2.log \n diff_2158_1_2.log\n\n\n# \n\n\n# diff ./mem_snapshot_2158_3.log ./mem_snapshot_2158_4.log \n diff_2158_3_4.log\n\n\n#\n\n\n\n\n\n\n\u5f97\u5230\u4e00\u4e2aPSS\u4ece1M\u589e\u957f\u52302M\u548c3M\u589e\u957f\u52304M\u7684\u4e24\u4e2adiff\u6587\u4ef6. \u5185\u5bb9\u5982\u4e0b:\n\n\n2c2\n\n  Total memory 6293072\n---\n\n  Total memory 7342672\n4,5c4,5\n\n size  1048576, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\n\n size     1024, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\n---\n\n size  1048576, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\n\n size     1024, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\n\n\n\n\n\n\n\u6267\u884c addr2func.py :\n\n\n# ./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_2158_3_4.log \n mem_stack_2158_3_4.log\n\n\n\n\n\n\n\u751f\u6210\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b:\n\n\n2c2                                                                                                                                                                              \n[\n0\n/59466\n]\n\n\n\n  Total memory \n8392272\n\n\n---\n\n\n  Total memory \n9441872\n\n\n\n4\n,5c4,5\n\n\n size  \n1048576\n, dup    \n3\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n size     \n1024\n, dup    \n3\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n---\n\n\n size  \n1048576\n, dup    \n4\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n size     \n1024\n, dup    \n4\n,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n\n\n\n\n\u6240\u6709\u7684\u5730\u5740\u88ab\u8f6c\u6362\u6210\u4e86\u961f\u957f.\n\n\n\u6700\u540e\u6267\u884c memincrease.py :\n\n\n./memincrease.py mem_stack_2158_3_4.log incr_2158_3_4.log\n\n\n\n\n\n\u751f\u6210\u7684\u6587\u4ef6 incr_2158_3_4.log \u5185\u5bb9\u5982\u4e0b:\n\n\nMemory increase \n1048576\n bytes                   \n### \u5185\u5b58\u589e\u52a0\u4e86 1048576 bytes\n\n98990365afa0d71d62949620cc7e3753f386e4e3\nold size \n1048576\n count \n3\n, total memory \n3145728\n       \n### \u4ece 3145728\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n98990365afa0d71d62949620cc7e3753f386e4e3\nnew size \n1048576\n count \n4\n, total memory \n4194304\n      \n### \u589e\u52a0\u5230 4194304\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\nMemory increase \n1024\n bytes\n833f23c991cc75facaa41fb74f7466b91c27917b\nold size \n1024\n count \n3\n, total memory \n3072\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n833f23c991cc75facaa41fb74f7466b91c27917b\nnew size \n1024\n count \n4\n, total memory \n4096\n\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315 \n(\ndiscriminator \n1\n)\n\n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1\n()\n, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26 \n(\ndiscriminator \n1\n)\n\n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\n\n\n\n\n\u57fa\u672c\u4e0a, \u5c06\u6700\u9876\u4e0a\u7684\u51e0\u4e2a\u5806\u6808\u786e\u8ba4\u4e0b\u662f\u5426\u5185\u5b58\u6cc4\u9732\u5373\u53ef.\n\n\n\u7279\u522b\u6ce8\u610f:\n\n\n\n\n\u7c7b\u6cc4\u9732\u65f6, \u5728\u5806\u6808\u4e0a\u7684\u8868\u73b0\u662f\u5176\u6210\u5458\u5185\u5b58\u6cc4\u9732. \u9700\u8981\u67e5\u770b\u5806\u6808\u662f\u5426\u6709\u8be5\u7c7b\u5bf9\u8c61\u7684new\u65b9\u6cd5, \u5e76\u4e14\u8be5\u65b9\u6cd5\u662f\u5426\u5728\u591a\u5904\u5b58\u5728.\n\n\n\n\nvalgrind \u8c03\u8bd5\u5185\u5b58\u6cc4\u9732\n\n\n\u573a\u666f: \u5bf9\u4e8e\u53ef\u9000\u51fa\u7684\u8fdb\u7a0b\u8fdb\u884c\u8c03\u8bd5\u6bd4\u8f83\u5408\u9002, \u53ef\u4ee5\u5bf9\u5e94\u7528\u7684native\u4ee3\u7801\u8fdb\u884c\u8c03\u8bd5.\n\n\n\u76ee\u524dhdtv\u4ee3\u7801\u4e0a\u7684 valgrind \u65e0\u6cd5\u83b7\u53d6\u88ab\u8c03\u8bd5\u8fdb\u7a0b\u7684\u5806\u6808, \u53ea\u80fd\u83b7\u53d6\u5b83\u81ea\u5df1\u5e93\u7684\u5806\u6808, \u5b58\u5728\u95ee\u9898. \u6682\u65f6\u65e0\u6cd5\u4f7f\u7528.", 
            "title": "Android\u5185\u5b58\u8c03\u8bd5\u603b\u7ed3"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#android", 
            "text": "", 
            "title": "Android\u5185\u5b58\u8c03\u8bd5\u5de5\u5177\u603b\u7ed3"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#_1", 
            "text": "\u7cfb\u7edf\u5185\u5b58\u5206\u6790, \u6240\u6709\u8fdb\u7a0b\u5185\u5b58\u5206\u6790  \u57fa\u672c\u7684 logcat \u8f93\u51fa\u4e2d\u53ef\u80fd\u5305\u542b\u7684GC\u76f8\u5173\u4fe1\u606f, \u53ef\u4ee5\u4f5c\u4e3a\u7cfb\u7edf\u6216\u67d0\u4e9b\u5e94\u7528\u5185\u5b58\u72b6\u51b5\u7684\u53c2\u8003\u4f9d\u636e.  \u5728SystemServer\u542f\u52a8\u7684\u60c5\u51b5\u4e0b, \u8fd8\u53ef\u4ee5\u901a\u8fc7  dumpsys meminfo  \u4eceframework\u5c42\u89d2\u5ea6\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u7684\u72b6\u51b5, \u8be5\u90e8\u5206\u4fe1\u606f\u4e0e\u4ece\u7cfb\u7edf\u89d2\u5ea6\u83b7\u53d6\u7684\u4fe1\u606f\u5b58\u5728\u5dee\u5f02.  \u5bf9\u4e8e\u9700\u8981\u6392\u5e8f\u5e76\u67e5\u627e\u5185\u5b58\u5360\u7528\u6700\u591a\u7684\u8fdb\u7a0b, \u63a8\u8350\u4f7f\u7528\u547d\u4ee4  procrank  \u5728\u5b9e\u5728\u7f3a\u5c11\u5de5\u5177, \u6216\u8005RD\u77e5\u9053\u9700\u8981\u4ec0\u4e48\u4fe1\u606f\u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u67e5\u770b /proc/meminfo  \u5982\u679c\u9700\u8981\u8fde\u7eed\u76d1\u63a7\u7cfb\u7edf\u7684\u72b6\u6001(\u5185\u5b58/CPU\u7b49), \u53ef\u4ee5\u8003\u8651\u5de5\u5177 vmstat  \u5982\u679c\u9700\u8981\u4ece\u5171\u4eab\u5e93\u6216\u8005\u5171\u4eab\u5185\u5b58\u7684\u89d2\u5ea6\u5206\u6790\u5176\u5185\u5b58\u5360\u7528\u7684\u60c5\u51b5, \u53ef\u4ee5\u8003\u8651\u7528  librank , \u5f53\u7136, \u5982\u679c\u5b58\u5728host\u7aef\u7684\u5206\u6790\u5de5\u5177, \u5219\u8be5\u5de5\u5177\u7684\u8f93\u51fa\u53ef\u4ee5\u9876\u66ff procrank \u548c procmem .  \u5982\u679c\u9700\u8981\u67e5\u770b\u7cfb\u7edf\u4e2d\u54ea\u4e9b\u5171\u4eab\u6587\u4ef6\u522b\u901a\u8fc7\u7f3a\u9875\u9519\u8bef\u7684\u65b9\u5f0f\u8bfb\u5230\u5185\u5b58, \u53ef\u4ee5\u4f7f\u7528\u5de5\u5177 dumpcache  \u5982\u679c\u5b9e\u5728\u4e0d\u77e5\u9053bug\u539f\u56e0\u6216\u8005\u95ee\u9898\u53ef\u80fd\u8ddf\u81ea\u5df1\u65e0\u5173, \u5efa\u8bae\u4f7f\u7528  bugreport , \u4f9b\u5176\u4ed6RD\u534f\u52a9\u5206\u6790\u95ee\u9898.    \u6307\u5b9a\u5e94\u7528(dalvik\u8fdb\u7a0b)\u5185\u5b58\u5206\u6790  dumpsys meminfo \u5e94\u7528\u5185\u5b58  \u8f93\u51fa\u5f53\u524d\u8fdb\u7a0b/\u5e94\u7528\u7684\u6240\u6709\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u5efa\u8bae\u53ea\u9488\u5bf9dalvik\u5c42\u7684\u8fdb\u7a0b.    \u6307\u5b9anative\u8fdb\u7a0b\u5185\u5b58\u5206\u6790  native\u7684\u5355\u4e2a\u8fdb\u7a0b\u5185\u5b58\u5206\u6790\u5efa\u8bae\u4f7f\u7528  procmem \u548c  showmap .  showmap  \u989d\u5916\u8f93\u51fa\u4e86\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4, \u53ef\u4ee5\u8f85\u52a9\u67e5\u770b\u7531\u4e8e\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f15\u8d77\u7684\u5185\u5b58\u95ee\u9898.    \u5e94\u7528\u5185\u5b58\u6cc4\u9732  \u5c11\u90e8\u5206\u7684\u6cc4\u9732, \u6bd4\u5982\u6570\u636e\u5e93/activity\u7b49, \u901a\u8fc7 dumpsys meminfo \u5e94\u7528\u5185\u5b58 , \u4f46\u53ea\u80fd\u77e5\u9053\u5b58\u5728\u6cc4\u9732.  \u5e94\u7528\u5728\u5f00\u542f  strictmode  \u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u53d1\u73b0\u66f4\u591a\u7684\u8d44\u6e90\u6cc4\u9732\u60c5\u51b5. \u4f46\u4ec5\u9650\u4e8e\u53d1\u73b0.  \u4e00\u4e2a\u6bd4\u8f83\u63a8\u8350\u7684\u7528\u4e8e\u5b9a\u4e49\u5e94\u7528\u5185\u5b58\u6cc4\u9732\u7684\u5de5\u5177\u662f  LeakCanary    native\u8fdb\u7a0b\u5185\u5b58\u6cc4\u9732  \u57fa\u4e8ebionic\u7684\u5185\u5b58\u6cc4\u9732\u5206\u6790\u5de5\u5177 , \u8be5\u5de5\u5177\u5bf9\u4e8eRD\u4f7f\u7528\u8981\u6c42\u504f\u9ad8.    bugreport \u4fe1\u606f\u5206\u6790  \u89c1\u5916\u90e8\u6587\u6863.", 
            "title": "\u7d22\u5f15"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#_2", 
            "text": "VSS - Virtual Set Size \u865a\u62df\u8017\u7528\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nRSS - Resident Set Size \u5b9e\u9645\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\nPSS - Proportional Set Size \u5b9e\u9645\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58, USS + \u6bd4\u4f8b\u5206\u914d\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff08[\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u7684\u5185\u5b58(RSS - USS)] / [\u5206\u4eab\u5171\u4eab\u5185\u5b58\u7684\u8fdb\u7a0b\u6570\u91cf]\uff09.\nUSS - Unique Set Size \u8fdb\u7a0b\u72ec\u81ea\u5360\u7528\u7684\u7269\u7406\u5185\u5b58\uff08\u4e0d\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09      \n\u5982\u679c\u770b\u8fdb\u7a0b\u72ec\u5360\u5185\u5b58\uff0c\u3000\u5219\u4f7f\u7528USS. \u4f46\u662f\u4e00\u822c\u8003\u8651\u5230\u5171\u4eab\u5185\u5b58\u7684\u60c5\u51b5, \u5927\u90e8\u5206\u90fd\u662f\u4f9d\u636ePSS\u67e5\u770b\u5bf9\u5e94\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528.  shared clean: \u5e72\u51c0\u7684\u5171\u4eab\u6570\u636e, \u4e5f\u5c31\u662f\u8bf4, \u5f53\u524d\u6709\u591a\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6307\u5411\u8be5\u7269\u7406\u7a7a\u95f4, \u4e14\u5f53\u524d\u8fdb\u7a0b\u7a7a\u95f4\u8be5\u6570\u636e\u4e0edisk\u4e0a\u4e00\u81f4.\nshared dirty: \u810f\u5171\u4eab\u6570\u636e, \u4e0e\u4e0a\u9762\u5bf9\u5e94, \u8be5\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5171\u4eab\u6570\u636e\u4e0edisk\u4e0a\u6570\u636e\u4e0d\u4e00\u81f4.\nprivate clean: \u8fdb\u7a0b\u79c1\u6709\u5e72\u51c0\u6570\u636e, \u4e0edisk\u6570\u636e\u4e00\u81f4.\nprivate dirty: \u8fdb\u7a0b\u79c1\u6709\u810f\u6570\u636e, \u4e0edisk\u6570\u636e\u4e0d\u4e00\u81f4.", 
            "title": "\u57fa\u7840\u6982\u5ff5"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#_3", 
            "text": "", 
            "title": "\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\u5206\u6790"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#logcat", 
            "text": "", 
            "title": "logcat \u8f93\u51fa "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#dalvik", 
            "text": "\u573a\u666f: \u5728\u5e94\u7528\u968f\u673a\u51fa\u73b0\u6162\u65f6, \u53ef\u4ee5\u770b\u770b\u90a3\u6bb5\u65f6\u95f4logcat\u7684\u8f93\u51fa, \u662f\u5426\u5305\u542bGC\u7684\u4e00\u4e9b\u4fe1\u606f. GC\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u6162, \u800c\u7cfb\u7edf\u53d1\u8d77\u7684GC\u5219\u610f\u5473\u7740\u5185\u5b58\u4e0d\u591f, \u53ef\u80fd\u51fa\u73b0\u4ece\u78c1\u76d8\u52a0\u8f7d\u7684\u60c5\u51b5.  \u5728logcat\u4e2d\u4f1a\u6253\u5370dalvik\u7684\u5783\u573e\u56de\u6536\u4fe1\u606f.  D/dalvikvm:  GC_Reason   Amount_freed ,  Heap_stats ,  External_memory_stats ,  Pause_time \nD/dalvikvm( 9050): GC_CONCURRENT freed 2049K, 65% free 3571K/9991K, external 4703K/5261K, paused 2ms+2ms   GC_Reason :  GC_CONCURRENT \n    \u5728\u60a8\u7684\u5806\u5f00\u59cb\u5360\u7528\u5185\u5b58\u65f6\u53ef\u4ee5\u91ca\u653e\u5185\u5b58\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002 GC_FOR_MALLOC \n    \u5806\u5df2\u6ee1\u800c\u7cfb\u7edf\u4e0d\u5f97\u4e0d\u505c\u6b62\u60a8\u7684\u5e94\u7528\u5e76\u56de\u6536\u5185\u5b58\u65f6\uff0c\u60a8\u7684\u5e94\u7528\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u800c\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002 GC_HPROF_DUMP_HEAP \n    \u5f53\u60a8\u8bf7\u6c42\u521b\u5efa HPROF \u6587\u4ef6\u6765\u5206\u6790\u5806\u65f6\u51fa\u73b0\u7684\u5783\u573e\u56de\u6536\u3002 GC_EXPLICIT \n    \u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\u5f53\u60a8\u8c03\u7528 gc() \u65f6\uff08\u60a8\u5e94\u907f\u514d\u8c03\u7528\uff0c\u800c\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u4f1a\u6839\u636e\u9700\u8981\u8fd0\u884c\uff09\u3002 GC_EXTERNAL_ALLOC \n    \u8fd9\u4ec5\u9002\u7528\u4e8e API \u7ea7\u522b 10 \u53ca\u66f4\u4f4e\u7ea7\u522b\uff08\u66f4\u65b0\u7248\u672c\u4f1a\u5728 Dalvik \u5806\u4e2d\u5206\u914d\u4efb\u4f55\u5185\u5b58\uff09\u3002\u5916\u90e8\u5206\u914d\u5185\u5b58\u7684\u5783\u573e\u56de\u6536\uff08\u4f8b\u5982\u5b58\u50a8\u5728\u539f\u751f\u5185\u5b58\u6216 NIO \u5b57\u8282\u7f13\u51b2\u533a\u4e2d\u7684\u50cf\u7d20\u6570\u636e\uff09\u3002   Amount_freed : \n\u4ece\u6b64\u6b21\u5783\u573e\u56de\u6536\u4e2d\u56de\u6536\u7684\u5185\u5b58\u91cf\u3002  Heap_stats :  \u5806\u7684\u53ef\u7528\u7a7a\u95f4\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002   External_memory_stats :  API \u7ea7\u522b 10 (Android3.0 \u4ee5\u4e0b)\u53ca\u66f4\u4f4e\u7ea7\u522b\u7684\u5916\u90e8\u5206\u914d\u5185\u5b58\uff08\u5df2\u5206\u914d\u5185\u5b58\u91cf\uff09/\uff08\u53d1\u751f\u56de\u6536\u7684\u9650\u503c\uff09. \u800c\u65b0API\u4e2d, \u7edf\u4e00\u7531dalvik\u7ba1\u7406.   Pause_time   \u5806\u8d8a\u5927\uff0c\u6682\u505c\u65f6\u95f4\u8d8a\u957f\u3002\u5e76\u53d1\u6682\u505c\u65f6\u95f4\u663e\u793a\u4e86\u4e24\u4e2a\u6682\u505c\uff1a\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5f00\u59cb\u65f6\uff0c\u53e6\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5feb\u8981\u5b8c\u6210\u65f6\u3002", 
            "title": "dalvik\u65e5\u5fd7\u6253\u5370"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#art", 
            "text": "\u4e0e Dalvik \u4e0d\u540c\uff0cART \u4e0d\u4f1a\u4e3a\u672a\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\u8bb0\u5f55\u6d88\u606f\u3002\u53ea\u6709\u5728\u8ba4\u4e3a\u5783\u573e\u56de\u6536\u901f\u5ea6\u8f83\u6162\u65f6\u624d\u4f1a\u6253\u5370\u5783\u573e\u56de\u6536\u3002\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u4ec5\u5728\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8d85\u8fc7 5ms \u6216\u5783\u573e\u56de\u6536\u6301\u7eed\u65f6\u95f4\u8d85\u8fc7 100ms \u65f6\u3002\u5982\u679c\u5e94\u7528\u672a\u5904\u4e8e\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\uff0c\u90a3\u4e48\u5176\u5783\u573e\u56de\u6536\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u8f83\u6162\u3002\u59cb\u7ec8\u4f1a\u8bb0\u5f55\u663e\u5f0f\u5783\u573e\u56de\u6536\u3002  I/art:  GC_Reason   GC_Name   Objects_freed ( Size_freed ) AllocSpace Objects,  Large_objects_freed ( Large_object_size_freed )  Heap_stats  LOS objects,  Pause_time(s) \n\nI/art : Explicit concurrent mark sweep GC freed 104710(7MB) AllocSpace objects, 21(416KB) LOS objects, 33% free, 25MB/38MB, paused 1.230ms total 67.216ms  GC_Reason :  Concurrent \n    \u4e0d\u4f1a\u6682\u505c\u5e94\u7528\u7ebf\u7a0b\u7684\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\u6b64\u5783\u573e\u56de\u6536\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u800c\u4e14\u4e0d\u4f1a\u963b\u6b62\u5206\u914d\u3002 Alloc \n    \u60a8\u7684\u5e94\u7528\u5728\u5806\u5df2\u6ee1\u65f6\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u5f15\u8d77\u7684\u5783\u573e\u56de\u6536\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5206\u914d\u7ebf\u7a0b\u4e2d\u53d1\u751f\u4e86\u5783\u573e\u56de\u6536\u3002 Explicit \n    \u7531\u5e94\u7528\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\uff0c\u901a\u8fc7\u8c03\u7528 gc() \u6216 gc()\u3002\u4e0e Dalvik \u76f8\u540c\uff0c\u5728 ART \u4e2d\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u60a8\u5e94\u4fe1\u4efb\u5783\u573e\u56de\u6536\u5e76\u907f\u514d\u8bf7\u6c42\u663e\u5f0f\u5783\u573e\u56de\u6536\uff08\u5982\u679c\u53ef\u80fd\uff09\u3002\u4e0d\u5efa\u8bae\u4f7f\u7528\u663e\u5f0f\u5783\u573e\u56de\u6536\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u963b\u6b62\u5206\u914d\u7ebf\u7a0b\u5e76\u4e0d\u5fc5\u8981\u5730\u6d6a\u8d39 CPU \u5468\u671f\u3002\u5982\u679c\u663e\u5f0f\u5783\u573e\u56de\u6536\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u88ab\u62a2\u5360\uff0c\u90a3\u4e48\u5b83\u4eec\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\uff08\u5e94\u7528\u4e2d\u51fa\u73b0\u95f4\u65ad\u3001\u6296\u52a8\u6216\u6682\u505c\uff09\u3002 NativeAlloc \n    \u539f\u751f\u5206\u914d\uff08\u5982\u4f4d\u56fe\u6216 RenderScript \u5206\u914d\u5bf9\u8c61\uff09\u5bfc\u81f4\u51fa\u73b0\u539f\u751f\u5185\u5b58\u538b\u529b\uff0c\u8fdb\u800c\u5f15\u8d77\u7684\u56de\u6536\u3002 CollectorTransition \n    \u7531\u5806\u8f6c\u6362\u5f15\u8d77\u7684\u56de\u6536\uff1b\u6b64\u56de\u6536\u7531\u8fd0\u884c\u65f6\u5207\u6362\u5783\u573e\u56de\u6536\u5f15\u8d77\u3002\u56de\u6536\u5668\u8f6c\u6362\u5305\u62ec\u5c06\u6240\u6709\u5bf9\u8c61\u4ece\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u590d\u5236\u5230\u78b0\u649e\u6307\u9488\u7a7a\u95f4\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002\u5f53\u524d\uff0c\u56de\u6536\u5668\u8f6c\u6362\u4ec5\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u51fa\u73b0\uff1a\u5728 RAM \u8f83\u5c0f\u7684\u8bbe\u5907\u4e0a\uff0c\u5e94\u7528\u5c06\u8fdb\u7a0b\u72b6\u6001\u4ece\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u72b6\u6001\u53d8\u66f4\u4e3a\u53ef\u5bdf\u89c9\u7684\u975e\u6682\u505c\u72b6\u6001\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002  HomogeneousSpaceCompact \n    \u9f50\u6027\u7a7a\u95f4\u538b\u7f29\u662f\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u5230\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u538b\u7f29\uff0c\u901a\u5e38\u5728\u5e94\u7528\u8fdb\u5165\u5230\u53ef\u5bdf\u89c9\u7684\u6682\u505c\u8fdb\u7a0b\u72b6\u6001\u65f6\u53d1\u751f\u3002\u8fd9\u6837\u505a\u7684\u4e3b\u8981\u539f\u56e0\u662f\u51cf\u5c11 RAM \u4f7f\u7528\u91cf\u5e76\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\u3002  DisableMovingGc \n    \u8fd9\u4e0d\u662f\u771f\u6b63\u7684\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u53d1\u751f\u5e76\u53d1\u5806\u538b\u7f29\u65f6\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86 GetPrimitiveArrayCritical\uff0c\u56de\u6536\u906d\u5230\u963b\u6b62\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 GetPrimitiveArrayCritical\uff0c\u56e0\u4e3a\u5b83\u5728\u79fb\u52a8\u56de\u6536\u5668\u65b9\u9762\u5177\u6709\u9650\u5236\u3002  HeapTrim \n    \u8fd9\u4e0d\u662f\u5783\u573e\u56de\u6536\u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5806\u4fee\u526a\u5b8c\u6210\u4e4b\u524d\u56de\u6536\u4f1a\u4e00\u76f4\u53d7\u5230\u963b\u6b62\u3002   GC_Name :  ART \u5177\u6709\u53ef\u4ee5\u8fd0\u884c\u7684\u591a\u79cd\u4e0d\u540c\u7684\u5783\u573e\u56de\u6536\u3002   Concurrent mark sweep (CMS) \n    \u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u91ca\u653e\u548c\u56de\u6536\u6620\u50cf\u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002 Concurrent partial mark sweep \n    \u51e0\u4e4e\u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u56de\u6536\u9664\u4e86\u6620\u50cf\u7a7a\u95f4\u548c zygote \u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002  Concurrent sticky mark sweep \n    \u751f\u6210\u56de\u6536\u5668\uff0c\u53ea\u80fd\u91ca\u653e\u81ea\u4e0a\u6b21\u5783\u573e\u56de\u6536\u4ee5\u6765\u5206\u914d\u7684\u5bf9\u8c61\u3002\u6b64\u5783\u573e\u56de\u6536\u6bd4\u5b8c\u6574\u6216\u90e8\u5206\u6807\u8bb0\u6e05\u9664\u8fd0\u884c\u5f97\u66f4\u9891\u7e41\uff0c\u56e0\u4e3a\u5b83\u66f4\u5feb\u901f\u4e14\u6682\u505c\u65f6\u95f4\u66f4\u77ed\u3002  Marksweep + semispace \n    \u975e\u5e76\u53d1\u3001\u590d\u5236\u5783\u573e\u56de\u6536\uff0c\u7528\u4e8e\u5806\u8f6c\u6362\u4ee5\u53ca\u9f50\u6027\u7a7a\u95f4\u538b\u7f29\uff08\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002   Objects_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002  Size_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002  Large_objects_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002  Large_object_size_freed :  \u6b64\u6b21\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002  Heap_stats  \u7a7a\u95f2\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002  Pause_time(s)  \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6682\u505c\u65f6\u95f4\u4e0e\u5783\u573e\u56de\u6536\u8fd0\u884c\u65f6\u4fee\u6539\u7684\u5bf9\u8c61\u5f15\u7528\u6570\u91cf\u6210\u6b63\u6bd4\u3002\u5f53\u524d\uff0cART CMS \u5783\u573e\u56de\u6536\u4ec5\u5728\u5783\u573e\u56de\u6536\u5373\u5c06\u5b8c\u6210\u65f6\u6682\u505c\u4e00\u6b21\u3002\u79fb\u52a8\u7684\u5783\u573e\u56de\u6536\u6682\u505c\u65f6\u95f4\u8f83\u957f\uff0c\u4f1a\u5728\u5927\u90e8\u5206\u5783\u573e\u56de\u6536\u671f\u95f4\u6301\u7eed\u51fa\u73b0\u3002", 
            "title": "art\u65e5\u5fd7\u6253\u5370"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#android_1", 
            "text": "", 
            "title": "android\u81ea\u5e26\u5de5\u5177"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#dumpsys-meminfo", 
            "text": "https://developer.android.com/studio/profile/investigate-ram.html\nhttp://gityuan.com/2016/01/02/memory-analysis-command/  \u573a\u666f: \u67e5\u770bdalvik\u7b49\u533a\u57df\u5185\u5b58\u60c5\u51b5.  root@zx1800:/data # dumpsys meminfo\nApplications Memory Usage (kB):                                           --- \u4ee5\u4e0b\u5185\u5b58\u5355\u4f4d\nUptime: 618252294 Realtime: 618252294                                     --- Realtime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u5305\u542b\u4f11\u7720, \u51c6\u786e\u6027\u4f9d\u8d56\u9a71\u52a8\u5b9e\u73b0. \u5728\u9a71\u52a8\u65e0\u5b9e\u73b0\u65f6, \u4f7f\u7528Uptime.\n                                                                          --- Uptime: \u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u8ba1\u65f6, \u4e0d\u5305\u542b\u4f11\u7720.\n\nTotal PSS by process:                                                     --- \u6240\u6709\u8fdb\u7a0b PSS \u5360\u7528\u6392\u5e8f\n    24712 kB: system (pid 445)\n    19600 kB: com.china_liantong.upgrade (pid 2660)\n    17500 kB: com.china_liantong.video (pid 3002 / activities)\n    11100 kB: com.china_liantong.oam (pid 999)\n    10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n     8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n     8394 kB: com.china_liantong.ocnadservice (pid 942)\n     7622 kB: com.android.systemui (pid 677)\n     6708 kB: dhcpcd (pid 639)\n     6541 kB: com.china_liantong.epg (pid 1235)\n     6286 kB: android.process.media (pid 2041)\n     5691 kB: com.china_liantong.airsharingservice (pid 2063)\n     4466 kB: dvbserver (pid 211)\n     4041 kB: mediaserver (pid 196)\n     3890 kB: com.china_liantong.xmppservice (pid 887)\n     3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n     3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     2466 kB: surfaceflinger (pid 183)\n     2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n     1955 kB: logd (pid 178)\n     1943 kB: com.china_liantong.tvframe (pid 1066)\n     1847 kB: com.china_liantong.playback (pid 923)\n     1640 kB: zygote (pid 220)\n      615 kB: sdcard (pid 1698)\n      473 kB: netd (pid 191)\n      415 kB: sysinfod (pid 184)\n      392 kB: vold (pid 182)\n      364 kB: developed (pid 222)\n      356 kB: adbd (pid 224)\n      350 kB: sh (pid 12684)\n      285 kB: /init (pid 1)\n      279 kB: dvbresourceserver (pid 210)\n      261 kB: sdcard (pid 223)\n      258 kB: avsettingd (pid 215)\n      240 kB: sh (pid 1325)\n      164 kB: ueventd (pid 159)\n      135 kB: keystore (pid 201)\n       82 kB: servicemanager (pid 181)\n       81 kB: installd (pid 199)\n       76 kB: healthd (pid 179)\n       62 kB: lmkd (pid 180)\n       26 kB: drmserver (pid 195)\n       26 kB: systemtaskd (pid 202)\n       22 kB: frontpaneld (pid 207)\n       15 kB: common_time (pid 189)\n       15 kB: frontpadserver (pid 216)\n       15 kB: dcaseventsvr (pid 219)\n        9 kB: sh (pid 190)\n        9 kB: debuggerd (pid 192)\n\nTotal PSS by OOM adjustment:                                              --- \u4ee5OOM\u7c7b\u522b\u5212\u5206(TODO: \u6bcf\u4e2a\u7c7b\u522b\u4f9d\u636e\u548c\u542b\u4e49)\n    26301 kB: Native\n                6708 kB: dhcpcd (pid 639)\n                4466 kB: dvbserver (pid 211)\n                4041 kB: mediaserver (pid 196)\n                2466 kB: surfaceflinger (pid 183)\n                1955 kB: logd (pid 178)\n                1640 kB: zygote (pid 220)\n                 615 kB: sdcard (pid 1698)\n                 473 kB: netd (pid 191)\n                 415 kB: sysinfod (pid 184)\n                 392 kB: vold (pid 182)\n                 364 kB: developed (pid 222)\n                 356 kB: adbd (pid 224)\n                 350 kB: sh (pid 12684)\n                 285 kB: /init (pid 1)\n                 279 kB: dvbresourceserver (pid 210)\n                 261 kB: sdcard (pid 223)\n                 258 kB: avsettingd (pid 215)\n                 240 kB: sh (pid 1325)\n                 164 kB: ueventd (pid 159)\n                 135 kB: keystore (pid 201)\n                  82 kB: servicemanager (pid 181)\n                  81 kB: installd (pid 199)\n                  76 kB: healthd (pid 179)\n                  62 kB: lmkd (pid 180)\n                  26 kB: drmserver (pid 195)\n                  26 kB: systemtaskd (pid 202)\n                  22 kB: frontpaneld (pid 207)\n                  15 kB: common_time (pid 189)\n                  15 kB: frontpadserver (pid 216)\n                  15 kB: dcaseventsvr (pid 219)\n                   9 kB: sh (pid 190)\n                   9 kB: debuggerd (pid 192)\n    24712 kB: System\n               24712 kB: system (pid 445)\n    48956 kB: Persistent\n               11100 kB: com.china_liantong.oam (pid 999)\n               10627 kB: com.china_liantong.channelmanagerservice (pid 961)\n                8394 kB: com.china_liantong.ocnadservice (pid 942)\n                7622 kB: com.android.systemui (pid 677)\n                3890 kB: com.china_liantong.xmppservice (pid 887)\n                3354 kB: com.china_liantong.tvmediaplayerservice (pid 905)\n                2122 kB: com.china_liantong.dtvsyskeyservice (pid 980)\n                1847 kB: com.china_liantong.playback (pid 923)\n    27280 kB: Foreground\n               17500 kB: com.china_liantong.video (pid 3002 / activities)\n                6541 kB: com.china_liantong.epg (pid 1235)\n                3239 kB: com.china_liantong.launcher:SettingContentProvider (pid 1165)\n     1943 kB: Visible\n                1943 kB: com.china_liantong.tvframe (pid 1066)\n     2214 kB: Perceptible\n                2214 kB: com.china_liantong.inputmethod.pinyin (pid 773)\n     6286 kB: Home\n                6286 kB: android.process.media (pid 2041)\n    34024 kB: B Services  (\u6ce8\u91ca: \u8001\u65e7\u7684, \u4e0d\u592a\u53ef\u80fd\u88ab\u4f7f\u7528\u5230\u7684\u670d\u52a1\u8fdb\u7a0b)\n               19600 kB: com.china_liantong.upgrade (pid 2660)\n                8733 kB: com.china_liantong.live.service.LiveService (pid 2086)\n                5691 kB: com.china_liantong.airsharingservice (pid 2063)\n\nTotal PSS by category:                                               --- \u4ee5 category \u5212\u5206\n    49530 kB: Native\n    35318 kB: Dalvik\n    26569 kB: .so mmap\n    17158 kB: .oat mmap\n    16357 kB: .art mmap\n     8144 kB: .dex mmap\n     6671 kB: Stack\n     2822 kB: Dalvik Other\n     2635 kB: Other mmap\n     2160 kB: .ttf mmap\n     1892 kB: Other dev\n     1581 kB: Unknown\n      843 kB: .apk mmap\n       36 kB: EGL mtrack\n        0 kB: Cursor\n        0 kB: Ashmem\n        0 kB: Gfx dev\n        0 kB: .jar mmap\n        0 kB: GL mtrack\n        0 kB: Other mtrack\n\nTotal RAM: 443652 kB (status critical)\n Free RAM: 137634 kB (40310 cached pss + 9492 cached kernel + 87832 free)\n Used RAM: 168782 kB (131406 used pss + 37376 kernel)\n Lost RAM: 137236 kB\n     ZRAM: 10684 kB physical used for 32252 kB in swap (196604 kB total swap)\n           \u538b\u7f29\u540e\u5185\u5b58\u5360\u7528             \u88ab\u538b\u7f29\u5185\u5b58\n      KSM: 39500 kB saved from shared 5844 kB\n           85420 kB unshared; 99276 kB volatile\n   Tuning: 96 (large 96), oom 10240 kB, restore limit 3413 kB (low-ram)", 
            "title": "dumpsys meminfo "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#procrank", 
            "text": "\u573a\u666f: \u67e5\u770b\u5404\u4e2a\u8fdb\u7a0b\u7684PSS/USS \u5e76\u6bd4\u8f83  shell@zx1800:/ # procrank\n  PID       Vss      Rss      Pss      Uss  cmdline\n  884   589628K   89320K   30444K   23128K  com.china_liantong.launcher\n  447   617060K   74620K   25695K   20904K  system_server\n 1139   572780K   61160K   14848K   10160K  com.china_liantong.browserreceiver\n  209   125160K   25312K   13834K   12696K  /system/bin/dvbserver\n 1180   549556K   65992K   12433K    6192K  com.china_liantong.upgrade\n  807   554556K   48092K    9636K    7160K  com.china_liantong.ocnadservice\n  222   516596K   54256K    8960K    3152K  zygote\n  864   547692K   47220K    8431K    6024K  com.china_liantong.oam\n  827   552092K   46208K    8180K    5840K  com.china_liantong.channelmanagerservice\n  223    71580K   18580K    7156K    3928K  /system/bin/developed\n  955   529948K   44620K    6591K    4000K  com.china_liantong.epg\n  534   525112K   41324K    6233K    3816K  com.android.systemui\n  516   523764K   39424K    5949K    3884K  android.process.media\n  183    55092K   17936K    5935K    4284K  /system/bin/surfaceflinger\n 1066   525392K   41296K    5140K    2712K  com.china_liantong.live.service.LiveService\n  771   529900K   40224K    4864K    2888K  com.china_liantong.tvmediaplayerservice\n  753   525476K   37228K    4681K    2804K  com.china_liantong.xmppservice\n  201    53500K   12232K    4421K    3460K  /system/bin/mediaserver\n 1206   521008K   36324K    4288K    2580K  com.china_liantong.mytv\n  979   527892K   36256K    4201K    2080K  com.china_liantong.launcher:SettingContentProvider\n 1095   526240K   36480K    4145K    2368K  com.china_liantong.airsharingservice\n  601   518952K   37128K    3898K    1984K  com.china_liantong.inputmethod.pinyin\n  789   526912K   32468K    3309K    1832K  com.china_liantong.playback\n 1048   520468K   32616K    2799K     968K  com.china_liantong.live\n  846   525972K   32620K    2787K    1336K  com.china_liantong.dtvsyskeyservice\n 1252   519376K   31716K    2687K    1260K  com.china_liantong.video\n  907   524920K   32120K    2676K    1236K  com.china_liantong.tvframe\n  511    19896K    5168K    2350K    1208K  /system/bin/dhcpcd\n  210    25496K    6480K    1662K    1316K  /system/bin/avsettingd\n  178    18252K    2596K    1509K    1476K  /system/bin/logd\n  199    23564K    4880K    1273K    1004K  /system/bin/drmserver\n  217    18936K    2864K     826K     740K  /system/bin/frontpadserver\n  182    19568K    3176K     816K     636K  /system/bin/vold\n  205    12508K    2804K     718K     572K  /system/bin/keystore\n  184    16580K    2580K     681K     536K  /system/bin/sysinfod\n  197    21796K    1672K     538K     480K  /system/bin/netd\n 2135     9192K    1100K     532K     520K  procrank\n  189    17484K    1748K     481K     420K  /system/bin/common_time\n  208    17492K    1792K     479K     436K  /system/bin/dvbresourceserver\n  220    16400K    1672K     434K     388K  /system/bin/dcaseventsvr\n  225    16980K     508K     416K     416K  /sbin/adbd\n  224    15412K    1048K     356K     336K  /system/bin/sdcard\n 1434     9324K    1020K     338K     244K  sh\n  186    14820K     428K     336K     332K  /sbin/watchdog\n    1     8860K     396K     327K     316K  /init\n 1428     9324K    1008K     326K     232K  /system/bin/sh\n  206    14460K    1036K     310K     288K  /system/bin/systemtaskd\n  203     9412K    1012K     272K     248K  /system/bin/installd\n  207    14456K     992K     266K     244K  /system/bin/frontpaneld\n  179     9828K     316K     260K     256K  /sbin/healthd\n  180    10624K    1664K     184K     116K  /system/bin/lmkd\n  181     9460K     792K      98K      76K  /system/bin/servicemanager\n  198    10056K    1108K      64K      28K  /system/bin/debuggerd\n  160     8852K      56K      11K       4K  /sbin/ueventd\n                           ------   ------  ------\n                          230106K  155544K  TOTAL\n\nRAM: 443652K total, 38684K free, 0K buffers, 98768K cached, 1384K shmem, 21560K slab", 
            "title": "procrank "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#cat-procmeminfo", 
            "text": "\u573a\u666f: \u7cfb\u7edf\u5185\u5b58\u8be6\u7ec6\u4fe1\u606f  shell@zx1800:/ # cat /proc/meminfo                                             \nMemTotal:         443652 kB                      --- \u7cfb\u7edf\u53ef\u89c1\u7684\u603b\u7269\u7406\u5185\u5b58\nMemFree:           38584 kB                      --- \u7cfb\u7edf\u4e2d\u672a\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\nMemAvailable:     125556 kB                      --- \u53ef\u7528\u5185\u5b58 = MemFree + Cached + Buffers\nBuffers:               0 kB                      --- \u7528\u4e8e\u6587\u4ef6\u7f13\u51b2\u7684\u5185\u5b58\u5927\u5c0f\nCached:            98768 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\nSwapCached:          128 kB                      --- \u7528\u4e8e\u9ad8\u901f\u7f13\u5b58\u5668\u5360\u7528\u7684swap\u5927\u5c0f\nActive:           143160 kB                      --- \u6d3b\u8dc3\u4f7f\u7528\u4e2d\u7684\u5185\u5b58, \u4e00\u822c\u4e0d\u4f1a\u56de\u6536. = anon + file\nInactive:          87104 kB                      --- \u6700\u8fd1\u672a\u88ab\u4f7f\u7528\u7684\u5185\u5b58, \u53ef\u4ee5\u88ab\u56de\u6536. = anon + file\nActive(anon):      94348 kB\nInactive(anon):    38532 kB\nActive(file):      48812 kB\nInactive(file):    48572 kB\nUnevictable:           0 kB                      \nMlocked:               0 kB\nHighTotal:             0 kB                      \nHighFree:              0 kB\nLowTotal:         443652 kB\nLowFree:           38584 kB\nSwapTotal:        196604 kB                      --- swap\u5206\u533a\u5927\u5c0f\nSwapFree:         193784 kB                      --- swap\u5206\u533a\u5269\u4f59\u7a7a\u95f4\nDirty:                 0 kB                      \nWriteback:             0 kB\nAnonPages:        131492 kB                      --- \u533f\u540d\u9875\nMapped:            90688 kB                      --- map\u7684\u5185\u5b58\nShmem:              1384 kB                      --- \u5171\u4eab\u5185\u5b58, \u8ddf\u6587\u4ef6\u65e0\u5173\u7684\nSlab:              21604 kB                      --- kernel slab\u5206\u914d\u5668\nSReclaimable:       5464 kB\nSUnreclaim:        16140 kB\nKernelStack:        5424 kB                      --- \u5185\u6838\u6808\nPageTables:         7932 kB                      --- \u7ba1\u7406\u9875\u7684\u6570\u636e\u7ed3\u6784\u5927\u5c0f\nNFS_Unstable:          0 kB\nBounce:                0 kB\nWritebackTmp:          0 kB\nCommitLimit:      418428 kB\nCommitted_AS:    8764944 kB\nVmallocTotal:     565248 kB\nVmallocUsed:       55952 kB\nVmallocChunk:     472068 kB", 
            "title": "cat /proc/meminfo "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#vmstat", 
            "text": "\u573a\u666f: \u76d1\u63a7\u7cfb\u7edf\u72b6\u6001.  \u8be5\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f, \u8fdb\u7a0b\u961f\u5217, \u7cfb\u7edf\u5207\u6362, CPU\u65f6\u95f4\u5360\u6bd4\u7b49\u4fe1\u606f, \u5468\u671f\u6027\u52a8\u6001\u8f93\u51fa.  procs  memory                       system          cpu              \n r  b    free mapped   anon   slab    in   cs  flt  us ni sy id wa ir\n  0    0     38628    90844   131992    21688    5268   10257      0     5    0    6   99    0    0 \n  0    0     38628    90844   132008    21688    5271   10367      0     8    0    9   99    0    0 \n  0    0     38628    90844   132048    21688    5150   10497      0    10    1    8   99    0    0 \n  0    0     38628    90844   132100    21688    5112   10180      0     8    0    3   99    0    0 \n  0    0     38628    90844   132120    21688    5221   10289      0     8    0    4   99    0    0   \u603b\u517115\u5217\u53c2\u6570, \u4e2a\u53c2\u6570\u542b\u4e49\u5982\u4e0b:   procs(\u8fdb\u7a0b)  r: Running\u961f\u5217\u4e2d\u8fdb\u7a0b\u6570, \u8fd9\u4e2a\u503c\u8d85\u8fc7cpu\u4e2a\u6570\u5c31\u4f1a\u51fa\u73b0cpu\u74f6\u9888.  b: IO wait \u7684\u8fdb\u7a0b\u6570, \u8be5\u503c\u8fc7\u5927, \u53ef\u80fd\u662f\u7b49\u5f85\u6587\u4ef6\u64cd\u4f5c\u7684\u8fdb\u7a0b\u591a\u6216\u8005\u6587\u4ef6\u8bfb\u5199\u6162.    memory(\u5185\u5b58)  free: \u53ef\u7528\u5185\u5b58\u5927\u5c0f  mapped: mmap\u6620\u5c04\u7684\u5185\u5b58\u5927\u5c0f  anon: \u533f\u540d\u5185\u5b58\u5927\u5c0f, \u4e00\u822c\u7531malloc\u5f15\u8d77, \u6216\u8005\u533f\u540dmmap.  slab: slab\u7684\u5185\u5b58\u5927\u5c0f.    system(\u7cfb\u7edf)  in: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u7684\u4e2d\u65ad\u6b21\u6570(\u5305\u62ec\u65f6\u949f\u4e2d\u65ad), \u8fd9\u4e2a\u503c\u8d8a\u5927, \u5185\u6838\u6d88\u8017\u7684cpu\u65f6\u95f4\u8d8a\u591a.\u9700\u8981\u67e5\u770b /proc/interrupts \u4e0b\u4e2d\u65ad\u589e\u957f\u60c5\u51b5.  cs: \u6bcf\u4e2a\u95f4\u9694\u65f6\u95f4\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570  flt: major page faults. \u9700\u8981\u4ecedisk\u8bfb\u53d6\u6570\u636e\u7684\u7f3a\u9875\u9519\u8bef.    CPU (\u5904\u7406\u5668)  us: user time, \u6bd4\u8f83\u9ad8\u65f6\uff0c\u8bf4\u660e\u7528\u6237\u8fdb\u7a0b\u6d88\u8017\u7684cpu\u65f6\u95f4\u591a.  ni: nice time, \u88ab\u964d\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u5728\u7528\u6237\u6a21\u5f0f\u4e0b\u7684\u6267\u884cCPU\u65f6\u95f4\u767e\u5206\u6bd4.  sy: system time, \u7cfb\u7edf\u5185\u6838\u6d88\u8017\u7684CPU\u767e\u5206\u6bd4  id: idle time, \u7cfb\u7edf\u7a7a\u95f2\u65f6\u95f4\u767e\u5206\u6bd4  wa: iowait time, CPU\u5728\u7b49\u5f85IO\u5b8c\u6210\u65f6\u95f4\u5360\u6bd4  ir: interrupt time, \u7cfb\u7edf\u4e2d\u65ad\u8017\u65f6\u5360CPU\u767e\u5206\u6bd4     \u66f4\u591a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f, \u8bf7\u76f4\u63a5\u67e5\u770b  /proc/vmstat \nhttp://blog.csdn.net/macky0668/article/details/6839498", 
            "title": "vmstat "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#librank", 
            "text": "\u573a\u666f: \u4e0eprocrank\u4e92\u8865\u4f7f\u7528, \u662fprocmem\u7684\u6269\u5c55. \u663e\u793a\u6240\u6709\u8fdb\u7a0b\u7684\u4fe1\u606f, \u9700\u8981\u5de5\u5177\u7edf\u8ba1\u5206\u7c7b. \u4e5f\u53ef\u4ee5\u7528\u6765\u67e5\u770b\u6bcf\u4e2a\u5e93\u6216\u5171\u4eab\u6587\u4ef6\u771f\u5b9e\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f.  \u6570\u636e\u6765\u6e90\u4e0eprocmem\u4e00\u6837, \u4f46\u662fprocmem\u9488\u5bf9\u7684\u662f\u5355\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5. \u800clibrank\u662f\u663e\u793a\u67d0\u4e2a\u5e93\u6216\u8005\u6587\u4ef6\u88ab\u54ea\u4e9b\u8fdb\u7a0b\u5171\u4eab, \u5e76\u663e\u793a\u5360\u7528\u5927\u5c0f. \u5982\u4e0b\u56fe\u6240\u793a.", 
            "title": "librank "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#dumpcache", 
            "text": "\u8be5\u5de5\u5177\u662fandroid7.0\u4e4b\u540e\u624d\u6709\u7684\u5de5\u5177,\u7528\u4e8e\u67e5\u770b\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u6bcf\u4e2a\u6587\u4ef6\u88abcache\u5230\u5185\u5b58\u7684\u5927\u5c0f. \u8be5\u6587\u4ef6\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u7f3a\u9875\u9519\u8bef\u65f6\u52a0\u8f7d\u7684\u6587\u4ef6.  \u5728Launcher\u754c\u9762\u65f6\u7684\u8f93\u51fa\u5982\u4e0b:   \u7a33\u5b9a\u64ad\u653e1080P\u89c6\u9891\u65f6:  \u6309\u4e0b\u9065\u63a7\u5668\u786e\u5b9a\u952e\u663e\u793aUI\u65f6:  \u5bf9\u6bd4, \u53ef\u4ee5\u77e5\u9053\u5728\u64ad\u653e\u8fc7\u7a0b\u4e2d, \u663e\u793aUI\u65f6\u4e3b\u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u662f:", 
            "title": "dumpcache "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#bugreport", 
            "text": "Android\u7cfb\u7edf\u60f3\u8981\u6210\u4e3a\u4e00\u4e2a\u529f\u80fd\u5b8c\u5907\uff0c\u751f\u6001\u7e41\u8363\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u90a3\u5c31\u5fc5\u987b\u63d0\u4f9b\u5b8c\u6574\u7684\u5e94\u7528\u5f00\u53d1\u73af\u5883\u3002\u800c\u5728\u5e94\u7528\u5f00\u53d1\u4e2d\uff0capp\u7a0b\u5e8f\u7684\u8c03\u8bd5\u5206\u6790\u662f\u65e5\u5e38\u751f\u4ea7\u4e2d\u8fdb\u7a0b\u4f1a\u8fdb\u884c\u7684\u5de5\u4f5c\u3002Android\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u5206\u6790\u6574\u4e2a\u7cfb\u7edf\u5e73\u53f0\u548c\u67d0\u4e2aapp\u5728\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u5185\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e13\u95e8\u5f00\u53d1\u4e86bugreport\u5de5\u5177\u3002  \n\u8be5\u5de5\u5177\u7684\u7f3a\u70b9\u662f: \n1. \u8017\u65f6\u8fc7\u957f, \u53ea\u80fd\u6293\u53d6\u5f53\u524d\u72b6\u6001.\n2. \u6293\u53d6\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u5bfc\u81f4\u7cfb\u7edf\u5f02\u5e38, \u56e0\u4e3a\u5176oom\u4f1a\u88ab\u8c03\u9ad8, \u5728\u5185\u5b58\u4e0d\u8db3\u65f6\u5bfc\u81f4\u7cfb\u7edf\u5176\u4ed6\u5e94\u7528\u88abkill.\n3. \u7531\u4e8ebugreport\u7684\u6743\u9650\u4f1a\u964d\u4f4e\u5230shell, \u800c\u5f88\u591a\u670d\u52a1\u5728\u4f1a\u62d2\u7edddumpsys\u7684\u64cd\u4f5c, \u5bfc\u81f4\u90e8\u5206\u4fe1\u606f\u65e0\u6cd5\u6293\u53d6.    \u4f7f\u7528\u65b9\u6cd5:    \u901a\u8fc7bugreport\u547d\u4ee4\u6293\u53d6\u4e00\u4efdbugreport\u539f\u59cb\u7684\u6587\u672clog\uff1a\n     shell# bugreport gt;/data/local/tmp/bugreport.txt    \u5c06\u4e0a\u9762\u547d\u4ee4\u6293\u53d6\u7684bugreport.txt\u6587\u672c\u6587\u4ef6\u62f7\u8d1d\u51fa\u6765\uff0c\u4e0a\u4f20\u5230bugreport\u5206\u6790\u670d\u52a1\u5668\u4e0a\u9762\uff0c\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u5f53\u524d\u72b6\u6001\u5feb\u7167\uff0c\u4e0a\u4f20\u65b9\u6cd5\u5982\u4e0b\uff1a\n  a. \u901a\u8fc7\u6d4f\u89c8\u5668\u8fdb\u5165\u670d\u52a1\u5668\u5730\u5740\uff1ahttp://10.27.254.108:8080/,\u5982\u4e0b\u56fe\uff1a\n      b. \u70b9\u51fbbroswer\u6d4f\u89c8report.txt\u6587\u672c\u6587\u4ef6\uff0c\u7136\u540e\u70b9\u51fbupload\u6309\u94ae\u4e0a\u4f20\u6587\u4ef6\uff0c\u4e0a\u4f20\u540e\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u751f\u6210\u7cfb\u7edf\u72b6\u6001\u5feb\u7167\uff0c\u5feb\u7167\u540d\u79f0\u5bf9\u5e94\u5230\u4e0a\u4f20\u65f6\u95f4\uff0c\u70b9\u51fb\u5feb\u7167\u540d\u79f0\u8fdb\u5165\u7cfb\u7edf\u5206\u6790\u9875\u9762\uff0c\u5982\u4e0b\uff1a\n    \u8be5\u7f51\u9875\u670d\u52a1\u5668\u7684dockerfile\u5982\u4e0b:  FROM ubuntu:14.04\n MAINTAINER wertherzhang  werther0331@gmail.com \n\n RUN apt-get update\n\n RUN apt-get -y install openjdk-7-jdk openjdk-7-jre\n RUN apt-get -y install python\n\n RUN mkdir -p /root/chkbugreport\n RUN apt-get -y install wget\n RUN wget http://10.27.8.54/chkbugreport.tgz -O /root/chkbugreport.tgz\n RUN tar xvf /root/chkbugreport.tgz -C /tmp/\n RUN mkdir -p /root/bin\n\n ADD server.py /root/chkbugreport/\n ADD chkbugreport.jar /root/bin/\n ADD chkbugreport /usr/local/bin/\n ADD ddmlib.jar /root/bin/\n\n RUN apt-get clean\n\n ENV JAVA_HOME /usr/lib/jvm/java-7-openjdk-amd64\n ENV PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n WORKDIR /root/chkbugreport/\n\n CMD [ python ,  server.py ]  \u9644\u4ef6:  chkbugreport-server.zip", 
            "title": "bugreport \u4fe1\u606f\u5206\u6790 "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#_4", 
            "text": "", 
            "title": "\u5e94\u7528\u5185\u5b58\u5206\u6790"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#android_2", 
            "text": "", 
            "title": "android\u81ea\u5e26\u5de5\u5177"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#dumpsys-meminfo_1", 
            "text": "\u573a\u666f: \u67e5\u770bjava\u8fdb\u7a0b\u7684\u4e0d\u540c\u7c7b\u522b\u5185\u5b58\u5360\u7528\u60c5\u51b5, \u7279\u522b\u662f\u786e\u5b9aactivity\u662f\u5426\u6cc4\u9732\u7b49\u4fe1\u606f.  \u547d\u4ee4  dumpsys meminfo com.china_liantong.launcher -d  \u8f93\u51fa:  shell@zx1800:/  # dumpsys meminfo com.china_liantong.launcher -d                 \nApplications Memory Usage  ( kB ) :\nUptime:  2612261  Realtime:  2612261 \n\n** MEMINFO in pid  884   [ com.china_liantong.launcher ]  **\n                   Pss  Private  Private  Swapped     Heap     Heap     Heap\n                 Total    Dirty    Clean    Dirty     Size    Alloc     Free\n                ------   ------   ------   ------   ------   ------   ------\n  Native Heap      5915       5440          0          0      24576      16208       8367 \n  Dalvik Heap     13764      13364          0          0      26989      20896       6093 \n Dalvik Other       248        248          0          0                            \n        Stack       513        512          0          0                            \n    Other dev         4          0          4          0                            \n     .so mmap      3392        424        472          0                            \n    .apk mmap        94          0          4          0                            \n    .ttf mmap      1573          0        568          0                            \n    .dex mmap      1188          0        752          0                            \n    .oat mmap      1419          0        260          0                            \n    .art mmap       979        616          0          0                            \n   Other mmap        80          4          0          0                            \n   EGL mtrack        17         17          0          0                            \n      Unknown       134        128          0          0                            \n        TOTAL     29320      20753       2060          0      51565      37104      14460 \n\n Objects\n               Views:      1192          ViewRootImpl:         1 \n         AppContexts:         3            Activities:         1 \n              Assets:         2         AssetManagers:         2 \n       Local Binders:        41         Proxy Binders:       220 \n       Parcel memory:         7          Parcel count:        14 \n    Death Recipients:        10       OpenSSL Sockets:         0 \n\n SQL\n         MEMORY_USED:         0 \n  PAGECACHE_OVERFLOW:         0           MALLOC_SIZE:         0   Native Heap : native\u5206\u914d\u5360\u7528\u7684RAM, \u901a\u8fc7malloc\u7533\u8bf7\u7684\u5185\u5b58.  Heap Size  \u662f\u5185\u5b58\u6c60\u603b\u5927\u5c0f(\u5411\u7cfb\u7edf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f).  Heap Alloc  \u5df2\u7ecf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f(\u5e94\u7528\u5411dlmalloc\u7533\u8bf7\u7684\u5185\u5b58).  Heap Free  \u5185\u5b58\u6c60\u5269\u4f59\u53ef\u5206\u914d\u5185\u5b58\u5927\u5c0f.  Dalvik Heap : \u5e94\u7528\u4e2dDalvi\u5206\u914d\u5360\u7528\u7684RAM.  Pss Total : \u5305\u542b\u6240\u6709Zygote\u5206\u914d(\u901a\u8fc7\u8fdb\u7a0b\u95f4\u5171\u4eab\u5360\u7528).  Private Dirty : \u4ec5\u5206\u914d\u5230\u5e94\u7528\u7684\u5b9e\u9645RAM, \u7531\u5e94\u7528\u5206\u914d\u6216\u8005zygote\u5206\u914d\u9875, \u8fd9\u4e9b\u9875\u81ea\u4ecezygote fork\u5e94\u7528\u8fdb\u7a0b\u540e\u88ab\u4fee\u6539\u8fc7.  .so map  \u548c  .dex map : mmap\u7684.so\u548c.dex(Dalvik\u6216ART)\u4ee3\u7801\u5360\u7528\u7684RAM.  Pss Total  \u6570\u503c\u5305\u62ec\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\u7684\u5e73\u53f0\u4ee3\u7801\uff1b Private Clean  \u662f\u60a8\u7684\u5e94\u7528\u81ea\u5df1\u7684\u4ee3\u7801\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u6620\u5c04\u7684\u5185\u5b58\u66f4\u5927 - \u6b64\u5904\u7684 RAM \u4ec5\u4e3a\u5e94\u7528\u6267\u884c\u7684\u4ee3\u7801\u5f53\u524d\u6240\u9700\u7684 RAM\u3002\u4e0d\u8fc7\uff0c.so mmap \u5177\u6709\u8f83\u5927\u7684\u79c1\u6709\u810f RAM\uff0c\u56e0\u4e3a\u5728\u52a0\u8f7d\u5230\u5176\u6700\u7ec8\u5730\u5740\u65f6\u5bf9\u539f\u751f\u4ee3\u7801\u8fdb\u884c\u4e86\u4fee\u6539(GOT?!)\u3002   .oat mmap : \u4ee3\u7801\u6620\u50cf\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6587\u4ef6\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002   .art mmap : \u5806\u5360\u7528\u7684 RAM \u91cf\uff0c\u6839\u636e\u591a\u4e2a\u5e94\u7528\u901a\u5e38\u4f7f\u7528\u7684\u9884\u52a0\u8f7d\u7c7b\u8ba1\u7b97\u3002\u6b64\u6620\u50cf\u5728\u6240\u6709\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\uff0c\u4e0d\u53d7\u7279\u5b9a\u5e94\u7528\u5f71\u54cd\u3002\u5c3d\u7ba1 ART \u6620\u50cf\u5305\u542b Object \u5b9e\u4f8b\uff0c\u5b83\u4ecd\u7136\u4e0d\u4f1a\u8ba1\u5165\u60a8\u7684\u5806\u5927\u5c0f\u3002   Unknown : \u7cfb\u7edf\u65e0\u6cd5\u5c06\u5176\u5206\u7c7b\u5230\u5176\u4ed6\u66f4\u5177\u4f53\u7684\u4e00\u4e2a\u9879\u4e2d\u7684\u4efb\u4f55 RAM \u9875\u3002 \u5176  Pss Total  \u4e0e Zygote\u5171\u4eab.  TOTAL : \u4e0a\u65b9\u6240\u6709 PSS \u5b57\u6bb5\u7684\u603b\u548c\u3002\u8868\u793a\u60a8\u7684\u8fdb\u7a0b\u5360\u7528\u7684\u5185\u5b58\u91cf\u5360\u6574\u4f53\u5185\u5b58\u7684\u6bd4.  Private Dirty  \u548c  Private Clean  \u662f\u60a8\u7684\u8fdb\u7a0b\u4e2d\u7684\u603b\u5206\u914d\uff0c\u672a\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u3002\u5b83\u4eec\uff08\u5c24\u5176\u662f Private Dirty\uff09\u7b49\u4e8e\u60a8\u7684\u8fdb\u7a0b\u88ab\u7834\u574f\u540e\u5c06\u91ca\u653e\u56de\u7cfb\u7edf\u4e2d\u7684 RAM \u91cf\u3002 Dirty \u56e0\u4e3a\u5df2\u88ab\u4fee\u6539\u800c\u5fc5\u987b\u4fdd\u6301\u5728 RAM \u4e2d\u7684 RAM \u9875\uff08\u56e0\u4e3a\u6ca1\u6709\u4ea4\u6362\uff09\uff1b Clean  \u662f\u5df2\u4ece\u67d0\u4e2a\u6301\u4e45\u6027\u6587\u4ef6\uff08\u4f8b\u5982\u6b63\u5728\u6267\u884c\u7684\u4ee3\u7801\uff09\u6620\u5c04\u7684 RAM \u9875\uff0c\u5982\u679c\u4e00\u6bb5\u65f6\u95f4\u4e0d\u7528\uff0c\u53ef\u4ee5\u79fb\u51fa\u5206\u9875\u3002  ViewRootImpl : \u8fdb\u7a0b\u4e2d\u5f53\u524d\u6d3b\u52a8\u7684\u6839\u89c6\u56fe\u6570\u91cf\u3002\u6bcf\u4e2a\u6839\u89c6\u56fe\u90fd\u4e0e\u4e00\u4e2a\u7a97\u53e3\u5173\u8054\uff0c\u56e0\u6b64\u6709\u52a9\u4e8e\u786e\u5b9a\u6d89\u53ca\u5bf9\u8bdd\u6846\u6216\u5176\u4ed6\u7a97\u53e3\u7684\u5185\u5b58\u6cc4\u6f0f\u3002   AppContexts  \u548c  Activities : \u5f53\u524d\u6d3b\u52a8\u7684\u5e94\u7528 Context \u548c Activity \u5bf9\u8c61\u6570\u91cf\u3002\u5feb\u901f\u786e\u5b9a\u7531\u4e8e\u5b58\u5728\u9759\u6001\u5f15\u7528\uff08\u6bd4\u8f83\u5e38\u89c1\uff09\u800c\u65e0\u6cd5\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u5df2\u6cc4\u6f0f Activity \u5bf9\u8c61\u3002\u8fd9\u4e9b\u5bf9\u8c61\u7ecf\u5e38\u62e5\u6709\u5f88\u591a\u5173\u8054\u7684\u5176\u4ed6\u5206\u914d\uff0c\u56e0\u6b64\u6210\u4e3a\u8ddf\u8e2a\u5927\u578b\u5185\u5b58\u6cc4\u6f0f\u7684\u4e00\u79cd\u4e0d\u9519\u7684\u65b9\u5f0f\u3002  \u4f8b\u5b50\u89c1\u5185\u5b58\u6cc4\u9732\u90e8\u5206.", 
            "title": "dumpsys meminfo \u5e94\u7528\u5185\u5b58 "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#procmem", 
            "text": "\u573a\u666f: \u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u5404\u90e8\u5206\u5185\u5b58\u5360\u7528\u60c5\u51b5.\n\u547d\u4ee4:  procmem  pid \n\u4f8b\u5b50:  procmem 2509 \n\u6570\u636e\u6765\u6e90:  /proc/ pid /maps  \u548c  /proc/ pid /pagemap  Vss      Rss      Pss      Uss     ShCl     ShDi     PrCl     PrDi  Name   \u5404\u5b57\u6bb5\u542b\u4e49:  ShCl  --  shared clean\nShDi  --  shared dirty\nPrCl  --  private clean\nPrDi  --  private dirty", 
            "title": "procmem  "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#showmap", 
            "text": "\u573a\u666f: \u8fdb\u7a0b\u865a\u62df\u8fdb\u7a0b\u7a7a\u95f4\u7684\u5185\u5b58\u5206\u914d\u60c5\u51b5 \u548c \u8be6\u7ec6\u7684\u5e72\u51c0\u810f\u6570\u636e\u4fe1\u606f.  \u4ece  /proc/[pid]/smaps  \u83b7\u53d6\u6570\u636e\u5e76\u7edf\u8ba1\u7684\u5de5\u5177.  \u547d\u4ee4:  showmap [-a] [-t] [-v]  pid \n\u4f8b\u5b50:  showmap -a 884 \n\u8f93\u51fa\u5355\u4f4d: KB   \u7531\u4e8e\u73b0\u5728\u5185\u6838\u90fd\u4f7f\u7528\u4e86\u52a8\u6001\u5185\u5b58\u5206\u914d\u7684\u673a\u5236, \u5728\u5927\u91cf\u7533\u8bf7\u5c0f\u5185\u5b58\u7684\u60c5\u51b5\u4e0b, \u4ece\u7cfb\u7edf\u770b\u5185\u5b58\u6709\u5269\u4f59, \u4f46\u662f\u8fdb\u7a0b\u5374\u65e0\u6cd5\u5206\u914d\u51fa\u9700\u8981\u7684\u5185\u5b58, \u8fd9\u5c31\u6709\u53ef\u80fd\u662f\u7531\u4e8e\u865a\u62df\u5730\u5740\u7684\u5185\u5b58\u788e\u7247\u5f15\u8d77, \u65e0\u6cd5\u627e\u5230\u4e00\u6bb5\u5927\u4e8e\u6240\u8bf7\u6c42\u5185\u5b58\u5927\u5c0f\u7684\u5730\u5740\u7a7a\u95f4.   \u4f8b\u5b50:", 
            "title": "showmap "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#android-oom", 
            "text": "\u89e6\u53d1OOM\u7684\u539f\u56e0\u662f, java\u5c42\u5185\u5b58\u5206\u914d\u5931\u8d25\u4e86.  \u9020\u6210\u5185\u5b58\u5206\u914d\u5931\u8d25\u7684\u53ef\u80fd\u539f\u56e0\u5982\u4e0b:   \u5185\u5b58\u6ea2\u51fa. \u7533\u8bf7\u7684\u5185\u5b58\u8d85\u51fa\u4e86\u865a\u62df\u673a\u6700\u5927\u5185\u5b58.  \u788e\u7247, \u5bfc\u81f4\u65e0\u6cd5\u627e\u5230\u8fde\u7eed\u7a7a\u95f4\u6ee1\u8db3\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f.  \u8d44\u6e90\u95ee\u9898, \u6bd4\u5982\u6587\u4ef6\u8282\u70b9\u8d85\u8fc7\u9650\u5236, \u5bfc\u81f4\u533f\u540d\u5185\u5b58\u7533\u8bf7\u51fa\u9519, \u9519\u8bef\u4fe1\u606f\u4e3a \"Too many open files\"  \u865a\u62df\u7a7a\u95f4\u5730\u5740\u7a7a\u95f4\u88ab\u5360\u6ee1, \u5bfc\u81f4OOM.   \u4ee5\u4e0a\u4e3a\u7f51\u4e0a\u7684\u7ed3\u8bba, \u5728android5.1.1\u4e0a\u6d4b\u8bd5\u53d1\u73b0:  fd\u95ee\u9898\u5e76\u4e0d\u4f1a\u5bfc\u81f4OOM  \u4ee3\u7801\u590d\u7528\u4e0b\u9762\u5185\u5b58\u6cc4\u9732\u7684\u4ee3\u7801,\u5728asynctask\u4e2d\u6267\u884c\u6587\u4ef6\u6253\u5f00\u64cd\u4f5c.   logcat\u4e2d\u8f93\u51fa\u5982\u4e0b, \u5e76\u6ca1\u6709OOM\u8f93\u51fa:   \u4f46\u662f\u8fd9\u6bb5\u4ee3\u7801\u7684\u786e\u8bc1\u660e\u4e86\u6253\u5f00\u6587\u4ef6\u592a\u591a\u4f1a\u5bfc\u81f4shmem\u521b\u5efa\u5931\u8d25.", 
            "title": "Android \u5e94\u7528 OOM"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#_5", 
            "text": "", 
            "title": "\u5185\u5b58\u6cc4\u9732\u5206\u6790"
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#activity", 
            "text": "activity \u7684\u6cc4\u9732\u57fa\u4e8eandroid\u81ea\u5e26\u5de5\u5177, \u53ef\u4ee5\u5feb\u901f\u786e\u5b9a, \u4f46\u662f\u5177\u4f53\u6cc4\u9732\u7684activity, \u9700\u8981\u4f9d\u8d56\u5de5\u5177 LeakCanary.  \u4ee3\u7801:  \u754c\u9762:   \u5728\u7b2c\u4e00\u6b21\u8fdb\u5165\u8be5\u5e94\u7528\u65f6:   \u6309\u4e0bBUTTON, \u7136\u540e\u9000\u51fa\u5e94\u7528:   \u7b2c\u4e8c\u6b21\u8fdb\u5165\u8be5\u5e94\u7528:   \u7b2c\u4e8c\u6b21\u6309\u4e0bBUTTON:   \u7b2c\u4e8c\u6b21\u9000\u51fa\u5e94\u7528:   \u57fa\u4e8e  dumpsys meminfo  \u786e\u8ba4\u5e94\u7528\u6709activity\u6cc4\u9732\u540e, \u5355\u7eaf\u901a\u8fc7UI\u64cd\u4f5c\u57fa\u672c\u4e5f\u53ef\u4ee5\u5224\u65ad\u51fa\u6765\u54ea\u4e2aactivity\u6cc4\u9732, \u66f4\u51c6\u786e\u7684\u6cc4\u9732\u68c0\u6d4b\u5de5\u5177\u662f LeakCanary, \u8be5\u5de5\u5177\u4e3a\u7b2c\u4e09\u65b9\u5de5\u5177.  \n\u5177\u4f53\u7528\u6cd5: https://www.liaohuqiu.net/cn/posts/leak-canary-read-me/  \u8fd8\u662f\u4ee5\u4e0a\u7684\u4f8b\u5b50, \u989d\u5916\u589e\u52a0\u5982\u4e0b\u4ee3\u7801.   \u5728MainActivity\u589e\u52a0\u5982\u4e0b\u4ee3\u7801, \u8be5\u4ee3\u7801\u7684\u542b\u4e49\u662f, \u5728activity\u89e6\u53d1onDestroy\u65f6, \u76d1\u63a7\u8be5activity\u5bf9\u8c61.      @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        LeakApplication.getRefWatcher().watch(this);\n\n    }  \u589e\u52a0application, \u5982\u4e0b:  \u7f16\u8bd1\u8fd0\u884c, \u6267\u884c\u4e0a\u9762\u540c\u6837\u7684\u64cd\u4f5c. \u5728\u901a\u77e5\u4e2d\u5fc3\u6709\u5982\u4e0b\u663e\u793a:   \u70b9\u51fb\u540e\u53ef\u4ee5\u67e5\u770b\u8be6\u7ec6\u7684\u5806\u6808:   \u540c\u6837\u5728logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:", 
            "title": "activity \u6cc4\u9732 "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#strictmode", 
            "text": "\u540c\u6837\u662f\u4e0a\u9762\u7684\u4f8b\u5b50, \u4fee\u6539\u4ee3\u7801\u5982\u4e0b, \u589e\u52a0strickmode\u7684\u8c03\u7528:   \u540c\u6837\u7684\u4e0a\u9762\u64cd\u4f5c\u65b9\u6cd5, logcat\u4e2d\u6709\u5982\u4e0b\u8f93\u51fa:", 
            "title": "StrictMode\u68c0\u6d4b\u5e94\u7528\u5185\u5b58\u6cc4\u9732 "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#libc", 
            "text": "\u5185\u5b58\u6cc4\u9732\u7684\u68c0\u6d4b\u4f9d\u636e\u662f, \u8fdb\u7a0b\u9000\u51fa\u65f6, \u8fd8\u6709\u672a\u91ca\u653e\u7684\u5185\u5b58. \u6240\u4ee5, valgrind\u5305\u62ecbionic libc\u4e2d, \u80fd\u7cbe\u786e\u68c0\u6d4b\u5230\u6cc4\u9732\u7684\u524d\u63d0\u6761\u4ef6\u5c31\u662f\u8fdb\u7a0b\u9000\u51fa. \u4f46\u662f\u8fd9\u4e2a\u5bf9\u4e8e\u7cfb\u7edf\u7ea7\u522b\u7684\u8fdb\u7a0b\u662f\u65e0\u7528\u7684, \u56e0\u4e3a\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u5e76\u4e0d\u4f1a\u9000\u51fa. \u4eceRD\u89d2\u5ea6, \u5224\u65ad\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\u662f\u5426\u6cc4\u9732\u7684\u4f9d\u636e\u662f\u5185\u5b58\u662f\u5426\u6301\u7eed\u589e\u957f, \u7279\u522b\u662f\u5728\u538b\u529b\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b. \u6240\u4ee5, \u8fd9\u4e2a\u90e8\u5206\u4ecb\u7ecd\u7684\u5de5\u5177, \u5b9e\u9645\u4e0a\u662f\u6293\u53d6\u4e86\u6301\u7eed\u589e\u957f\u7684\u5185\u5b58\u4fe1\u606f, \u8fd9\u4e9b\u4fe1\u606f, \u53ef\u80fd\u662f\u5185\u5b58\u6cc4\u9732, \u4e5f\u53ef\u80fd\u662f\u8fdb\u7a0b\u6b63\u5e38\u7533\u8bf7\u7684\u5185\u5b58, \u9700\u8981RD\u4ecb\u5165\u5224\u65ad.  \u9644\u4ef6:  Memleak_tools_android.zip  \u4f9d\u8d56\u5de5\u5177:   libc_malloc_debug_leak.so  , bionic\u6e90\u7801\u4e0b, \u9700\u8981\u7f16\u8bd1\u5e76push\u5230\u7cfb\u7edf\u4e2d  libmemleakutils.so , \u4eceandroid\u63d0\u53d6\u5e76\u66f4\u6539. \u4ece\u9644\u4ef6\u6e90\u7801\u4e0b\u8f7d\u7f16\u8bd1, \u9700\u8981push\u5230\u7cfb\u7edf\u4e2d.  addr2func.py, \u8be5\u811a\u672c\u80fd\u81ea\u52a8\u5c06\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808. \u5728\u9644\u4ef6\u4e2d.  memincrease.py, \u8be5\u811a\u672c\u80fd\u5c06\u4e0a\u4e00\u811a\u672c\u7684\u8f93\u51fa, \u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f,  \u6309\u5185\u5b58\u589e\u52a0\u4ece\u5927\u5230\u5c0f\u6392\u5e8f. \u57fa\u672c\u6700\u9876\u4e0a\u7684\u662f\u5b58\u5728\u95ee\u9898\u7684. \u5728\u9644\u4ef6\u4e2d.   \u5c40\u9650:   \u53ea\u80fd\u8c03\u8bd5native\u8fdb\u7a0b.  \u8fdb\u7a0b\u4e0d\u80fd\u91cd\u542f.  \u9700\u8981\u538b\u529b\u6d4b\u8bd5, \u957f\u65f6\u95f4\u8fd0\u884c  \u9700\u8981RD\u4ecb\u5165\u5224\u65ad\u662f\u5426\u5b58\u5728\u6cc4\u9732.   \u7528\u6cd5:   \u5c06libmemleakutils.so\u5e93\u94fe\u63a5\u5230\u88ab\u8c03\u8bd5\u7a0b\u5e8f\u4e2d, \u8c03\u7528\u51fd\u6570 start_memleak_watcher(memstep) , \u5176\u4e2dmemstep\u8868\u793a, pss\u6bcf\u589e\u52a0memstep, \u5219\u6293\u53d6\u4e00\u6b21\u5f53\u524d\u5185\u5b58\u5206\u914d\u4fe1\u606f.  \u5c06libmemleakutils.so \u548c  libc_malloc_debug_leak.so  push\u5230/system/lib/\u4e0b.  \u5c06\u88ab\u8c03\u8bd5\u7a0b\u5e8fpush\u5230 /system/bin/ \u4e0b.  \u8bbe\u7f6e property  libc.debug.malloc.program  \u4e3a \u4f60\u7684\u8c03\u8bd5\u8fdb\u7a0b\u540d\u5b57.  \u8bbe\u7f6e property  libc.debug.malloc  \u4e3a 1  stop \u6216\u8005 kill \u88ab\u8c03\u8bd5\u8fdb\u7a0b.  start \u6216\u8005 \u542f\u52a8 \u88ab\u8c03\u8bd5\u8fdb\u7a0b.  \u538b\u529b\u6d4b\u8bd5\u540e, \u68c0\u67e5 /data/local/tmp/ \u5e95\u4e0b\u5b58\u5728\u6587\u4ef6  mem_snapshot_$pid_$memsize.log , \u4e14\u4e2a\u6570\u5927\u4e8e2\u4e2a(\u8d8a\u591a\u8d8a\u597d).  cp /proc/${pid}/maps /data/local/tmp/  \u5c06 /data/local/tmp/ \u5e95\u4e0b\u6240\u6709\u6587\u4ef6\u590d\u5236\u5230host\u673a\u5668.  \u7528 diff \u547d\u4ee4\u6bd4\u8f83 \u4e24\u4e2a  mem_snapshot_$pid_$memsize.log , \u5e76\u4fdd\u5b58\u8f93\u51fa\u4e3a  diff_$pid_$memsize1_$memsize2.log  \u6267\u884c  ./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_$pid_$memsize1_$memsize2.log   mem_stack_$pid_$memsize1_$memsize2.log , \u8be5\u8fc7\u7a0b\u662f\u5c06diff\u751f\u6210\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u5730\u5740\u8f6c\u6362\u6210\u5e93\u548c\u5806\u6808\u4fe1\u606f.  \u6267\u884c  ./memincrease.py mem_stack_$pi_$memsize1_$memsize2.log incr_$pid_$memsize1_$memsize2.log , \u8be5\u8fc7\u7a0b\u662f\u5bf912\u751f\u6210\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\u6392\u5e8f, \u4ece\u5927\u5230\u5c0f\u6392\u5e8f.   \u4f8b\u5b50:   \u8fd0\u884c\u4e00\u4f1a\u513f\u540e, \u5728 /data/local/tmp/\u76ee\u5f55\u4e0b\u5b58\u5728\u6587\u4ef6:  mem_snapshot_2158_1.log\nmem_snapshot_2158_2.log\nmem_snapshot_2158_3.log\nmem_snapshot_2158_4.log  \u5176\u5185\u5bb9\u5982\u4e0b:   Allocation count  5 \n Total memory  6293072 \nsize   5242880 , dup     1 , 0xb6ed36b2, 0xb6f4cd4e, 0xb6f1da44, 0xb6f1de38, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92\nsize   1048576 , dup     1 , 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400\nsize      1024 , dup     1 , 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\nsize       580 , dup     1 , 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f510c8, 0xb6f1decc, 0xb6fc838c, 0xb6f4ce68, 0xb6fc8400\nsize        12 , dup     1 , 0xb6ed36b2, 0xb6ed391c, 0xb6f4cd0e, 0xb6f14c46, 0xb6f1dd98, 0xb6f1dea0, 0xb6f5104a, 0xb6f4ef92  \u6267\u884cdiff\u547d\u4ee4:  # diff ./mem_snapshot_2158_1.log ./mem_snapshot_2158_2.log   diff_2158_1_2.log  #   # diff ./mem_snapshot_2158_3.log ./mem_snapshot_2158_4.log   diff_2158_3_4.log  #   \u5f97\u5230\u4e00\u4e2aPSS\u4ece1M\u589e\u957f\u52302M\u548c3M\u589e\u957f\u52304M\u7684\u4e24\u4e2adiff\u6587\u4ef6. \u5185\u5bb9\u5982\u4e0b:  2c2   Total memory 6293072\n---   Total memory 7342672\n4,5c4,5  size  1048576, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400  size     1024, dup    1, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400\n---  size  1048576, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc8492, 0xb6fc8390, 0xb6f4ce68, 0xb6fc8400  size     1024, dup    2, 0xb6ed36b2, 0xb6f4cd4e, 0xb6fc84aa, 0xb6fc8394, 0xb6f4ce68, 0xb6fc8400  \n\u6267\u884c addr2func.py :  # ./addr2func.py --root-dir=/remote/ANDROID/hdtv/ --maps-file=./maps --product=zx2000 diff_2158_3_4.log   mem_stack_2158_3_4.log   \u751f\u6210\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b:  2c2                                                                                                                                                                               [ 0 /59466 ]    Total memory  8392272 \n\n---   Total memory  9441872  4 ,5c4,5  size   1048576 , dup     3 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  size      1024 , dup     3 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n---  size   1048576 , dup     4 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  size      1024 , dup     4 ,\n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  \u6240\u6709\u7684\u5730\u5740\u88ab\u8f6c\u6362\u6210\u4e86\u961f\u957f. \n\u6700\u540e\u6267\u884c memincrease.py :  ./memincrease.py mem_stack_2158_3_4.log incr_2158_3_4.log  \u751f\u6210\u7684\u6587\u4ef6 incr_2158_3_4.log \u5185\u5bb9\u5982\u4e0b:  Memory increase  1048576  bytes                    ### \u5185\u5b58\u589e\u52a0\u4e86 1048576 bytes \n98990365afa0d71d62949620cc7e3753f386e4e3\nold size  1048576  count  3 , total memory  3145728         ### \u4ece 3145728 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n98990365afa0d71d62949620cc7e3753f386e4e3\nnew size  1048576  count  4 , total memory  4194304        ### \u589e\u52a0\u5230 4194304 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:11\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:25  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n\nMemory increase  1024  bytes\n833f23c991cc75facaa41fb74f7466b91c27917b\nold size  1024  count  3 , total memory  3072 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?\n833f23c991cc75facaa41fb74f7466b91c27917b\nnew size  1024  count  4 , total memory  4096 \n    leak_malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_leak.cpp:315  ( discriminator  1 ) \n    malloc, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/malloc_debug_common.cpp:259\n    mem_test1 () , /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:17\n    main, /home/werther/workspace/ANDROID/hdtv/pdk/memleak/main.cpp:26  ( discriminator  1 ) \n    __libc_init, /home/werther/workspace/ANDROID/hdtv/bionic/libc/bionic/libc_init_dynamic.cpp:113\n    _start, main.cpp:?  \u57fa\u672c\u4e0a, \u5c06\u6700\u9876\u4e0a\u7684\u51e0\u4e2a\u5806\u6808\u786e\u8ba4\u4e0b\u662f\u5426\u5185\u5b58\u6cc4\u9732\u5373\u53ef.  \u7279\u522b\u6ce8\u610f:   \u7c7b\u6cc4\u9732\u65f6, \u5728\u5806\u6808\u4e0a\u7684\u8868\u73b0\u662f\u5176\u6210\u5458\u5185\u5b58\u6cc4\u9732. \u9700\u8981\u67e5\u770b\u5806\u6808\u662f\u5426\u6709\u8be5\u7c7b\u5bf9\u8c61\u7684new\u65b9\u6cd5, \u5e76\u4e14\u8be5\u65b9\u6cd5\u662f\u5426\u5728\u591a\u5904\u5b58\u5728.", 
            "title": "\u57fa\u4e8elibc\u8c03\u8bd5\u5185\u5b58\u6cc4\u9732 "
        }, 
        {
            "location": "/2017-11-14-Android-memory-debug/#valgrind", 
            "text": "\u573a\u666f: \u5bf9\u4e8e\u53ef\u9000\u51fa\u7684\u8fdb\u7a0b\u8fdb\u884c\u8c03\u8bd5\u6bd4\u8f83\u5408\u9002, \u53ef\u4ee5\u5bf9\u5e94\u7528\u7684native\u4ee3\u7801\u8fdb\u884c\u8c03\u8bd5.  \u76ee\u524dhdtv\u4ee3\u7801\u4e0a\u7684 valgrind \u65e0\u6cd5\u83b7\u53d6\u88ab\u8c03\u8bd5\u8fdb\u7a0b\u7684\u5806\u6808, \u53ea\u80fd\u83b7\u53d6\u5b83\u81ea\u5df1\u5e93\u7684\u5806\u6808, \u5b58\u5728\u95ee\u9898. \u6682\u65f6\u65e0\u6cd5\u4f7f\u7528.", 
            "title": "valgrind \u8c03\u8bd5\u5185\u5b58\u6cc4\u9732"
        }, 
        {
            "location": "/2017-10-01-slackbot/", 
            "text": "slackbot \u6846\u67b6\n\n\nslackbot, \u987e\u540d\u601d\u4e49, \u662f\u57fa\u4e8eslack\u7684bot\u7a0b\u5e8f, \u4f7f\u7528python\u5b9e\u73b0. \u4e2a\u4eba\u5728\nlins05/slackbot\n\u7684\u57fa\u7840\u4e0a, \u8fdb\u884c\u4e86\u4e8c\u6b21\u5f00\u53d1,\u7528\u4e8e\u6811\u8393\u6d3e\u7684\u63a7\u5236\u4e2d\u5fc3\u548c\u667a\u80fd\u5bb6\u5c45\u7684\u63a7\u5236\u4e2d\u5fc3. \u6700\u521d\u9009\u4e2d\u5b83\u7684\u539f\u56e0\u662f, \u5728\u7f51\u4e0a\u770b\u5230\u5927\u91cf\u7684\u4f8b\u5b50\u57fa\u4e8eslack\u505a\u8fdc\u7a0b\u8fd0\u7ef4\u7684\u4f8b\u5b50.\n\n\n\u4e0b\u6587\u4ecb\u7ecd\u7684slackbot\u6846\u67b6, \u662f\u5305\u542b\nlins05/slackbot\n\u548c\u4e2a\u4eba\u4e8c\u6b21\u5f00\u53d1\u4e4b\u540e\u7684\u5185\u5bb9.\u4e8c\u6b21\u5f00\u53d1\u7684\u6838\u5fc3\u5728\u4e8e\u63d2\u4ef6\u548c\u7ec4\u4ef6\u6269\u5145.\n\n\n\u7531\u4e8e\u7528\u4e86\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u6a21\u5f0f, \u5bfc\u81f4\u53ef\u4ee5\u6dfb\u52a0\u4efb\u610f\u591a\u529f\u80fd\u7684\u63d2\u4ef6\u548c\u7ec4\u4ef6. \u6240\u4ee5, \u529f\u80fd\u8fd8\u5728\u6301\u7eed\u5f00\u53d1\u4e2d.\n\n\n\u8ba1\u5212: \u63d2\u4ef6\u548c\u7ec4\u4ef6\u8ddfpython-fire\u7ed3\u5408, \u671f\u671b\u5b9e\u73b0\u81ea\u52a8\u89e3\u6790\u7ec4\u4ef6\u7684\u63a5\u53e3, \u800c\u4e0d\u9700\u8981\u4e13\u95e8\u5c01\u88c5\u63d2\u4ef6.\n\n\n\u6846\u67b6\u56fe\n\n\n\n\n\u8be5\u6a21\u5f0f\u662f\u5178\u578b\u7684\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b, \u751f\u4ea7\u8005\u67092\u4e2a, \u4e00\u4e2a\u662f\u4eceslack\u5b98\u7f51\u63a5\u6536\u6d88\u606f\u5e76\u653e\u5165\u961f\u5217, \u53e6\u4e00\u4e2a\u662f\u5b9a\u65f6\u4efb\u52a1,\u9694\u4e00\u5b9a\u65f6\u95f4\u5f80\u961f\u5217\u4e2d\u5b58\u5165\u6307\u4ee4. \u6d88\u8d39\u8005\u670910\u4e2a(10\u7ebf\u7a0b\u7b49\u5f85\u5728\u961f\u5217\u4e0a), \u5176\u529f\u80fd\u5c31\u662f\u5206\u522b\u5904\u7406\u5b9a\u65f6\u4efb\u52a1, \u5404\u79cd\u6d88\u606f.\n\n\n\u63d2\u4ef6\u7c7b\u662f\u7531PluginManager\u7ba1\u7406\u548c\u52a0\u8f7d, \u4ece\u63d2\u4ef6\u76ee\u5f55\u4e2d\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u89c4\u5219\u52a0\u8f7d\u6307\u5b9a\u7684\u63d2\u4ef6\u7c7b, \u5e76\u6839\u636e\u63d2\u4ef6\u7c7b\u7684\u4fee\u9970\u51fd\u6570\u83b7\u53d6\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570(\u5b9a\u65f6\u5904\u7406\u51fd\u6570, \u6d88\u606f\u5904\u7406\u51fd\u6570).\n\n\n\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u5b9e\u73b0\n\n\n\u7531\u4e8e\u4f7f\u7528\u4e86\u4fee\u9970\u51fd\u6570, \u5219\u88ab\u8c03\u7528\u51fd\u6570\u65e0\u6cd5\u662f\u7c7b\u6210\u5458\u51fd\u6570. \u867d\u7136\u5728\u5199\u63d2\u4ef6\u4e0a\u66f4\u65b9\u4fbf, \u4f46\u662f\u5bf9\u4e8e\u63d2\u4ef6\u529f\u80fd\u5f3a\u5927\u7684\u5b9e\u73b0, \u5219\u9700\u8981\u989d\u5916\u5c01\u88c5.\n\n\n\u5728\u6b64\u57fa\u7840\u4e0a, \u65b0\u6dfb\u52a0\u4e86\u7ec4\u4ef6\u6982\u5ff5, \u7ec4\u4ef6\u53ef\u4ee5\u662f\u4efb\u610f\u7684\u7b2c\u4e09\u65b9\u5e93\u6216\u5b9e\u73b0(\u7eaf\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0), \u7136\u540e\u5728\u63d2\u4ef6\u76ee\u5f55\u4e0b\u5b9e\u73b0\u5bf9\u5e94\u7684\u63d2\u4ef6\u8c03\u7528\u8be5\u7ec4\u4ef6\u7ec4\u6210\u529f\u80fd. \u8fd9\u5c31\u662fpi\u4e0a\u667a\u80fd\u5bb6\u5c45\u63a7\u5236\u4e2d\u7684\u57fa\u7840. \u540e\u7eed\u7684\u63a7\u5236\u5b9e\u73b0\u90fd\u5728\u8be5\u57fa\u7840\u4e0a\u6269\u5c55, \u7279\u522b\u662f\u5b9a\u65f6\u4efb\u52a1.\n\n\n\u7ec4\u4ef6\u4e2d\u4f1a\u51fa\u73b0\u591a\u4e2a\u6a21\u5757\u88ab\u4e0d\u540c\u63d2\u4ef6\u8c03\u7528\u7684\u573a\u666f, \u8fd9\u5c31\u9700\u8981\u7ec4\u4ef6\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f(\u7ec4\u4ef6\u521d\u59cb\u5316\u53c2\u6570\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a). \u5355\u4f8b\u6a21\u5f0f\u7684\u5b9e\u73b0,\u5728python2\u548cpython3\u4e0a\u4e0d\u540c, \u7531\u4e8e\u76ee\u524d\u5168\u4f53\u5207\u6362\u5230python3\u4e0a, \u5b9e\u73b0\u4e0a\u4f7f\u7528\u4e86metaclass, \u4f46\u662f\u5b9e\u9645\u4e0a\u91cd\u5199new\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e5f\u662f\u53ef\u4ee5\u7684. \u7279\u522b\u6ce8\u610f, \u5355\u4f8b\u5b9e\u9645\u4e0a\u662f\u76f4\u63a5\u8fd4\u56de\u4e86\u5185\u5b58\u5bf9\u8c61, \u4f46\u4f9d\u7136\u4f1a\u7ee7\u7eed\u540e\u7eed\u7684\n__init__\n, \u6240\u4ee5\u5fc5\u987b\u6dfb\u52a0\u6807\u8bb0\u6765\u8868\u793a\u5df2\u7ecf\u521d\u59cb\u5316\u53d8\u91cf.\n\n\n\u63d2\u4ef6\u5217\u8868\n\n\n\u667a\u80fd\u5bb6\u5c45\u7684\u4e3b\u63a7\u4e3ahomeassistant, \u8fd9\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u6846\u67b6, \u5e76\u4e14\u652f\u6301\u5f00\u6e90\u534f\u8bae, \u5c0f\u7c73\u7cfb\u5217\u548cyeelight\u7cfb\u5217\u5927\u90e8\u5206\u90fd\u80fd\u76f4\u63a5\u6dfb\u52a0, \u5c11\u91cf\u9700\u8981hack\u4e0b.\n\n\n\u6240\u6709\u667a\u80fd\u5bb6\u5c45\u6a21\u5757\u5b58\u653e\u5728 \ncomponent/ha/\n, slackbot\u4e0ehomeassistant\u901a\u8fc7rest API \u901a\u4fe1. \u6240\u6709\u7684\u8bf7\u6c42\u90fd\u662fslackbot\u8bf7\u6c42\u53d1\u8d77. \n\n\n\u6240\u6709\u7684\u667a\u80fd\u5bb6\u5c45\u8bbe\u5907\u90fd\u53ef\u4ee5\u901a\u8fc7slackbot\u8fdc\u7a0b\u63a7\u5236\u5f00\u5173.\n\n\n\u540e\u9762\u5217\u51fa\u7684\u662f\u7ec4\u4ef6\u5217\u8868, \u5217\u8868\u4e2d\u7ec4\u4ef6\u7ec4\u5408\u4e0d\u540c\u53ef\u4ee5\u4ea7\u751f\u4e0d\u540c\u7684\u63d2\u4ef6, \u6bd4\u5982:\n\n\n\n\n\u65e5\u7167\u72b6\u6001 + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 + \u706f\u5177\u63a7\u5236 = \u592a\u9633\u4e0b\u5c71\u5ba2\u5385\u6709\u4eba\u81ea\u52a8\u5f00\u706f, \u5ba2\u5385\u6ca1\u4eba\u81ea\u52a8\u5173\u706f\n\n\n\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 = \u5bb6\u91cc\u6ca1\u4eba, \u4e14\u5b9a\u65f6\u4efb\u52a1\u5230, \u81ea\u52a8\u5f00\u59cb\u626b\u5730\n\n\n\u5f55\u5236\u6a21\u5757 + \u64ad\u653e\u6a21\u5757 + \u8bed\u97f3\u8f6c\u6587\u5b57\u6a21\u5757 + \u6587\u5b57\u8f6c\u8bed\u97f3\u6a21\u5757 = \u8ddf\u795e\u7ecf\u51b0\u804a\u5929\u5e76\u53d1\u5e03\u4efb\u52a1\u7684\u529f\u80fd\n\n\n\n\nhomeassistant\u63d0\u4f9b\u7684\u529f\u80fd\u5217\u8868\n\n\n\u5bb6\u5ead\u4eba\u5458\u5728\u5bb6\u72b6\u6001\n\n\n\u83b7\u53d6\u5bb6\u5ead\u4eba\u5458\u662f\u5426\u5728\u5bb6, \u8be5\u5b9e\u73b0\u5176\u5b9e\u662f\u68c0\u6d4b\u5bb6\u5ead\u6210\u5458\u624b\u673a\u7684mac\u5730\u5740\u5224\u65ad\u662f\u5426\u8fde\u63a5\u4e0a\u8def\u7531\u5668.\n\n\n\u706f\u5177\u63a7\u5236\n\n\n\u8fdc\u7a0b\u63a7\u5236\u6307\u5b9a\u706f\u5177\u7684\u5f00\u5173\n\n\n\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba\n\n\n\u63a5\u5165\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba, \u9ed8\u8ba4\u6bcf\u5468\u4e00\u4e09\u4e94\u542f\u52a8\u6e05\u626b, \u4f4624\u5c0f\u65f6\u5185\u4e0d\u91cd\u542f\u542f\u52a8\u6e05\u626b.\n\n\n\u65e5\u7167\u72b6\u6001\n\n\n\u4e5f\u5c31\u662f\u592a\u9633\u4e0b\u5c71\u4e0e\u5426\u7684\u72b6\u6001.\n\n\n\u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001\n\n\n\u8be5\u72b6\u6001\u7684\u5b58\u5728\u610f\u4e49\u662f, \u4e2a\u4eba\u671f\u671b\u5bb6\u5ead\u6210\u5458\u5728\u5ba2\u5385\u65f6, \u81ea\u52a8\u6253\u5f00\u5ba2\u5385\u706f, \u79bb\u5f00\u5ba2\u5385\u65f6, \u81ea\u52a8\u5173\u95ed\u5ba2\u5385\u7684.\n\n\n\u5728\u521d\u671f\u5b66\u4e60\u9636\u6bb5, \u89e3\u9664\u5230\u7684\u4e3b\u8981\u6709\u84dd\u7259\u5e7f\u64ad\u548cRFID, \u90fd\u662f\u901a\u8fc7\u4e09\u70b9\u6cd5\u6765\u5b9a\u4f4d(\u76f8\u5173\u4fe1\u606f\u53ef\u4ee5\u767e\u5ea6\u5ba4\u5185\u5b9a\u4f4d). \u9996\u5148, \u57fa\u4e8e\u82af\u7247\u7684\u5b9a\u4f4d(\u4ed3\u5e93\u5b9a\u4f4d)\u4e0d\u9002\u5408\u5bb6\u5ead\u4f7f\u7528, \u56e0\u4e3a\u5bb6\u5ead\u4e0d\u53ef\u80fd\u4f1a\u5e26\u7740\u5c04\u9891\u82af\u7247.\u800c\u84dd\u7259\u5e7f\u64ad\u53ea\u6709\u63a5\u6536\u7aef\u624d\u80fd\u77e5\u9053\u81ea\u5df1\u4e0e\u53d1\u9001\u7aef\u7684\u8ddd\u79bb(\u4fe1\u53f7\u8870\u51cf), \u4e14\u9700\u8981\u4e09\u4e2a\u84dd\u7259\u5b9a\u4f4d. \u8003\u8651\u5230\u4e0e\u84dd\u7259\u7c7b\u4f3c, \u4f46\u6536\u5230\u73af\u5883\u5f71\u54cd\u66f4\u5927\u7684wifi, \u6d4b\u8bd5\u5c0f\u7c73\u8def\u7531\u5668\u4e0a\u53ef\u4ee5\u83b7\u53d6\u5230\u76ee\u6807\u624b\u673a\u7684\u4fe1\u53f7\u5f3a\u5ea6, \u5219\u51b3\u5b9a\u6539\u7528wifi\u5212\u5b9a\u4e24\u4e2a\u5706\u5f27\u533a\u57df. \u5c0f\u5706\u5f27\u533a\u57df\u5185\u5f00\u706f, \u5927\u5706\u5f27\u533a\u57df\u5916\u5173\u706f, \u800c\u4e24\u4e2a\u5706\u5f27\u533a\u57df\u4e2d\u95f4\u4fdd\u6301\u539f\u72b6\u6001\u4e0d\u53d8. \n\n\n\n\u804a\u5929\u673a\u5668\u4eba\n\n\n\u5206\u522b\u6709 ibot, tuling, xiaoi, emotibot. \u4f46\u4e0d\u662f\u6240\u6709\u7684\u90fd\u542f\u7528, \u5728\u804a\u5929\u63d2\u4ef6\u4e2d, \u9009\u62e9\u5176\u4e2d\u7684\u4e00\u4e2a\u542f\u52a8\u5e76\u4ea4\u4e92.\n\n\n\u6587\u4ef6\u7ba1\u7406\u5668\n\n\n\u6240\u8c13\u7684\u6587\u4ef6\u7ba1\u7406\u5668, \u53ea\u662f\u4e00\u4e2a\u6587\u4ef6\u7d22\u5f15\u52a0\u4e0a\u6587\u4ef6\u67e5\u627e\u7684\u5de5\u5177, \u989d\u5916\u589e\u52a0\u4e86\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u7684\u529f\u80fd. \u6587\u4ef6\u7d22\u5f15\u4f7f\u7528\u7684\u662fjieba\u548cwhoos. \u53ef\u4ee5\u901a\u8fc7slackbot\u5feb\u901f\u67e5\u627e\u67d0\u4e2a\u6587\u4ef6\u6216\u8005\u67d0\u672c\u4e66(\u7535\u5b50\u4e66\u591a\u5230\u81ea\u5df1\u4e5f\u4e0d\u77e5\u9053\u6709\u591a\u5c11\u672c).\n\n\n\u8ffd\u5267\u6a21\u5757\n\n\n\u4e0d\u53ea\u662f\u8ffd\u5267, \u4e5f\u662f\u8ffd\u7535\u5f71. \u7535\u5f71\u8c46\u74e37.0\u4ee5\u4e0a\u624d\u63a8\u9001, \u800c\u5267\u662f\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u65e5\u5267, \u5168\u63a8((\u2299\ufe4f\u2299)b),\u540e\u6765\u56e0\u4e3a\u67d0\u4e9b\u6bd4\u8f83\u65e0\u5948\u7684\u539f\u56e0,  \u8fd9\u8d27\u5f00\u59cb\u63a8\u4e00\u4e9b\u8001\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u5267, \u5c31\u6309\u9700\u52a0\u4e86\u4e2a\u529f\u80fd, \u9ed1\u767d\u540d\u5355. \u679c\u7136\u8001\u5a46\u662f\u7b2c\u4e00\u751f\u4ea7\u529b.\n\n\n\u5c0f\u8bf4\u6a21\u5757\n\n\n\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u722c\u866b, \u4e0d\u505c\u5730\u722c\u53d6\u6307\u5b9a\u5c0f\u8bf4\u5224\u65ad\u662f\u5426\u5b58\u5728\u66f4\u65b0. \u5728\u4e2a\u4eba\u7684\u4e3b\u9875\u4ecb\u7ecd\u4e2d\u4ecb\u7ecd\u4e86\u559c\u6b22\u5386\u53f2\u5c0f\u8bf4, \u6240\u4ee5\u5927\u90e8\u5206\u90fd\u662f\u5386\u53f2\u7c7b\u5c0f\u8bf4\n\n\n\u64ad\u653e\u6a21\u5757\n\n\n\u8c03\u7528mplayer\u64ad\u653e\n\n\n\u5f55\u5236\u6a21\u5757\n\n\n\u8c03\u7528arecord\u5f55\u97f3\n\n\n\u8bed\u97f3\u8f6c\u6587\u5b57\n\n\n\u7528\u4e86\u767e\u5ea6\u7684api\n\n\n\u6587\u5b57\u8f6c\u8bed\n\n\n\u7528\u4e86iflytek\u7684API, \u4e0d\u5f97\u4e0d\u8bf4\u5b83\u4eec\u5bb6\u8bed\u97f3\u505a\u5f97\u597d, \u5404\u79cd\u4eba\u7269\u53ef\u9009.\n\n\n\u5de5\u5177\n\n\n\u5305\u542b\u4e86\u6a21\u4eff\u6d4f\u89c8\u5668\u6253\u5f00\u7684\u4ee3\u7801(cookie\u7b49), \u5b9e\u73b0\u4e86\u4ee3\u7406\u6c60, \u5e76\u53ef\u4ee3\u7406\u8bbf\u95ee.", 
            "title": "slackbot\u8be6\u7ec6\u8bf4\u660e"
        }, 
        {
            "location": "/2017-10-01-slackbot/#slackbot", 
            "text": "slackbot, \u987e\u540d\u601d\u4e49, \u662f\u57fa\u4e8eslack\u7684bot\u7a0b\u5e8f, \u4f7f\u7528python\u5b9e\u73b0. \u4e2a\u4eba\u5728 lins05/slackbot \u7684\u57fa\u7840\u4e0a, \u8fdb\u884c\u4e86\u4e8c\u6b21\u5f00\u53d1,\u7528\u4e8e\u6811\u8393\u6d3e\u7684\u63a7\u5236\u4e2d\u5fc3\u548c\u667a\u80fd\u5bb6\u5c45\u7684\u63a7\u5236\u4e2d\u5fc3. \u6700\u521d\u9009\u4e2d\u5b83\u7684\u539f\u56e0\u662f, \u5728\u7f51\u4e0a\u770b\u5230\u5927\u91cf\u7684\u4f8b\u5b50\u57fa\u4e8eslack\u505a\u8fdc\u7a0b\u8fd0\u7ef4\u7684\u4f8b\u5b50.  \u4e0b\u6587\u4ecb\u7ecd\u7684slackbot\u6846\u67b6, \u662f\u5305\u542b lins05/slackbot \u548c\u4e2a\u4eba\u4e8c\u6b21\u5f00\u53d1\u4e4b\u540e\u7684\u5185\u5bb9.\u4e8c\u6b21\u5f00\u53d1\u7684\u6838\u5fc3\u5728\u4e8e\u63d2\u4ef6\u548c\u7ec4\u4ef6\u6269\u5145.  \u7531\u4e8e\u7528\u4e86\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u6a21\u5f0f, \u5bfc\u81f4\u53ef\u4ee5\u6dfb\u52a0\u4efb\u610f\u591a\u529f\u80fd\u7684\u63d2\u4ef6\u548c\u7ec4\u4ef6. \u6240\u4ee5, \u529f\u80fd\u8fd8\u5728\u6301\u7eed\u5f00\u53d1\u4e2d.  \u8ba1\u5212: \u63d2\u4ef6\u548c\u7ec4\u4ef6\u8ddfpython-fire\u7ed3\u5408, \u671f\u671b\u5b9e\u73b0\u81ea\u52a8\u89e3\u6790\u7ec4\u4ef6\u7684\u63a5\u53e3, \u800c\u4e0d\u9700\u8981\u4e13\u95e8\u5c01\u88c5\u63d2\u4ef6.", 
            "title": "slackbot \u6846\u67b6"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_1", 
            "text": "\u8be5\u6a21\u5f0f\u662f\u5178\u578b\u7684\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b, \u751f\u4ea7\u8005\u67092\u4e2a, \u4e00\u4e2a\u662f\u4eceslack\u5b98\u7f51\u63a5\u6536\u6d88\u606f\u5e76\u653e\u5165\u961f\u5217, \u53e6\u4e00\u4e2a\u662f\u5b9a\u65f6\u4efb\u52a1,\u9694\u4e00\u5b9a\u65f6\u95f4\u5f80\u961f\u5217\u4e2d\u5b58\u5165\u6307\u4ee4. \u6d88\u8d39\u8005\u670910\u4e2a(10\u7ebf\u7a0b\u7b49\u5f85\u5728\u961f\u5217\u4e0a), \u5176\u529f\u80fd\u5c31\u662f\u5206\u522b\u5904\u7406\u5b9a\u65f6\u4efb\u52a1, \u5404\u79cd\u6d88\u606f.  \u63d2\u4ef6\u7c7b\u662f\u7531PluginManager\u7ba1\u7406\u548c\u52a0\u8f7d, \u4ece\u63d2\u4ef6\u76ee\u5f55\u4e2d\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u89c4\u5219\u52a0\u8f7d\u6307\u5b9a\u7684\u63d2\u4ef6\u7c7b, \u5e76\u6839\u636e\u63d2\u4ef6\u7c7b\u7684\u4fee\u9970\u51fd\u6570\u83b7\u53d6\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570(\u5b9a\u65f6\u5904\u7406\u51fd\u6570, \u6d88\u606f\u5904\u7406\u51fd\u6570).", 
            "title": "\u6846\u67b6\u56fe"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_2", 
            "text": "\u7531\u4e8e\u4f7f\u7528\u4e86\u4fee\u9970\u51fd\u6570, \u5219\u88ab\u8c03\u7528\u51fd\u6570\u65e0\u6cd5\u662f\u7c7b\u6210\u5458\u51fd\u6570. \u867d\u7136\u5728\u5199\u63d2\u4ef6\u4e0a\u66f4\u65b9\u4fbf, \u4f46\u662f\u5bf9\u4e8e\u63d2\u4ef6\u529f\u80fd\u5f3a\u5927\u7684\u5b9e\u73b0, \u5219\u9700\u8981\u989d\u5916\u5c01\u88c5.  \u5728\u6b64\u57fa\u7840\u4e0a, \u65b0\u6dfb\u52a0\u4e86\u7ec4\u4ef6\u6982\u5ff5, \u7ec4\u4ef6\u53ef\u4ee5\u662f\u4efb\u610f\u7684\u7b2c\u4e09\u65b9\u5e93\u6216\u5b9e\u73b0(\u7eaf\u9762\u5411\u5bf9\u8c61\u5b9e\u73b0), \u7136\u540e\u5728\u63d2\u4ef6\u76ee\u5f55\u4e0b\u5b9e\u73b0\u5bf9\u5e94\u7684\u63d2\u4ef6\u8c03\u7528\u8be5\u7ec4\u4ef6\u7ec4\u6210\u529f\u80fd. \u8fd9\u5c31\u662fpi\u4e0a\u667a\u80fd\u5bb6\u5c45\u63a7\u5236\u4e2d\u7684\u57fa\u7840. \u540e\u7eed\u7684\u63a7\u5236\u5b9e\u73b0\u90fd\u5728\u8be5\u57fa\u7840\u4e0a\u6269\u5c55, \u7279\u522b\u662f\u5b9a\u65f6\u4efb\u52a1.  \u7ec4\u4ef6\u4e2d\u4f1a\u51fa\u73b0\u591a\u4e2a\u6a21\u5757\u88ab\u4e0d\u540c\u63d2\u4ef6\u8c03\u7528\u7684\u573a\u666f, \u8fd9\u5c31\u9700\u8981\u7ec4\u4ef6\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f(\u7ec4\u4ef6\u521d\u59cb\u5316\u53c2\u6570\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a). \u5355\u4f8b\u6a21\u5f0f\u7684\u5b9e\u73b0,\u5728python2\u548cpython3\u4e0a\u4e0d\u540c, \u7531\u4e8e\u76ee\u524d\u5168\u4f53\u5207\u6362\u5230python3\u4e0a, \u5b9e\u73b0\u4e0a\u4f7f\u7528\u4e86metaclass, \u4f46\u662f\u5b9e\u9645\u4e0a\u91cd\u5199new\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e5f\u662f\u53ef\u4ee5\u7684. \u7279\u522b\u6ce8\u610f, \u5355\u4f8b\u5b9e\u9645\u4e0a\u662f\u76f4\u63a5\u8fd4\u56de\u4e86\u5185\u5b58\u5bf9\u8c61, \u4f46\u4f9d\u7136\u4f1a\u7ee7\u7eed\u540e\u7eed\u7684 __init__ , \u6240\u4ee5\u5fc5\u987b\u6dfb\u52a0\u6807\u8bb0\u6765\u8868\u793a\u5df2\u7ecf\u521d\u59cb\u5316\u53d8\u91cf.", 
            "title": "\u63d2\u4ef6\u548c\u7ec4\u4ef6\u7684\u5b9e\u73b0"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_3", 
            "text": "\u667a\u80fd\u5bb6\u5c45\u7684\u4e3b\u63a7\u4e3ahomeassistant, \u8fd9\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u6846\u67b6, \u5e76\u4e14\u652f\u6301\u5f00\u6e90\u534f\u8bae, \u5c0f\u7c73\u7cfb\u5217\u548cyeelight\u7cfb\u5217\u5927\u90e8\u5206\u90fd\u80fd\u76f4\u63a5\u6dfb\u52a0, \u5c11\u91cf\u9700\u8981hack\u4e0b.  \u6240\u6709\u667a\u80fd\u5bb6\u5c45\u6a21\u5757\u5b58\u653e\u5728  component/ha/ , slackbot\u4e0ehomeassistant\u901a\u8fc7rest API \u901a\u4fe1. \u6240\u6709\u7684\u8bf7\u6c42\u90fd\u662fslackbot\u8bf7\u6c42\u53d1\u8d77.   \u6240\u6709\u7684\u667a\u80fd\u5bb6\u5c45\u8bbe\u5907\u90fd\u53ef\u4ee5\u901a\u8fc7slackbot\u8fdc\u7a0b\u63a7\u5236\u5f00\u5173.  \u540e\u9762\u5217\u51fa\u7684\u662f\u7ec4\u4ef6\u5217\u8868, \u5217\u8868\u4e2d\u7ec4\u4ef6\u7ec4\u5408\u4e0d\u540c\u53ef\u4ee5\u4ea7\u751f\u4e0d\u540c\u7684\u63d2\u4ef6, \u6bd4\u5982:   \u65e5\u7167\u72b6\u6001 + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 + \u706f\u5177\u63a7\u5236 = \u592a\u9633\u4e0b\u5c71\u5ba2\u5385\u6709\u4eba\u81ea\u52a8\u5f00\u706f, \u5ba2\u5385\u6ca1\u4eba\u81ea\u52a8\u5173\u706f  \u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba + \u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001 = \u5bb6\u91cc\u6ca1\u4eba, \u4e14\u5b9a\u65f6\u4efb\u52a1\u5230, \u81ea\u52a8\u5f00\u59cb\u626b\u5730  \u5f55\u5236\u6a21\u5757 + \u64ad\u653e\u6a21\u5757 + \u8bed\u97f3\u8f6c\u6587\u5b57\u6a21\u5757 + \u6587\u5b57\u8f6c\u8bed\u97f3\u6a21\u5757 = \u8ddf\u795e\u7ecf\u51b0\u804a\u5929\u5e76\u53d1\u5e03\u4efb\u52a1\u7684\u529f\u80fd", 
            "title": "\u63d2\u4ef6\u5217\u8868"
        }, 
        {
            "location": "/2017-10-01-slackbot/#homeassistant", 
            "text": "", 
            "title": "homeassistant\u63d0\u4f9b\u7684\u529f\u80fd\u5217\u8868"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_4", 
            "text": "\u83b7\u53d6\u5bb6\u5ead\u4eba\u5458\u662f\u5426\u5728\u5bb6, \u8be5\u5b9e\u73b0\u5176\u5b9e\u662f\u68c0\u6d4b\u5bb6\u5ead\u6210\u5458\u624b\u673a\u7684mac\u5730\u5740\u5224\u65ad\u662f\u5426\u8fde\u63a5\u4e0a\u8def\u7531\u5668.", 
            "title": "\u5bb6\u5ead\u4eba\u5458\u5728\u5bb6\u72b6\u6001"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_5", 
            "text": "\u8fdc\u7a0b\u63a7\u5236\u6307\u5b9a\u706f\u5177\u7684\u5f00\u5173", 
            "title": "\u706f\u5177\u63a7\u5236"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_6", 
            "text": "\u63a5\u5165\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba, \u9ed8\u8ba4\u6bcf\u5468\u4e00\u4e09\u4e94\u542f\u52a8\u6e05\u626b, \u4f4624\u5c0f\u65f6\u5185\u4e0d\u91cd\u542f\u542f\u52a8\u6e05\u626b.", 
            "title": "\u5c0f\u7c73\u626b\u5730\u673a\u5668\u4eba"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_7", 
            "text": "\u4e5f\u5c31\u662f\u592a\u9633\u4e0b\u5c71\u4e0e\u5426\u7684\u72b6\u6001.", 
            "title": "\u65e5\u7167\u72b6\u6001"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_8", 
            "text": "\u8be5\u72b6\u6001\u7684\u5b58\u5728\u610f\u4e49\u662f, \u4e2a\u4eba\u671f\u671b\u5bb6\u5ead\u6210\u5458\u5728\u5ba2\u5385\u65f6, \u81ea\u52a8\u6253\u5f00\u5ba2\u5385\u706f, \u79bb\u5f00\u5ba2\u5385\u65f6, \u81ea\u52a8\u5173\u95ed\u5ba2\u5385\u7684.  \u5728\u521d\u671f\u5b66\u4e60\u9636\u6bb5, \u89e3\u9664\u5230\u7684\u4e3b\u8981\u6709\u84dd\u7259\u5e7f\u64ad\u548cRFID, \u90fd\u662f\u901a\u8fc7\u4e09\u70b9\u6cd5\u6765\u5b9a\u4f4d(\u76f8\u5173\u4fe1\u606f\u53ef\u4ee5\u767e\u5ea6\u5ba4\u5185\u5b9a\u4f4d). \u9996\u5148, \u57fa\u4e8e\u82af\u7247\u7684\u5b9a\u4f4d(\u4ed3\u5e93\u5b9a\u4f4d)\u4e0d\u9002\u5408\u5bb6\u5ead\u4f7f\u7528, \u56e0\u4e3a\u5bb6\u5ead\u4e0d\u53ef\u80fd\u4f1a\u5e26\u7740\u5c04\u9891\u82af\u7247.\u800c\u84dd\u7259\u5e7f\u64ad\u53ea\u6709\u63a5\u6536\u7aef\u624d\u80fd\u77e5\u9053\u81ea\u5df1\u4e0e\u53d1\u9001\u7aef\u7684\u8ddd\u79bb(\u4fe1\u53f7\u8870\u51cf), \u4e14\u9700\u8981\u4e09\u4e2a\u84dd\u7259\u5b9a\u4f4d. \u8003\u8651\u5230\u4e0e\u84dd\u7259\u7c7b\u4f3c, \u4f46\u6536\u5230\u73af\u5883\u5f71\u54cd\u66f4\u5927\u7684wifi, \u6d4b\u8bd5\u5c0f\u7c73\u8def\u7531\u5668\u4e0a\u53ef\u4ee5\u83b7\u53d6\u5230\u76ee\u6807\u624b\u673a\u7684\u4fe1\u53f7\u5f3a\u5ea6, \u5219\u51b3\u5b9a\u6539\u7528wifi\u5212\u5b9a\u4e24\u4e2a\u5706\u5f27\u533a\u57df. \u5c0f\u5706\u5f27\u533a\u57df\u5185\u5f00\u706f, \u5927\u5706\u5f27\u533a\u57df\u5916\u5173\u706f, \u800c\u4e24\u4e2a\u5706\u5f27\u533a\u57df\u4e2d\u95f4\u4fdd\u6301\u539f\u72b6\u6001\u4e0d\u53d8.", 
            "title": "\u5bb6\u5ead\u4eba\u5458\u5728\u5ba2\u5385\u72b6\u6001"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_9", 
            "text": "\u5206\u522b\u6709 ibot, tuling, xiaoi, emotibot. \u4f46\u4e0d\u662f\u6240\u6709\u7684\u90fd\u542f\u7528, \u5728\u804a\u5929\u63d2\u4ef6\u4e2d, \u9009\u62e9\u5176\u4e2d\u7684\u4e00\u4e2a\u542f\u52a8\u5e76\u4ea4\u4e92.", 
            "title": "\u804a\u5929\u673a\u5668\u4eba"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_10", 
            "text": "\u6240\u8c13\u7684\u6587\u4ef6\u7ba1\u7406\u5668, \u53ea\u662f\u4e00\u4e2a\u6587\u4ef6\u7d22\u5f15\u52a0\u4e0a\u6587\u4ef6\u67e5\u627e\u7684\u5de5\u5177, \u989d\u5916\u589e\u52a0\u4e86\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u7684\u529f\u80fd. \u6587\u4ef6\u7d22\u5f15\u4f7f\u7528\u7684\u662fjieba\u548cwhoos. \u53ef\u4ee5\u901a\u8fc7slackbot\u5feb\u901f\u67e5\u627e\u67d0\u4e2a\u6587\u4ef6\u6216\u8005\u67d0\u672c\u4e66(\u7535\u5b50\u4e66\u591a\u5230\u81ea\u5df1\u4e5f\u4e0d\u77e5\u9053\u6709\u591a\u5c11\u672c).", 
            "title": "\u6587\u4ef6\u7ba1\u7406\u5668"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_11", 
            "text": "\u4e0d\u53ea\u662f\u8ffd\u5267, \u4e5f\u662f\u8ffd\u7535\u5f71. \u7535\u5f71\u8c46\u74e37.0\u4ee5\u4e0a\u624d\u63a8\u9001, \u800c\u5267\u662f\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u65e5\u5267, \u5168\u63a8((\u2299\ufe4f\u2299)b),\u540e\u6765\u56e0\u4e3a\u67d0\u4e9b\u6bd4\u8f83\u65e0\u5948\u7684\u539f\u56e0,  \u8fd9\u8d27\u5f00\u59cb\u63a8\u4e00\u4e9b\u8001\u5bb6\u91cc\u653f\u59d4\u559c\u6b22\u7684\u5267, \u5c31\u6309\u9700\u52a0\u4e86\u4e2a\u529f\u80fd, \u9ed1\u767d\u540d\u5355. \u679c\u7136\u8001\u5a46\u662f\u7b2c\u4e00\u751f\u4ea7\u529b.", 
            "title": "\u8ffd\u5267\u6a21\u5757"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_12", 
            "text": "\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u722c\u866b, \u4e0d\u505c\u5730\u722c\u53d6\u6307\u5b9a\u5c0f\u8bf4\u5224\u65ad\u662f\u5426\u5b58\u5728\u66f4\u65b0. \u5728\u4e2a\u4eba\u7684\u4e3b\u9875\u4ecb\u7ecd\u4e2d\u4ecb\u7ecd\u4e86\u559c\u6b22\u5386\u53f2\u5c0f\u8bf4, \u6240\u4ee5\u5927\u90e8\u5206\u90fd\u662f\u5386\u53f2\u7c7b\u5c0f\u8bf4", 
            "title": "\u5c0f\u8bf4\u6a21\u5757"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_13", 
            "text": "\u8c03\u7528mplayer\u64ad\u653e", 
            "title": "\u64ad\u653e\u6a21\u5757"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_14", 
            "text": "\u8c03\u7528arecord\u5f55\u97f3", 
            "title": "\u5f55\u5236\u6a21\u5757"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_15", 
            "text": "\u7528\u4e86\u767e\u5ea6\u7684api", 
            "title": "\u8bed\u97f3\u8f6c\u6587\u5b57"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_16", 
            "text": "\u7528\u4e86iflytek\u7684API, \u4e0d\u5f97\u4e0d\u8bf4\u5b83\u4eec\u5bb6\u8bed\u97f3\u505a\u5f97\u597d, \u5404\u79cd\u4eba\u7269\u53ef\u9009.", 
            "title": "\u6587\u5b57\u8f6c\u8bed"
        }, 
        {
            "location": "/2017-10-01-slackbot/#_17", 
            "text": "\u5305\u542b\u4e86\u6a21\u4eff\u6d4f\u89c8\u5668\u6253\u5f00\u7684\u4ee3\u7801(cookie\u7b49), \u5b9e\u73b0\u4e86\u4ee3\u7406\u6c60, \u5e76\u53ef\u4ee3\u7406\u8bbf\u95ee.", 
            "title": "\u5de5\u5177"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/", 
            "text": "\u6765\u6e90:https://pengzhangdev.github.io/Android-AB-system-update/\n\n\n A/B\u7cfb\u7edf\u7b80\u4ecb \n\n\n\n\u987e\u540d\u601d\u4e49, \nA/B\n\u7cfb\u7edf\u5c31\u662f\u6307\u7ec8\u7aef\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf,(userdata\u53ea\u6709\u4e00\u4efd, \u88ab\u4e24\u5957\u7cfb\u7edf\u5171\u7528). \u7b80\u5355\u6765\u8bb2, \u53ef\u4ee5\u7406\u89e3\u4e3a, \u5b58\u5728\u4e00\u5957\u7cfb\u7edf\u5206\u533a, \u4e00\u5957\u5907\u4efd\u5206\u533a, \u4e24\u5957\u7cfb\u7edf\u90fd\u53ef\u4ee5\u88ab\u542f\u52a8, \u4e24\u5957\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u53ef\u4ee5\u4e00\u6837, \u4e5f\u53ef\u4ee5\u4e00\u5957\u65e7, \u4e00\u5957\u65b0. \u800c\u5347\u7ea7\u5c31\u662f\u5c06\u65e7\u7684\u7cfb\u7edf\u5347\u7ea7\u5230\u65b0\u7248\u672c.\n\n\nA/B\u7cfb\u7edf\u5b9e\u73b0\u4e86\u65e0\u7f1d\u5347\u7ea7(Seamless System Updates), \u5b58\u5728\u5982\u4e0b\u7279\u70b9:\n\n\n\n\n\u7ec8\u7aef\u8bbe\u5907\u5728\u51fa\u5382\u65f6\u6709\u4e24\u5957\u8bbe\u5907\u53ef\u4ee5\u5de5\u4f5c, \u5728\u5347\u7ea7\u51fa\u73b0\u5f02\u5e38\u6216\u8005\u51fa\u9519\u65f6, \u59cb\u7ec8\u786e\u4fdd\u7cfb\u7edf\u5b58\u5728\u4e00\u5957\u8bbe\u5907\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c.\n\n\n\u7cfb\u7edf\u5728\u540e\u53f0\u8fdb\u884c\u5347\u7ea7, \u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf, \u7528\u6237\u4e0d\u4f1a\u88ab\u6253\u65ad. \u5728\u66f4\u65b0\u5b8c\u6210\u540e, \u7528\u6237\u5728\u4e0b\u6b21\u91cd\u542f\u624b\u673a\u65f6, \u5c31\u4f1a\u8fdb\u5165\u65b0\u7cfb\u7edf.\n\n\n\u5728 dm-verity \u6216\u8005\u5176\u4ed6\u6821\u9a8c\u65b9\u5f0f\u68c0\u6d4b\u5230\u7cfb\u7edf\u987a\u574f\u6216\u5f02\u5e38\u540e, \u53ef\u4ee5\u91cd\u542f\u56de\u5230\u5347\u7ea7\u524d\u7684\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u4f7f\u7528\u4e0d\u53d7\u5f71\u54cd.\n\n\n\n\nAndroid8.0\u7684\u4ee3\u7801\u7f16\u8bd1\u65f6, \u5728BoardConfig\u6709\u5bf9\u5e94\u7684\u9009\u9879\u6765\u63a7\u5236\u662f\u7f16\u8bd1\u6210A/B\u7cfb\u7edf\u8fd8\u662f\u6b63\u5e38\u5355\u7cfb\u7edf. \u7531\u4e8e\u65b0\u7cfb\u7edf\u8ddf\u539f\u6765\u7684OTA\u5347\u7ea7\u7cfb\u7edf\u5b58\u5728\u5927\u4e0d\u540c, \u5bfc\u81f4\u65e0\u6cd5\u901a\u8fc7\u4ee5\u524d\u7684OTA\u5347\u7ea7\u65b9\u5f0f(\u5b89\u5168\u5730)\u5347\u7ea7\u5230A/B\u7cfb\u7edf.\n\n\n\u800cA/B\u7cfb\u7edf\u5347\u7ea7, \u662f\u7531\u8fd0\u884c\u4e8eAndroid\u540e\u53f0\u7684\nupdate_engine\n\u548c \nslot a\n, \nslot b\n\u4e24\u5957\u7cfb\u7edf\u5171\u540c\u5b8c\u6210. \u5728\u542f\u52a8\u5176\u4e2d\u4e00\u5957\u7cfb\u7edf\u7684\u60c5\u51b5\u4e0b, \nupdate_engine\n\u5728\u540e\u53f0\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u4e0b\u8f7d\u5347\u7ea7\u6d41\u5e76\u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf.\n\n\nA/B \u7cfb\u7edf\u5347\u7ea7\u4e3b\u8981\u6d89\u53ca\u5982\u4e0b4\u4e2a\u65b9\u9762:\n\n\n\n\n\u5206\u533a\u9009\u62e9(slots), \u5373\u9009\u62e9\u54ea\u4e2a\u7cfb\u7edf.\n\n\nupdate_engine\n, \u5373\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7\n\n\nbootloader\u4ea4\u4e92, \u5373\u5982\u4f55\u901a\u77e5bootloader\u5207\u6362slot\n\n\nota\u5305\u751f\u6210.\n\n\n\n\n\n \u5206\u533a\u9009\u62e9 \n\n\n\n\n\u5206\u533a\u8868\u548c\u5206\u533a\u5185\u5bb9\u53d8\u5316\n\n\n\n\n\u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003 \nAndroid8 \u5206\u533a\u8868\u548c\u5206\u533a\u76f8\u5173\u64cd\u4f5c\n. \u8fd9\u91cc\u7b80\u5355\u603b\u7ed3\u4e0b\u5206\u533a\u8868\u4e0a\u8ddf\u5355\u7cfb\u7edf\u7684\u5dee\u5f02.\n\u8fd9\u91cc\u4ee5boot,system, vendor\u548cmodem\u5b58\u5728\u4e24\u5957\u7cfb\u7edf\u4e3a\u4f8b\u5b50, \u5176\u4f59\u5206\u533a\u6309\u7167\u6700\u5c0f\u5206\u533a\u8868.\n\n\n\n\n\n\n\n\n\u5355\u7cfb\u7edf\u5206\u533a\u8868\n\n\nA/B\u7cfb\u7edf\u5206\u533a\u8868\n\n\n\u529f\u80fd\u63cf\u8ff0\n\n\n\n\n\n\n\n\n\n\nbootloader\n\n\nbootloader\n\n\n\u5f15\u5bfclinux\u7cfb\u7edf\n\n\n\n\n\n\nmisc\n\n\nmisc\n\n\nAndroid\u7cfb\u7edf\u4e0erecovery, bootloade\u901a\u4fe1\u7684\u6570\u636e\n\n\n\n\n\n\nboot\n\n\n-\n\n\n\u5b58\u653eAndroid\u7684kernel\u548cramdisk\n\n\n\n\n\n\n-\n\n\nboot_a\n\n\n\u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk\n\n\n\n\n\n\n-\n\n\nboot_b\n\n\n\u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk\n\n\n\n\n\n\nsystem\n\n\n-\n\n\nAndroid\u7cfb\u7edf\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6.\n\n\n\n\n\n\n-\n\n\nsystem_a\n\n\n\u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6\n\n\n\n\n\n\n-\n\n\nsystem_b\n\n\n\u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6\n\n\n\n\n\n\n-\n\n\nvendor_a\n\n\n\u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4\n\n\n\n\n\n\n-\n\n\nvendor_b\n\n\n\u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4\n\n\n\n\n\n\ncache\n\n\n-\n\n\n\u4e34\u65f6\u5b58\u653e\u6570\u636e, \u901a\u5e38\u4e34\u65f6\u5b58\u653e\u4e0b\u8f7d, \u5907\u4efd\u548c\u5347\u7ea7\u5305\n\n\n\n\n\n\nrecovery\n\n\n-\n\n\n\u5b58\u653erecovery\u7cfb\u7edf\u7684kernel\u548cramdisk\n\n\n\n\n\n\nuserdata\n\n\nuserdata\n\n\n\u5b58\u653e\u7528\u6237\u6570\u636e\n\n\n\n\n\n\n\n\n\u6240\u8c13\u7684A/B\u7cfb\u7edf\u5206\u533a, \u5c31\u662f\u5728\u539f\u6709\u5206\u533a\u540d\u5b57\u540e\u5417\u6dfb\u52a0\n_a\n \u548c \n_b\n, \u5728\u5237\u673a, \u6216\u8005\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019, \u6839\u636ebootloader\u7684\u53c2\u6570\u6dfb\u52a0\u540e\u7f00, \u9009\u62e9\u6b63\u786e\u7684\u7cfb\u7edf. misc\u5206\u533a\u5728A/B\u7cfb\u7edf\u4e2d\u53d8\u6210\u4e00\u4e2a\u53ef\u6709\u53ef\u65e0\u7684\u5b58\u5728, \u56e0\u4e3a\u5176\u529f\u80fd\u53ea\u662f\u4f20\u9012\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u53c2\u6570, \u800crecovery\u7684\u529f\u80fd\u4e5f\u53ea\u5269\u4e0b\u6062\u590d\u51fa\u5382\u8bbe\u7f6e, \u6240\u4ee5, \u672c\u8d28\u4e0a, \u6ca1\u5fc5\u8981\u518d\u57fa\u4e8emisc\u4f20\u9012\u53c2\u6570\u4e86.\n\n\n\n\u7cfb\u7edf\u5206\u533a\u5c5e\u6027\n\n\n\nbootloader\u4e3a\u4e86\u5224\u65ad\u4e00\u4e2a\u7cfb\u7edf(slot)\u662f\u5426\u4e3a\u53ef\u4ee5\u542f\u52a8\u7684\u72b6\u6001, \u9700\u8981\u4e3a\u5176\u5b9a\u4e49\u5bf9\u5e94\u7684\u5c5e\u6027(\u72b6\u6001). \u5176\u72b6\u6001\u8bf4\u660e\u5982\u4e0b:\n\n\n\n\nactive. \u6d3b\u52a8\u5206\u533a\u6807\u8bc6, \u6392\u4ed6, \u4ee3\u8868\u8be5\u5206\u533a\u4e3a\u542f\u52a8\u5206\u533a, bootloader\u603b\u4f1a\u9009\u62e9\u8be5\u5206\u533a.\n\n\nbootable. \u8868\u793a\u8be5slot\u7684\u5206\u533a\u5b58\u5728\u4e00\u5957\u53ef\u80fd\u53ef\u4ee5\u542f\u52a8\u7684\u7cfb\u7edf.\n\n\nsuccessful. \u8868\u793a\u8be5slot\u7684\u7cfb\u7edf\u80fd\u6b63\u5e38\u542f\u52a8.\n\n\nunbootable. \u4ee3\u8868\u8be5\u5206\u533a\u635f\u574f\u7684, \u65e0\u6cd5\u542f\u52a8, \u5728\u5347\u7ea7\u8fc7\u7a0b\u603b\u88ab\u6807\u8bb0, \u8be5\u6807\u8bb0\u7b49\u6548\u4e8e\u4ee5\u4e0a\u6807\u8bb0\u88ab\u6e05\u7a7a. \u800cactive\u6807\u8bb0\u4f1a\u5c06\u8be5\u6807\u8bb0\u6e05\u7a7a.\n\n\n\n\nslot a\n \u548c \nslot b\n, \u53ea\u6709\u4e00\u4e2a\u662factive, \u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u6709 bootable \u548c successful \u5c5e\u6027.\n\n\n\n\n\nbootloader\u68c0\u6d4b\u52301\u4e2a\u6216\u80052\u4e2aslot\u90fd\u662fbootable\u7684\u72b6\u6001.\n\n\n\u9009\u62e9active\u7684slot\u6216\u8005\u9009\u62e9successful\u7684slot\u8fdb\u884c\u5c1d\u8bd5\u542f\u52a8.\n\n\n\u542f\u52a8\u6210\u529f\u7684\u6807\u8bb0\u662f, dm-verity \u6210\u529f.\n\n\n\u7531\u4e8e\u542f\u52a8\u6210\u529f, \u5219\u8be5slot\u88ab\u6807\u8bb0\u4e3asuccessful\u548cactive\n\n\n\u7531\u4e8e\u542f\u52a8\u5931\u8d25, \u5219\u8bbe\u7f6e\u8be5slot\u4e3aunbootable, \u5e76\u8bbe\u7f6e\u53e6\u4e00\u4e2aslot\u4e3aactive, \u8fdb\u884c\u4e0b\u4e00\u6b21\u5c1d\u8bd5.\n\n\n\n\n\n\n\n\n\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7\n\n\n\n\n\u9996\u5148, \u6211\u4eec\u770b\u4e0b\u5347\u7ea7\u5305\u7684\u5185\u5bb9. \u5728A/B\u5347\u7ea7\u7684\u60c5\u51b5\u4e0b, \u5347\u7ea7\u5305\u5185\u5bb9\u5982\u4e0b:\n\n\nPath = aosp_marlin-ota-eng.builder.zip\nType = zip\nComment = signed by SignApk\nPhysical Size = 384694679\n\n   Date      Time    Attr         Size   Compressed  Name\n------------------- ----- ------------ ------------  ------------------------\n2009-01-01 00:00:00 .....          360          360  META-INF/com/android/metadata\n2009-01-01 00:00:00 .....          107          107  care_map.txt\n2009-01-01 00:00:00 .....    384690699    384690699  payload.bin\n2009-01-01 00:00:00 .....          154          154  payload_properties.txt\n2009-01-01 00:00:00 .....         1675          943  META-INF/com/android/otacert\n------------------- ----- ------------ ------------  ------------------------\n                             384692995    384692263  5 files, 0 folders\n\n\n\n\n\n\n\n\u4e0b\u8f7d\u548c\u5347\u7ea7\u7a0b\u5e8f\u662f\nupdate_engine\n, \u6765\u81eachrome os, \u4ee3\u7801\u4e2d\u5927\u91cf\u5b58\u5728dbus\u548cchrome os\u7684\u75d5\u8ff9, \u800cAndroid\u4e0a\u6539\u7a0b\u5e8f\u662f\u57fa\u4e8ebinde\u8fdb\u884c\u901a\u4fe1. \u4e0e\u539f\u5148\u7684ota\u5347\u7ea7\u4e0d\u540c, \u8be5\u5347\u7ea7\u5305\u4e2d\u4e0d\u5305\u542bupdater, \u4e5f\u5c31\u662f\u8bf4, \u5347\u7ea7\u7684\u903b\u8f91\u5728\u8bbe\u5907\u7aef\u800c\u4e0d\u662f\u5728\u5347\u7ea7\u5305\u4e2d. \u5982\u679c\u719f\u6089ota\u5347\u7ea7\u7684\u8bdd, \u8fd9\u4e2a\u5347\u7ea7\u5305\u4e2d\u7684\u6570\u636e\u8ddf\u5757\u5347\u7ea7\u6570\u636e\u51e0\u4e4e\u4e00\u6837, \u521d\u6b65\u5224\u65ad\u7528\u7684\u662f\u5757\u5347\u7ea7.\n\u90a3\u4e48, \u5982\u679c\u6709\u65b0\u7684\u9700\u6c42, \u6bd4\u5982\u6b64\u6b21\u66f4\u65b0\u9700\u8981\u8c03\u6574\u6570\u636e\u5e93, \u662f\u5982\u4f55\u505a\u5230\u7684? \u8bf7\u67e5\u770b\u540e\u6587\u7b2c\u4e8c\u6b65\u5347\u7ea7.\n\n\n\n\u6574\u4e2a\u5347\u7ea7\u5206\u4e3a\u4e94\u6b65:\n\n\n\n\n\u4e0b\u8f7d\u5347\u7ea7\u5305, \u6216\u8005\u5347\u7ea7\u6d41. Android8 \u65b0\u652f\u6301\u4e86\u6d41\u5f0f\u5347\u7ea7, \u53ef\u4ee5\u8fb9\u4e0b\u8fb9\u5347.\n\n\n\u7b2c\u4e00\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f, \nupdate_engine\n\u6267\u884c\u7684\u5347\u7ea7\u903b\u8f91, \u57fa\u672c\u7684\u6570\u636e\u5199\u5165.\n\n\n\u6821\u9a8c\u5199\u5165\u6570\u636e. \u786e\u4fdd\u4e0a\u4e00\u6b65\u5199\u5165\u6570\u636e\u53ef\u9760\u5b8c\u6574.\n\n\n\u7b2c\u4e8c\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f, \u6302\u8f7d\u65b0\u70e7\u5199\u7684\u5206\u533a, \u5e76\u6267\u884c\u5176\u4e2d\u7684\u6307\u5b9a\u811a\u672c(\u7a0b\u5e8f)\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u64cd\u4f5c.\n\n\n\u5e94\u7528\u4f18\u5316.  \u7531\u4e8e\u5b58\u5728A/B\u65b0\u65e7\u4e24\u5957\u7cfb\u7edf, \u6240\u4ee5, data\u5e95\u4e0b\u4e5f\u5b58\u5728\u4e24\u5957odex/vdex.\n\n\n\n\n\u524d4\u6b65, \u57fa\u4e8e\u4e00\u79cdpipe\u7684\u6846\u67b6\u5b9e\u73b0, \u6bcf\u4e00\u6b65\u90fd\u662f\u4e00\u4e2aaction, \u522b\u94fe\u63a5\u5230actio list\u4e2d, \u524d\u540e\u4e24\u4e2aaction\u901a\u8fc7pipe\u673a\u5236\u8fdb\u884c\u6570\u636e\u901a\u4fe1. \u4e5f\u5c31\u662f\u8bf4, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u9ed8\u8ba4\u53d8\u6210\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. action\u7684\u6267\u884c\u51fd\u6570\u662f\nPerformAction()\n. \u901a\u8fc7\nHasInputObject()\n\u548c\nHasOutputPipe()\n\u5224\u65ad\u662f\u5426\u6709\u8f93\u5165\u548c\u8f93\u51fa\u6d41, \u800c\nGetInputObject()\n\u63a5\nSetOutputObject()\n\u5206\u522b\u662f\u8bfb\u53d6\u548c\u5199\u5165pipe.\n\n\nupdate_engine\n \u7684 Androidmk\u76ee\u6807, \u4f9d\u8d56\u548c\u5bf9\u5e94\u6e90\u7801\u6587\u4ef6\u5982\u4e0b.\n\n\n# \u9759\u6001\u5e93\u6a21\u5757\nSTATIC_LIBRARIES:\n    update_metadata-protos      (host, target)\n    libpayload_consumer         (host, target)\n    libupdate_engine_android    (target)\n    libpayload_generator        (host, target)\n\n# \u53ef\u6267\u884c\u6a21\u5757\nEXECUTABLES:\n    update_engine           (target)\n    update_engine_sideload      (target)\n    update_engine_client        (target)\n    delta_generator         (host)\n\n# \u5171\u4eab\u5e93\u6a21\u5757\nSHARED_LIBRARIES:\n    libupdate_engine_client     (target)\n\n# \u9884\u7f16\u8bd1\u6a21\u5757\nPREBUILT:\n    updater.json            (target)\n    brillo_update_payload       (host)\n\n\n\n\n\n\u4ece\u4e0a\u6587\u7684\u76ee\u6807\u53ef\u4ee5\u83b7\u53d6\u5982\u4e0b\u4fe1\u606f:\n\n\n\n\npayload \u4e2d\u7684\u6587\u4ef6\u7ed3\u6784\u662fprotos\n\n\n\u53ef\u6267\u884c\u6587\u4ef6\u662f \nupdate_engine\n, \u800c \nupdate_engine_client\n \u662f\u5ba2\u6237\u7aef, \nupdate_engine_sideload\n \u662frecovery\u6a21\u5f0f\u4e0b\u901a\u8fc7usb\u66f4\u65b0.\n\n\ndelta_generator\n \u7528\u4e8e\u751f\u6210payload\n\n\n\u5b8c\u6574\u7684Android.mk\u4e2d, \u5b58\u5728\u6807\u8bb0\u4e3a\nlocal_use_omaha\n, \u53ea\u6709\u5728 \nPRODUCT_IOT\n \u7269\u8054\u7f51\u65f6, \u624d\u542f\u7528, \u7f16\u8bd1\u83b7\u5f97\u7684\u662fdbus\u7248\u672c\u7684\nupdate_engine\n.\n\n\n\n\n\u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b:\n\n\nupdate_engine (target)\n  --\n libupdate_engine_android\n    --\n libpayload_consumer\n      --\n update_metadata-protos\n\nupdate_engine_sideload (target)\n  --\n update_engine_sideload\n    --\n update_metadata-protos\n\nupdate_engine_client (target)\n\ndelta_generator (host)\n  --\n libpayload_generator\n    --\n libpayload_consumer\n      --\n update_metadata-protos\n\n\n\n\n\n\u6e90\u7801\u5217\u8868\u5982\u4e0b:\n\n\nupdate_metadata-protos (STATIC_LIBRARIES)\n  --\n update_metadata.proto\n\nlibpayload_consumer (STATIC_LIBRARIES)\n  --\n common/action_processor.cc\n      common/boot_control_stub.cc\n      common/clock.cc\n      common/constants.cc\n      common/cpu_limiter.cc\n      common/error_code_utils.cc\n      common/hash_calculator.cc\n      common/http_common.cc\n      common/http_fetcher.cc\n      common/file_fetcher.cc\n      common/hwid_override.cc\n      common/multi_range_http_fetcher.cc\n      common/platform_constants_android.cc\n      common/prefs.cc\n      common/subprocess.cc\n      common/terminator.cc\n      common/utils.cc\n      payload_consumer/bzip_extent_writer.cc\n      payload_consumer/delta_performer.cc\n      payload_consumer/download_action.cc\n      payload_consumer/extent_writer.cc\n      payload_consumer/file_descriptor.cc\n      payload_consumer/file_writer.cc\n      payload_consumer/filesystem_verifier_action.cc\n      payload_consumer/install_plan.cc\n      payload_consumer/payload_constants.cc\n      payload_consumer/payload_verifier.cc\n      payload_consumer/postinstall_runner_action.cc\n      payload_consumer/xz_extent_writer.cc\n\nlibupdate_engine_android (STATIC_LIBRARIES)\n  --\n binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      binder_service_android.cc\n      boot_control_android.cc\n      certificate_checker.cc\n      daemon.cc\n      daemon_state_android.cc\n      hardware_android.cc\n      libcurl_http_fetcher.cc\n      network_selector_android.cc\n      proxy_resolver.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n\nupdate_engine (EXECUTABLES)\n  --\n main.cc\n\nupdate_engine_sideload (EXECUTABLES)\n  --\n boot_control_android.cc\n      hardware_android.cc\n      network_selector_stub.cc\n      proxy_resolver.cc\n      sideload_main.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n      boot_control_recovery_stub.cc\n\nupdate_engine_client (EXECUTABLES)\n  --\n binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      common/error_code_utils.cc\n      update_engine_client_android.cc\n      update_status_utils.cc\n\nlibpayload_generator (SHARED_LIBRARIES)\n  --\n payload_generator/ab_generator.cc\n      payload_generator/annotated_operation.cc\n      payload_generator/blob_file_writer.cc\n      payload_generator/block_mapping.cc\n      payload_generator/bzip.cc\n      payload_generator/cycle_breaker.cc\n      payload_generator/delta_diff_generator.cc\n      payload_generator/delta_diff_utils.cc\n      payload_generator/ext2_filesystem.cc\n      payload_generator/extent_ranges.cc\n      payload_generator/extent_utils.cc\n      payload_generator/full_update_generator.cc\n      payload_generator/graph_types.cc\n      payload_generator/graph_utils.cc\n      payload_generator/inplace_generator.cc\n      payload_generator/payload_file.cc\n      payload_generator/payload_generation_config.cc\n      payload_generator/payload_signer.cc\n      payload_generator/raw_filesystem.cc\n      payload_generator/tarjan.cc\n      payload_generator/topological_sort.cc\n      payload_generator/xz_android.cc\n\ndelta_generator (EXECUTABLES)\n  --\n payload_generator/generate_delta_main.cc\n\n\n\n\n\n \u4e0b\u8f7d \n\n\n\u4e0b\u8f7d\u76f8\u5173\u4e0e\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u903b\u8f91: \ndelta_performer.cc\n\n\n\u5347\u7ea7\u6d41(\u5305)\u7684\u4e0b\u8f7d, \u5206\u4e3a\u4e24\u4e2a\u6a21\u5f0f:\n\n\n\n\n\u4e0b\u8f7dzip\u5305\u5230data\u5206\u533a.\n\n\n\u4e0b\u8f7d\u5347\u7ea7\u6d41, \u8fb9\u4e0b\u8fb9\u5347\u7ea7.\n\n\n\n\n( \u4ecechrome os\u4ee3\u7801\u770b, \u5176\u5347\u7ea7\u670d\u52a1\u5668\u662fomaha server, \u53ef\u4ee5\u53c2\u8003\u770b\u4e0b\u5bf9\u4e8e\u6211\u4eec\u7684\u5347\u7ea7\u670d\u52a1\u5668\u662f\u5426\u6709\u5e2e\u52a9.\nhttps://github.com/Crystalnix/omaha-server\nhttps://github.com/Crystalnix/omaha-server/wiki\n)\n\n\npayload \u6570\u636e\u7ed3\u6784:\n\n\nversion 1:\n| \nC\nr\nA\nU\n | version(8) | manifestSize(8) | manifest(manifestSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |\n\nversion 2:\n| \nC\nr\nA\nU\n | version(8) | manifestSize(8) | MetadataSignatureSize(4) | manifest(manifestSize) | medatadataSignatureMessage(MetadataSignatureSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |\n\n\n\n\n\n\u5176\u4e2d medatadataSignatureMessage \u6821\u9a8c\u7684\u662f\u5176\u4e4b\u524d\u7684\u6240\u6709\u6570\u636e, \u800c payloadSignatureMessage \u6821\u9a8c\u7684\u662f payloadSignatureMessageSize \u4e4b\u524d\u7684\u6240\u6709\u6570\u636e.\n\n\n\u800c manifest \u662fprotobuff, \u5176\u4e2d\u5305\u542b\u4e00\u7ec4\u6307\u4ee4\u96c6, \u4e5f\u5c31\u662f\u4ee5\u524drecovery \u5757\u5347\u7ea7\u7684\u4e00\u7cfb\u5217\u6307\u4ee4. rawData\u662f\u88ab\u66f4\u65b0\u6570\u636e, \u6307\u4ee4\u4f1a\u4ecerawData\u6307\u5b9a\u4f4d\u7f6e\u8bfb\u53d6\u6570\u636e\u5e76\u5e94\u7528\u5230\u76ee\u6807\u5206\u533a\u7684\u6307\u5b9a\u4f4d\u7f6e.\n\n\nmetadata\u7684\u6570\u636e\u662fprotobuf, \u6570\u636e\u7ed3\u6784\u4e3a update_metadata.proto\n\n\n\u4e0b\u8f7d\u5b58\u5728\u4e24\u79cd\u6a21\u5f0f, p2p\u548c\u666e\u901a\u4e0b\u8f7d.\n\n\n\u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u903b\u8f91\u4e0e\u4e4b\u524dota\u5347\u7ea7\u4e0b\u8f7d\u5347\u7ea7\u5305\u7684\u903b\u8f91\u4e00\u81f4. \nupdate_engine\n\u5c06\u5347\u7ea7\u5305\u4e0b\u8f7d\u5230\u672c\u5730.  \u4e0b\u9762\u5148\u4ecb\u7ecd\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u7684\u903b\u8f91.\n\n\n\u4e0b\u8f7d\u5230data\u5206\u533a\n\n\n\u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u5b9e\u73b0\u4e0d\u518d\nupdate_engine\n\u4e2d, \u800c\u5982\u679c\u662f\u9884\u5148\u4e0b\u8f7d\u5b8c\u6210\u7684payload, \u901a\u8fc7\nfile://\n\u7684url\u4f20\u9012\u7ed9\nupdate_engine\n, \u540e\u7eed\u903b\u8f91\u4e0e\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u4e00\u6837.\n\n\n\u800cjava\u5c42\u7684UpdateEngine.java\u7684API, \u66b4\u9732\u5230\u4e86\u7cfb\u7edf\u7684jar\u5305\u4e2d, \u5e76\u672a\u627e\u5230\u8c03\u7528\u8005, \u4e5f\u5c31\u662f\u8bf4, \u8fd9\u5757\u903b\u8f91\u662f\u975e\u5f00\u6e90\u7684, \u6211\u4eec\u65e0\u6cd5\u83b7\u5f97.\n\n\n\u8fb9\u4e0b\u8fb9\u5347\n\n\n\u6240\u8c13\u8fb9\u4e0b\u8fb9\u5347, \u5c31\u662f\u5c06\u5347\u7ea7\u6570\u636e\u4e0b\u8f7d\u5230\u5185\u5b58\u4e2d, \u5e76\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\u76f8\u5e94\u5904\u7406, \u6700\u540e\u5199\u5165\u76ee\u6807\u5206\u533a.\n\n\n\u4e0b\u9762\u662f\u8fb9\u4e0b\u8fb9\u5347\u7684\u5ba2\u6237\u7aef\u6267\u884c\u547d\u4ee4.\n\n\n# update_engine_client \\\n--payload=http://xxx/android/full-ota/payload.bin \\\n--update \\\n--headers=\n\\\n  FILE_HASH=ozGgyQEddkI5Zax+Wbjo6I/PCR8PEZka9gGd0nWa+oY= \\\n  FILE_SIZE=282344983\n  METADATA_HASH=GLIKfE6KRwylWMHsNadG/Q8iy5f786WTatvMdBlpOPg= \\\n  METADATA_SIZE=26723 \\\n\n\n\n\n\n\n\n\u5728Pixel\u624b\u673a\u4e0a\u5347\u7ea7\u7684\u8f93\u51falog\u5982\u9644\u4ef6\nupdate_engine.log\n, \u611f\u5174\u8da3\u7684\u7ae5\u978b\u53ef\u4ee5\u770b\u4e0b, \u5176\u4e2d\u5305\u542b\u4e86\u5404\u4e2a\u9636\u6bb5\u7684\u884c\u4e3a.\n\n\n\u5176\u4e2dheader\u540e\u9762\u7684\u5185\u5bb9, \u8ddf\u5347\u7ea7\u5305\u4e2d\u7684\npayload_properties.txt\n \u6587\u4ef6\u5185\u5bb9\u4e00\u6837. \u5404\u5b57\u6bb5\u7684\u4f5c\u7528\u53ef\u4ee5\u53c2\u8003\u524d\u6587payload\u7684\u5934\u6570\u636e\u683c\u5f0f\u6765\u7406\u89e3\u5177\u4f53\u6821\u9a8c\u7684\u6570\u636e\u4f4d.\n\n\nupdate_engine\n \u9996\u5148\u5b9a\u4e49\u4e00\u7cfb\u5217\u7684action:\n\n\n\n\ndownload_action\n: \u4e0b\u8f7d\u6a21\u5757, \u8d1f\u8d23\u8fb9\u4e0b\u8fb9\u5347\u7ea7.\n\n\nfilesystem_verifier_action\n: \u6587\u4ef6\u7cfb\u7edf\u6821\u9a8c\u6a21\u5757, \u8d1f\u8d23\u5347\u7ea7\u5b8c\u6210\u540e\u6821\u9a8c\u6570\u636e\u7684\u5b8c\u6574\u6027\n\n\npostinstall_runner_action\n: \u540e\u5347\u7ea7\u6a21\u5757, \u4e00\u4e9b\u811a\u672c\u6216\u53ef\u6267\u884c\u7a0b\u5e8f\u5728\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u540e\u6267\u884c.\n\n\n\n\n\u4ee5\u4e0aaction\u901a\u8fc7\u7c7b\u4f3cpipeline\u7684\u5f62\u5f0f\u7ec4\u7ec7, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. \u800c\u5728\u5176\u4e2d\u4f20\u9012\u7684\u6570\u636e\u662f\ninstall_plan_\n, \u8be5\u6570\u636e\u5305\u542b\u4e86payload(\u5347\u7ea7\u6570\u636e)\u7684\u6240\u6709\u4fe1\u606f(\u64cd\u4f5c\u5206\u533a, url, \u6821\u9a8c\u4fe1\u606f\u7b49), \u90e8\u5206\u4fe1\u606f\u7531\u540e\u9762\u7684action\u6267\u884c\u540e\u63d0\u4f9b.\n\u6240\u6709\u7684action, \u5176\u6267\u884c\u5165\u53e3\u51fd\u6570\u662f\nPerformAction()\n, \u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570, \u53ef\u4ee5\u66f4\u7ec6\u81f4\u5730\u4e86\u89e3\u8f93\u5165\u8f93\u51fa\u6570\u636e\u548c\u8be5action\u7684\u5177\u4f53\u529f\u80fd.\n\n\n\u672c\u6bb5\u5185\u5bb9\u7740\u91cd\u4ecb\u7ecd\ndownload_action\n, \u5176\u4f59\u6a21\u5757\u5728\u540e\u9762\u4ecb\u7ecd.\n\n\n\n\n\n\n1. \u8bfb\u53d6\u6570\u636e. \u8fd9\u91cc\u5e76\u4e0d\u662f\u6b63\u5e38\u7684read, \u8be5\u51fd\u6570\u662f\u4e2a\u4e0b\u8f7d\u7684Write\u56de\u8c03, \u800c\u8bfb\u53d6\u6570\u636e\u5728\u4ee3\u7801\u4e0a\u7684\u771f\u5b9e\u884c\u4e3a\u662f, \u8fd4\u56de\u9519\u8bef\u8868\u793a\u6570\u636e\u4e0d\u591f, \u7ee7\u7eed\u8bfb\u53d6, \u800c\u5df2\u7ecf\u8bfb\u53d6\u7684\u6570\u636e\u5b58\u653e\u5728buffer\u4e2d.\n2. \u89e3\u6790manifest. \u5c31\u662f\u4e0a\u6587\u4e2dpayload\u7684\u5934, \u5305\u542b\u6821\u9a8c\u4fe1\u606f\u548c\u6267\u884c\u7684\u6307\u4ee4\u96c6, \u8fd8\u6709\u6240\u6709\u64cd\u4f5c\u7684\u5206\u533a\u6821\u9a8c\u503c\u7b49.\n3. \u6253\u5f00\u5206\u533a\u8bbe\u5907. \u6839\u636e\u5347\u7ea7\u7c7b\u578b, \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7(manifest\u4e2d\u5305\u542b\u8be5\u4fe1\u606f), \u5219\u6253\u5f00\u88ab\u5347\u7ea7\u8bbe\u5907\u5206\u533a, \u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u6253\u5f00\u5f53\u524d\u8fd0\u884c\u8bbe\u5907\u5206\u533a\u548c\u88ab\u5347\u7ea7\u76ee\u6807\u5206\u533a.\n4. \u83b7\u53d6\u6307\u4ee4\u5217\u8868. \u662f\u4ecemanifest\u4e2d\u83b7\u53d6. \u4e0d\u540c\u6307\u4ee4, \u683c\u5f0f\u4e0d\u540c, \u4f46\u57fa\u672c\u683c\u5f0f\u662f \nsrc:offset:size\n, \u6307\u5b9a\u64cd\u4f5c\u6e90/\u76ee\u6807, \u504f\u79fb\u548c\u5927\u5c0f.\n5. \u7531\u4e8e1\u63d0\u5230\u7684, \u5728\u6570\u636e\u4e0d\u591f\u65f6\u4f1a\u9000\u51fa, \u6240\u4ee5, \u4f1a\u4fdd\u5b58\u5f53\u524d\u5df2\u7ecf\u6267\u884c\u5230\u7684\u6307\u4ee4, \u5e76\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6307\u4ee4\u4fe1\u606f, \u8fd9\u91cc\u4fe1\u606f\u91cd\u70b9\u662f, \u9700\u8981\u8bfb\u53d6\u7684payload\u4e2doffset\u548csize. \u7531\u4e8epayload\u4e2d\u7684\u5347\u7ea7\u6570\u636e\u662f\u8ddf\u6307\u4ee4\u4e00\u8d77\u751f\u6210\u7684, \u6240\u4ee5, \u5176\u6570\u636e\u7684\u504f\u79fb\u5b8c\u5168\u53ef\u4ee5\u8ddf\u6307\u4ee4\u7684\u987a\u5e8f\u4e00\u81f4, \u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u8bfb\u6307\u9488\u8df3\u52a8, \u4e5f\u5c31\u4e0d\u9700\u8981p2p\u652f\u6301.\n6. \u6267\u884c\u6307\u4ee4. \u57fa\u672c\u6307\u4ee4\u53ef\u4ee5\u67e5\u770b\u4ee3\u7801, \u4e0e\u5757\u5347\u7ea7\u6307\u4ee4\u4e00\u6837.\n\n\n\u4e0b\u9762\u662f\u5347\u7ea7\u65f6\u6570\u636e\u7684\u5408\u6210\u56fe.\n\n\n\n\n\n\u8fd9\u5e45\u56fe\u5c55\u793a\u7684\u662f\u5347\u7ea7\u6570\u636e\u7684\u5408\u6210. \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7, source\u4e3a\u7a7a, \u5219payload\u76f4\u63a5\u5199\u5165target. \u4f46\u4e0e\u4e00\u822c\u5206\u533a\u70e7\u5199\u8fd8\u662f\u6709\u4e9b\u5dee\u5f02, \u5e76\u4e0d\u4f1a\u64e6\u9664target, \u800c\u662f\u6309\u7167\u504f\u79fb\u548c\u5927\u5c0f\u76f4\u63a5\u5199\u5165.\u800c\u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u5219\u662f\u57fa\u4e8e\u5f53\u524d\u8fd0\u884c\u7cfb\u7edf\u4e3asource, \u4e0epayload\u7684\u6570\u636e\u5408\u5e76\u5199\u5165target.\n\n\n\u6240\u4ee5, \u4e0d\u7ba1\u662f\u5168\u91cf\u5347\u7ea7\u8fd8\u662f\u589e\u91cf\u5347\u7ea7, \u65ad\u7535\u540e\u90fd\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u518d\u5347\u7ea7.\n\n\n \u6821\u9a8c \n\n\n\n\n\n\n\n\n\n\n\u83b7\u53d6\u8f93\u5165\u6570\u636e. \u662f\u6307\u83b7\u53d6\u4ece\ndownload_action\n\u5b8c\u6210\u540e\u7684\u6570\u636e, \u5305\u542b\u88ab\u5347\u7ea7\u5206\u533a\u53ca\u5176\u54c8\u5e0c\u503c\u7b49.\n\n\n\u5f00\u59cb\u6821\u9a8c\u88ab\u5347\u7ea7\u5206\u533a. \u5355\u7eaf\u4ece\u5206\u533a\u8bfb\u53d6\u5757\u6570\u636e\u5e76\u4e0epayload\u4e2d\u5b58\u653e\u7684\u8fdb\u884c\u6bd4\u5bf9\u6821\u9a8c.\n\n\n\u5f00\u59cb\u6821\u9a8c\u5f53\u524dslot\u6e90\u5206\u533a. \u8fd9\u4e2a\u662f\u9488\u5bf9\u589e\u91cf\u5347\u7ea7\u7684. \u5728\u6821\u9a8c\u76ee\u6807\u5206\u533a\u5931\u8d25\u540e, \u6821\u9a8c\u6e90\u5206\u533a.\u6b64\u5904\u6821\u9a8c\u7684\u76ee\u7684\u4e0d\u662f\u5224\u65ad\u5f53\u524d\u8fd0\u884c\u7684\u5206\u533a\u662f\u5426\u5408\u6cd5(\u542f\u52a8\u65f6, \u7531\u5176\u4ed6\u6a21\u5757\u6821\u9a8c), \u800c\u662f\u5224\u65ad\u4e0b\u8f7d\u7684payload\u662f\u5426\u4e0e\u5f53\u524d\u7cfb\u7edf\u5339\u914d(\u670d\u52a1\u5668\u7aef\u653e\u9519\u5347\u7ea7\u6587\u4ef6).\n\n\n\u6807\u8bb0\u4f20\u8f93\u5931\u8d25. \u8fd9\u91cc\u662f\u57283\u7684\u57fa\u7840\u4e0a, \u5c06\u5f53\u524dpayload\u7684\u4e0b\u8f7durl\u6807\u8bb0\u5931\u8d25, \u5e76\u589e\u52a0\u5931\u8d25\u6b21\u6570. \u5728\u8fbe\u5230\u4e00\u5b9a\u6b21\u6570\u540e(\u670d\u52a1\u7aef\u914d\u7f6e), \u4e0d\u518d\u4ece\u8be5url\u83b7\u53d6\u5347\u7ea7\u6570\u636e, \u8df3\u5f80\u4e0b\u4e00\u4e2aurl.\n\n\n\n\n post install \n\n\n\u5404\u4e2a\u5206\u533a\u90fd\u53ef\u4ee5\u6307\u5b9apostinstall, \u800cpostinstall\u811a\u672c\u662f\u5728\ndownload_action\n\u89e3\u6790mainifest\u65f6\u89e3\u6790\u5e76\u83b7\u5f97. \u5728\u5b9a\u4e49\u6267\u884cpostinstall\u4f46\u53c8\u65e0\u811a\u672c\u6307\u5b9a\u65f6, \u9ed8\u8ba4postinstall\u811a\u672c\u662f\u5206\u533a\u6839\u76ee\u5f55\u4e0b\u7684\npostinst\n\n\n\u5728Chrome OS\u4e2d, postinstall \u662f\u5141\u8bb8\u5bf9\u5206\u533a\u6267\u884c\u5757\u5199\u5165\u64cd\u4f5c\u7684,\u4f46\u662f\u5728Android, \u6302\u8f7d\u5206\u533a\u88ab\u6267\u884c\u6807\u8bb0\u4e3a\u53ea\u8bfb, \u5e76\u4e14\u4e5f\u6302\u8f7d\u6210\u53ea\u8bfb, \u4e5f\u5c31\u662f\u8bf4, \u4e0d\u5141\u8bb8\u5bf9\u88ab\u5347\u7ea7\u5206\u533a\u505a\u4fee\u6539(\u5c31\u7b97\u4fee\u6539\u4e86, \u4e4b\u540e\u6821\u9a8c\u4f9d\u7136\u53ef\u80fd\u51fa\u9519). postinstall\u7684\u811a\u672c\u662f\u76f4\u63a5\u57fa\u4e8e\u5f53\u524d\u88ab\u5347\u7ea7\u7cfb\u7edf\u6267\u884c, \u5e76\u672achroot, \u6240\u4ee5, postinstall\u811a\u672c\u5fc5\u987b\u80fd\u591f\u88ab\u4fdd\u8bc1\u8fd0\u884c\u5728\u88ab\u5347\u7ea7\u7cfb\u7edf\u4e2d. \u6240\u4ee5, \u4e00\u822c\u662f\u7eaf\u9759\u6001\u7684\u53ef\u6267\u884c\u7a0b\u5e8f, \u800c\u4e14\u5176\u529f\u80fd\u5728android\u4e0a\u4e5f\u88ab\u5f31\u5316\u4e86.\n\n\n odex\u4f18\u5316 \n\n\n\u5728\u4ee5\u4e0a\u5168\u90e8\u5b8c\u6210\u540e, \u7cfb\u7edf\u5c06\u6807\u8bb0slot\u4e3a\u88ab\u5347\u7ea7\u7cfb\u7edf, \u5e76\u5728\u4e0b\u6b21\u91cd\u542f\u540e, \u8fdb\u5165\u5347\u7ea7\u540e\u7684\u7cfb\u7edf, \u6821\u9a8c\u5e76\u4f18\u5316. \u8fd9\u65f6\u5019\u5982\u679c\u6821\u9a8c\u5931\u8d25, \u5219\u8fd8\u4f1a\u56de\u5230\u539f\u5148\u7cfb\u7edf. \u5219\u8be5\u60c5\u51b5\u5b58\u5728data\u4e0b\u5e94\u7528\u6570\u636e\u5df2\u7ecf\u88ab\u4f18\u5316\u4e3a\u65b0\u7248\u672c\u6216\u8005\u4f18\u5316\u5230\u4e00\u534a\u7684\u95ee\u9898. \u8ddf\u4e86\u4e0b\u76f8\u5173\u4ee3\u7801\u548c\u7f51\u4e0a\u7684\u8d44\u6599, \u7ed3\u8bba\u5982\u4e0b.\n\n\n\u5728A/B\u5347\u7ea7\u5b8c\u6210\u8fdb\u5165\u65b0\u7cfb\u7edf\u540e, dexopt\u7684\u53c2\u6570\u662fspeed-profile, \u800c\u8be5\u53c2\u6570\u7684\u542b\u4e49\u5c31\u662f\u6839\u636e\u201c\u70ed\u4ee3\u7801\u201d\u7684profile\u914d\u7f6e\u6765\u7f16\u8bd1. \u90a3\u4e48\u95ee\u9898\u5c31\u662f\u8fd9\u4e2aprofile\u7684\u751f\u6210,\u548c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u589e\u91cf\u7f16\u8bd1.\n\n\n\n\nprofile\u5728\u8fbe\u5230\u4e00\u5b9a\u6761\u4ef6\u540e\u5199\u5165/data/, \u76ee\u524d\u4ece\u4ee3\u7801\u770b, \u5df2\u77e5\u7684\u4e00\u4e2a\u6761\u4ef6\u662f\u5927\u5c0f\n50K\u65f6, \u5199\u5165\u6587\u4ef6. \u800c\u5728\u5df2\u7ecf\u5b58\u5728\u8be5\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b, \u4f1a\u4f18\u5148\u52a0\u8f7d, \u5982\u679c\u52a0\u8f7d\u5931\u8d25, \u5219\u5220\u9664\u5e76\u91cd\u65b0\u751f\u6210.\n\n\n\u6267\u884c\u589e\u91cf\u7f16\u8bd1\u7684\u65f6\u95f4\u662f, \u673a\u5728\u5145\u7535\uff0b\u7a7a\u95f2\uff0b\u56db\u4e2a\u5c0f\u65f6\u95f4\u9694\u7b49\u591a\u4e2a\u6761\u4ef6\u4e0b, \u5728\u540e\u53f0\u5b8c\u6210.\n\n\n\n\n\n\u4e5f\u5c31\u662f\u8bf4, \u5728AB\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u65f6, \u4e0d\u4f1a\u6267\u884c\u7f16\u8bd1, \u53ea\u4f1a\u6267\u884cprofile\u7684\u751f\u6210. \u800c\u5728\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u88ab\u68c0\u6d4b\u5230\u7cfb\u7edf\u6821\u9a8c\u5931\u8d25, \u5219\u4f1a\u56de\u5230\u4e0a\u4e00\u7248\u672c\u7cfb\u7edf.\n\n\nbootloader\u4ea4\u4e92\n\n\n\n\n\u4f20\u7edf\u7684Android\u4e0ebootloader\u901a\u4fe1\u662f\u901a\u8fc7misc\u5206\u533a. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u6570\u636e\u5e76\u4e0d\u662f\u5b58\u5728misc\u5206\u533a, \u800c\u4e14\u5b58\u653e\u4f4d\u7f6e\u7531\u5382\u5546\u5b9a\u4e49, \u63a5\u53e3\u5728\nhardware/libhardware/include/hardware/boot_control.h\n. \u5176\u7ed3\u6784\u4f53\u662f \nboot_control_module_t\n, \u5305\u542b\u4e86\u6240\u6709\u8bbe\u7f6e\u4ee5\u4e0aslot\u72b6\u6001\u7684\u63a5\u53e3.\n\n\n\u4e0b\u9762\u4ecb\u7ecd\u4e0b\u4e0d\u540c\u5382\u5546\nboot_control\n\u7684\u5b9e\u73b0.\n\n\n\nqcom\u7684\u5b9e\u73b0\n\n\n\n\u4ee3\u7801\u4f4d\u7f6e:  \nhardware/qcom/bootctrl/boot_control.cpp\n\nqcom\u7684\u5b9e\u73b0\u662f, \u76f4\u63a5\u5c06A/B\u5206\u533a\u7684\u5c5e\u6027, \u5199\u5165\u7684gpt\u5206\u533a\u8868\u7684boot\u5206\u533a(\nboot_a\n\u548c\nboot_b\n).qcom\u673a\u9876\u76d2gpt\u8868\u7684\u5206\u6790:http://blog.csdn.net/guyongqiangx/article/details/68924436\n\n\n\n\n\n\n\u4e0a\u56fe\u662fqcom\u673a\u9876\u76d2gpt\u5206\u533a\u8868\u7684\u4fe1\u606f, \u5728Entry\u4e2d\u67e5\u627e\u5230\u5206\u533a\nboot_a\n\u548c\nboot_b\n, \u63d0\u53d6\u5176\u5c5e\u6027.\n\u4ece LAB 2 \u5f00\u59cb\u5b58\u653e\u7684\u662fGPT\u5206\u533a\u7684\u8be6\u7ec6\u4fe1\u606f\nPartition Entry\n, \u5355\u4e2a\nPartition Entry\n\u5360128\u4e2a\u5b57\u8282, \u4ece\u7b2c48\u4e2a\u5b57\u8282\u5f00\u59cb\u5b58\u653e\u7684\u662f\u5206\u533a\u5c5e\u6027, \u800cA/B\u7cfb\u7edf\u7684\u5206\u533a\u5c5e\u6027\u4e5f\u662f\u5b58\u653e\u5728\u8fd9\u4e2a\u4f4d\u7f6e.\n\n\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230, qcom\u7684\u5b9e\u73b0, \u6ca1\u6709bootable\u7684\u6807\u8bb0\u4f4d, \u53d6\u800c\u4ee3\u4e4b\u7684\u662funbootable.\n\n\n\ngoogle\u7684\u53c2\u8003\u5b9e\u73b0\n\n\n\n\u4ee3\u7801\u4f4d\u7f6e\nsystem/extras/boot_control_copy/boot_control_copy.c\n\n\ngoogle\u7684\u53c2\u8003\u5b9e\u73b0\u590d\u7528\u4e86misc\u5206\u533a\u7684\nbootloader_message\n(recovery\u4e0ebootloader\u901a\u4fe1\u7684\u5206\u533a). \u6574\u4e2amisc\u5206\u533a\u7684\u6570\u636e\u7ed3\u6784\u56fe\u5982\u4e0b.\n\n\n\n\n\n\n\n\n\nfsmgr\u4f7f\u7528, \u5728\u8bbe\u7f6e\u6307\u5b9aslot\u4e3aactive\u65f6, \u540c\u65f6\u5c06\u5bf9\u5e94\u540e\u7f00\u8bbe\u7f6e\u5230\u8be5\u5b57\u6bb5. fsmgr\u5728\u6302\u8f7d\u5206\u533a\u65f6,\u901a\u8fc7\u8be5\u5b57\u6bb5\u62fc\u6210\u5b8c\u6210\u7684\u5206\u533a\u8def\u5f84.\n\n\nMagic Numbe. \u7528\u6765\u786e\u5b9a\u8be5\u6570\u636e\u7aef\u7684\u5408\u6cd5, \u5fc5\u987b\u662f 'B', 'C' , 'c' (\"\nboot_control\n copy\" \u7684\u7f29\u5199)\n\n\n\u63a5\u53e3\u7248\u672c\u53f7\n\n\nactive\u72b6\u6001\u7684slot\u53f7, \u5728\u8be5\u5b9e\u73b0\u4e2d\u53ea\u6709 0 \u6216 1.\n\n\n0 \u4e3a \u7b2c\u4e00\u4e2aslot, 1 \u4e3a\u7b2c\u4e8c\u4e2aslot, \u8bbe\u7f6eslot\u7684bootable/unbootable\u72b6\u6001.\n\n\n\n\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa, \u5e76\u6ca1\u6709\u53ef\u4ee5\u6807\u8bb0\u4e3asuccessful\u7684\u4f4d, \u901a\u8fc7\u4ee3\u7801\u4e5f\u53d1\u73b0, \u5176\u5b9e\u73b0\u4e3a\u7a7a, \u4e5f\u5c31\u662f\u8bf4, \u5e76\u6ca1\u6709\u5b9e\u73b0\u8be5\u72b6\u6001.\n\n\n\u5982\u679c\u6ce8\u610f\u5230\u4ee3\u7801, \u5728\nmodule_setActiveBootSlot\n\u540e\u534a\u6bb5, \u4f1a\u5c06active\u72b6\u6001\u7684\nboot_X\n\u5206\u533a\u5185\u5bb9\u62f7\u8d1d\u5230boot\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u7cfb\u7edf\u5b58\u5728\u4e09\u4e2a\u5206\u533a(boot, \nboot_a\n, \nboot_b\n), \u88ab\u8bbe\u7f6e\u4e3aactive\u7684\u5206\u533a\u4f1a\u88ab\u62f7\u8d1d\u5230boot\u5206\u533a, \u518d\u7ed3\u5408\nmodule_getCurrentSlot\n\u7684\u5b9e\u73b0(\u4ece/system\u5206\u533a\u83b7\u53d6\u6302\u8f7d\u4fe1\u606f) ,\u4ece\u8fd9\u4e24\u6bb5\u4ee3\u7801\u53ef\u4ee5\u63a8\u6d4b\u51fa\u4e24\u4e2a\u7ed3\u8bba:\n\n\n\n\nA/B\u7cfb\u7edf\u53ef\u4ee5\u4e0d\u5347\u7ea7firmware(bootloader), \u6216\u8005\u8bf4google\u7684\u8be5\u5b9e\u73b0\u6700\u521d\u662f\u4e3a\u4e86\u517c\u5bb9\u8001\u7684bootloader.\n\n\nboot.img\u4e2d\u7684ramdisk\u53ef\u4ee5\u8fd8\u662fboot\u7684ramdisk.\n\n\n\n\n\u4f46\u662f, \u4e0d\u786e\u5b9a\u53c2\u8003\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u8fd0\u884c. \u4f46\u662f\u5355\u7eaf\u4ece\u4ee5\u4e0a\u4ee3\u7801\u770b, \u9664\u4e86\u5206\u533a, A/B\u7cfb\u7edf\u7684\u542f\u52a8, \u6302\u8f7d, \u90fd\u53ef\u4ee5\u5728\u7528\u6237\u5c42\u641e\u5b9a. \u4f46\u662f\u5e26\u6765\u7684\u540e\u679c\u5c31\u662f, \u5982\u679cbootloader\u542f\u52a8boot\u5931\u8d25, \u5219\u65e0\u6cd5\u5207\u6362\u5230\u53e6\u4e00\u4e2aslot.\n\n\n\u5347\u7ea7\u5305\u751f\u6210\n\n\n\u5347\u7ea7\u5305\u5236\u4f5c\u5de5\u5177\u4e0d\u518d\u652f\u6301 \u57fa\u4e8e\u6587\u4ef6\u7684\u5347\u7ea7, \u5f53\u524d\u53ea\u652f\u6301ab\u5347\u7ea7\u548c\u5757\u5347\u7ea7.\n\n\n\u5757\u5347\u7ea7\u548cab\u5347\u7ea7\u5728\u751f\u6210\u6570\u636e\u6587\u4ef6\u548c\u811a\u672c\u4e0a\u539f\u7406\u662f\u4e00\u6837\u7684, \u53ea\u662f\u5728\u751f\u6210\u5347\u7ea7\u6570\u636e\u65f6\u5b58\u5728\u5dee\u5f02.\n\n\nAB\u5347\u7ea7payload\u5236\u4f5c\u903b\u8f91\u5728\u5347\u7ea7\u5305\u5236\u4f5c\u811a\u672c\u7684\nWriteABOTAPackageWithBrilloScript\n, \u800c\u771f\u6b63payload\u751f\u6210\u7684\u903b\u8f91\u5728\u51fd\u6570\nGenerateUpdatePayloadFile\n.\n\n\n\u6d41\u7a0b\u5982\u4e0b:\n\n\n\n\u751f\u6210payload\u6307\u4ee4\u89c4\u5219:\n\n\n\nAB\u5347\u7ea7\u603b\u6d41\u7a0b\u56fe", 
            "title": "AB\u7cfb\u7edf\u5347\u7ea7"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#ab", 
            "text": "\u987e\u540d\u601d\u4e49,  A/B \u7cfb\u7edf\u5c31\u662f\u6307\u7ec8\u7aef\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf,(userdata\u53ea\u6709\u4e00\u4efd, \u88ab\u4e24\u5957\u7cfb\u7edf\u5171\u7528). \u7b80\u5355\u6765\u8bb2, \u53ef\u4ee5\u7406\u89e3\u4e3a, \u5b58\u5728\u4e00\u5957\u7cfb\u7edf\u5206\u533a, \u4e00\u5957\u5907\u4efd\u5206\u533a, \u4e24\u5957\u7cfb\u7edf\u90fd\u53ef\u4ee5\u88ab\u542f\u52a8, \u4e24\u5957\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u53ef\u4ee5\u4e00\u6837, \u4e5f\u53ef\u4ee5\u4e00\u5957\u65e7, \u4e00\u5957\u65b0. \u800c\u5347\u7ea7\u5c31\u662f\u5c06\u65e7\u7684\u7cfb\u7edf\u5347\u7ea7\u5230\u65b0\u7248\u672c.  A/B\u7cfb\u7edf\u5b9e\u73b0\u4e86\u65e0\u7f1d\u5347\u7ea7(Seamless System Updates), \u5b58\u5728\u5982\u4e0b\u7279\u70b9:   \u7ec8\u7aef\u8bbe\u5907\u5728\u51fa\u5382\u65f6\u6709\u4e24\u5957\u8bbe\u5907\u53ef\u4ee5\u5de5\u4f5c, \u5728\u5347\u7ea7\u51fa\u73b0\u5f02\u5e38\u6216\u8005\u51fa\u9519\u65f6, \u59cb\u7ec8\u786e\u4fdd\u7cfb\u7edf\u5b58\u5728\u4e00\u5957\u8bbe\u5907\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c.  \u7cfb\u7edf\u5728\u540e\u53f0\u8fdb\u884c\u5347\u7ea7, \u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf, \u7528\u6237\u4e0d\u4f1a\u88ab\u6253\u65ad. \u5728\u66f4\u65b0\u5b8c\u6210\u540e, \u7528\u6237\u5728\u4e0b\u6b21\u91cd\u542f\u624b\u673a\u65f6, \u5c31\u4f1a\u8fdb\u5165\u65b0\u7cfb\u7edf.  \u5728 dm-verity \u6216\u8005\u5176\u4ed6\u6821\u9a8c\u65b9\u5f0f\u68c0\u6d4b\u5230\u7cfb\u7edf\u987a\u574f\u6216\u5f02\u5e38\u540e, \u53ef\u4ee5\u91cd\u542f\u56de\u5230\u5347\u7ea7\u524d\u7684\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u4f7f\u7528\u4e0d\u53d7\u5f71\u54cd.   Android8.0\u7684\u4ee3\u7801\u7f16\u8bd1\u65f6, \u5728BoardConfig\u6709\u5bf9\u5e94\u7684\u9009\u9879\u6765\u63a7\u5236\u662f\u7f16\u8bd1\u6210A/B\u7cfb\u7edf\u8fd8\u662f\u6b63\u5e38\u5355\u7cfb\u7edf. \u7531\u4e8e\u65b0\u7cfb\u7edf\u8ddf\u539f\u6765\u7684OTA\u5347\u7ea7\u7cfb\u7edf\u5b58\u5728\u5927\u4e0d\u540c, \u5bfc\u81f4\u65e0\u6cd5\u901a\u8fc7\u4ee5\u524d\u7684OTA\u5347\u7ea7\u65b9\u5f0f(\u5b89\u5168\u5730)\u5347\u7ea7\u5230A/B\u7cfb\u7edf.  \u800cA/B\u7cfb\u7edf\u5347\u7ea7, \u662f\u7531\u8fd0\u884c\u4e8eAndroid\u540e\u53f0\u7684 update_engine \u548c  slot a ,  slot b \u4e24\u5957\u7cfb\u7edf\u5171\u540c\u5b8c\u6210. \u5728\u542f\u52a8\u5176\u4e2d\u4e00\u5957\u7cfb\u7edf\u7684\u60c5\u51b5\u4e0b,  update_engine \u5728\u540e\u53f0\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u4e0b\u8f7d\u5347\u7ea7\u6d41\u5e76\u66f4\u65b0\u5230\u53e6\u4e00\u5957\u7cfb\u7edf.  A/B \u7cfb\u7edf\u5347\u7ea7\u4e3b\u8981\u6d89\u53ca\u5982\u4e0b4\u4e2a\u65b9\u9762:   \u5206\u533a\u9009\u62e9(slots), \u5373\u9009\u62e9\u54ea\u4e2a\u7cfb\u7edf.  update_engine , \u5373\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7  bootloader\u4ea4\u4e92, \u5373\u5982\u4f55\u901a\u77e5bootloader\u5207\u6362slot  ota\u5305\u751f\u6210.", 
            "title": " A/B\u7cfb\u7edf\u7b80\u4ecb "
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_1", 
            "text": "", 
            "title": " \u5206\u533a\u9009\u62e9 "
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_2", 
            "text": "\u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003  Android8 \u5206\u533a\u8868\u548c\u5206\u533a\u76f8\u5173\u64cd\u4f5c . \u8fd9\u91cc\u7b80\u5355\u603b\u7ed3\u4e0b\u5206\u533a\u8868\u4e0a\u8ddf\u5355\u7cfb\u7edf\u7684\u5dee\u5f02.\n\u8fd9\u91cc\u4ee5boot,system, vendor\u548cmodem\u5b58\u5728\u4e24\u5957\u7cfb\u7edf\u4e3a\u4f8b\u5b50, \u5176\u4f59\u5206\u533a\u6309\u7167\u6700\u5c0f\u5206\u533a\u8868.     \u5355\u7cfb\u7edf\u5206\u533a\u8868  A/B\u7cfb\u7edf\u5206\u533a\u8868  \u529f\u80fd\u63cf\u8ff0      bootloader  bootloader  \u5f15\u5bfclinux\u7cfb\u7edf    misc  misc  Android\u7cfb\u7edf\u4e0erecovery, bootloade\u901a\u4fe1\u7684\u6570\u636e    boot  -  \u5b58\u653eAndroid\u7684kernel\u548cramdisk    -  boot_a  \u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk    -  boot_b  \u5b58\u653eAndroid\u7684kernel\u548c\u5355\u7cfb\u7edf\u4e2drecovery\u7684ramdisk    system  -  Android\u7cfb\u7edf\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6.    -  system_a  \u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6    -  system_b  \u5b58\u653e\u5355\u7cfb\u7edfboot\u4e2d\u7684ramdisk\u548csystem\u4e2d\u7684\u5e94\u7528, \u5e93\u548c\u8d44\u6e90\u6587\u4ef6    -  vendor_a  \u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4    -  vendor_b  \u5b58\u653e\u5382\u5546\u7684\u914d\u7f6e, \u53ef\u6267\u884c\u7a0b\u5e8f, \u5e93, \u76ee\u5f55\u7ed3\u6784\u4e0e/system/\u4e00\u81f4    cache  -  \u4e34\u65f6\u5b58\u653e\u6570\u636e, \u901a\u5e38\u4e34\u65f6\u5b58\u653e\u4e0b\u8f7d, \u5907\u4efd\u548c\u5347\u7ea7\u5305    recovery  -  \u5b58\u653erecovery\u7cfb\u7edf\u7684kernel\u548cramdisk    userdata  userdata  \u5b58\u653e\u7528\u6237\u6570\u636e     \u6240\u8c13\u7684A/B\u7cfb\u7edf\u5206\u533a, \u5c31\u662f\u5728\u539f\u6709\u5206\u533a\u540d\u5b57\u540e\u5417\u6dfb\u52a0 _a  \u548c  _b , \u5728\u5237\u673a, \u6216\u8005\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019, \u6839\u636ebootloader\u7684\u53c2\u6570\u6dfb\u52a0\u540e\u7f00, \u9009\u62e9\u6b63\u786e\u7684\u7cfb\u7edf. misc\u5206\u533a\u5728A/B\u7cfb\u7edf\u4e2d\u53d8\u6210\u4e00\u4e2a\u53ef\u6709\u53ef\u65e0\u7684\u5b58\u5728, \u56e0\u4e3a\u5176\u529f\u80fd\u53ea\u662f\u4f20\u9012\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u53c2\u6570, \u800crecovery\u7684\u529f\u80fd\u4e5f\u53ea\u5269\u4e0b\u6062\u590d\u51fa\u5382\u8bbe\u7f6e, \u6240\u4ee5, \u672c\u8d28\u4e0a, \u6ca1\u5fc5\u8981\u518d\u57fa\u4e8emisc\u4f20\u9012\u53c2\u6570\u4e86.", 
            "title": "\u5206\u533a\u8868\u548c\u5206\u533a\u5185\u5bb9\u53d8\u5316"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_3", 
            "text": "bootloader\u4e3a\u4e86\u5224\u65ad\u4e00\u4e2a\u7cfb\u7edf(slot)\u662f\u5426\u4e3a\u53ef\u4ee5\u542f\u52a8\u7684\u72b6\u6001, \u9700\u8981\u4e3a\u5176\u5b9a\u4e49\u5bf9\u5e94\u7684\u5c5e\u6027(\u72b6\u6001). \u5176\u72b6\u6001\u8bf4\u660e\u5982\u4e0b:   active. \u6d3b\u52a8\u5206\u533a\u6807\u8bc6, \u6392\u4ed6, \u4ee3\u8868\u8be5\u5206\u533a\u4e3a\u542f\u52a8\u5206\u533a, bootloader\u603b\u4f1a\u9009\u62e9\u8be5\u5206\u533a.  bootable. \u8868\u793a\u8be5slot\u7684\u5206\u533a\u5b58\u5728\u4e00\u5957\u53ef\u80fd\u53ef\u4ee5\u542f\u52a8\u7684\u7cfb\u7edf.  successful. \u8868\u793a\u8be5slot\u7684\u7cfb\u7edf\u80fd\u6b63\u5e38\u542f\u52a8.  unbootable. \u4ee3\u8868\u8be5\u5206\u533a\u635f\u574f\u7684, \u65e0\u6cd5\u542f\u52a8, \u5728\u5347\u7ea7\u8fc7\u7a0b\u603b\u88ab\u6807\u8bb0, \u8be5\u6807\u8bb0\u7b49\u6548\u4e8e\u4ee5\u4e0a\u6807\u8bb0\u88ab\u6e05\u7a7a. \u800cactive\u6807\u8bb0\u4f1a\u5c06\u8be5\u6807\u8bb0\u6e05\u7a7a.   slot a  \u548c  slot b , \u53ea\u6709\u4e00\u4e2a\u662factive, \u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u6709 bootable \u548c successful \u5c5e\u6027.   bootloader\u68c0\u6d4b\u52301\u4e2a\u6216\u80052\u4e2aslot\u90fd\u662fbootable\u7684\u72b6\u6001.  \u9009\u62e9active\u7684slot\u6216\u8005\u9009\u62e9successful\u7684slot\u8fdb\u884c\u5c1d\u8bd5\u542f\u52a8.  \u542f\u52a8\u6210\u529f\u7684\u6807\u8bb0\u662f, dm-verity \u6210\u529f.  \u7531\u4e8e\u542f\u52a8\u6210\u529f, \u5219\u8be5slot\u88ab\u6807\u8bb0\u4e3asuccessful\u548cactive  \u7531\u4e8e\u542f\u52a8\u5931\u8d25, \u5219\u8bbe\u7f6e\u8be5slot\u4e3aunbootable, \u5e76\u8bbe\u7f6e\u53e6\u4e00\u4e2aslot\u4e3aactive, \u8fdb\u884c\u4e0b\u4e00\u6b21\u5c1d\u8bd5.", 
            "title": "\u7cfb\u7edf\u5206\u533a\u5c5e\u6027"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_4", 
            "text": "\u9996\u5148, \u6211\u4eec\u770b\u4e0b\u5347\u7ea7\u5305\u7684\u5185\u5bb9. \u5728A/B\u5347\u7ea7\u7684\u60c5\u51b5\u4e0b, \u5347\u7ea7\u5305\u5185\u5bb9\u5982\u4e0b:  Path = aosp_marlin-ota-eng.builder.zip\nType = zip\nComment = signed by SignApk\nPhysical Size = 384694679\n\n   Date      Time    Attr         Size   Compressed  Name\n------------------- ----- ------------ ------------  ------------------------\n2009-01-01 00:00:00 .....          360          360  META-INF/com/android/metadata\n2009-01-01 00:00:00 .....          107          107  care_map.txt\n2009-01-01 00:00:00 .....    384690699    384690699  payload.bin\n2009-01-01 00:00:00 .....          154          154  payload_properties.txt\n2009-01-01 00:00:00 .....         1675          943  META-INF/com/android/otacert\n------------------- ----- ------------ ------------  ------------------------\n                             384692995    384692263  5 files, 0 folders   \u4e0b\u8f7d\u548c\u5347\u7ea7\u7a0b\u5e8f\u662f update_engine , \u6765\u81eachrome os, \u4ee3\u7801\u4e2d\u5927\u91cf\u5b58\u5728dbus\u548cchrome os\u7684\u75d5\u8ff9, \u800cAndroid\u4e0a\u6539\u7a0b\u5e8f\u662f\u57fa\u4e8ebinde\u8fdb\u884c\u901a\u4fe1. \u4e0e\u539f\u5148\u7684ota\u5347\u7ea7\u4e0d\u540c, \u8be5\u5347\u7ea7\u5305\u4e2d\u4e0d\u5305\u542bupdater, \u4e5f\u5c31\u662f\u8bf4, \u5347\u7ea7\u7684\u903b\u8f91\u5728\u8bbe\u5907\u7aef\u800c\u4e0d\u662f\u5728\u5347\u7ea7\u5305\u4e2d. \u5982\u679c\u719f\u6089ota\u5347\u7ea7\u7684\u8bdd, \u8fd9\u4e2a\u5347\u7ea7\u5305\u4e2d\u7684\u6570\u636e\u8ddf\u5757\u5347\u7ea7\u6570\u636e\u51e0\u4e4e\u4e00\u6837, \u521d\u6b65\u5224\u65ad\u7528\u7684\u662f\u5757\u5347\u7ea7.\n\u90a3\u4e48, \u5982\u679c\u6709\u65b0\u7684\u9700\u6c42, \u6bd4\u5982\u6b64\u6b21\u66f4\u65b0\u9700\u8981\u8c03\u6574\u6570\u636e\u5e93, \u662f\u5982\u4f55\u505a\u5230\u7684? \u8bf7\u67e5\u770b\u540e\u6587\u7b2c\u4e8c\u6b65\u5347\u7ea7.  \u6574\u4e2a\u5347\u7ea7\u5206\u4e3a\u4e94\u6b65:   \u4e0b\u8f7d\u5347\u7ea7\u5305, \u6216\u8005\u5347\u7ea7\u6d41. Android8 \u65b0\u652f\u6301\u4e86\u6d41\u5f0f\u5347\u7ea7, \u53ef\u4ee5\u8fb9\u4e0b\u8fb9\u5347.  \u7b2c\u4e00\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f,  update_engine \u6267\u884c\u7684\u5347\u7ea7\u903b\u8f91, \u57fa\u672c\u7684\u6570\u636e\u5199\u5165.  \u6821\u9a8c\u5199\u5165\u6570\u636e. \u786e\u4fdd\u4e0a\u4e00\u6b65\u5199\u5165\u6570\u636e\u53ef\u9760\u5b8c\u6574.  \u7b2c\u4e8c\u6b65\u5347\u7ea7. \u4e5f\u5c31\u662f, \u6302\u8f7d\u65b0\u70e7\u5199\u7684\u5206\u533a, \u5e76\u6267\u884c\u5176\u4e2d\u7684\u6307\u5b9a\u811a\u672c(\u7a0b\u5e8f)\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u64cd\u4f5c.  \u5e94\u7528\u4f18\u5316.  \u7531\u4e8e\u5b58\u5728A/B\u65b0\u65e7\u4e24\u5957\u7cfb\u7edf, \u6240\u4ee5, data\u5e95\u4e0b\u4e5f\u5b58\u5728\u4e24\u5957odex/vdex.   \u524d4\u6b65, \u57fa\u4e8e\u4e00\u79cdpipe\u7684\u6846\u67b6\u5b9e\u73b0, \u6bcf\u4e00\u6b65\u90fd\u662f\u4e00\u4e2aaction, \u522b\u94fe\u63a5\u5230actio list\u4e2d, \u524d\u540e\u4e24\u4e2aaction\u901a\u8fc7pipe\u673a\u5236\u8fdb\u884c\u6570\u636e\u901a\u4fe1. \u4e5f\u5c31\u662f\u8bf4, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u9ed8\u8ba4\u53d8\u6210\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. action\u7684\u6267\u884c\u51fd\u6570\u662f PerformAction() . \u901a\u8fc7 HasInputObject() \u548c HasOutputPipe() \u5224\u65ad\u662f\u5426\u6709\u8f93\u5165\u548c\u8f93\u51fa\u6d41, \u800c GetInputObject() \u63a5 SetOutputObject() \u5206\u522b\u662f\u8bfb\u53d6\u548c\u5199\u5165pipe.  update_engine  \u7684 Androidmk\u76ee\u6807, \u4f9d\u8d56\u548c\u5bf9\u5e94\u6e90\u7801\u6587\u4ef6\u5982\u4e0b.  # \u9759\u6001\u5e93\u6a21\u5757\nSTATIC_LIBRARIES:\n    update_metadata-protos      (host, target)\n    libpayload_consumer         (host, target)\n    libupdate_engine_android    (target)\n    libpayload_generator        (host, target)\n\n# \u53ef\u6267\u884c\u6a21\u5757\nEXECUTABLES:\n    update_engine           (target)\n    update_engine_sideload      (target)\n    update_engine_client        (target)\n    delta_generator         (host)\n\n# \u5171\u4eab\u5e93\u6a21\u5757\nSHARED_LIBRARIES:\n    libupdate_engine_client     (target)\n\n# \u9884\u7f16\u8bd1\u6a21\u5757\nPREBUILT:\n    updater.json            (target)\n    brillo_update_payload       (host)  \u4ece\u4e0a\u6587\u7684\u76ee\u6807\u53ef\u4ee5\u83b7\u53d6\u5982\u4e0b\u4fe1\u606f:   payload \u4e2d\u7684\u6587\u4ef6\u7ed3\u6784\u662fprotos  \u53ef\u6267\u884c\u6587\u4ef6\u662f  update_engine , \u800c  update_engine_client  \u662f\u5ba2\u6237\u7aef,  update_engine_sideload  \u662frecovery\u6a21\u5f0f\u4e0b\u901a\u8fc7usb\u66f4\u65b0.  delta_generator  \u7528\u4e8e\u751f\u6210payload  \u5b8c\u6574\u7684Android.mk\u4e2d, \u5b58\u5728\u6807\u8bb0\u4e3a local_use_omaha , \u53ea\u6709\u5728  PRODUCT_IOT  \u7269\u8054\u7f51\u65f6, \u624d\u542f\u7528, \u7f16\u8bd1\u83b7\u5f97\u7684\u662fdbus\u7248\u672c\u7684 update_engine .   \u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b:  update_engine (target)\n  --  libupdate_engine_android\n    --  libpayload_consumer\n      --  update_metadata-protos\n\nupdate_engine_sideload (target)\n  --  update_engine_sideload\n    --  update_metadata-protos\n\nupdate_engine_client (target)\n\ndelta_generator (host)\n  --  libpayload_generator\n    --  libpayload_consumer\n      --  update_metadata-protos  \u6e90\u7801\u5217\u8868\u5982\u4e0b:  update_metadata-protos (STATIC_LIBRARIES)\n  --  update_metadata.proto\n\nlibpayload_consumer (STATIC_LIBRARIES)\n  --  common/action_processor.cc\n      common/boot_control_stub.cc\n      common/clock.cc\n      common/constants.cc\n      common/cpu_limiter.cc\n      common/error_code_utils.cc\n      common/hash_calculator.cc\n      common/http_common.cc\n      common/http_fetcher.cc\n      common/file_fetcher.cc\n      common/hwid_override.cc\n      common/multi_range_http_fetcher.cc\n      common/platform_constants_android.cc\n      common/prefs.cc\n      common/subprocess.cc\n      common/terminator.cc\n      common/utils.cc\n      payload_consumer/bzip_extent_writer.cc\n      payload_consumer/delta_performer.cc\n      payload_consumer/download_action.cc\n      payload_consumer/extent_writer.cc\n      payload_consumer/file_descriptor.cc\n      payload_consumer/file_writer.cc\n      payload_consumer/filesystem_verifier_action.cc\n      payload_consumer/install_plan.cc\n      payload_consumer/payload_constants.cc\n      payload_consumer/payload_verifier.cc\n      payload_consumer/postinstall_runner_action.cc\n      payload_consumer/xz_extent_writer.cc\n\nlibupdate_engine_android (STATIC_LIBRARIES)\n  --  binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      binder_service_android.cc\n      boot_control_android.cc\n      certificate_checker.cc\n      daemon.cc\n      daemon_state_android.cc\n      hardware_android.cc\n      libcurl_http_fetcher.cc\n      network_selector_android.cc\n      proxy_resolver.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n\nupdate_engine (EXECUTABLES)\n  --  main.cc\n\nupdate_engine_sideload (EXECUTABLES)\n  --  boot_control_android.cc\n      hardware_android.cc\n      network_selector_stub.cc\n      proxy_resolver.cc\n      sideload_main.cc\n      update_attempter_android.cc\n      update_status_utils.cc\n      utils_android.cc\n      boot_control_recovery_stub.cc\n\nupdate_engine_client (EXECUTABLES)\n  --  binder_bindings/android/os/IUpdateEngine.aidl\n      binder_bindings/android/os/IUpdateEngineCallback.aidl\n      common/error_code_utils.cc\n      update_engine_client_android.cc\n      update_status_utils.cc\n\nlibpayload_generator (SHARED_LIBRARIES)\n  --  payload_generator/ab_generator.cc\n      payload_generator/annotated_operation.cc\n      payload_generator/blob_file_writer.cc\n      payload_generator/block_mapping.cc\n      payload_generator/bzip.cc\n      payload_generator/cycle_breaker.cc\n      payload_generator/delta_diff_generator.cc\n      payload_generator/delta_diff_utils.cc\n      payload_generator/ext2_filesystem.cc\n      payload_generator/extent_ranges.cc\n      payload_generator/extent_utils.cc\n      payload_generator/full_update_generator.cc\n      payload_generator/graph_types.cc\n      payload_generator/graph_utils.cc\n      payload_generator/inplace_generator.cc\n      payload_generator/payload_file.cc\n      payload_generator/payload_generation_config.cc\n      payload_generator/payload_signer.cc\n      payload_generator/raw_filesystem.cc\n      payload_generator/tarjan.cc\n      payload_generator/topological_sort.cc\n      payload_generator/xz_android.cc\n\ndelta_generator (EXECUTABLES)\n  --  payload_generator/generate_delta_main.cc", 
            "title": "\u5347\u7ea7\u6d41\u4e0b\u8f7d\u548c\u5347\u7ea7"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_5", 
            "text": "\u4e0b\u8f7d\u76f8\u5173\u4e0e\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u903b\u8f91:  delta_performer.cc  \u5347\u7ea7\u6d41(\u5305)\u7684\u4e0b\u8f7d, \u5206\u4e3a\u4e24\u4e2a\u6a21\u5f0f:   \u4e0b\u8f7dzip\u5305\u5230data\u5206\u533a.  \u4e0b\u8f7d\u5347\u7ea7\u6d41, \u8fb9\u4e0b\u8fb9\u5347\u7ea7.   ( \u4ecechrome os\u4ee3\u7801\u770b, \u5176\u5347\u7ea7\u670d\u52a1\u5668\u662fomaha server, \u53ef\u4ee5\u53c2\u8003\u770b\u4e0b\u5bf9\u4e8e\u6211\u4eec\u7684\u5347\u7ea7\u670d\u52a1\u5668\u662f\u5426\u6709\u5e2e\u52a9.\nhttps://github.com/Crystalnix/omaha-server\nhttps://github.com/Crystalnix/omaha-server/wiki\n)  payload \u6570\u636e\u7ed3\u6784:  version 1:\n|  C r A U  | version(8) | manifestSize(8) | manifest(manifestSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |\n\nversion 2:\n|  C r A U  | version(8) | manifestSize(8) | MetadataSignatureSize(4) | manifest(manifestSize) | medatadataSignatureMessage(MetadataSignatureSize) | rawData | payloadSignatureMessageSize | payloadSignatureMessage(payloadSignatureMessageSize) |  \u5176\u4e2d medatadataSignatureMessage \u6821\u9a8c\u7684\u662f\u5176\u4e4b\u524d\u7684\u6240\u6709\u6570\u636e, \u800c payloadSignatureMessage \u6821\u9a8c\u7684\u662f payloadSignatureMessageSize \u4e4b\u524d\u7684\u6240\u6709\u6570\u636e.  \u800c manifest \u662fprotobuff, \u5176\u4e2d\u5305\u542b\u4e00\u7ec4\u6307\u4ee4\u96c6, \u4e5f\u5c31\u662f\u4ee5\u524drecovery \u5757\u5347\u7ea7\u7684\u4e00\u7cfb\u5217\u6307\u4ee4. rawData\u662f\u88ab\u66f4\u65b0\u6570\u636e, \u6307\u4ee4\u4f1a\u4ecerawData\u6307\u5b9a\u4f4d\u7f6e\u8bfb\u53d6\u6570\u636e\u5e76\u5e94\u7528\u5230\u76ee\u6807\u5206\u533a\u7684\u6307\u5b9a\u4f4d\u7f6e.  metadata\u7684\u6570\u636e\u662fprotobuf, \u6570\u636e\u7ed3\u6784\u4e3a update_metadata.proto  \u4e0b\u8f7d\u5b58\u5728\u4e24\u79cd\u6a21\u5f0f, p2p\u548c\u666e\u901a\u4e0b\u8f7d.  \u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u903b\u8f91\u4e0e\u4e4b\u524dota\u5347\u7ea7\u4e0b\u8f7d\u5347\u7ea7\u5305\u7684\u903b\u8f91\u4e00\u81f4.  update_engine \u5c06\u5347\u7ea7\u5305\u4e0b\u8f7d\u5230\u672c\u5730.  \u4e0b\u9762\u5148\u4ecb\u7ecd\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u7684\u903b\u8f91.", 
            "title": " \u4e0b\u8f7d "
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#data", 
            "text": "\u4e0b\u8f7d\u5230data\u5206\u533a\u7684\u5b9e\u73b0\u4e0d\u518d update_engine \u4e2d, \u800c\u5982\u679c\u662f\u9884\u5148\u4e0b\u8f7d\u5b8c\u6210\u7684payload, \u901a\u8fc7 file:// \u7684url\u4f20\u9012\u7ed9 update_engine , \u540e\u7eed\u903b\u8f91\u4e0e\u8fb9\u4e0b\u8fb9\u5347\u7ea7\u4e00\u6837.  \u800cjava\u5c42\u7684UpdateEngine.java\u7684API, \u66b4\u9732\u5230\u4e86\u7cfb\u7edf\u7684jar\u5305\u4e2d, \u5e76\u672a\u627e\u5230\u8c03\u7528\u8005, \u4e5f\u5c31\u662f\u8bf4, \u8fd9\u5757\u903b\u8f91\u662f\u975e\u5f00\u6e90\u7684, \u6211\u4eec\u65e0\u6cd5\u83b7\u5f97.", 
            "title": "\u4e0b\u8f7d\u5230data\u5206\u533a"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_6", 
            "text": "\u6240\u8c13\u8fb9\u4e0b\u8fb9\u5347, \u5c31\u662f\u5c06\u5347\u7ea7\u6570\u636e\u4e0b\u8f7d\u5230\u5185\u5b58\u4e2d, \u5e76\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\u76f8\u5e94\u5904\u7406, \u6700\u540e\u5199\u5165\u76ee\u6807\u5206\u533a. \n\u4e0b\u9762\u662f\u8fb9\u4e0b\u8fb9\u5347\u7684\u5ba2\u6237\u7aef\u6267\u884c\u547d\u4ee4.  # update_engine_client \\\n--payload=http://xxx/android/full-ota/payload.bin \\\n--update \\\n--headers= \\\n  FILE_HASH=ozGgyQEddkI5Zax+Wbjo6I/PCR8PEZka9gGd0nWa+oY= \\\n  FILE_SIZE=282344983\n  METADATA_HASH=GLIKfE6KRwylWMHsNadG/Q8iy5f786WTatvMdBlpOPg= \\\n  METADATA_SIZE=26723 \\   \u5728Pixel\u624b\u673a\u4e0a\u5347\u7ea7\u7684\u8f93\u51falog\u5982\u9644\u4ef6 update_engine.log , \u611f\u5174\u8da3\u7684\u7ae5\u978b\u53ef\u4ee5\u770b\u4e0b, \u5176\u4e2d\u5305\u542b\u4e86\u5404\u4e2a\u9636\u6bb5\u7684\u884c\u4e3a.  \u5176\u4e2dheader\u540e\u9762\u7684\u5185\u5bb9, \u8ddf\u5347\u7ea7\u5305\u4e2d\u7684 payload_properties.txt  \u6587\u4ef6\u5185\u5bb9\u4e00\u6837. \u5404\u5b57\u6bb5\u7684\u4f5c\u7528\u53ef\u4ee5\u53c2\u8003\u524d\u6587payload\u7684\u5934\u6570\u636e\u683c\u5f0f\u6765\u7406\u89e3\u5177\u4f53\u6821\u9a8c\u7684\u6570\u636e\u4f4d.  update_engine  \u9996\u5148\u5b9a\u4e49\u4e00\u7cfb\u5217\u7684action:   download_action : \u4e0b\u8f7d\u6a21\u5757, \u8d1f\u8d23\u8fb9\u4e0b\u8fb9\u5347\u7ea7.  filesystem_verifier_action : \u6587\u4ef6\u7cfb\u7edf\u6821\u9a8c\u6a21\u5757, \u8d1f\u8d23\u5347\u7ea7\u5b8c\u6210\u540e\u6821\u9a8c\u6570\u636e\u7684\u5b8c\u6574\u6027  postinstall_runner_action : \u540e\u5347\u7ea7\u6a21\u5757, \u4e00\u4e9b\u811a\u672c\u6216\u53ef\u6267\u884c\u7a0b\u5e8f\u5728\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u540e\u6267\u884c.   \u4ee5\u4e0aaction\u901a\u8fc7\u7c7b\u4f3cpipeline\u7684\u5f62\u5f0f\u7ec4\u7ec7, \u524d\u4e00\u4e2aaction\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2aaction\u7684\u8f93\u5165. \u800c\u5728\u5176\u4e2d\u4f20\u9012\u7684\u6570\u636e\u662f install_plan_ , \u8be5\u6570\u636e\u5305\u542b\u4e86payload(\u5347\u7ea7\u6570\u636e)\u7684\u6240\u6709\u4fe1\u606f(\u64cd\u4f5c\u5206\u533a, url, \u6821\u9a8c\u4fe1\u606f\u7b49), \u90e8\u5206\u4fe1\u606f\u7531\u540e\u9762\u7684action\u6267\u884c\u540e\u63d0\u4f9b.\n\u6240\u6709\u7684action, \u5176\u6267\u884c\u5165\u53e3\u51fd\u6570\u662f PerformAction() , \u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570, \u53ef\u4ee5\u66f4\u7ec6\u81f4\u5730\u4e86\u89e3\u8f93\u5165\u8f93\u51fa\u6570\u636e\u548c\u8be5action\u7684\u5177\u4f53\u529f\u80fd.  \u672c\u6bb5\u5185\u5bb9\u7740\u91cd\u4ecb\u7ecd download_action , \u5176\u4f59\u6a21\u5757\u5728\u540e\u9762\u4ecb\u7ecd.   \n1. \u8bfb\u53d6\u6570\u636e. \u8fd9\u91cc\u5e76\u4e0d\u662f\u6b63\u5e38\u7684read, \u8be5\u51fd\u6570\u662f\u4e2a\u4e0b\u8f7d\u7684Write\u56de\u8c03, \u800c\u8bfb\u53d6\u6570\u636e\u5728\u4ee3\u7801\u4e0a\u7684\u771f\u5b9e\u884c\u4e3a\u662f, \u8fd4\u56de\u9519\u8bef\u8868\u793a\u6570\u636e\u4e0d\u591f, \u7ee7\u7eed\u8bfb\u53d6, \u800c\u5df2\u7ecf\u8bfb\u53d6\u7684\u6570\u636e\u5b58\u653e\u5728buffer\u4e2d.\n2. \u89e3\u6790manifest. \u5c31\u662f\u4e0a\u6587\u4e2dpayload\u7684\u5934, \u5305\u542b\u6821\u9a8c\u4fe1\u606f\u548c\u6267\u884c\u7684\u6307\u4ee4\u96c6, \u8fd8\u6709\u6240\u6709\u64cd\u4f5c\u7684\u5206\u533a\u6821\u9a8c\u503c\u7b49.\n3. \u6253\u5f00\u5206\u533a\u8bbe\u5907. \u6839\u636e\u5347\u7ea7\u7c7b\u578b, \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7(manifest\u4e2d\u5305\u542b\u8be5\u4fe1\u606f), \u5219\u6253\u5f00\u88ab\u5347\u7ea7\u8bbe\u5907\u5206\u533a, \u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u6253\u5f00\u5f53\u524d\u8fd0\u884c\u8bbe\u5907\u5206\u533a\u548c\u88ab\u5347\u7ea7\u76ee\u6807\u5206\u533a.\n4. \u83b7\u53d6\u6307\u4ee4\u5217\u8868. \u662f\u4ecemanifest\u4e2d\u83b7\u53d6. \u4e0d\u540c\u6307\u4ee4, \u683c\u5f0f\u4e0d\u540c, \u4f46\u57fa\u672c\u683c\u5f0f\u662f  src:offset:size , \u6307\u5b9a\u64cd\u4f5c\u6e90/\u76ee\u6807, \u504f\u79fb\u548c\u5927\u5c0f.\n5. \u7531\u4e8e1\u63d0\u5230\u7684, \u5728\u6570\u636e\u4e0d\u591f\u65f6\u4f1a\u9000\u51fa, \u6240\u4ee5, \u4f1a\u4fdd\u5b58\u5f53\u524d\u5df2\u7ecf\u6267\u884c\u5230\u7684\u6307\u4ee4, \u5e76\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6307\u4ee4\u4fe1\u606f, \u8fd9\u91cc\u4fe1\u606f\u91cd\u70b9\u662f, \u9700\u8981\u8bfb\u53d6\u7684payload\u4e2doffset\u548csize. \u7531\u4e8epayload\u4e2d\u7684\u5347\u7ea7\u6570\u636e\u662f\u8ddf\u6307\u4ee4\u4e00\u8d77\u751f\u6210\u7684, \u6240\u4ee5, \u5176\u6570\u636e\u7684\u504f\u79fb\u5b8c\u5168\u53ef\u4ee5\u8ddf\u6307\u4ee4\u7684\u987a\u5e8f\u4e00\u81f4, \u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u8bfb\u6307\u9488\u8df3\u52a8, \u4e5f\u5c31\u4e0d\u9700\u8981p2p\u652f\u6301.\n6. \u6267\u884c\u6307\u4ee4. \u57fa\u672c\u6307\u4ee4\u53ef\u4ee5\u67e5\u770b\u4ee3\u7801, \u4e0e\u5757\u5347\u7ea7\u6307\u4ee4\u4e00\u6837. \n\u4e0b\u9762\u662f\u5347\u7ea7\u65f6\u6570\u636e\u7684\u5408\u6210\u56fe.   \u8fd9\u5e45\u56fe\u5c55\u793a\u7684\u662f\u5347\u7ea7\u6570\u636e\u7684\u5408\u6210. \u5982\u679c\u662f\u5168\u91cf\u5347\u7ea7, source\u4e3a\u7a7a, \u5219payload\u76f4\u63a5\u5199\u5165target. \u4f46\u4e0e\u4e00\u822c\u5206\u533a\u70e7\u5199\u8fd8\u662f\u6709\u4e9b\u5dee\u5f02, \u5e76\u4e0d\u4f1a\u64e6\u9664target, \u800c\u662f\u6309\u7167\u504f\u79fb\u548c\u5927\u5c0f\u76f4\u63a5\u5199\u5165.\u800c\u5982\u679c\u662f\u589e\u91cf\u5347\u7ea7, \u5219\u662f\u57fa\u4e8e\u5f53\u524d\u8fd0\u884c\u7cfb\u7edf\u4e3asource, \u4e0epayload\u7684\u6570\u636e\u5408\u5e76\u5199\u5165target.  \u6240\u4ee5, \u4e0d\u7ba1\u662f\u5168\u91cf\u5347\u7ea7\u8fd8\u662f\u589e\u91cf\u5347\u7ea7, \u65ad\u7535\u540e\u90fd\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u518d\u5347\u7ea7.", 
            "title": "\u8fb9\u4e0b\u8fb9\u5347"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_7", 
            "text": "\u83b7\u53d6\u8f93\u5165\u6570\u636e. \u662f\u6307\u83b7\u53d6\u4ece download_action \u5b8c\u6210\u540e\u7684\u6570\u636e, \u5305\u542b\u88ab\u5347\u7ea7\u5206\u533a\u53ca\u5176\u54c8\u5e0c\u503c\u7b49.  \u5f00\u59cb\u6821\u9a8c\u88ab\u5347\u7ea7\u5206\u533a. \u5355\u7eaf\u4ece\u5206\u533a\u8bfb\u53d6\u5757\u6570\u636e\u5e76\u4e0epayload\u4e2d\u5b58\u653e\u7684\u8fdb\u884c\u6bd4\u5bf9\u6821\u9a8c.  \u5f00\u59cb\u6821\u9a8c\u5f53\u524dslot\u6e90\u5206\u533a. \u8fd9\u4e2a\u662f\u9488\u5bf9\u589e\u91cf\u5347\u7ea7\u7684. \u5728\u6821\u9a8c\u76ee\u6807\u5206\u533a\u5931\u8d25\u540e, \u6821\u9a8c\u6e90\u5206\u533a.\u6b64\u5904\u6821\u9a8c\u7684\u76ee\u7684\u4e0d\u662f\u5224\u65ad\u5f53\u524d\u8fd0\u884c\u7684\u5206\u533a\u662f\u5426\u5408\u6cd5(\u542f\u52a8\u65f6, \u7531\u5176\u4ed6\u6a21\u5757\u6821\u9a8c), \u800c\u662f\u5224\u65ad\u4e0b\u8f7d\u7684payload\u662f\u5426\u4e0e\u5f53\u524d\u7cfb\u7edf\u5339\u914d(\u670d\u52a1\u5668\u7aef\u653e\u9519\u5347\u7ea7\u6587\u4ef6).  \u6807\u8bb0\u4f20\u8f93\u5931\u8d25. \u8fd9\u91cc\u662f\u57283\u7684\u57fa\u7840\u4e0a, \u5c06\u5f53\u524dpayload\u7684\u4e0b\u8f7durl\u6807\u8bb0\u5931\u8d25, \u5e76\u589e\u52a0\u5931\u8d25\u6b21\u6570. \u5728\u8fbe\u5230\u4e00\u5b9a\u6b21\u6570\u540e(\u670d\u52a1\u7aef\u914d\u7f6e), \u4e0d\u518d\u4ece\u8be5url\u83b7\u53d6\u5347\u7ea7\u6570\u636e, \u8df3\u5f80\u4e0b\u4e00\u4e2aurl.", 
            "title": " \u6821\u9a8c "
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#post-install", 
            "text": "\u5404\u4e2a\u5206\u533a\u90fd\u53ef\u4ee5\u6307\u5b9apostinstall, \u800cpostinstall\u811a\u672c\u662f\u5728 download_action \u89e3\u6790mainifest\u65f6\u89e3\u6790\u5e76\u83b7\u5f97. \u5728\u5b9a\u4e49\u6267\u884cpostinstall\u4f46\u53c8\u65e0\u811a\u672c\u6307\u5b9a\u65f6, \u9ed8\u8ba4postinstall\u811a\u672c\u662f\u5206\u533a\u6839\u76ee\u5f55\u4e0b\u7684 postinst  \u5728Chrome OS\u4e2d, postinstall \u662f\u5141\u8bb8\u5bf9\u5206\u533a\u6267\u884c\u5757\u5199\u5165\u64cd\u4f5c\u7684,\u4f46\u662f\u5728Android, \u6302\u8f7d\u5206\u533a\u88ab\u6267\u884c\u6807\u8bb0\u4e3a\u53ea\u8bfb, \u5e76\u4e14\u4e5f\u6302\u8f7d\u6210\u53ea\u8bfb, \u4e5f\u5c31\u662f\u8bf4, \u4e0d\u5141\u8bb8\u5bf9\u88ab\u5347\u7ea7\u5206\u533a\u505a\u4fee\u6539(\u5c31\u7b97\u4fee\u6539\u4e86, \u4e4b\u540e\u6821\u9a8c\u4f9d\u7136\u53ef\u80fd\u51fa\u9519). postinstall\u7684\u811a\u672c\u662f\u76f4\u63a5\u57fa\u4e8e\u5f53\u524d\u88ab\u5347\u7ea7\u7cfb\u7edf\u6267\u884c, \u5e76\u672achroot, \u6240\u4ee5, postinstall\u811a\u672c\u5fc5\u987b\u80fd\u591f\u88ab\u4fdd\u8bc1\u8fd0\u884c\u5728\u88ab\u5347\u7ea7\u7cfb\u7edf\u4e2d. \u6240\u4ee5, \u4e00\u822c\u662f\u7eaf\u9759\u6001\u7684\u53ef\u6267\u884c\u7a0b\u5e8f, \u800c\u4e14\u5176\u529f\u80fd\u5728android\u4e0a\u4e5f\u88ab\u5f31\u5316\u4e86.", 
            "title": " post install "
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#odex", 
            "text": "\u5728\u4ee5\u4e0a\u5168\u90e8\u5b8c\u6210\u540e, \u7cfb\u7edf\u5c06\u6807\u8bb0slot\u4e3a\u88ab\u5347\u7ea7\u7cfb\u7edf, \u5e76\u5728\u4e0b\u6b21\u91cd\u542f\u540e, \u8fdb\u5165\u5347\u7ea7\u540e\u7684\u7cfb\u7edf, \u6821\u9a8c\u5e76\u4f18\u5316. \u8fd9\u65f6\u5019\u5982\u679c\u6821\u9a8c\u5931\u8d25, \u5219\u8fd8\u4f1a\u56de\u5230\u539f\u5148\u7cfb\u7edf. \u5219\u8be5\u60c5\u51b5\u5b58\u5728data\u4e0b\u5e94\u7528\u6570\u636e\u5df2\u7ecf\u88ab\u4f18\u5316\u4e3a\u65b0\u7248\u672c\u6216\u8005\u4f18\u5316\u5230\u4e00\u534a\u7684\u95ee\u9898. \u8ddf\u4e86\u4e0b\u76f8\u5173\u4ee3\u7801\u548c\u7f51\u4e0a\u7684\u8d44\u6599, \u7ed3\u8bba\u5982\u4e0b. \n\u5728A/B\u5347\u7ea7\u5b8c\u6210\u8fdb\u5165\u65b0\u7cfb\u7edf\u540e, dexopt\u7684\u53c2\u6570\u662fspeed-profile, \u800c\u8be5\u53c2\u6570\u7684\u542b\u4e49\u5c31\u662f\u6839\u636e\u201c\u70ed\u4ee3\u7801\u201d\u7684profile\u914d\u7f6e\u6765\u7f16\u8bd1. \u90a3\u4e48\u95ee\u9898\u5c31\u662f\u8fd9\u4e2aprofile\u7684\u751f\u6210,\u548c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u589e\u91cf\u7f16\u8bd1.   profile\u5728\u8fbe\u5230\u4e00\u5b9a\u6761\u4ef6\u540e\u5199\u5165/data/, \u76ee\u524d\u4ece\u4ee3\u7801\u770b, \u5df2\u77e5\u7684\u4e00\u4e2a\u6761\u4ef6\u662f\u5927\u5c0f 50K\u65f6, \u5199\u5165\u6587\u4ef6. \u800c\u5728\u5df2\u7ecf\u5b58\u5728\u8be5\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b, \u4f1a\u4f18\u5148\u52a0\u8f7d, \u5982\u679c\u52a0\u8f7d\u5931\u8d25, \u5219\u5220\u9664\u5e76\u91cd\u65b0\u751f\u6210.  \u6267\u884c\u589e\u91cf\u7f16\u8bd1\u7684\u65f6\u95f4\u662f, \u673a\u5728\u5145\u7535\uff0b\u7a7a\u95f2\uff0b\u56db\u4e2a\u5c0f\u65f6\u95f4\u9694\u7b49\u591a\u4e2a\u6761\u4ef6\u4e0b, \u5728\u540e\u53f0\u5b8c\u6210.   \u4e5f\u5c31\u662f\u8bf4, \u5728AB\u7cfb\u7edf\u5347\u7ea7\u5b8c\u6210\u65f6, \u4e0d\u4f1a\u6267\u884c\u7f16\u8bd1, \u53ea\u4f1a\u6267\u884cprofile\u7684\u751f\u6210. \u800c\u5728\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u88ab\u68c0\u6d4b\u5230\u7cfb\u7edf\u6821\u9a8c\u5931\u8d25, \u5219\u4f1a\u56de\u5230\u4e0a\u4e00\u7248\u672c\u7cfb\u7edf.", 
            "title": " odex\u4f18\u5316 "
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#bootloader", 
            "text": "\u4f20\u7edf\u7684Android\u4e0ebootloader\u901a\u4fe1\u662f\u901a\u8fc7misc\u5206\u533a. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u6570\u636e\u5e76\u4e0d\u662f\u5b58\u5728misc\u5206\u533a, \u800c\u4e14\u5b58\u653e\u4f4d\u7f6e\u7531\u5382\u5546\u5b9a\u4e49, \u63a5\u53e3\u5728 hardware/libhardware/include/hardware/boot_control.h . \u5176\u7ed3\u6784\u4f53\u662f  boot_control_module_t , \u5305\u542b\u4e86\u6240\u6709\u8bbe\u7f6e\u4ee5\u4e0aslot\u72b6\u6001\u7684\u63a5\u53e3.  \u4e0b\u9762\u4ecb\u7ecd\u4e0b\u4e0d\u540c\u5382\u5546 boot_control \u7684\u5b9e\u73b0.", 
            "title": "bootloader\u4ea4\u4e92"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#qcom", 
            "text": "\u4ee3\u7801\u4f4d\u7f6e:   hardware/qcom/bootctrl/boot_control.cpp \nqcom\u7684\u5b9e\u73b0\u662f, \u76f4\u63a5\u5c06A/B\u5206\u533a\u7684\u5c5e\u6027, \u5199\u5165\u7684gpt\u5206\u533a\u8868\u7684boot\u5206\u533a( boot_a \u548c boot_b ).qcom\u673a\u9876\u76d2gpt\u8868\u7684\u5206\u6790:http://blog.csdn.net/guyongqiangx/article/details/68924436   \n\u4e0a\u56fe\u662fqcom\u673a\u9876\u76d2gpt\u5206\u533a\u8868\u7684\u4fe1\u606f, \u5728Entry\u4e2d\u67e5\u627e\u5230\u5206\u533a boot_a \u548c boot_b , \u63d0\u53d6\u5176\u5c5e\u6027.\n\u4ece LAB 2 \u5f00\u59cb\u5b58\u653e\u7684\u662fGPT\u5206\u533a\u7684\u8be6\u7ec6\u4fe1\u606f Partition Entry , \u5355\u4e2a Partition Entry \u5360128\u4e2a\u5b57\u8282, \u4ece\u7b2c48\u4e2a\u5b57\u8282\u5f00\u59cb\u5b58\u653e\u7684\u662f\u5206\u533a\u5c5e\u6027, \u800cA/B\u7cfb\u7edf\u7684\u5206\u533a\u5c5e\u6027\u4e5f\u662f\u5b58\u653e\u5728\u8fd9\u4e2a\u4f4d\u7f6e.  \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230, qcom\u7684\u5b9e\u73b0, \u6ca1\u6709bootable\u7684\u6807\u8bb0\u4f4d, \u53d6\u800c\u4ee3\u4e4b\u7684\u662funbootable.", 
            "title": "qcom\u7684\u5b9e\u73b0"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#google", 
            "text": "\u4ee3\u7801\u4f4d\u7f6e system/extras/boot_control_copy/boot_control_copy.c  google\u7684\u53c2\u8003\u5b9e\u73b0\u590d\u7528\u4e86misc\u5206\u533a\u7684 bootloader_message (recovery\u4e0ebootloader\u901a\u4fe1\u7684\u5206\u533a). \u6574\u4e2amisc\u5206\u533a\u7684\u6570\u636e\u7ed3\u6784\u56fe\u5982\u4e0b.     fsmgr\u4f7f\u7528, \u5728\u8bbe\u7f6e\u6307\u5b9aslot\u4e3aactive\u65f6, \u540c\u65f6\u5c06\u5bf9\u5e94\u540e\u7f00\u8bbe\u7f6e\u5230\u8be5\u5b57\u6bb5. fsmgr\u5728\u6302\u8f7d\u5206\u533a\u65f6,\u901a\u8fc7\u8be5\u5b57\u6bb5\u62fc\u6210\u5b8c\u6210\u7684\u5206\u533a\u8def\u5f84.  Magic Numbe. \u7528\u6765\u786e\u5b9a\u8be5\u6570\u636e\u7aef\u7684\u5408\u6cd5, \u5fc5\u987b\u662f 'B', 'C' , 'c' (\" boot_control  copy\" \u7684\u7f29\u5199)  \u63a5\u53e3\u7248\u672c\u53f7  active\u72b6\u6001\u7684slot\u53f7, \u5728\u8be5\u5b9e\u73b0\u4e2d\u53ea\u6709 0 \u6216 1.  0 \u4e3a \u7b2c\u4e00\u4e2aslot, 1 \u4e3a\u7b2c\u4e8c\u4e2aslot, \u8bbe\u7f6eslot\u7684bootable/unbootable\u72b6\u6001.   \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa, \u5e76\u6ca1\u6709\u53ef\u4ee5\u6807\u8bb0\u4e3asuccessful\u7684\u4f4d, \u901a\u8fc7\u4ee3\u7801\u4e5f\u53d1\u73b0, \u5176\u5b9e\u73b0\u4e3a\u7a7a, \u4e5f\u5c31\u662f\u8bf4, \u5e76\u6ca1\u6709\u5b9e\u73b0\u8be5\u72b6\u6001.  \u5982\u679c\u6ce8\u610f\u5230\u4ee3\u7801, \u5728 module_setActiveBootSlot \u540e\u534a\u6bb5, \u4f1a\u5c06active\u72b6\u6001\u7684 boot_X \u5206\u533a\u5185\u5bb9\u62f7\u8d1d\u5230boot\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u7cfb\u7edf\u5b58\u5728\u4e09\u4e2a\u5206\u533a(boot,  boot_a ,  boot_b ), \u88ab\u8bbe\u7f6e\u4e3aactive\u7684\u5206\u533a\u4f1a\u88ab\u62f7\u8d1d\u5230boot\u5206\u533a, \u518d\u7ed3\u5408 module_getCurrentSlot \u7684\u5b9e\u73b0(\u4ece/system\u5206\u533a\u83b7\u53d6\u6302\u8f7d\u4fe1\u606f) ,\u4ece\u8fd9\u4e24\u6bb5\u4ee3\u7801\u53ef\u4ee5\u63a8\u6d4b\u51fa\u4e24\u4e2a\u7ed3\u8bba:   A/B\u7cfb\u7edf\u53ef\u4ee5\u4e0d\u5347\u7ea7firmware(bootloader), \u6216\u8005\u8bf4google\u7684\u8be5\u5b9e\u73b0\u6700\u521d\u662f\u4e3a\u4e86\u517c\u5bb9\u8001\u7684bootloader.  boot.img\u4e2d\u7684ramdisk\u53ef\u4ee5\u8fd8\u662fboot\u7684ramdisk.   \u4f46\u662f, \u4e0d\u786e\u5b9a\u53c2\u8003\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u8fd0\u884c. \u4f46\u662f\u5355\u7eaf\u4ece\u4ee5\u4e0a\u4ee3\u7801\u770b, \u9664\u4e86\u5206\u533a, A/B\u7cfb\u7edf\u7684\u542f\u52a8, \u6302\u8f7d, \u90fd\u53ef\u4ee5\u5728\u7528\u6237\u5c42\u641e\u5b9a. \u4f46\u662f\u5e26\u6765\u7684\u540e\u679c\u5c31\u662f, \u5982\u679cbootloader\u542f\u52a8boot\u5931\u8d25, \u5219\u65e0\u6cd5\u5207\u6362\u5230\u53e6\u4e00\u4e2aslot.", 
            "title": "google\u7684\u53c2\u8003\u5b9e\u73b0"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#_8", 
            "text": "\u5347\u7ea7\u5305\u5236\u4f5c\u5de5\u5177\u4e0d\u518d\u652f\u6301 \u57fa\u4e8e\u6587\u4ef6\u7684\u5347\u7ea7, \u5f53\u524d\u53ea\u652f\u6301ab\u5347\u7ea7\u548c\u5757\u5347\u7ea7.  \u5757\u5347\u7ea7\u548cab\u5347\u7ea7\u5728\u751f\u6210\u6570\u636e\u6587\u4ef6\u548c\u811a\u672c\u4e0a\u539f\u7406\u662f\u4e00\u6837\u7684, \u53ea\u662f\u5728\u751f\u6210\u5347\u7ea7\u6570\u636e\u65f6\u5b58\u5728\u5dee\u5f02.  AB\u5347\u7ea7payload\u5236\u4f5c\u903b\u8f91\u5728\u5347\u7ea7\u5305\u5236\u4f5c\u811a\u672c\u7684 WriteABOTAPackageWithBrilloScript , \u800c\u771f\u6b63payload\u751f\u6210\u7684\u903b\u8f91\u5728\u51fd\u6570 GenerateUpdatePayloadFile .  \u6d41\u7a0b\u5982\u4e0b:  \u751f\u6210payload\u6307\u4ee4\u89c4\u5219:", 
            "title": "\u5347\u7ea7\u5305\u751f\u6210"
        }, 
        {
            "location": "/2017-09-20-Android-AB-system-update/#ab_1", 
            "text": "", 
            "title": "AB\u5347\u7ea7\u603b\u6d41\u7a0b\u56fe"
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/", 
            "text": "\u6765\u6e90: https://pengzhangdev.github.io/android8-partiton-table/\n\n\n\u5dee\u5f02\u7b80\u8ff0 \n\n\n\u5728Android8.0\u4e4b\u540e, \u5c31\u5b58\u5728\u4e24\u5957\u5206\u533a\u8868, \u5206\u522b\u5bf9\u5e94\u7684\u662fA/B\u7cfb\u7edf\u548c\u975eA/B\u7cfb\u7edf.\n\n\n\n\n\u975eA/B\u7cfb\u7edf\u7684\u5206\u533a\u8868\u4e0e\u4e4b\u524d\u5206\u533a\u8868\u4e00\u6837, \u6ca1\u6709\u53d8\u5316.\n\n\nA/B\u7cfb\u7edf\u7684\u5206\u533a\u8868, \u662f\u672c\u6587\u7684\u4e3b\u8981\u63cf\u8ff0\u70b9.\n\n\n\n\n\u6240\u8c13\u7684A/B\u7cfb\u7edf, \u662f\u6307\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf, \u5176\u5206\u533a\u540d\u4e5f\u662f\u5b58\u5728\n_a\n \u548c \n_b\n \u7684\u533a\u522b.\u4e24\u5957\u7cfb\u7edf\u4e2d, \u53ea\u6709\u4e00\u5957\u4e3aactive, \u8fd0\u884c\u72b6\u6001, \u800c\u5347\u7ea7\u5219\u6267\u884c\u5728\u53e6\u4e00\u5957\u7cfb\u7edf\u7684\u5206\u533a\u4e2d. \u4ece\u800c\u8fbe\u5230, \u4e0d\u7ba1\u5347\u7ea7\u6210\u529f\u4e0e\u5426, \u603b\u6709\u4e00\u5957\u7cfb\u7edf\u4fdd\u8bc1\u80fd\u4f7f\u7528.\n\n\n\u800c\u5237\u673a, \u5305\u62ec\u6302\u65f6\u7684\u5206\u533a\u8868\u4e2d, \u90fd\u4e0d\u4f1a\u6dfb\u52a0\u540e\u7f00(\n_a\n\u6216\n_b\n). \u53ea\u6709\u5728fastboot\u5237\u673a\u65f6, \u6216\u8005\u5728init\u6302\u8f7d\u65f6, \u627e\u5230active\u7684slot, \u5728\u6307\u5b9a\u5206\u533a\u540d\u5b57\u540e\u9762\u6dfb\u52a0\u540e\u7f00\u5e76\u6302\u8f7d. \u6240\u4ee5, \u5355\u7eaf\u4ece\u6e90\u7801\u6216\u8005\u5237\u673a\u5305\u662f\u65e0\u6cd5\u6307\u5b9a\u54ea\u4e9b\u5206\u533a\u88ab\u6307\u5b9a\u4e3aA/B\u4e86.\n\n\n\nA/B\u7cfb\u7edf\u5e26\u6765\u7684\u597d\u5904\u662f:\n\n\n\n\n\u65e0\u7f1d\u5347\u7ea7, \u4e0d\u9700\u8981\u518d\u8fdb\u5165recovery\u8fdb\u884c\u5347\u7ea7.\n\n\n\u53cc\u7cfb\u7edf\u5907\u4efd, \u4e0d\u7ba1\u662f\u7cfb\u7edf\u5347\u7ea7\u5931\u8d25, \u8fd8\u662f\u88ab\u7834\u574f, \u90fd\u53ef\u4ee5\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u8bbe\u5907\u7684\u6b63\u5e38\u4f7f\u7528.\n\n\n\n\n\u5206\u533a\u8868\u4e0e\u5176\u5185\u5bb9\n\n\n\u4e0b\u9762\u4e3b\u8981\u9488\u5bf9pixel\u8bbe\u5907\u8fdb\u884c\u5206\u6790, \u4e5f\u5c31\u662fAndroid8\u7684\u6e90\u7801\u4e2dmarlin\u8bbe\u5907.\n\n\n\u5237\u673a\u6587\u4ef6\u548c\u5237\u673a\u65b9\u5f0f \n\n\n\u9996\u5148\u6211\u4eec\u770b\u4e0bandroid\u5b98\u7f51\u63d0\u4f9b\u7684marlin\u8bbe\u5907\u5237\u673a\u6587\u4ef6. \u4e0b\u9762\u662f\u57fa\u5e26\u548cbootloader\u7684\u5237\u673a\u6587\u4ef6.\n\n\n\n\n\nzip\u5305\u4e2d\u7684\u6587\u4ef6\u5982\u4e0b.\n\n\n\n\n\n\u5982\u679c\u5355\u7eaf\u6309\u7167\u4e4b\u524d\u5bf9\u8be5zip\u5305\u6587\u4ef6\u7684\u7406\u89e3, \u6587\u4ef6\u540d\u5b57\u5c31\u662f\u5bf9\u5e94\u7684\u5206\u533a\u540d. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u5374\u5e76\u4e0d\u662f\u5982\u6b64. \u800c\u662f\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u67e5\u627eA/B\u5206\u533a.\n\n\n\u9996\u5148, \u6700\u5148\u6ce8\u610f\u5230\u7684\u662f\u4e24\u4e2asystem\u5927\u5c0f\u4e0d\u4e00\u81f4, \u4f46\u662f\u8fd9\u4e2a\u5c55\u5f00\u6765\u8bb2\u6709\u70b9\u591a, \u6211\u4eec\u5148\u628aA/B\u7cfb\u7edf\u5237\u673a\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u4ecb\u7ecd\u4ee5\u4e0b, \u4ee3\u7801\u5728\u540e\u6587\u4ecb\u7ecd\u7b2c\u4e8c\u4e2a\u89c4\u5219\u65f6\u53ef\u4ee5\u540c\u65f6\u770b\u5230.\n\n\nA/B\u7cfb\u7edffastboot\u5237\u673a\u65f6, \u5982\u679c\u6ca1\u6709\u6307\u5b9aslot, \u5219\u9ed8\u8ba4\u5237\u5165\u7684\u662factive\u7684slot, \u6bd4\u5982\u5982\u679cbootloader\u6807\u8bb0\u4e3aslot A \u4e3aactive, \u5219\u6240\u6709\u5206\u533a\u9ed8\u8ba4\u5237\u5165slot A, \u4e5f\u5c31\u662f\u8bf4\nboot_a\n, \nsystem_a\n \u7b49. \u4f46\u662f, \u5982\u679cbootloader\u53cd\u9988\u67d0\u4e2a\u5206\u533a\u6ca1\u6709\u533a\u5206A/B, \u5219\u9ed8\u8ba4\u76f4\u63a5\u5237\u5165\u8be5\u5206\u533a. \u6bd4\u5982 vendor \u65e0\u533a\u5206A/B, \u5219\u76f4\u63a5\u5237\u5165vendor.\n\n\n\u7136\u540e, \u6211\u4eec\u5173\u6ce8\u4e0b\nsystem.img\n\u548c\nsystem_other.img\n, \u5982\u679c\u5355\u7eaf\u7406\u89e3\u4e3a\u8fd9\u4e24\u4e2aimage\u5206\u522b\u5237\u5165A/B\u5206\u533a, \u5219\u5927\u5c0f\u4e5f\u5b8c\u5168\u5bf9\u5e94\u4e0d\u4e0a. \u5927\u5c0f\u95ee\u9898, \u6211\u4eec\u7a0d\u540e\u518d\u770b, \u5148\u7814\u7a76\u4e0b\nsystem_other.img\n\u5237\u5165\u54ea\u4e2a\u5206\u533a.\n\n\nstatic struct {\n    char img_name[17];\n    char sig_name[17];\n    char part_name[9];\n    bool is_optional;\n    bool is_secondary;\n} images[] = {\n    {\nboot.img\n, \nboot.sig\n, \nboot\n, false, false},\n    {\nboot_other.img\n, \nboot.sig\n, \nboot\n, true, true},\n    {\nrecovery.img\n, \nrecovery.sig\n, \nrecovery\n, true, false},\n    {\nsystem.img\n, \nsystem.sig\n, \nsystem\n, false, false},\n    {\nsystem_other.img\n, \nsystem.sig\n, \nsystem\n, true, true},\n    {\nvendor.img\n, \nvendor.sig\n, \nvendor\n, true, false},\n    {\nvendor_other.img\n, \nvendor.sig\n, \nvendor\n, true, true},\n};\n\n\n\n\n\n\u5176\u4e2d \nis_secondary\n \u5982\u679c\u4e3atrue, \u5219\u610f\u5473\u7740\u8f93\u5165\u975eactive slot.\n\n\n    \nif\n \n(!\nskip_secondary\n)\n \n{\n         \n//\n \n\u9ed8\u8ba4\n \nfalse\n\n        \nif\n \n(slot_override\n \n!=\n \n)\n \n{\n  \n//\n \n\u5237\u673a\u65f6\n \n\u4e3a\n \n\n            \nsecondary\n \n=\n \nget_other_slot(transport,\n \nslot_override)\n;\n\n        \n}\n \nelse\n \n{\n\n            \nsecondary\n \n=\n \nget_other_slot(transport)\n;\n \n//\n \n\u83b7\u53d6\u975eactive\n \nslot\n\n        \n}\n\n        \nif\n \n(\nsecondary\n \n==\n \n)\n \n{\n\n            \nif\n \n(supports_AB(transport))\n \n{\n\n                \nfprintf(stderr,\n \nWarning\n:\n \nCould\n \nnot\n \ndetermine\n \nslot\n \nfor\n \nsecondary\n \nimages\n.\n \nIgnoring\n.\n\\\nn\n);\n\n\n            }\n\n\n            skip_secondary = true;\n\n\n        }\n\n\n    }\n\n\n    for (size_t i = 0; i \n arraysize(images); ++i) {\n\n\n        const char* slot = slot_override.c_str();\n\n\n        if (images\n[\ni\n]\n.is_secondary) {\n\n\n            if (!skip_secondary) {\n\n\n                slot = secondary.c_str(); //\u6307\u5b9a\u4e3a\u975eactive slot\n\n\n            } else {\n\n\n                continue;\n\n\n            }\n\n\n        }\n\n\n\n        int fd = unzip_to_file(zip, images\n[\ni\n]\n.img_name);\n\n\n        if (fd == -1) {\n\n\n            if (images\n[\ni\n]\n.is_optional) {\n\n\n                continue;\n\n\n            }\n\n\n            CloseArchive(zip);\n\n\n            exit(1); // unzip_to_file already explained why.\n\n\n        }\n\n\n        fastboot_buffer buf;\n\n\n        if (!load_buf_fd(transport, fd, \nbuf)) {\n\n\n            die(\ncannot\n \nload\n \n%\ns\n \nfrom\n \nflash\n:\n \n%\ns\n,\n \nimages\n[\ni\n]\n.\nimg_name\n,\n \nstrerror\n(\nerrno\n));\n\n        \n}\n\n\n        \nauto\n \nupdate\n \n=\n \n[\n]\n(\nconst\n \nstd\n::\nstring\n \npartition\n)\n \n{\n\n            \ndo_update_signature(zip,\n \nimages\n[\ni\n]\n.sig_name)\n;\n\n            \nif\n \n(erase_first\n \n \nneeds_erase(transport,\n \npartition.c_str()))\n \n{\n\n                \nfb_queue_erase(partition.c_str())\n;\n\n            \n}\n\n            \nflash_buf\n(\npartition\n.\nc_str\n(),\n \nbuf\n);\n\n            \n/* not closing the fd here since the sparse code keeps the fd around\n\n\n             * but hasn\nt mmaped data yet. The tmpfile will get cleaned up when the\n\n\n             * program exits.\n\n\n             */\n\n        \n}\n;\n\n        \ndo_for_partitions\n(\ntransport\n,\n \nimages\n[\ni\n]\n.\npart_name\n,\n \nslot\n,\n \nupdate\n,\n \nfalse\n);\n\n    \n}\n\n\n\n\n\n\n\u6240\u4ee5, \nsystem_other.img\n \u4f1a\u5237\u5165\u975eactive slot, \u5982\u679cactive\u4e3aa. \u5219\u5237\u5165\nsystem_b\n. \n\n\n\u5728\u786e\u5b9a\nsystem_other.img\n\u4f1a\u5237\u5165\u53e6\u4e00\u4e2aslot\u540e, \u6309\u7167\u7b2c\u4e00\u4e2a\u89c4\u5219(\u53ea\u5237active\u7684slot), \u5219\u53ef\u4ee5\u57fa\u672c\u731c\u6d4b, \nsystem_other.img\n\u4e2d\u7684\u5185\u5bb9\u4e0d\u662f\u7528\u4e8e\u542f\u52a8\u7cfb\u7edf\u7684, \u6216\u8005\u4e0d\u662f\u5b8c\u6574\u7cfb\u7edf.\n\n\n\n\n\u5bf9\u6bd4, \u5176\u5185\u5bb9\u5dee\u5f02, \nsystem_other.img\n \u4e2d, \u53ea\u6709 app \u548c \npriv-app\n\u76ee\u5f55.\nsystem_other.img\n\u7684\u76ee\u5f55\u4e2d\u53ea\u5b58\u5728odex\u548cvdex\u6587\u4ef6, \u4e5f\u5c31\u662fapp\u4f18\u5316\u8fc7\u7684\u6587\u4ef6, \u5e76\u4e14\u989d\u5916\u591a\u4e00\u4e2a\u6587\u4ef6\nsystem-other-odex-marker\n. \u8fd9\u4e2a\u6587\u4ef6\u662f\u4e2a\u7ebf\u7d22, \u6240\u4ee5, \u521d\u6b65\u53ef\u4ee5\u5224\u65ad, \u7cfb\u7edf\u542f\u52a8\u540e\u4e00\u5b9a\u4f1a\u4ece\nsystem_b\n\u5c06\u8fd9\u4e9b\u6570\u636e\u590d\u5236\u5230/data/\u4e0b.\n\n\n\u4e0b\u9762\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u6587\u4ef6\u7684\u4f5c\u7528\u548c\u5982\u4f55copy.\n\n\non property:sys.cppreopt=requested \n property:ro.boot.slot_suffix=_a\n    mount ext4 /dev/block/bootdevice/by-name/system_b /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished\n\non property:sys.cppreopt=requested \n property:ro.boot.slot_suffix=_b\n    mount ext4 /dev/block/bootdevice/by-name/system_a /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished\n\n\n\n\n\n\u5728\u542f\u52a8\u4e3a\u4efb\u4f55\u4e4b\u4e00\u65f6, \u4f1a\u4ece\u53e6\u4e00\u4e2aslot\u6302\u8f7d\u5230/postinstall, \u7136\u540e\u4f7f\u7528cppreopts.sh, \u5c06odexvdex\u6587\u4ef6\u62f7\u8d1d\u5230\n/data/\ndalvik-cache/\nisa\n/\nxiam, isa\u662f\u786c\u4ef6\u67b6\u6784(arm64/arm32).\n\u800c \npreloads_copy.sh\n \u4f1a\u5c06\nsystem_other\n\u4e2d\u7684preloads\u6587\u4ef6\u62f7\u8d1d\u5230/data/preloads/ \u76ee\u5f55\u4e0b.\n\n\n\u57fa\u4e8e\u4ee5\u4e0asystem\u7684\u673a\u5236, \u5728\u5237\u673a\u65f6, \u5b9e\u9645\u53ea\u5237\u5165\u4e00\u5957\u7cfb\u7edf\u5230active slot\u4e2d, \u7136\u540e\u4ece\u53e6\u4e00\u5957\u7cfb\u7edf\u4e2d\u7684system\u5206\u533a\u5c06\u4f18\u5316\u540e\u7684dex\u5305\u62f7\u8d1d\u5230data\u5206\u533a\u4e0b,. \u4e0e\u4e4b\u524d\u7684\u5dee\u5f02\u662f, \u8fde\u5e94\u7528\u7684\u7f16\u8bd1\u548c\u4f18\u5316\u90fd\u5728host\u7aef\u5b8c\u6210, android8\u7684\u542f\u52a8\u901f\u5ea6\u5c06\u975e\u5e38\u5feb.\n\n\n\u6e90\u7801\u548c\u5206\u533a\u5927\u5c0f \n\n\n\u4ecerecovery\u7684fstab\u4e2d,\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7684\u5206\u533a\u8868\u5982\u4e0b:\n\n\n/dev/block/platform/soc/624000.ufshc/by-name/system_a\n/dev/block/platform/soc/624000.ufshc/by-name/system_b\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_a\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_b\n/dev/block/platform/soc/624000.ufshc/by-name/userdata\n/dev/block/platform/soc/624000.ufshc/by-name/boot_a\n/dev/block/platform/soc/624000.ufshc/by-name/boot_b\n\n\n\n\n\n\u4f46\u4ee5\u4e0a\u5206\u533a\u8868\u5728\u4e3b\u7cfb\u7edf\u4e2d\u65e0\u6cd5\u770b\u5230, \u6216\u8005\u8bf4\u4e3b\u7cfb\u7edf\u4e2d\u53ea\u6709\u5728vendor\u4e0b\u5b58\u5728fstab, \u5176\u4ed6\u5730\u65b9\u5e76\u6ca1\u6709, \u800cvendor\u4e0b\u7684fstab\u5185\u5bb9\u5982\u4e0b, \u662f\u7531vendor\u5e95\u4e0b\u7684init.{device}.rc \u6302\u8f7d.\n\n\n/dev/block/platform/soc/624000.ufshc/by-name/system     /                   ext4    ro,barrier=1                wait,slotselect,verify\n/dev/block/platform/soc/624000.ufshc/by-name/modem      /firmware/radio     vfat    ro,shortname=lower,uid=1000,gid=0,dmask=227,fmask=337,context=u:object_r:firmware_file:s0   wait,slotselect\n/dev/block/platform/soc/624000.ufshc/by-name/userdata   /data               ext4    noatime,nosuid,nodev,barrier=1,noauto_da_alloc  latemount,wait,check,formattable,fileencryption=ice,quota\n/dev/block/zram0                                        none                swap    defaults                    zramsize=536870912,max_comp_streams=4\n/dev/block/platform/soc/624000.ufshc/by-name/misc       /misc               emmc    defaults                    defaults\n/devices/*/xhci-hcd.0.auto/usb*                         auto                vfat    defaults                    voldmanaged=usb:auto\n\n\n\n\n\n\u521d\u6b65\u5224\u65ad, \u5176\u6709\u7528\u7684\u5185\u5bb9\u662f\u7ed9vold\u7684\u6302\u8f7d\u4fe1\u606f\u548c\u57fa\u5e26\u5206\u533a. \u4f46\u4e0d\u7ba1\u600e\u4e48\u770b\u81f3\u5c11\u7f3a\u5c11\u4e86vendor\u6302\u8f7d\u7684\u4fe1\u606f. \u800c\u4e14fstab\u5728vendor\u5206\u533a\u4e0b, \u5219\u610f\u5473\u7740vendor\u7684\u6302\u8f7d\u5c06\u63d0\u524d\u5230\u548cboot\u540c\u4e2a\u7ea7\u522b. \u6ca1\u9519, \u65b0\u5f15\u5165\u4e86\u4e00\u4e2a\nearly-mounted\n, \u800c\u5206\u533a\u8868\u662f\u5728 device tree \u4e2d, \u4e5f\u5c31\u662f\u542f\u52a8\u540e, \u5728 \n/proc/device-tree/firmware/android/fstab/vendor\n. \n\u4e0a\u6587\u7684fstab\u8fd8\u7ed9\u6211\u4eec\u4e00\u4e2a\u4fe1\u606f, \u6807\u5fd7\u4f4d\nslotselect\n, \u610f\u5473\u8fd9system\u5206\u533a\u662f\u5206A/B\u7cfb\u7edf\u7684\u5e76\u4e14\u7531init\u6839\u636eactive\u7684slot\u9009\u62e9\u5bf9\u5e94\u7684\u771f\u5b9e\u5206\u533a\u8def\u5f84(\u540e\u7f00'_a'\u6216'_b')\u8fdb\u884c\u6302\u8f7d.\n\n\n\u6211\u4eec\u5728\u770b\u4e00\u773csystem\u5206\u533a, \u5176\u6302\u8f7d\u70b9\u662f / .  \u6ca1\u9519, \u5728Android8\u4e4b\u540e, system\u5206\u533a\u7684\u786e\u662f\u88ab\u6302\u8f7d\u5230 /, \u4e5f\u5c31\u662f\u8bf4, system\u5206\u533a\u5305\u542b\u4e86rootfs, \u5176\u5185\u5bb9\u5982\u4e0b.\n\n\ntotal 1724\ndrwxr-xr-x. 21 root    root       4096 Sep  8 18:30 .\ndrwxrwxrwx  25 werther werther   32768 Sep 19 13:15 ..\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 acct\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 bt_firmware\nlrw-r--r--.  1 root    root         50 Sep  8 18:30 bugreports -\n /data/user_de/0/com.android.shell/files/bugreports\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 cache -\n /data/cache\nlrw-r--r--.  1 root    root         13 Sep  8 18:30 charger -\n /sbin/charger\ndr-x------.  2 root    root       4096 Sep  8 15:49 config\nlrw-r--r--.  1 root    root         17 Sep  8 18:30 d -\n /sys/kernel/debug\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 data\nlrw-------.  1 root    root         23 Sep  8 18:30 default.prop -\n system/etc/prop.default\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 dev\nlrw-r--r--.  1 root    root         15 Sep  8 18:30 dsp -\n /vendor/lib/dsp\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 etc -\n /system/etc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:49 firmware\n-rwxr-x---.  1 root       2000 1559136 Sep  8 18:11 init\n-rwxr-x---.  1 root       2000     996 Sep  8 15:49 init.environ.rc\n-rwxr-x---.  1 root       2000   26830 Sep  8 15:49 init.rc\n-rwxr-x---.  1 root       2000     141 Sep  8 15:49 init.recovery.marlin.rc\n-rwxr-x---.  1 root       2000    7623 Sep  8 15:49 init.usb.configfs.rc\n-rwxr-x---.  1 root       2000    5715 Sep  8 15:49 init.usb.rc\n-rwxr-x---.  1 root       2000     497 Sep  8 15:49 init.zygote32.rc\n-rwxr-x---.  1 root       2000     847 Sep  8 15:49 init.zygote64_32.rc\ndrwx------.  2 root    root      16384 Sep  8 18:30 lost+found\ndrwxr-xr-x.  2 root    werther    4096 Sep  8 15:49 mnt\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 oem\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 persist\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 postinstall\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 proc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:48 res\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 root\ndrwxr-x---.  2 root       2000    4096 Sep  8 18:11 sbin\nlrw-r--r--.  1 root    root         21 Sep  8 18:30 sdcard -\n /storage/self/primary\ndrwxr-x--x.  2 root       1028    4096 Sep  8 15:49 storage\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 sys\ndrwxr-xr-x. 16 root    root       4096 Sep  8 18:30 system\n-rw-r--r--.  1 root    root       4849 Sep  8 15:49 ueventd.rc\ndrwxr-xr-x.  2 root       2000    4096 Sep  8 15:49 vendor\n-rw-r--r--.  1 root    root        524 Sep  8 15:50 verity_key\n\n\n\n\n\n\u90a3\u4e48, \u8fd9\u4e9b\u53d8\u5316\u662f\u5982\u4f55\u505a\u5230\u7684, \u5e76\u4e14, \u4e3a\u4ec0\u4e48system.img\u4e2d\u8981\u5305\u542brootfs? \u6211\u4eec\u5728\u540e\u6587\u4f1a\u63d0\u5230.\n\n\n\n\u6211\u4eec\u6765\u770b\u4e0bAndroid\u5b98\u65b9\u7f51\u7ad9\u7ed9\u51fa\u7684\u4ece\u666e\u901a\u5206\u533a\u5207\u6362\u5230A/B\u5206\u533a, \u5bf9\u4e8e\u5206\u533a\u5927\u5c0f\u7684\u5f71\u54cd.\n\n\n\n\n\n\n\n\nPixel Partitions Size\n\n\nA/B\n\n\nNon-A/B\n\n\n\n\n\n\n\n\n\n\nBootloader\n\n\n50*2\n\n\n50\n\n\n\n\n\n\nBoot\n\n\n32*2\n\n\n32\n\n\n\n\n\n\nRecovery\n\n\n0\n\n\n32\n\n\n\n\n\n\nCache\n\n\n0\n\n\n100\n\n\n\n\n\n\nRadio\n\n\n70*2\n\n\n70\n\n\n\n\n\n\nVendor\n\n\n300*2\n\n\n300\n\n\n\n\n\n\nSystem\n\n\n2048*2\n\n\n4096\n\n\n\n\n\n\nTotal\n\n\n5000\n\n\n4680\n\n\n\n\n\n\n\n\n\u4ece\u8fd9\u5f20\u8868\u4e0a,\u6211\u4eec\u770b\u5230pixel\u5206\u533a\u7684A/B\u7cfb\u7edf\u5305\u62ec bootloader, boot, radio, vendor, system.\n\n\n\u5206\u533a\u8868\u6539\u53d8\u5bf9\u7cfb\u7edf\u903b\u8f91\u7684\u5f71\u54cd\n\n\n\u8fd9\u91cc\u603b\u7ed3\u4e0b\u4ee5\u4e0a\u5206\u533a\u8868\u7684\u6539\u53d8:\n\n\n\n\n\u6ca1\u6709recovery\u5206\u533a\u548ccache\u5206\u533a.\n\n\nvendor\u5206\u533a\u63d0\u524d\u6302\u8f7d(\u4e0d\u662f\u5728fstab\u6587\u4ef6\u4e2d\u4e2d\u6302\u8f7d, \u5728 device tree\u4e2d\u6307\u5b9a)\n\n\n\u771f\u5b9e\u5206\u533a\u540d\u5b57\u5b58\u5728\n_a\n\u548c\n_b\n\u540e\u7f00.\n\n\n\n\n \u6302\u8f7d\u5206\u533a\u65b9\u5f0f\u6539\u53d8 \n\n\nearly-mounted\n\u4ee3\u7801\u89c1 \ninit_first_stage.cpp\n\n\u5728init\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6, \u4f1a\u8c03\u7528\nDoFirstStageMount\n, \u548c\u4e00\u4e9b\u73af\u5883\u7684\u914d\u7f6e. \u5b8c\u6210\u540e\u518d\u6b21\u8fd0\u884cinit, \u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\u7684\u6267\u884c. \u800c\u7b2c\u4e8c\u9636\u6bb5\u5b9e\u9645\u4e0a\u5c31\u662f\u8ddf\u4ee5\u524d\u7684Android\u5904\u7406\u65b9\u5f0f\u4e00\u6837.\n\n\n\u6302\u8f7d\u65f6\u9009\u62e9slot\u7684\u4ee3\u7801\u89c1init\u7684\nDoFirstStageMount\n\n\u5237\u673a\u65f6\u9009\u62e9slog\u7684\u4ee3\u7801\u89c1fastboot, \u4e5f\u53ef\u89c1\u4e0a\u9762\u8d34\u7684\u4ee3\u7801.\n\n\nboot\u5305\u542brecovery\u529f\u80fd\n\n\n\u9996\u5148, \u5347\u7ea7\u5207\u6362\u6210A/B\u65e0\u7f1d\u5347\u7ea7, \u5177\u4f53\u8bf4\u660e\u8bf7\u53c2\u8003recovery8\u7684\u6587\u6863.\n\u4f46\u662f, recovery\u7684\u529f\u80fd\u5e76\u4e0d\u6b62\u662f\u5347\u7ea7, \u8fd8\u5305\u62ec\u6062\u590d, \u5982\u5176\u540d\u5b57.\n\n\n\u4e3a\u4e86\u652f\u6301\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u529f\u80fd, recovery\u7684\u529f\u80fd\u88ab\u96c6\u6210\u5230\u4e86boot\u4e2d, bootloader\u5728\u8fdb\u5165recovery\u7684\u65f6\u5019, \u8fdb\u7684\u662fboot\u5206\u533a, \u4f46\u662f\u4f20\u7684\u53c2\u6570\u4e0d\u5305\u542b\nskip_initramfs\n. \n\u6b63\u5e38\u542f\u52a8\u5230android\u7cfb\u7edf\u65f6\u7684\u542f\u52a8\u53c2\u6570.\n\n\nskip_initramfs rootwait ro init=/init root=\n/dev/dm-0 dm=system none ro,0 1 android-verity \npublic-key-id\n \npath-to-system-partition\n\n\n\n\n\n\n\u8fd9\u91cc\u8bbe\u7f6e\u7684\nskip_initramfs\n, \u662f\u901a\u77e5\u5185\u6838, \u8df3\u8fc7boot\u4e2d\u7684ramdisk. \u8fd9\u4e2a\u53c2\u6570\u662fandroid\u6dfb\u52a0\u7684, \u6807\u51c6\u5185\u6838\u4e0d\u652f\u6301. \n\u7136\u540e\u6211\u4eec\u89e3\u6790\u4e0b\u5269\u4f59\u53c2\u6570, \u4e3b\u8981\u662froot\u53c2\u6570. \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230, root\u6307\u5b9a\u7684\u662fsystem\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u6839\u5206\u533a\u5c31\u662f\u4ee5system\u5206\u533a.\n\n\n\u7136\u540e\u6211\u4eec\u770b\u4e0b\u542f\u52a8recovery\u65f6\u7684\u53c2\u6570.\n\n\nrootwait init=/init ro\n\n\n\n\n\n\u8fd9\u91cc\u56e0\u4e3a\u6ca1\u6307\u5b9a\nskip_initramfs\n, \u6240\u4ee5, \u4f1a\u76f4\u63a5\u8bfb\u53d6boot\u5206\u533a\u4e2d\u7684ramdisk.\n\n\n\u8fdb\u4e00\u6b65\u7684\u7406\u89e3\u5c31\u662f, boot.img\u5305\u542b\u7684\u662f\u4ee5\u524drecovery\u7684\u5185\u5bb9, \u529f\u80fd\u53ea\u6709\u6062\u590d\u51fa\u5382\u8bbe\u7f6e. \u800c\u539f\u6765\u7684boot\u4e0esystem\u5408\u5e76\u4e3asystem.img.\n\n\n\u7f16\u8bd1\u53c2\u6570\u6539\u53d8\n\n\nhttps://source.android.com/devices/tech/ota/ab_implement\n\n\n\u5fc5\u987b\u5b9a\u4e49\u5b58\u6863\u53c2\u6570\u5982\u4e0b:\n\n\n    AB_OTA_UPDATER := true\n    AB_OTA_PARTITIONS := \\\n      boot \\\n      system \\\n      vendor\n    *and other partitions updated through update_engine (radio, bootloader, etc.)*\n    BOARD_BUILD_SYSTEM_ROOT_IMAGE := true\n    TARGET_NO_RECOVERY := true\n    BOARD_USES_RECOVERY_AS_BOOT := true\n    PRODUCT_PACKAGES += \\\n      update_engine \\\n      update_verifier\n\n*For an example, refer to /device/google/marlin/+/android-7.1.0_r1/device-common.mk. You can optionally conduct the post-install (but pre-reboot) dex2oat step described in Compiling. *\n\n\n\n\n\n\u5fc5\u987b\u4e0d\u5b9a\u4e49\u7684\u53c2\u6570\u5982\u4e0b:\n\n\n    BOARD_RECOVERYIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE", 
            "title": "Android8\u5206\u533a\u8868\u5206\u6790"
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_1", 
            "text": "\u5728Android8.0\u4e4b\u540e, \u5c31\u5b58\u5728\u4e24\u5957\u5206\u533a\u8868, \u5206\u522b\u5bf9\u5e94\u7684\u662fA/B\u7cfb\u7edf\u548c\u975eA/B\u7cfb\u7edf.   \u975eA/B\u7cfb\u7edf\u7684\u5206\u533a\u8868\u4e0e\u4e4b\u524d\u5206\u533a\u8868\u4e00\u6837, \u6ca1\u6709\u53d8\u5316.  A/B\u7cfb\u7edf\u7684\u5206\u533a\u8868, \u662f\u672c\u6587\u7684\u4e3b\u8981\u63cf\u8ff0\u70b9.   \u6240\u8c13\u7684A/B\u7cfb\u7edf, \u662f\u6307\u8bbe\u5907\u4e0a\u5b58\u5728\u4e24\u5957\u7cfb\u7edf, \u5176\u5206\u533a\u540d\u4e5f\u662f\u5b58\u5728 _a  \u548c  _b  \u7684\u533a\u522b.\u4e24\u5957\u7cfb\u7edf\u4e2d, \u53ea\u6709\u4e00\u5957\u4e3aactive, \u8fd0\u884c\u72b6\u6001, \u800c\u5347\u7ea7\u5219\u6267\u884c\u5728\u53e6\u4e00\u5957\u7cfb\u7edf\u7684\u5206\u533a\u4e2d. \u4ece\u800c\u8fbe\u5230, \u4e0d\u7ba1\u5347\u7ea7\u6210\u529f\u4e0e\u5426, \u603b\u6709\u4e00\u5957\u7cfb\u7edf\u4fdd\u8bc1\u80fd\u4f7f\u7528.  \u800c\u5237\u673a, \u5305\u62ec\u6302\u65f6\u7684\u5206\u533a\u8868\u4e2d, \u90fd\u4e0d\u4f1a\u6dfb\u52a0\u540e\u7f00( _a \u6216 _b ). \u53ea\u6709\u5728fastboot\u5237\u673a\u65f6, \u6216\u8005\u5728init\u6302\u8f7d\u65f6, \u627e\u5230active\u7684slot, \u5728\u6307\u5b9a\u5206\u533a\u540d\u5b57\u540e\u9762\u6dfb\u52a0\u540e\u7f00\u5e76\u6302\u8f7d. \u6240\u4ee5, \u5355\u7eaf\u4ece\u6e90\u7801\u6216\u8005\u5237\u673a\u5305\u662f\u65e0\u6cd5\u6307\u5b9a\u54ea\u4e9b\u5206\u533a\u88ab\u6307\u5b9a\u4e3aA/B\u4e86.  \nA/B\u7cfb\u7edf\u5e26\u6765\u7684\u597d\u5904\u662f:   \u65e0\u7f1d\u5347\u7ea7, \u4e0d\u9700\u8981\u518d\u8fdb\u5165recovery\u8fdb\u884c\u5347\u7ea7.  \u53cc\u7cfb\u7edf\u5907\u4efd, \u4e0d\u7ba1\u662f\u7cfb\u7edf\u5347\u7ea7\u5931\u8d25, \u8fd8\u662f\u88ab\u7834\u574f, \u90fd\u53ef\u4ee5\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7cfb\u7edf, \u786e\u4fdd\u7528\u6237\u8bbe\u5907\u7684\u6b63\u5e38\u4f7f\u7528.", 
            "title": "\u5dee\u5f02\u7b80\u8ff0 "
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_2", 
            "text": "\u4e0b\u9762\u4e3b\u8981\u9488\u5bf9pixel\u8bbe\u5907\u8fdb\u884c\u5206\u6790, \u4e5f\u5c31\u662fAndroid8\u7684\u6e90\u7801\u4e2dmarlin\u8bbe\u5907.", 
            "title": "\u5206\u533a\u8868\u4e0e\u5176\u5185\u5bb9"
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_3", 
            "text": "\u9996\u5148\u6211\u4eec\u770b\u4e0bandroid\u5b98\u7f51\u63d0\u4f9b\u7684marlin\u8bbe\u5907\u5237\u673a\u6587\u4ef6. \u4e0b\u9762\u662f\u57fa\u5e26\u548cbootloader\u7684\u5237\u673a\u6587\u4ef6.   \nzip\u5305\u4e2d\u7684\u6587\u4ef6\u5982\u4e0b.   \u5982\u679c\u5355\u7eaf\u6309\u7167\u4e4b\u524d\u5bf9\u8be5zip\u5305\u6587\u4ef6\u7684\u7406\u89e3, \u6587\u4ef6\u540d\u5b57\u5c31\u662f\u5bf9\u5e94\u7684\u5206\u533a\u540d. \u7136\u800c\u5728A/B\u7cfb\u7edf\u4e2d, \u5374\u5e76\u4e0d\u662f\u5982\u6b64. \u800c\u662f\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u67e5\u627eA/B\u5206\u533a.  \u9996\u5148, \u6700\u5148\u6ce8\u610f\u5230\u7684\u662f\u4e24\u4e2asystem\u5927\u5c0f\u4e0d\u4e00\u81f4, \u4f46\u662f\u8fd9\u4e2a\u5c55\u5f00\u6765\u8bb2\u6709\u70b9\u591a, \u6211\u4eec\u5148\u628aA/B\u7cfb\u7edf\u5237\u673a\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u4ecb\u7ecd\u4ee5\u4e0b, \u4ee3\u7801\u5728\u540e\u6587\u4ecb\u7ecd\u7b2c\u4e8c\u4e2a\u89c4\u5219\u65f6\u53ef\u4ee5\u540c\u65f6\u770b\u5230.  A/B\u7cfb\u7edffastboot\u5237\u673a\u65f6, \u5982\u679c\u6ca1\u6709\u6307\u5b9aslot, \u5219\u9ed8\u8ba4\u5237\u5165\u7684\u662factive\u7684slot, \u6bd4\u5982\u5982\u679cbootloader\u6807\u8bb0\u4e3aslot A \u4e3aactive, \u5219\u6240\u6709\u5206\u533a\u9ed8\u8ba4\u5237\u5165slot A, \u4e5f\u5c31\u662f\u8bf4 boot_a ,  system_a  \u7b49. \u4f46\u662f, \u5982\u679cbootloader\u53cd\u9988\u67d0\u4e2a\u5206\u533a\u6ca1\u6709\u533a\u5206A/B, \u5219\u9ed8\u8ba4\u76f4\u63a5\u5237\u5165\u8be5\u5206\u533a. \u6bd4\u5982 vendor \u65e0\u533a\u5206A/B, \u5219\u76f4\u63a5\u5237\u5165vendor.  \u7136\u540e, \u6211\u4eec\u5173\u6ce8\u4e0b system.img \u548c system_other.img , \u5982\u679c\u5355\u7eaf\u7406\u89e3\u4e3a\u8fd9\u4e24\u4e2aimage\u5206\u522b\u5237\u5165A/B\u5206\u533a, \u5219\u5927\u5c0f\u4e5f\u5b8c\u5168\u5bf9\u5e94\u4e0d\u4e0a. \u5927\u5c0f\u95ee\u9898, \u6211\u4eec\u7a0d\u540e\u518d\u770b, \u5148\u7814\u7a76\u4e0b system_other.img \u5237\u5165\u54ea\u4e2a\u5206\u533a.  static struct {\n    char img_name[17];\n    char sig_name[17];\n    char part_name[9];\n    bool is_optional;\n    bool is_secondary;\n} images[] = {\n    { boot.img ,  boot.sig ,  boot , false, false},\n    { boot_other.img ,  boot.sig ,  boot , true, true},\n    { recovery.img ,  recovery.sig ,  recovery , true, false},\n    { system.img ,  system.sig ,  system , false, false},\n    { system_other.img ,  system.sig ,  system , true, true},\n    { vendor.img ,  vendor.sig ,  vendor , true, false},\n    { vendor_other.img ,  vendor.sig ,  vendor , true, true},\n};  \u5176\u4e2d  is_secondary  \u5982\u679c\u4e3atrue, \u5219\u610f\u5473\u7740\u8f93\u5165\u975eactive slot.       if   (! skip_secondary )   {           //   \u9ed8\u8ba4   false \n         if   (slot_override   !=   )   {    //   \u5237\u673a\u65f6   \u4e3a   \n             secondary   =   get_other_slot(transport,   slot_override) ; \n         }   else   { \n             secondary   =   get_other_slot(transport) ;   //   \u83b7\u53d6\u975eactive   slot \n         } \n         if   ( secondary   ==   )   { \n             if   (supports_AB(transport))   { \n                 fprintf(stderr,   Warning :   Could   not   determine   slot   for   secondary   images .   Ignoring . \\ n );              }              skip_secondary = true;          }      }      for (size_t i = 0; i   arraysize(images); ++i) {          const char* slot = slot_override.c_str();          if (images [ i ] .is_secondary) {              if (!skip_secondary) {                  slot = secondary.c_str(); //\u6307\u5b9a\u4e3a\u975eactive slot              } else {                  continue;              }          }          int fd = unzip_to_file(zip, images [ i ] .img_name);          if (fd == -1) {              if (images [ i ] .is_optional) {                  continue;              }              CloseArchive(zip);              exit(1); // unzip_to_file already explained why.          }          fastboot_buffer buf;          if (!load_buf_fd(transport, fd,  buf)) {              die( cannot   load   % s   from   flash :   % s ,   images [ i ] . img_name ,   strerror ( errno )); \n         } \n\n         auto   update   =   [ ] ( const   std :: string   partition )   { \n             do_update_signature(zip,   images [ i ] .sig_name) ; \n             if   (erase_first     needs_erase(transport,   partition.c_str()))   { \n                 fb_queue_erase(partition.c_str()) ; \n             } \n             flash_buf ( partition . c_str (),   buf ); \n             /* not closing the fd here since the sparse code keeps the fd around               * but hasn t mmaped data yet. The tmpfile will get cleaned up when the               * program exits.               */ \n         } ; \n         do_for_partitions ( transport ,   images [ i ] . part_name ,   slot ,   update ,   false ); \n     }   \u6240\u4ee5,  system_other.img  \u4f1a\u5237\u5165\u975eactive slot, \u5982\u679cactive\u4e3aa. \u5219\u5237\u5165 system_b .   \u5728\u786e\u5b9a system_other.img \u4f1a\u5237\u5165\u53e6\u4e00\u4e2aslot\u540e, \u6309\u7167\u7b2c\u4e00\u4e2a\u89c4\u5219(\u53ea\u5237active\u7684slot), \u5219\u53ef\u4ee5\u57fa\u672c\u731c\u6d4b,  system_other.img \u4e2d\u7684\u5185\u5bb9\u4e0d\u662f\u7528\u4e8e\u542f\u52a8\u7cfb\u7edf\u7684, \u6216\u8005\u4e0d\u662f\u5b8c\u6574\u7cfb\u7edf.   \u5bf9\u6bd4, \u5176\u5185\u5bb9\u5dee\u5f02,  system_other.img  \u4e2d, \u53ea\u6709 app \u548c  priv-app \u76ee\u5f55. system_other.img \u7684\u76ee\u5f55\u4e2d\u53ea\u5b58\u5728odex\u548cvdex\u6587\u4ef6, \u4e5f\u5c31\u662fapp\u4f18\u5316\u8fc7\u7684\u6587\u4ef6, \u5e76\u4e14\u989d\u5916\u591a\u4e00\u4e2a\u6587\u4ef6 system-other-odex-marker . \u8fd9\u4e2a\u6587\u4ef6\u662f\u4e2a\u7ebf\u7d22, \u6240\u4ee5, \u521d\u6b65\u53ef\u4ee5\u5224\u65ad, \u7cfb\u7edf\u542f\u52a8\u540e\u4e00\u5b9a\u4f1a\u4ece system_b \u5c06\u8fd9\u4e9b\u6570\u636e\u590d\u5236\u5230/data/\u4e0b.  \u4e0b\u9762\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u6587\u4ef6\u7684\u4f5c\u7528\u548c\u5982\u4f55copy.  on property:sys.cppreopt=requested   property:ro.boot.slot_suffix=_a\n    mount ext4 /dev/block/bootdevice/by-name/system_b /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished\n\non property:sys.cppreopt=requested   property:ro.boot.slot_suffix=_b\n    mount ext4 /dev/block/bootdevice/by-name/system_a /postinstall ro nosuid nodev noexec\n    exec - root -- /system/bin/cppreopts.sh /postinstall\n    # Optional script to copy additional preloaded content to data directory\n    exec - system system -- /system/bin/preloads_copy.sh /postinstall\n    umount /postinstall\n    setprop sys.cppreopt finished  \u5728\u542f\u52a8\u4e3a\u4efb\u4f55\u4e4b\u4e00\u65f6, \u4f1a\u4ece\u53e6\u4e00\u4e2aslot\u6302\u8f7d\u5230/postinstall, \u7136\u540e\u4f7f\u7528cppreopts.sh, \u5c06odexvdex\u6587\u4ef6\u62f7\u8d1d\u5230 /data/\ndalvik-cache/ isa / xiam, isa\u662f\u786c\u4ef6\u67b6\u6784(arm64/arm32).\n\u800c  preloads_copy.sh  \u4f1a\u5c06 system_other \u4e2d\u7684preloads\u6587\u4ef6\u62f7\u8d1d\u5230/data/preloads/ \u76ee\u5f55\u4e0b.  \u57fa\u4e8e\u4ee5\u4e0asystem\u7684\u673a\u5236, \u5728\u5237\u673a\u65f6, \u5b9e\u9645\u53ea\u5237\u5165\u4e00\u5957\u7cfb\u7edf\u5230active slot\u4e2d, \u7136\u540e\u4ece\u53e6\u4e00\u5957\u7cfb\u7edf\u4e2d\u7684system\u5206\u533a\u5c06\u4f18\u5316\u540e\u7684dex\u5305\u62f7\u8d1d\u5230data\u5206\u533a\u4e0b,. \u4e0e\u4e4b\u524d\u7684\u5dee\u5f02\u662f, \u8fde\u5e94\u7528\u7684\u7f16\u8bd1\u548c\u4f18\u5316\u90fd\u5728host\u7aef\u5b8c\u6210, android8\u7684\u542f\u52a8\u901f\u5ea6\u5c06\u975e\u5e38\u5feb.", 
            "title": "\u5237\u673a\u6587\u4ef6\u548c\u5237\u673a\u65b9\u5f0f "
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_4", 
            "text": "\u4ecerecovery\u7684fstab\u4e2d,\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7684\u5206\u533a\u8868\u5982\u4e0b:  /dev/block/platform/soc/624000.ufshc/by-name/system_a\n/dev/block/platform/soc/624000.ufshc/by-name/system_b\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_a\n/dev/block/platform/soc/624000.ufshc/by-name/vendor_b\n/dev/block/platform/soc/624000.ufshc/by-name/userdata\n/dev/block/platform/soc/624000.ufshc/by-name/boot_a\n/dev/block/platform/soc/624000.ufshc/by-name/boot_b  \u4f46\u4ee5\u4e0a\u5206\u533a\u8868\u5728\u4e3b\u7cfb\u7edf\u4e2d\u65e0\u6cd5\u770b\u5230, \u6216\u8005\u8bf4\u4e3b\u7cfb\u7edf\u4e2d\u53ea\u6709\u5728vendor\u4e0b\u5b58\u5728fstab, \u5176\u4ed6\u5730\u65b9\u5e76\u6ca1\u6709, \u800cvendor\u4e0b\u7684fstab\u5185\u5bb9\u5982\u4e0b, \u662f\u7531vendor\u5e95\u4e0b\u7684init.{device}.rc \u6302\u8f7d.  /dev/block/platform/soc/624000.ufshc/by-name/system     /                   ext4    ro,barrier=1                wait,slotselect,verify\n/dev/block/platform/soc/624000.ufshc/by-name/modem      /firmware/radio     vfat    ro,shortname=lower,uid=1000,gid=0,dmask=227,fmask=337,context=u:object_r:firmware_file:s0   wait,slotselect\n/dev/block/platform/soc/624000.ufshc/by-name/userdata   /data               ext4    noatime,nosuid,nodev,barrier=1,noauto_da_alloc  latemount,wait,check,formattable,fileencryption=ice,quota\n/dev/block/zram0                                        none                swap    defaults                    zramsize=536870912,max_comp_streams=4\n/dev/block/platform/soc/624000.ufshc/by-name/misc       /misc               emmc    defaults                    defaults\n/devices/*/xhci-hcd.0.auto/usb*                         auto                vfat    defaults                    voldmanaged=usb:auto  \u521d\u6b65\u5224\u65ad, \u5176\u6709\u7528\u7684\u5185\u5bb9\u662f\u7ed9vold\u7684\u6302\u8f7d\u4fe1\u606f\u548c\u57fa\u5e26\u5206\u533a. \u4f46\u4e0d\u7ba1\u600e\u4e48\u770b\u81f3\u5c11\u7f3a\u5c11\u4e86vendor\u6302\u8f7d\u7684\u4fe1\u606f. \u800c\u4e14fstab\u5728vendor\u5206\u533a\u4e0b, \u5219\u610f\u5473\u7740vendor\u7684\u6302\u8f7d\u5c06\u63d0\u524d\u5230\u548cboot\u540c\u4e2a\u7ea7\u522b. \u6ca1\u9519, \u65b0\u5f15\u5165\u4e86\u4e00\u4e2a early-mounted , \u800c\u5206\u533a\u8868\u662f\u5728 device tree \u4e2d, \u4e5f\u5c31\u662f\u542f\u52a8\u540e, \u5728  /proc/device-tree/firmware/android/fstab/vendor . \n\u4e0a\u6587\u7684fstab\u8fd8\u7ed9\u6211\u4eec\u4e00\u4e2a\u4fe1\u606f, \u6807\u5fd7\u4f4d slotselect , \u610f\u5473\u8fd9system\u5206\u533a\u662f\u5206A/B\u7cfb\u7edf\u7684\u5e76\u4e14\u7531init\u6839\u636eactive\u7684slot\u9009\u62e9\u5bf9\u5e94\u7684\u771f\u5b9e\u5206\u533a\u8def\u5f84(\u540e\u7f00'_a'\u6216'_b')\u8fdb\u884c\u6302\u8f7d.  \u6211\u4eec\u5728\u770b\u4e00\u773csystem\u5206\u533a, \u5176\u6302\u8f7d\u70b9\u662f / .  \u6ca1\u9519, \u5728Android8\u4e4b\u540e, system\u5206\u533a\u7684\u786e\u662f\u88ab\u6302\u8f7d\u5230 /, \u4e5f\u5c31\u662f\u8bf4, system\u5206\u533a\u5305\u542b\u4e86rootfs, \u5176\u5185\u5bb9\u5982\u4e0b.  total 1724\ndrwxr-xr-x. 21 root    root       4096 Sep  8 18:30 .\ndrwxrwxrwx  25 werther werther   32768 Sep 19 13:15 ..\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 acct\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 bt_firmware\nlrw-r--r--.  1 root    root         50 Sep  8 18:30 bugreports -  /data/user_de/0/com.android.shell/files/bugreports\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 cache -  /data/cache\nlrw-r--r--.  1 root    root         13 Sep  8 18:30 charger -  /sbin/charger\ndr-x------.  2 root    root       4096 Sep  8 15:49 config\nlrw-r--r--.  1 root    root         17 Sep  8 18:30 d -  /sys/kernel/debug\ndrwxrwx--x.  2 werther werther    4096 Sep  8 15:49 data\nlrw-------.  1 root    root         23 Sep  8 18:30 default.prop -  system/etc/prop.default\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 dev\nlrw-r--r--.  1 root    root         15 Sep  8 18:30 dsp -  /vendor/lib/dsp\nlrw-r--r--.  1 root    root         11 Sep  8 18:30 etc -  /system/etc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:49 firmware\n-rwxr-x---.  1 root       2000 1559136 Sep  8 18:11 init\n-rwxr-x---.  1 root       2000     996 Sep  8 15:49 init.environ.rc\n-rwxr-x---.  1 root       2000   26830 Sep  8 15:49 init.rc\n-rwxr-x---.  1 root       2000     141 Sep  8 15:49 init.recovery.marlin.rc\n-rwxr-x---.  1 root       2000    7623 Sep  8 15:49 init.usb.configfs.rc\n-rwxr-x---.  1 root       2000    5715 Sep  8 15:49 init.usb.rc\n-rwxr-x---.  1 root       2000     497 Sep  8 15:49 init.zygote32.rc\n-rwxr-x---.  1 root       2000     847 Sep  8 15:49 init.zygote64_32.rc\ndrwx------.  2 root    root      16384 Sep  8 18:30 lost+found\ndrwxr-xr-x.  2 root    werther    4096 Sep  8 15:49 mnt\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 oem\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 persist\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 postinstall\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 proc\ndrwxr-xr-x.  3 root    root       4096 Sep  8 15:48 res\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 root\ndrwxr-x---.  2 root       2000    4096 Sep  8 18:11 sbin\nlrw-r--r--.  1 root    root         21 Sep  8 18:30 sdcard -  /storage/self/primary\ndrwxr-x--x.  2 root       1028    4096 Sep  8 15:49 storage\ndrwxr-xr-x.  2 root    root       4096 Sep  8 15:49 sys\ndrwxr-xr-x. 16 root    root       4096 Sep  8 18:30 system\n-rw-r--r--.  1 root    root       4849 Sep  8 15:49 ueventd.rc\ndrwxr-xr-x.  2 root       2000    4096 Sep  8 15:49 vendor\n-rw-r--r--.  1 root    root        524 Sep  8 15:50 verity_key  \u90a3\u4e48, \u8fd9\u4e9b\u53d8\u5316\u662f\u5982\u4f55\u505a\u5230\u7684, \u5e76\u4e14, \u4e3a\u4ec0\u4e48system.img\u4e2d\u8981\u5305\u542brootfs? \u6211\u4eec\u5728\u540e\u6587\u4f1a\u63d0\u5230.  \n\u6211\u4eec\u6765\u770b\u4e0bAndroid\u5b98\u65b9\u7f51\u7ad9\u7ed9\u51fa\u7684\u4ece\u666e\u901a\u5206\u533a\u5207\u6362\u5230A/B\u5206\u533a, \u5bf9\u4e8e\u5206\u533a\u5927\u5c0f\u7684\u5f71\u54cd.     Pixel Partitions Size  A/B  Non-A/B      Bootloader  50*2  50    Boot  32*2  32    Recovery  0  32    Cache  0  100    Radio  70*2  70    Vendor  300*2  300    System  2048*2  4096    Total  5000  4680     \u4ece\u8fd9\u5f20\u8868\u4e0a,\u6211\u4eec\u770b\u5230pixel\u5206\u533a\u7684A/B\u7cfb\u7edf\u5305\u62ec bootloader, boot, radio, vendor, system.", 
            "title": "\u6e90\u7801\u548c\u5206\u533a\u5927\u5c0f "
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_5", 
            "text": "\u8fd9\u91cc\u603b\u7ed3\u4e0b\u4ee5\u4e0a\u5206\u533a\u8868\u7684\u6539\u53d8:   \u6ca1\u6709recovery\u5206\u533a\u548ccache\u5206\u533a.  vendor\u5206\u533a\u63d0\u524d\u6302\u8f7d(\u4e0d\u662f\u5728fstab\u6587\u4ef6\u4e2d\u4e2d\u6302\u8f7d, \u5728 device tree\u4e2d\u6307\u5b9a)  \u771f\u5b9e\u5206\u533a\u540d\u5b57\u5b58\u5728 _a \u548c _b \u540e\u7f00.", 
            "title": "\u5206\u533a\u8868\u6539\u53d8\u5bf9\u7cfb\u7edf\u903b\u8f91\u7684\u5f71\u54cd"
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_6", 
            "text": "early-mounted \u4ee3\u7801\u89c1  init_first_stage.cpp \n\u5728init\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6, \u4f1a\u8c03\u7528 DoFirstStageMount , \u548c\u4e00\u4e9b\u73af\u5883\u7684\u914d\u7f6e. \u5b8c\u6210\u540e\u518d\u6b21\u8fd0\u884cinit, \u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\u7684\u6267\u884c. \u800c\u7b2c\u4e8c\u9636\u6bb5\u5b9e\u9645\u4e0a\u5c31\u662f\u8ddf\u4ee5\u524d\u7684Android\u5904\u7406\u65b9\u5f0f\u4e00\u6837.  \u6302\u8f7d\u65f6\u9009\u62e9slot\u7684\u4ee3\u7801\u89c1init\u7684 DoFirstStageMount \n\u5237\u673a\u65f6\u9009\u62e9slog\u7684\u4ee3\u7801\u89c1fastboot, \u4e5f\u53ef\u89c1\u4e0a\u9762\u8d34\u7684\u4ee3\u7801.", 
            "title": " \u6302\u8f7d\u5206\u533a\u65b9\u5f0f\u6539\u53d8 "
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#bootrecovery", 
            "text": "\u9996\u5148, \u5347\u7ea7\u5207\u6362\u6210A/B\u65e0\u7f1d\u5347\u7ea7, \u5177\u4f53\u8bf4\u660e\u8bf7\u53c2\u8003recovery8\u7684\u6587\u6863.\n\u4f46\u662f, recovery\u7684\u529f\u80fd\u5e76\u4e0d\u6b62\u662f\u5347\u7ea7, \u8fd8\u5305\u62ec\u6062\u590d, \u5982\u5176\u540d\u5b57.  \u4e3a\u4e86\u652f\u6301\u6062\u590d\u51fa\u5382\u8bbe\u7f6e\u7684\u529f\u80fd, recovery\u7684\u529f\u80fd\u88ab\u96c6\u6210\u5230\u4e86boot\u4e2d, bootloader\u5728\u8fdb\u5165recovery\u7684\u65f6\u5019, \u8fdb\u7684\u662fboot\u5206\u533a, \u4f46\u662f\u4f20\u7684\u53c2\u6570\u4e0d\u5305\u542b skip_initramfs . \n\u6b63\u5e38\u542f\u52a8\u5230android\u7cfb\u7edf\u65f6\u7684\u542f\u52a8\u53c2\u6570.  skip_initramfs rootwait ro init=/init root= /dev/dm-0 dm=system none ro,0 1 android-verity  public-key-id   path-to-system-partition   \u8fd9\u91cc\u8bbe\u7f6e\u7684 skip_initramfs , \u662f\u901a\u77e5\u5185\u6838, \u8df3\u8fc7boot\u4e2d\u7684ramdisk. \u8fd9\u4e2a\u53c2\u6570\u662fandroid\u6dfb\u52a0\u7684, \u6807\u51c6\u5185\u6838\u4e0d\u652f\u6301. \n\u7136\u540e\u6211\u4eec\u89e3\u6790\u4e0b\u5269\u4f59\u53c2\u6570, \u4e3b\u8981\u662froot\u53c2\u6570. \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230, root\u6307\u5b9a\u7684\u662fsystem\u5206\u533a. \u4e5f\u5c31\u662f\u8bf4, \u6839\u5206\u533a\u5c31\u662f\u4ee5system\u5206\u533a. \n\u7136\u540e\u6211\u4eec\u770b\u4e0b\u542f\u52a8recovery\u65f6\u7684\u53c2\u6570.  rootwait init=/init ro  \u8fd9\u91cc\u56e0\u4e3a\u6ca1\u6307\u5b9a skip_initramfs , \u6240\u4ee5, \u4f1a\u76f4\u63a5\u8bfb\u53d6boot\u5206\u533a\u4e2d\u7684ramdisk.  \u8fdb\u4e00\u6b65\u7684\u7406\u89e3\u5c31\u662f, boot.img\u5305\u542b\u7684\u662f\u4ee5\u524drecovery\u7684\u5185\u5bb9, \u529f\u80fd\u53ea\u6709\u6062\u590d\u51fa\u5382\u8bbe\u7f6e. \u800c\u539f\u6765\u7684boot\u4e0esystem\u5408\u5e76\u4e3asystem.img.", 
            "title": "boot\u5305\u542brecovery\u529f\u80fd"
        }, 
        {
            "location": "/2017-09-19-android8-partiton-table/#_7", 
            "text": "https://source.android.com/devices/tech/ota/ab_implement  \u5fc5\u987b\u5b9a\u4e49\u5b58\u6863\u53c2\u6570\u5982\u4e0b:      AB_OTA_UPDATER := true\n    AB_OTA_PARTITIONS := \\\n      boot \\\n      system \\\n      vendor\n    *and other partitions updated through update_engine (radio, bootloader, etc.)*\n    BOARD_BUILD_SYSTEM_ROOT_IMAGE := true\n    TARGET_NO_RECOVERY := true\n    BOARD_USES_RECOVERY_AS_BOOT := true\n    PRODUCT_PACKAGES += \\\n      update_engine \\\n      update_verifier\n\n*For an example, refer to /device/google/marlin/+/android-7.1.0_r1/device-common.mk. You can optionally conduct the post-install (but pre-reboot) dex2oat step described in Compiling. *  \u5fc5\u987b\u4e0d\u5b9a\u4e49\u7684\u53c2\u6570\u5982\u4e0b:      BOARD_RECOVERYIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_PARTITION_SIZE\n    BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE", 
            "title": "\u7f16\u8bd1\u53c2\u6570\u6539\u53d8"
        }, 
        {
            "location": "/2017-08-22-zram/", 
            "text": "\u6765\u6e90: https://pengzhangdev.github.io/zram/\n\n\n\u7b80\u4ecb\n\n\n\u5728linux\u5185\u6838\u7684mm\u5b50\u7cfb\u7edf\u4e2d, \u5305\u542b\u4e09\u4e2a\u652f\u6301\u5185\u5b58\u538b\u7f29\u7684\u7ec4\u4ef6, \u5206\u522b\u662fzram, zcache \u548c zswap.\n\n\n\nzswap\n: \u524d\u63d0\u6761\u4ef6\u662f, \u7cfb\u7edf\u4e2d\u5b58\u5728swap\u8bbe\u5907, \u5185\u6838\u7248\u672c\n3.5, \u56e0\u4e3a\u4f9d\u8d56\u4e86frontswap\u7684\u63a5\u53e3, \u7528\u4e8e\u7ba1\u7406swap page.\nzswap\u662f\u4e00\u4e2a\u8f7b\u91cf\u5316\u7684\u540e\u7aef\u67b6\u6784, \u5c06\u8fdb\u7a0b\u5404\u79cd\u4ea4\u6362\u51fa\u7684\u9875\u9762\u8fdb\u884c\u538b\u7f29, \u5e76\u5b58\u50a8\u5728\u4e00\u4e2a\u57fa\u4e8eRAM\u7684\u5185\u7f13\u51b2\u6c60\u4e2d. \u7f13\u51b2\u6c60\u4e0d\u9884\u5206\u914d, \u6709\u6700\u5927\u503c, \u4e14\u5f53\u7f13\u51b2\u6c60\u6ee1\u4e86, LRU\u7684\u5185\u5b58\u9875\u4f1a\u88ab\u5199\u5165swap\u8bbe\u5907. \u4f9d\u8d56swap\u5206\u533a, \u4e0d\u9002\u7528hdtv.\n\n\n\nzcache\n: \u4e0ezswap\u7c7b\u4f3c, \u4f9d\u8d56frontswap\u63a5\u53e3\u548ccleacache\u63a5\u53e3, \u5185\u6838\u7248\u672c\n3.5. \u4e0ezswap\u4e00\u6837, \u5c06\u8fdb\u7a0b\u4ea4\u6362\u51fa\u7684\u9875\u9762\u548c\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u51b2\u8fdb\u884c\u538b\u7f29\u5e76\u5b58\u50a8\u5728RAM\u7684\u5185\u5b58\u7f13\u51b2\u6c60\u4e2d, \u5728\u7f13\u51b2\u6c60\u6ee1\u540e, \u5c06\u9875\u9762\u5b58\u5165swap\u5206\u533a\u6216\u8005 RAMster (\u4e00\u79cd\u57fa\u4e8e\u7f51\u7edc\u7684\u5185\u5b58\u6c60\u5171\u4eab\u6280\u672f, \u53ef\u4ee5\u5171\u4eab\u7f51\u7edc\u4e2d\u5176\u4f59\u786c\u4ef6\u7684\u5185\u5b58). zswap\u53ef\u4ee5\u7406\u89e3\u4e3a\u662fzcache\u7684\u5b50\u96c6. \u4e0d\u9002\u7528hdtv.\n\n\n\nzram\n: \u5185\u5b58\u4e2d\u7684swap\u8bbe\u5907, \u5185\u6838\n3.14, \u53ef\u4ee5\u7406\u89e3\u4e3azcache\u7684RAM\u7f13\u51b2\u6c60. \u4f18\u5148\u7ea7\u6700\u9ad8, \u4e0d\u5efa\u8bae\u4e0e\u5176\u4ed6swap\u4e00\u8d77\u4f7f\u7528.\u4e0d\u4f9d\u8d56\u771f\u5b9e\u7684swap\u8bbe\u5907(Nand\u6216\u8005\u7f51\u7edc), \u503e\u5411\u4e8e\u5728\u4f4e\u5185\u5b58\u7684\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e2d\u4f7f\u7528.\n\n\n\n\u7efc\u4e0a, zram\u66f4\u9002\u5408hdtv\u8fd9\u4e2a\u9879\u76ee\n\n\n zram \n\n\nzram\u662f\u5c06\u7cfb\u7edf\u4e2d\u7684\u5185\u5b58\u7684\u4e00\u90e8\u5206\u5185\u5b58\u9694\u79bb\u6210zram\u8bbe\u5907(swap\u8bbe\u5907),\u5bf9\u4e8e\u5c0f\u5185\u5b58\u7684\u8bbe\u5907, \u5728\u4f7f\u7528\u4e0a\u4f1a\u611f\u5185\u5b58\u88ab\u6269\u5927\u4e86.\n\n\nlinux\u5185\u6838\u4e2d\u4e3azram\u63d0\u4f9b\u4e86\u5404\u79cd\u538b\u7f29\u7b97\u6cd5, \u9ed8\u8ba4\u7684\u662fLZO, \u8be5\u7b97\u6cd5\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u80fd\u5f88\u597d\u5730\u5e73\u8861\u538b\u7f29\u7387\u548c\u901f\u5ea6. LZO\u4e3b\u8981\u662f\u5728\u901f\u5ea6\u4e0a\u4f18\u5316.\u5728\u4e00\u4e9b\u6bd4\u8f83\u6b63\u5f0f\u7684\u6587\u6863\u4e0a, LZO\u7684\u538b\u7f29\u7387\u5e73\u5747\u4e3a50%. \u4e0b\u9762\u662f\u9488\u5bf9\u5185\u6838\u6e90\u7801(50.6M)\u538b\u7f29\u7684\u4e00\u4e2a\u56fe\u8868, \u7f51\u4e0a\u63d0\u4f9b\u7684.\n\n\nlzop\n:\n \n1.62\n \nseconds\n \nto\n \ncompress\n,\n \n18.0\n \nMB\n,\n \nratio\n=.\n355\n\n\ngzip\n:\n \n19.13\n \nseconds\n,\n \n10.8\n \nMB\n,\n \nratio\n=.\n213\n\n\nbzip2\n:\n \n60.81\n \nseconds\n,\n \n8.46\n \nMB\n,\n \nratio\n=.\n176\n\n\nxz\n:\n \n311.65\n \nseconds\n,\n \n7.33\n \nMB\n,\n \nratio\n=.\n145\n\n\n\n\n\n\n\n\n\u538b\u7f29\u7387\u8ba1\u7b97:\n\u76f8\u5173\u6570\u636e/sys/block/zram0/{\nmem_used_total\n,\norig_data_size\n,\ncompr_data_size\n}\n\n\ncompression radio = orig_data_size / compr_data_size\nreal compr. ratio  = orig_data_size / mem_used_total\n\n\n\n\n\n\n\n\u4f18\u70b9\n\n\n\n\n\u5185\u5b58\u6269\u5927, \u5e73\u5747\u538b\u7f29\u6bd4\u4e3a2.0\n\n\n\u7531\u4e8e\u5728\u5b9e\u73b0\u4e0a, \u5982\u679c\u67d0\u4e2aPAGE\u7684\u538b\u7f29\u7387\u5927\u4e8ePAGE_SIZE * 4 / 3 (kernel 3.10), \u5219\u4e0d\u8fdb\u884c\u538b\u7f29, \u5728\u8bfb\u53d6\u65f6, \u4e5f\u5c31\u7701\u4e0b\u89e3\u538b\u7684\u6d88\u8017. \u4ece\u800c\u63d0\u9ad8\u901f\u5ea6,\u964d\u4f4eCPU\u5360\u7528,\u4f46\u662f\u4f1a\u964d\u4f4e\u538b\u7f29\u7387.\n\n\n\n\n\u7f3a\u70b9\n\n\n\n\nCPU\u5360\u7528\n\n\n\u529f\u8017\u589e\u52a0\n\n\n\u7531\u4e8e\u5360\u7528\u4e00\u90e8\u5206\u5185\u5b58\u4f5c\u4e3azram\u8bbe\u5907, \u5219\u5982\u679czram\u538b\u7f29\u901f\u5ea6\u4e0d\u591f\u5feb, \u53cd\u800c\u66f4\u5bb9\u6613\u5f15\u53d1OOM.(github\u4e0a\u7684\u4e00\u4e2a\u60c5\u51b5, \u65e0\u6570\u636e\u4fe1\u606f, \u5728ZX2000\u4e0a\u672a\u51fa\u73b0\u8be5\u60c5\u51b5)\n\n\n\n\n\u8c03\u6574\u65b9\u6cd5\n\n\nCPU\u5360\u7528\u67e5\u770bkswapd(kswap)\n\n\nCPU\u5360\u7528\u8c03\u6574:\n\n\n\n\n/sys/block/zram0/max_comp_streams \u8bbe\u7f6e\u538b\u7f29\u6d41\u4e2a\u6570. \u9ed8\u8ba4\u4e3a\u6bcf\u4e2aCPU\u5206\u914d1\u4e2a.\n\n\n/sys/block/zram0/comp_algorithm  \u5207\u6362\u538b\u7f29\u7b97\u6cd5, \u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684LZO, \u901f\u5ea6\u5feb\n\n\n\n\n\n\n\u6d4b\u8bd5\n\n\n\n\n\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728\nZX2000\n\u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e\n\n\n\u538b\u7f29\u7387\u76f8\u5173\u7684\u4e09\u4e2a\u503c\u5206\u522b\u4e3a\n\n\n# busybox free                               \n             total       used       free     shared    buffers     cached\nMem:        427400     365136      62264        408        348      72148\n-/+ buffers/cache:     292640     134760\nSwap:       204796     103784     101012\n\n\norig_data_size:\u300090275840\nmem_used_total:  25862144\ncompr_data_size: 21846958\nzero_pages:      1903\n\n\n\n\n\n\n\u538b\u7f29\u7387\u4e3a\uff1a\n\n\ncompression radio(orig_data_size / compr_data_size) = 90275840 / 21846958 = 4.13\nreal compr. ratio (orig_data_size / mem_used_total) = 90275840 / 25862144 = 3.49\n\n\n\n\n\ncpu \u5360\u7528\u6570\u636e\uff1a\n\n\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   5% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n5%\u662f\u5728\u542f\u52a8\u65b0Activity\u7684\u65f6\u5019, \u521d\u6b65\u7ed3\u8bba\u662f, CPU\u5360\u7528\u4e0d\u9ad8.\n\n\n\n\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728\nZX1800\n\u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e\n\n\n\n# ./busybox free                                  \n             total       used       free     shared    buffers     cached\nMem:        427396     422720       4676       1688          0      42412\n-/+ buffers/cache:     380308      47088\nSwap:       204796     112748      92048\n\norig_data_size:  106278912\nmem_used_total:  25624576\ncompr_data_size: 23845230\nzero_pages:      3273\n\n\n\n\n\n\n\u538b\u7f29\u7387\u4e3a\uff1a\n\n\ncompression radio(orig_data_size / compr_data_size) = 106278912 / 23845230 = 4.45\nreal compr. ratio (orig_data_size / mem_used_total) = 106278912 / 25624576 = 4.14\n\n\n\n\n\ncpu \u5360\u7528\u6570\u636e\uff1a\n\n\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   4% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n\n\n\u5185\u5b58\u7533\u8bf7\u6d4b\u8bd5\n\n\n\u4ee5\u4e0b\u662f\u5728\nzx2000\n\u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.\n\n\n\n\u5728\u7cfb\u7edf\u505c\u7559\u5728\u4e3b\u754c\u9762\u540e, \u5c0f\u7a97\u53e3\u64ad\u53f0, \u5728\u5185\u5b58\u7533\u8bf7\u4f7f\u7528\u4e86167M\u540e, \u89e6\u53d1OOM.\nCPU\u5360\u7528\u5982\u4e0b, \u89e6\u53d1OOM\u65f6, CPU\u5360\u7528\u8fbe\u52308%\n\n\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n\u5185\u5b58\u5360\u7528\u5982\u4e0b:\n\n\n# busybox free     #\u5f00\u59cb\u65f6\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     423752       3648       2224       2540     105892\n-/+ buffers/cache:     315320     112080\nSwap:       204796          0     204796\n\n# busybox free     # OOM \u65f6\u5185\u5b58                              \n             total       used       free     shared    buffers     cached\nMem:        427400     422908       4492        292        200      11464\n-/+ buffers/cache:     411244      16156\nSwap:       204796     204796          0\n\n\n\n\n\nzram\u4fe1\u606f\u5982\u4e0b:\n\n\n# \u5f00\u59cb\u4f7f\u7528zram\u4e0d\u4e45\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 1175K\norig_data_size: 2232K\nmem_used_total: 2232K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n# \u4e00\u6bb5\u65f6\u95f4\u540e\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 3675K\norig_data_size: 11800K\nmem_used_total: 4648K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n==============================================\nstatus: enabled\ncompression: 3\ndisksize: 200M\ncompr_data_size: 15230K\norig_data_size: 55040K\nmem_used_total: 16624K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 44355K\norig_data_size: 120788K\nmem_used_total: 46196K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 137773K\norig_data_size: 200280K\nmem_used_total: 144096K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n\n\n\n\n\u53ef\u4ee5\u770b\u5230, \u538b\u7f29\u6bd4, \u4ece1 -\n 3 -\n\uff11, \u4e5f\u5c31\u662f\u8bf4\u5728swap\u7a7a\u6216\u8005\u5feb\u6ee1\u662f, \u538b\u7f29\u6bd4\u662f\u6700\u4f4e\u7684, \u4ece\u6700\u540e\u89e6\u53d1OOM\u770b, \u901a\u8fc7\u538b\u7f29\u8282\u7701\u7684\u5185\u5b58\u670960M\u5de6\u53f3. \u5e76\u4e14\u7531\u4e8e1M\u586b\u5145\u7684\u90fd\u662furandom\u8bbe\u5907\u7684\u5185\u5bb9, \u672c\u8eab\u5bfc\u81f4\u538b\u7f29\u6bd4\u6bd4\u6b63\u5e38\u4f7f\u7528\u65f6\u504f\u4f4e(\u51e0\u4e4e\u65e00\u9875, \u6570\u636e\u968f\u673a).\n\n\n\n\u5728\u4e0d\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b\uff0c\u3000\u5185\u5b58\u7533\u8bf7\u572895 M\u7684\u65f6\u5019\uff0c\u3000\u89e6\u53d1\u4e86OOM.\n\n\n # busybox free       # \u5f00\u59cb\u5185\u5b58\u7533\u8bf7\u65f6\u7684\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     422932       4468       2224       2524     103748\n-/+ buffers/cache:     316660     110740\nSwap:            0          0          0\n\n\n# busybox free       # OOM \u65f6\u7684\u5185\u5b58                                            \n             total       used       free     shared    buffers     cached\nMem:        427400     424052       3348       2224         36      16608\n-/+ buffers/cache:     407408      19992\nSwap:            0          0          0\n\n\n\n\n\n\n\n\n\n\u4ee5\u4e0b\u662f\u5728\nzx1800\n\u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.\n\n\n\u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u5185\u5b58\u8fbe\u5230166M\u65f6, \u89e6\u53d1OOM.\nCPU \u5360\u7528\n\n\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   1% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% R     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% R     1      0K      0K  fg root     kswapd0\n\n\n\n\n\n\u538b\u7f29\u6bd4\u7684\u6570\u636e\u4e0ezx2000 emmc\u76f8\u540c, \u7279\u522b\u662f\u5728zram\u5269\u4f59\u5927\u5c0f\u4e0d\u591a\u65f6, \u538b\u7f29\u6bd4\u5feb\u901f\u7f29\u5c0f\u52301.4(\u4ece3\u964d\u52301)\u5de6\u53f3.\n\u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.\n\n\n# ./busybox free           #\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u65f6                 \n             total       used       free     shared    buffers     cached\nMem:        427396     422192       5204       2224          4     109536\n-/+ buffers/cache:     312652     114744\nSwap:       204796          0     204796\n\n\n# ./busybox free        # OOM \u65f6\n             total       used       free     shared    buffers     cached\nMem:        427396     423280       4116        264          0      13268\n-/+ buffers/cache:     410012      17384\nSwap:       204796     204796          0\n\n\n\n\n\n\u5728\u4e0d\u5f00\u542fzram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u7684\u5185\u5b58\u8fbe\u523096M\u65f6\u89e6\u53d1OOM, \u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.\n\n\n# ./busybox free         # \u7cfb\u7edf\u542f\u52a8\u5b8c\u6210                      \n             total       used       free     shared    buffers     cached\nMem:        427396     411928      15468       2224          0     107552\n-/+ buffers/cache:     304376     123020\nSwap:            0          0          0\n\n\n# ./busybox free         # \u89e6\u53d1OOM                         \n             total       used       free     shared    buffers     cached\nMem:        427396     419892       7504       2224          0      15372\n-/+ buffers/cache:     404520      22876\nSwap:            0          0          0\n\n\n\n\n\n\u7efc\u4e0a, \u4e0ezx2000\u76f8\u540c, \u53ef\u7528\u5185\u5b58\u589e\u52a070M\u5de6\u53f3.\n\n\nOOM\u6d4b\u8bd5\n\n\n\u57fa\u4e8e\nzx2000\n 8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.\n\n\n\u6267\u884c\u64cd\u4f5c\u5982\u4e0b:\n\n\n\n\n\u91cd\u542f\u7cfb\u7edf.\n\n\n\u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.\n\n\n\u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.\n\n\n\n\n\u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u672a\u89e6\u53d1OOM.\n\n\n\n\n\n\u57fa\u4e8e\nzx1800\n 8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.\n\n\n\u6267\u884c\u64cd\u4f5c\u5982\u4e0b:\n\n\n\n\n\u91cd\u542f\u7cfb\u7edf.\n\n\n\u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.\n\n\n\u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.\n\n\n\n\n\u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u975e\u5e38\u5361, \u751a\u81f3\u9ed1\u5c4f\u51e0\u79d2\u949f.\n\u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u4e0d\u4f1a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u53ea\u6709\u7b2c\u4e00\u6b21\u5bfc\u89c6\u952e\u5361\u987f, \u4e4b\u540e\u90fd\u4e0d\u5361.\n\n\n \u5728Android\u542f\u7528\u65b9\u6cd5 \n\n\nhttps://source.android.com/devices/tech/perf/low-ram\n\n\n\u4e0a\u9762\u8fd9\u4e2a\u94fe\u63a5\u662fAndroid\u5b98\u7f51\u7ed9\u51fa\u6765\u7684\u5bf9\u4e8e\u4f4e\u5185\u5b58\u8bbe\u5907(512M)\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae(\u5185\u6838/\u7cfb\u7edf/\u5e94\u7528\u7b49), \u5176\u4e2d\u6709\u5728Android\u4e0a\u542f\u7528zram\u7684\u6574\u4e2a\u914d\u7f6e\u6d41\u7a0b.\n\n\n\u5728hisi\u63d0\u4f9b\u7684TVOS2.0\u4ee3\u7801\u4e2d, \u5df2\u7ecf\u5b9e\u73b0Android\u5b98\u65b9\u63d0\u4f9b\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae, \u8fdb\u884c\u4e86\u4f18\u5316, \u5176\u4e2d\u5305\u62eczram\u7684\u914d\u7f6e, \u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u4e5f\u4f7f\u7528.\n\n\n\u5b98\u65b9\u5efa\u8bae, \u4f7f\u7528\u603b\u5185\u5b58\u7684 30%-50% \u4f5c\u4e3azram, \u6309\u7167\u538b\u7f29\u7387\u4e3a50%\u8ba1\u7b97, \u5219\u5185\u5b58\u589e\u52a030%-50%\u5de6\u53f3.\n\n\nSwap to zRAM\n\n\nzRAM swap can increase the amount of memory available in the system by compressing memory pages and putting them in a dynamically allocated swap area of memory.\n\n\nAgain, since this is trading off CPU time for a small increase in memory, you should be careful about measuring the performance impact zRAM swap has on your system.\n\n\nAndroid handles swap to zRAM at several levels:\n\n\nFirst, the following kernel options must be enabled to use zRAM swap effectively:\n    CONFIG_SWAP\n    CONFIG_CGROUP_MEM_RES_CTLR\n    CONFIG_CGROUP_MEM_RES_CTLR_SWAP\n    CONFIG_ZRAM\nThen, you should add a line that looks like this to your fstab:\n\n/dev/block/zram0 none swap defaults zramsize=\nsize in bytes\n,swapprio=\nswap partition priority\n\n\n    zramsize is mandatory and indicates how much uncompressed memory you want the zram area to hold. Compression ratios in the 30-50% range are usually observed.\n    swapprio is optional and not needed if you don\nt have more than one swap area.\n\nYou should also be sure to label the associated block device as a swap_block_device in the device-specific sepolicy/file_contexts so that it is treated properly by SELinux.\n\n/dev/block/zram0 u:object_r:swap_block_device:s0\n\nBy default, the Linux kernel swaps in 8 pages of memory at a time. When using ZRAM, the incremental cost of reading 1 page at a time is negligible and may help in case the device is under extreme memory pressure. To read only 1 page at a time, add the following to your init.rc:\n\nwrite /proc/sys/vm/page-cluster 0\n\nIn your init.rc after the mount_all /fstab.X line, add:\n\nswapon_all /fstab.X\n\nThe memory cgroups are automatically configured at boot time if the feature is enabled in kernel.\nIf memory cgroups are available, the ActivityManager will mark lower priority threads as being more swappable than other threads. If memory is needed, the Android kernel will start migrating memory pages to zRAM swap, giving a higher priority to those memory pages that have been marked by ActivityManager.\n\n\n\n\n\n\n\n\n\n\n \u6210\u529f\u4f8b\u5b50 \n\n\n\n\nchrome os\n\n\ndebian/ubuntu\n\n\n\u7b2c\u4e09\u65b9Android ROM \u548c TV", 
            "title": "zram"
        }, 
        {
            "location": "/2017-08-22-zram/#_1", 
            "text": "\u5728linux\u5185\u6838\u7684mm\u5b50\u7cfb\u7edf\u4e2d, \u5305\u542b\u4e09\u4e2a\u652f\u6301\u5185\u5b58\u538b\u7f29\u7684\u7ec4\u4ef6, \u5206\u522b\u662fzram, zcache \u548c zswap.  zswap : \u524d\u63d0\u6761\u4ef6\u662f, \u7cfb\u7edf\u4e2d\u5b58\u5728swap\u8bbe\u5907, \u5185\u6838\u7248\u672c 3.5, \u56e0\u4e3a\u4f9d\u8d56\u4e86frontswap\u7684\u63a5\u53e3, \u7528\u4e8e\u7ba1\u7406swap page.\nzswap\u662f\u4e00\u4e2a\u8f7b\u91cf\u5316\u7684\u540e\u7aef\u67b6\u6784, \u5c06\u8fdb\u7a0b\u5404\u79cd\u4ea4\u6362\u51fa\u7684\u9875\u9762\u8fdb\u884c\u538b\u7f29, \u5e76\u5b58\u50a8\u5728\u4e00\u4e2a\u57fa\u4e8eRAM\u7684\u5185\u7f13\u51b2\u6c60\u4e2d. \u7f13\u51b2\u6c60\u4e0d\u9884\u5206\u914d, \u6709\u6700\u5927\u503c, \u4e14\u5f53\u7f13\u51b2\u6c60\u6ee1\u4e86, LRU\u7684\u5185\u5b58\u9875\u4f1a\u88ab\u5199\u5165swap\u8bbe\u5907. \u4f9d\u8d56swap\u5206\u533a, \u4e0d\u9002\u7528hdtv.  zcache : \u4e0ezswap\u7c7b\u4f3c, \u4f9d\u8d56frontswap\u63a5\u53e3\u548ccleacache\u63a5\u53e3, \u5185\u6838\u7248\u672c 3.5. \u4e0ezswap\u4e00\u6837, \u5c06\u8fdb\u7a0b\u4ea4\u6362\u51fa\u7684\u9875\u9762\u548c\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u51b2\u8fdb\u884c\u538b\u7f29\u5e76\u5b58\u50a8\u5728RAM\u7684\u5185\u5b58\u7f13\u51b2\u6c60\u4e2d, \u5728\u7f13\u51b2\u6c60\u6ee1\u540e, \u5c06\u9875\u9762\u5b58\u5165swap\u5206\u533a\u6216\u8005 RAMster (\u4e00\u79cd\u57fa\u4e8e\u7f51\u7edc\u7684\u5185\u5b58\u6c60\u5171\u4eab\u6280\u672f, \u53ef\u4ee5\u5171\u4eab\u7f51\u7edc\u4e2d\u5176\u4f59\u786c\u4ef6\u7684\u5185\u5b58). zswap\u53ef\u4ee5\u7406\u89e3\u4e3a\u662fzcache\u7684\u5b50\u96c6. \u4e0d\u9002\u7528hdtv.  zram : \u5185\u5b58\u4e2d\u7684swap\u8bbe\u5907, \u5185\u6838 3.14, \u53ef\u4ee5\u7406\u89e3\u4e3azcache\u7684RAM\u7f13\u51b2\u6c60. \u4f18\u5148\u7ea7\u6700\u9ad8, \u4e0d\u5efa\u8bae\u4e0e\u5176\u4ed6swap\u4e00\u8d77\u4f7f\u7528.\u4e0d\u4f9d\u8d56\u771f\u5b9e\u7684swap\u8bbe\u5907(Nand\u6216\u8005\u7f51\u7edc), \u503e\u5411\u4e8e\u5728\u4f4e\u5185\u5b58\u7684\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e2d\u4f7f\u7528.  \u7efc\u4e0a, zram\u66f4\u9002\u5408hdtv\u8fd9\u4e2a\u9879\u76ee", 
            "title": "\u7b80\u4ecb"
        }, 
        {
            "location": "/2017-08-22-zram/#zram", 
            "text": "zram\u662f\u5c06\u7cfb\u7edf\u4e2d\u7684\u5185\u5b58\u7684\u4e00\u90e8\u5206\u5185\u5b58\u9694\u79bb\u6210zram\u8bbe\u5907(swap\u8bbe\u5907),\u5bf9\u4e8e\u5c0f\u5185\u5b58\u7684\u8bbe\u5907, \u5728\u4f7f\u7528\u4e0a\u4f1a\u611f\u5185\u5b58\u88ab\u6269\u5927\u4e86.  linux\u5185\u6838\u4e2d\u4e3azram\u63d0\u4f9b\u4e86\u5404\u79cd\u538b\u7f29\u7b97\u6cd5, \u9ed8\u8ba4\u7684\u662fLZO, \u8be5\u7b97\u6cd5\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u80fd\u5f88\u597d\u5730\u5e73\u8861\u538b\u7f29\u7387\u548c\u901f\u5ea6. LZO\u4e3b\u8981\u662f\u5728\u901f\u5ea6\u4e0a\u4f18\u5316.\u5728\u4e00\u4e9b\u6bd4\u8f83\u6b63\u5f0f\u7684\u6587\u6863\u4e0a, LZO\u7684\u538b\u7f29\u7387\u5e73\u5747\u4e3a50%. \u4e0b\u9762\u662f\u9488\u5bf9\u5185\u6838\u6e90\u7801(50.6M)\u538b\u7f29\u7684\u4e00\u4e2a\u56fe\u8868, \u7f51\u4e0a\u63d0\u4f9b\u7684.  lzop :   1.62   seconds   to   compress ,   18.0   MB ,   ratio =. 355  gzip :   19.13   seconds ,   10.8   MB ,   ratio =. 213  bzip2 :   60.81   seconds ,   8.46   MB ,   ratio =. 176  xz :   311.65   seconds ,   7.33   MB ,   ratio =. 145    \u538b\u7f29\u7387\u8ba1\u7b97:\n\u76f8\u5173\u6570\u636e/sys/block/zram0/{ mem_used_total , orig_data_size , compr_data_size }  compression radio = orig_data_size / compr_data_size\nreal compr. ratio  = orig_data_size / mem_used_total", 
            "title": " zram "
        }, 
        {
            "location": "/2017-08-22-zram/#_2", 
            "text": "\u5185\u5b58\u6269\u5927, \u5e73\u5747\u538b\u7f29\u6bd4\u4e3a2.0  \u7531\u4e8e\u5728\u5b9e\u73b0\u4e0a, \u5982\u679c\u67d0\u4e2aPAGE\u7684\u538b\u7f29\u7387\u5927\u4e8ePAGE_SIZE * 4 / 3 (kernel 3.10), \u5219\u4e0d\u8fdb\u884c\u538b\u7f29, \u5728\u8bfb\u53d6\u65f6, \u4e5f\u5c31\u7701\u4e0b\u89e3\u538b\u7684\u6d88\u8017. \u4ece\u800c\u63d0\u9ad8\u901f\u5ea6,\u964d\u4f4eCPU\u5360\u7528,\u4f46\u662f\u4f1a\u964d\u4f4e\u538b\u7f29\u7387.", 
            "title": "\u4f18\u70b9"
        }, 
        {
            "location": "/2017-08-22-zram/#_3", 
            "text": "CPU\u5360\u7528  \u529f\u8017\u589e\u52a0  \u7531\u4e8e\u5360\u7528\u4e00\u90e8\u5206\u5185\u5b58\u4f5c\u4e3azram\u8bbe\u5907, \u5219\u5982\u679czram\u538b\u7f29\u901f\u5ea6\u4e0d\u591f\u5feb, \u53cd\u800c\u66f4\u5bb9\u6613\u5f15\u53d1OOM.(github\u4e0a\u7684\u4e00\u4e2a\u60c5\u51b5, \u65e0\u6570\u636e\u4fe1\u606f, \u5728ZX2000\u4e0a\u672a\u51fa\u73b0\u8be5\u60c5\u51b5)", 
            "title": "\u7f3a\u70b9"
        }, 
        {
            "location": "/2017-08-22-zram/#_4", 
            "text": "CPU\u5360\u7528\u67e5\u770bkswapd(kswap)  CPU\u5360\u7528\u8c03\u6574:   /sys/block/zram0/max_comp_streams \u8bbe\u7f6e\u538b\u7f29\u6d41\u4e2a\u6570. \u9ed8\u8ba4\u4e3a\u6bcf\u4e2aCPU\u5206\u914d1\u4e2a.  /sys/block/zram0/comp_algorithm  \u5207\u6362\u538b\u7f29\u7b97\u6cd5, \u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684LZO, \u901f\u5ea6\u5feb", 
            "title": "\u8c03\u6574\u65b9\u6cd5"
        }, 
        {
            "location": "/2017-08-22-zram/#_5", 
            "text": "\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728 ZX2000 \u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e \n\u538b\u7f29\u7387\u76f8\u5173\u7684\u4e09\u4e2a\u503c\u5206\u522b\u4e3a  # busybox free                               \n             total       used       free     shared    buffers     cached\nMem:        427400     365136      62264        408        348      72148\n-/+ buffers/cache:     292640     134760\nSwap:       204796     103784     101012\n\n\norig_data_size:\u300090275840\nmem_used_total:  25862144\ncompr_data_size: 21846958\nzero_pages:      1903  \n\u538b\u7f29\u7387\u4e3a\uff1a  compression radio(orig_data_size / compr_data_size) = 90275840 / 21846958 = 4.13\nreal compr. ratio (orig_data_size / mem_used_total) = 90275840 / 25862144 = 3.49  cpu \u5360\u7528\u6570\u636e\uff1a     44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   5% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0  5%\u662f\u5728\u542f\u52a8\u65b0Activity\u7684\u65f6\u5019, \u521d\u6b65\u7ed3\u8bba\u662f, CPU\u5360\u7528\u4e0d\u9ad8.  \n\u4ee5\u4e0b\u6570\u636e\u662f\u3000\u5728 ZX1800 \u4e0a, UI\u5207\u6362\u548c\u542f\u52a8\u65b0\u5e94\u7528\u6362, \u6293\u53d6\u7684\u6570\u636e\uff0e  # ./busybox free                                  \n             total       used       free     shared    buffers     cached\nMem:        427396     422720       4676       1688          0      42412\n-/+ buffers/cache:     380308      47088\nSwap:       204796     112748      92048\n\norig_data_size:  106278912\nmem_used_total:  25624576\ncompr_data_size: 23845230\nzero_pages:      3273  \n\u538b\u7f29\u7387\u4e3a\uff1a  compression radio(orig_data_size / compr_data_size) = 106278912 / 23845230 = 4.45\nreal compr. ratio (orig_data_size / mem_used_total) = 106278912 / 25624576 = 4.14  cpu \u5360\u7528\u6570\u636e\uff1a     44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  0   4% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   1% S     1      0K      0K  fg root     kswapd0", 
            "title": "\u6d4b\u8bd5"
        }, 
        {
            "location": "/2017-08-22-zram/#_6", 
            "text": "\u4ee5\u4e0b\u662f\u5728 zx2000 \u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.  \n\u5728\u7cfb\u7edf\u505c\u7559\u5728\u4e3b\u754c\u9762\u540e, \u5c0f\u7a97\u53e3\u64ad\u53f0, \u5728\u5185\u5b58\u7533\u8bf7\u4f7f\u7528\u4e86167M\u540e, \u89e6\u53d1OOM.\nCPU\u5360\u7528\u5982\u4e0b, \u89e6\u53d1OOM\u65f6, CPU\u5360\u7528\u8fbe\u52308%     44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0\n   44  1   8% S     1      0K      0K  fg root     kswapd0  \u5185\u5b58\u5360\u7528\u5982\u4e0b:  # busybox free     #\u5f00\u59cb\u65f6\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     423752       3648       2224       2540     105892\n-/+ buffers/cache:     315320     112080\nSwap:       204796          0     204796\n\n# busybox free     # OOM \u65f6\u5185\u5b58                              \n             total       used       free     shared    buffers     cached\nMem:        427400     422908       4492        292        200      11464\n-/+ buffers/cache:     411244      16156\nSwap:       204796     204796          0  zram\u4fe1\u606f\u5982\u4e0b:  # \u5f00\u59cb\u4f7f\u7528zram\u4e0d\u4e45\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 1175K\norig_data_size: 2232K\nmem_used_total: 2232K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n# \u4e00\u6bb5\u65f6\u95f4\u540e\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 3675K\norig_data_size: 11800K\nmem_used_total: 4648K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]\n\n==============================================\nstatus: enabled\ncompression: 3\ndisksize: 200M\ncompr_data_size: 15230K\norig_data_size: 55040K\nmem_used_total: 16624K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 2\ndisksize: 200M\ncompr_data_size: 44355K\norig_data_size: 120788K\nmem_used_total: 46196K\nmax_comp_streams: 1\ncomp_algorithm: [lzo] \n\n==============================================\nstatus: enabled\ncompression: 1\ndisksize: 200M\ncompr_data_size: 137773K\norig_data_size: 200280K\nmem_used_total: 144096K\nmax_comp_streams: 1\ncomp_algorithm: [lzo]  \u53ef\u4ee5\u770b\u5230, \u538b\u7f29\u6bd4, \u4ece1 -  3 - \uff11, \u4e5f\u5c31\u662f\u8bf4\u5728swap\u7a7a\u6216\u8005\u5feb\u6ee1\u662f, \u538b\u7f29\u6bd4\u662f\u6700\u4f4e\u7684, \u4ece\u6700\u540e\u89e6\u53d1OOM\u770b, \u901a\u8fc7\u538b\u7f29\u8282\u7701\u7684\u5185\u5b58\u670960M\u5de6\u53f3. \u5e76\u4e14\u7531\u4e8e1M\u586b\u5145\u7684\u90fd\u662furandom\u8bbe\u5907\u7684\u5185\u5bb9, \u672c\u8eab\u5bfc\u81f4\u538b\u7f29\u6bd4\u6bd4\u6b63\u5e38\u4f7f\u7528\u65f6\u504f\u4f4e(\u51e0\u4e4e\u65e00\u9875, \u6570\u636e\u968f\u673a).  \n\u5728\u4e0d\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b\uff0c\u3000\u5185\u5b58\u7533\u8bf7\u572895 M\u7684\u65f6\u5019\uff0c\u3000\u89e6\u53d1\u4e86OOM.   # busybox free       # \u5f00\u59cb\u5185\u5b58\u7533\u8bf7\u65f6\u7684\u5185\u5b58                                             \n             total       used       free     shared    buffers     cached\nMem:        427400     422932       4468       2224       2524     103748\n-/+ buffers/cache:     316660     110740\nSwap:            0          0          0\n\n\n# busybox free       # OOM \u65f6\u7684\u5185\u5b58                                            \n             total       used       free     shared    buffers     cached\nMem:        427400     424052       3348       2224         36      16608\n-/+ buffers/cache:     407408      19992\nSwap:            0          0          0    \u4ee5\u4e0b\u662f\u5728 zx1800 \u8bbe\u5907\u4e0a, \u901a\u8fc7\u6bcf\u79d2\u5206\u914d1M\u5185\u5b58\u7684\u65b9\u5f0f, \u5185\u5b58\u4e2d\u6570\u636e\u4e3aurandom\u8bbe\u5907\u6570\u636e, \u6d4b\u8bd5\u5b9e\u9645\u7533\u8bf7\u5185\u5b58\u589e\u52a0\u7684\u503c. \u7edf\u8ba1\u7684\u6570\u636e\u5982\u4e0b.  \u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u5185\u5b58\u8fbe\u5230166M\u65f6, \u89e6\u53d1OOM.\nCPU \u5360\u7528     44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   1% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% S     1      0K      0K  fg root     kswapd0\n   44  2   0% R     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  3   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  1   0% S     1      0K      0K  fg root     kswapd0\n   44  0   0% S     1      0K      0K  fg root     kswapd0\n   44  1   2% R     1      0K      0K  fg root     kswapd0  \u538b\u7f29\u6bd4\u7684\u6570\u636e\u4e0ezx2000 emmc\u76f8\u540c, \u7279\u522b\u662f\u5728zram\u5269\u4f59\u5927\u5c0f\u4e0d\u591a\u65f6, \u538b\u7f29\u6bd4\u5feb\u901f\u7f29\u5c0f\u52301.4(\u4ece3\u964d\u52301)\u5de6\u53f3.\n\u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.  # ./busybox free           #\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u65f6                 \n             total       used       free     shared    buffers     cached\nMem:        427396     422192       5204       2224          4     109536\n-/+ buffers/cache:     312652     114744\nSwap:       204796          0     204796\n\n\n# ./busybox free        # OOM \u65f6\n             total       used       free     shared    buffers     cached\nMem:        427396     423280       4116        264          0      13268\n-/+ buffers/cache:     410012      17384\nSwap:       204796     204796          0  \u5728\u4e0d\u5f00\u542fzram\u7684\u60c5\u51b5\u4e0b, \u7533\u8bf7\u7684\u5185\u5b58\u8fbe\u523096M\u65f6\u89e6\u53d1OOM, \u4ee5\u4e0b\u662ffree\u7684\u8f93\u51fa.  # ./busybox free         # \u7cfb\u7edf\u542f\u52a8\u5b8c\u6210                      \n             total       used       free     shared    buffers     cached\nMem:        427396     411928      15468       2224          0     107552\n-/+ buffers/cache:     304376     123020\nSwap:            0          0          0\n\n\n# ./busybox free         # \u89e6\u53d1OOM                         \n             total       used       free     shared    buffers     cached\nMem:        427396     419892       7504       2224          0      15372\n-/+ buffers/cache:     404520      22876\nSwap:            0          0          0  \u7efc\u4e0a, \u4e0ezx2000\u76f8\u540c, \u53ef\u7528\u5185\u5b58\u589e\u52a070M\u5de6\u53f3.", 
            "title": "\u5185\u5b58\u7533\u8bf7\u6d4b\u8bd5"
        }, 
        {
            "location": "/2017-08-22-zram/#oom", 
            "text": "\u57fa\u4e8e zx2000  8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.  \u6267\u884c\u64cd\u4f5c\u5982\u4e0b:   \u91cd\u542f\u7cfb\u7edf.  \u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.  \u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.   \u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u672a\u89e6\u53d1OOM.   \u57fa\u4e8e zx1800  8\u670818\u65e5\u7684autobuild\u7cfb\u7edf, \u5728\u5206\u522b\u4e0d\u542f\u7528\u548c\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6d4b\u8bd5\u5bf9OOM\u7684\u5f71\u54cd.  \u6267\u884c\u64cd\u4f5c\u5982\u4e0b:   \u91cd\u542f\u7cfb\u7edf.  \u901a\u8fc7UI\u754c\u9762\u5206\u522b\u542f\u52a8\u672c\u5730\u89c6\u9891, \u672c\u5730\u97f3\u4e50 \u548c\u672c\u5730\u56fe\u7247\u4e09\u4e2a\u5e94\u7528.  \u6309\u9065\u63a7\u5668\u9000\u51fa\u952e, \u56de\u5230\u7535\u89c6\u76f4\u64ad\u754c\u9762.   \u5728\u672a\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u5fc5\u5b9a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u975e\u5e38\u5361, \u751a\u81f3\u9ed1\u5c4f\u51e0\u79d2\u949f.\n\u5728\u542f\u7528zram\u7684\u60c5\u51b5\u4e0b, \u6267\u884c\u4ee5\u4e0a\u64cd\u4f5c, \u4e0d\u4f1a\u89e6\u53d1OOM. \u5e76\u4e14\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e4b\u540e, \u91cd\u590d\u6309\u5bfc\u89c6\u952e\u548c\u9000\u51fa\u952e, \u53ea\u6709\u7b2c\u4e00\u6b21\u5bfc\u89c6\u952e\u5361\u987f, \u4e4b\u540e\u90fd\u4e0d\u5361.", 
            "title": "OOM\u6d4b\u8bd5"
        }, 
        {
            "location": "/2017-08-22-zram/#android", 
            "text": "https://source.android.com/devices/tech/perf/low-ram \n\u4e0a\u9762\u8fd9\u4e2a\u94fe\u63a5\u662fAndroid\u5b98\u7f51\u7ed9\u51fa\u6765\u7684\u5bf9\u4e8e\u4f4e\u5185\u5b58\u8bbe\u5907(512M)\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae(\u5185\u6838/\u7cfb\u7edf/\u5e94\u7528\u7b49), \u5176\u4e2d\u6709\u5728Android\u4e0a\u542f\u7528zram\u7684\u6574\u4e2a\u914d\u7f6e\u6d41\u7a0b. \n\u5728hisi\u63d0\u4f9b\u7684TVOS2.0\u4ee3\u7801\u4e2d, \u5df2\u7ecf\u5b9e\u73b0Android\u5b98\u65b9\u63d0\u4f9b\u7684\u5185\u5b58\u4f18\u5316\u5efa\u8bae, \u8fdb\u884c\u4e86\u4f18\u5316, \u5176\u4e2d\u5305\u62eczram\u7684\u914d\u7f6e, \u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u4e5f\u4f7f\u7528. \n\u5b98\u65b9\u5efa\u8bae, \u4f7f\u7528\u603b\u5185\u5b58\u7684 30%-50% \u4f5c\u4e3azram, \u6309\u7167\u538b\u7f29\u7387\u4e3a50%\u8ba1\u7b97, \u5219\u5185\u5b58\u589e\u52a030%-50%\u5de6\u53f3. \nSwap to zRAM  zRAM swap can increase the amount of memory available in the system by compressing memory pages and putting them in a dynamically allocated swap area of memory.  Again, since this is trading off CPU time for a small increase in memory, you should be careful about measuring the performance impact zRAM swap has on your system.  Android handles swap to zRAM at several levels:  First, the following kernel options must be enabled to use zRAM swap effectively:\n    CONFIG_SWAP\n    CONFIG_CGROUP_MEM_RES_CTLR\n    CONFIG_CGROUP_MEM_RES_CTLR_SWAP\n    CONFIG_ZRAM\nThen, you should add a line that looks like this to your fstab:\n\n/dev/block/zram0 none swap defaults zramsize= size in bytes ,swapprio= swap partition priority \n\n    zramsize is mandatory and indicates how much uncompressed memory you want the zram area to hold. Compression ratios in the 30-50% range are usually observed.\n    swapprio is optional and not needed if you don t have more than one swap area.\n\nYou should also be sure to label the associated block device as a swap_block_device in the device-specific sepolicy/file_contexts so that it is treated properly by SELinux.\n\n/dev/block/zram0 u:object_r:swap_block_device:s0\n\nBy default, the Linux kernel swaps in 8 pages of memory at a time. When using ZRAM, the incremental cost of reading 1 page at a time is negligible and may help in case the device is under extreme memory pressure. To read only 1 page at a time, add the following to your init.rc:\n\nwrite /proc/sys/vm/page-cluster 0\n\nIn your init.rc after the mount_all /fstab.X line, add:\n\nswapon_all /fstab.X\n\nThe memory cgroups are automatically configured at boot time if the feature is enabled in kernel.\nIf memory cgroups are available, the ActivityManager will mark lower priority threads as being more swappable than other threads. If memory is needed, the Android kernel will start migrating memory pages to zRAM swap, giving a higher priority to those memory pages that have been marked by ActivityManager.", 
            "title": " \u5728Android\u542f\u7528\u65b9\u6cd5 "
        }, 
        {
            "location": "/2017-08-22-zram/#_7", 
            "text": "chrome os  debian/ubuntu  \u7b2c\u4e09\u65b9Android ROM \u548c TV", 
            "title": " \u6210\u529f\u4f8b\u5b50 "
        }
    ]
}